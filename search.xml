<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>esp32å­¦ä¹ ä¸å¼€å‘-å¢¨æ°´å±æ¡Œé¢å°å±å¹•</title>
      <link href="/2024/09/04/esp32-xue-xi-yu-kai-fa-mo-shui-ping-zhuo-mian-xiao-ping-mu/"/>
      <url>/2024/09/04/esp32-xue-xi-yu-kai-fa-mo-shui-ping-zhuo-mian-xiao-ping-mu/</url>
      
        <content type="html"><![CDATA[<h1 id="1ã€å­¦ä¹ "><a href="#1ã€å­¦ä¹ " class="headerlink" title="1ã€å­¦ä¹ "></a>1ã€å­¦ä¹ </h1><p><strong>å‚è€ƒ</strong>ï¼š<a href="https://www.bilibili.com/video/BV1wV4y1G7Vk?p=1&vd_source=c2fe15d5282e5de556b5fccfc70e9600">ã€æœ‰æ‰‹å°±è¡Œç³»åˆ—ã€‘åµŒå…¥å¼å•ç‰‡æœºæ•™ç¨‹-æ¡Œé¢å°å±å¹•å®æˆ˜æ•™å­¦ ä»è®¾è®¡ã€ç¡¬ä»¶ã€ç„Šæ¥åˆ°ä»£ç ç¼–å†™ã€è°ƒè¯• ESP32 æŒç»­æ›´æ–°2022</a></p><p>â€‹<a href="https://x509p6c8to.feishu.cn/docx/NQCTdjUFJoYoZ1xYHS9cIlbwnxh">å¯¹åº”åœ¨çº¿æ–‡æ¡£</a></p><p>â€‹<a href="https://docs.espressif.com/projects/arduino-esp32/en/latest/index.html">Welcome to ESP32 Arduino Coreâ€™s documentation - - â€” Arduino ESP32 latest documentation (espressif.com)</a></p><h2 id="1ã€éœ€æ±‚åˆ†æ"><a href="#1ã€éœ€æ±‚åˆ†æ" class="headerlink" title="1ã€éœ€æ±‚åˆ†æ"></a>1ã€éœ€æ±‚åˆ†æ</h2><p>â€‹éœ€æ±‚â€“&gt;éœ€æ±‚ç»†åŒ–â€“&gt;æµç¨‹åŒ–â€“&gt;å¤–è®¾æ–¹æ¡ˆåŒ–â€“&gt;è½¯ç¡¬ä»¶æ¥å£æ¢³ç†ï¼›</p><h2 id="2ã€-æ–¹æ¡ˆé€‰å‹"><a href="#2ã€-æ–¹æ¡ˆé€‰å‹" class="headerlink" title="2ã€ æ–¹æ¡ˆé€‰å‹"></a>2ã€ æ–¹æ¡ˆé€‰å‹</h2><p>â€‹å¤–è®¾é€‰å‹ï¼ˆå°è£…ã€é€šç”¨&#x2F;ç¨³å®šæ€§ã€ç”µæ± å®¹é‡&#x2F;å……ç”µç”µæµ&#x2F;ä¿æŠ¤ã€ä¸»æ§ä¸»é¢‘&#x2F;RAM&#x2F;ROM&#x2F;IOï¼‰;</p><p>â€‹<a href="https://www.bilibili.com/read/cv15539489/">ESP32é€‰å‹ä¸€æ–‡å°±å¤Ÿï¼ŒESP32-WROOM-32ã€ESP32-WROVERã€ESP32-Sè¡ç”Ÿæ¨¡ç»„ã€ESP32-PICOå·®å¼‚ - å“”å“©å“”å“© (bilibili.com)</a></p><h2 id="3ã€ç»˜åˆ¶PCB"><a href="#3ã€ç»˜åˆ¶PCB" class="headerlink" title="3ã€ç»˜åˆ¶PCB"></a>3ã€ç»˜åˆ¶PCB</h2><p><strong>å‚è€ƒ</strong>ï¼š<a href="https://blog.csdn.net/weixin_73588765/article/details/135441822">ESP32è‡ªåŠ¨ä¸‹è½½ç”µè·¯ç©¶ç«Ÿæ˜¯å¦‚ä½•å·§å¦™å®ç°çš„-CSDNåšå®¢</a>)</p><p>â€‹åŸç†å›¾â€“&gt;PCBï¼ˆlayoutè§„èŒƒã€ç»˜åˆ¶æ¿æ¡†å°ºå¯¸ã€å¸ƒå±€ã€èµ°çº¿è§„èŒƒã€è¿‡å­”&#x2F;æµ‹è¯•ç‚¹&#x2F;æ³ªæ»´&#x2F;ä¸å°ã€DRCæ£€æŸ¥ã€‚ï¼ˆPSï¼šCH340æ·»åŠ é˜²å€’çŒç”µè·¯ã€é¢„ç•™æµ‹è¯•&#x2F;ä¸‹è½½ç‚¹ã€ç”µæºçº¿è¦ç²—ç‚¹.ç«‹åˆ›EDAç»˜åˆ¶è‡ªå·±çš„å…ƒä»¶ï¼ˆæ— ç¬¦å·&#x2F;å°è£…ï¼‰ï¼šæ–°å»ºå…ƒä»¶åº“â€“&gt;æ–°å»ºç¬¦å·â€“æ–°å»ºå°è£…â€“&gt;å…³è”ç¬¦å·ä¸å°è£…ï¼‰;</p><h2 id="4ã€è®¾è®¡æ¢³ç†ï¼Œç»˜åˆ¶æµç¨‹å›¾"><a href="#4ã€è®¾è®¡æ¢³ç†ï¼Œç»˜åˆ¶æµç¨‹å›¾" class="headerlink" title="4ã€è®¾è®¡æ¢³ç†ï¼Œç»˜åˆ¶æµç¨‹å›¾"></a>4ã€è®¾è®¡æ¢³ç†ï¼Œç»˜åˆ¶æµç¨‹å›¾</h2><h2 id="5ã€-å¼€å‘ç¯å¢ƒæ­å»º"><a href="#5ã€-å¼€å‘ç¯å¢ƒæ­å»º" class="headerlink" title="5ã€ å¼€å‘ç¯å¢ƒæ­å»º"></a>5ã€ å¼€å‘ç¯å¢ƒæ­å»º</h2><h3 id="1ã€Linux"><a href="#1ã€Linux" class="headerlink" title="1ã€Linux:"></a>1ã€Linux:</h3><p><strong>æ–¹æ¡ˆ</strong>ï¼šè™šæ‹Ÿæœº(ubuntu2 + ssh+samba + vscode(windows) +esp32å¼€å‘ä¾èµ–ç¯å¢ƒï¼ˆESP-IDF v5.3ï¼‰ï¼›</p><p><strong>å‚è€ƒ</strong>ï¼š<a href="https://docs.espressif.com/projects/esp-idf/zh_CN/stable/esp32/get-started/linux-macos-setup.html">Linux å’Œ macOS å¹³å°å·¥å…·é“¾çš„æ ‡å‡†è®¾ç½® - ESP32 - â€” ESP-IDF ç¼–ç¨‹æŒ‡å— v5.3 æ–‡æ¡£ (espressif.com)</a></p><p>â€‹<a href="https://x509p6c8to.feishu.cn/docs/doccnk1gfc2Ddes4jzGDzm7L7tf">Embeded 2 ç¯å¢ƒæ­å»º - é£ä¹¦äº‘æ–‡æ¡£ (feishu.cn)</a></p><ol><li><p>å®‰è£…ç¼–è¯‘æ‰€éœ€è½¯ä»¶åŒ…ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install git wget flex bison gperf python3 python3-pip python3-venv cmake ninja-build ccache libffi-dev libssl-dev dfu-util libusb-1.0-0</span><br></pre></td></tr></table></figure></li><li><p>è·å–ESP-IDF:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p ~/esp</span><br><span class="line">cd ~/esp</span><br><span class="line">git clone -b v5.3 --recursive https://github.com/espressif/esp-idf.git</span><br></pre></td></tr></table></figure></li><li><p>è®¾ç½®å·¥å…·ï¼ˆç¼–è¯‘å™¨ã€è°ƒè¯•å™¨ã€PythonåŒ…ç­‰ï¼‰ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">ESP-IDF å·¥å…·å®‰è£…å™¨ä¼šä¸‹è½½ Github å‘å¸ƒç‰ˆæœ¬ä¸­é™„å¸¦çš„ä¸€äº›å·¥å…·ï¼Œå¦‚æœè®¿é—® Github è¾ƒä¸ºç¼“æ…¢ï¼Œå¯ä»¥è®¾ç½®ä¸€ä¸ªç¯å¢ƒå˜é‡ï¼Œä»è€Œä¼˜å…ˆé€‰æ‹© Espressif çš„ä¸‹è½½æœåŠ¡å™¨è¿›è¡Œ Github èµ„æºä¸‹è½½ã€‚</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">æ¨èå›½å†…ç”¨æˆ·ä½¿ç”¨å›½å†…çš„ä¸‹è½½æœåŠ¡å™¨ï¼Œä»¥åŠ å¿«ä¸‹è½½é€Ÿåº¦</span></span><br><span class="line">cd ~/esp/esp-idf</span><br><span class="line">export IDF_GITHUB_ASSETS=&quot;dl.espressif.cn/github_assets&quot;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">ä»…ä¸º ESP32 å®‰è£…æ‰€éœ€å·¥å…·</span></span><br><span class="line">./install.sh esp32</span><br></pre></td></tr></table></figure></li><li><p>è®¾ç½®ç¯å¢ƒå˜é‡ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">. $HOME/esp/esp-idf/export.sh</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">å¯ä¸ºæ‰§è¡Œ . <span class="variable">$HOME</span>/esp/esp-idf/export.shåˆ›å»ºä¸€ä¸ªåˆ«å</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">åœ¨.bashrcæ–‡ä»¶ä¸­æ·»åŠ </span></span><br><span class="line">alias get_idf=&#x27;. $HOME/esp/esp-idf/export.sh&#x27;</span><br></pre></td></tr></table></figure></li><li><p>å¼€å§‹ä½¿ç”¨ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">get_idf</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">å°† get-started/hello_world å·¥ç¨‹å¤åˆ¶è‡³æœ¬åœ°çš„ ~/esp ç›®å½•ä¸‹ï¼š</span></span><br><span class="line">cd ~/esp</span><br><span class="line">cp -r $IDF_PATH/examples/get-started/hello_world .</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">è¿›å…¥ hello_world ç›®å½•ï¼Œè®¾ç½® ESP32 ä¸ºç›®æ ‡èŠ¯ç‰‡ï¼Œç„¶åè¿è¡Œå·¥ç¨‹é…ç½®å·¥å…· menuconfig</span></span><br><span class="line">cd ~/esp/hello_world</span><br><span class="line">idf.py set-target esp32</span><br><span class="line">idf.py menuconfig</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">æ¸…æ¥šå…ˆå‰ç¼–è¯‘äº§ç”Ÿçš„æ–‡ä»¶ï¼ˆæ¶‰åŠåˆ†åŒºæ“ä½œæ—¶æœ€å¥½æ‰§è¡Œä¸€æ¬¡ï¼‰</span></span><br><span class="line">idf.py fullclean</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">ç¼–è¯‘</span></span><br><span class="line">idf.py build</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">çƒ§å½•&amp;ç›‘è§†è¾“å‡º</span></span><br><span class="line">idf.py -p /dev/ttyUSB0 -b 115200 flash moitor</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">é€€å‡ºESP-IDFç›‘è§†å™¨</span></span><br><span class="line">ctr+]</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">æ“¦é™¤æ•´ä¸ª flash</span></span><br><span class="line">idf.py -p PORT erase-flash</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">è‹¥å­˜åœ¨éœ€è¦æ“¦é™¤çš„ OTA æ•°æ®</span></span><br><span class="line">idf.py -p PORT erase-otadata</span><br></pre></td></tr></table></figure></li><li><p>(å¯é€‰)æ›´æ–°ESP-IDF:</p></li></ol><h3 id="2ã€windows"><a href="#2ã€windows" class="headerlink" title="2ã€windows:"></a>2ã€windows:</h3><h3 id="3ã€iats-pro-esp-idf3-0-windows"><a href="#3ã€iats-pro-esp-idf3-0-windows" class="headerlink" title="3ã€iats_pro @esp-idf3.0 @windows"></a>3ã€iats_pro @esp-idf3.0 @windows</h3><ol><li>è®¾ç½®å·¥å…·é“¾ï¼š<a href="https://dl.espressif.com/dl/esp32_win32_msys2_environment_and_toolchain-20181001.zip">ä¸‹è½½é›†æˆåœ¨ä¸€èµ·çš„å·¥å…·é“¾å’Œ MSYS2 å‹ç¼©æ–‡ä»¶</a>ï¼Œå°† zip å‹ç¼©æ–‡ä»¶è§£å‹åˆ° <code>C:\</code> (æˆ–å…¶å®ƒè·¯å¾„ï¼Œè¿™é‡Œå‡è®¾æ˜¯ <code>C:\</code>)ï¼Œå®ƒä¼šä½¿ç”¨é¢„å…ˆå‡†å¤‡çš„ç¯å¢ƒåˆ›å»ºä¸€ä¸ª <code>msys32</code> ç›®å½•ï¼Œè¿è¡Œ <code>C:\msys32\mingw32.exe</code> æ‰“å¼€ä¸€ä¸ª MSYS2 çš„ç»ˆç«¯çª—å£ï¼Œåœ¨æ­¤çª—å£ä¸‹å¼€å‘ï¼›</li><li>è·å–ESP-IDFï¼›</li><li>è®¾ç½®ESP-IDFç¯å¢ƒå˜é‡(è¿™é‡Œä½¿ç”¨å•æ¬¡ï¼š<code>export IDF_PATH=&quot;D:/South/iAts_pro/lib/esp-idf&quot;</code>)ï¼š<a href="https://docs.espressif.com/projects/esp-idf/zh-cn/v3.3.1/get-started/add-idf_path-to-profile.html">åœ¨ç”¨æˆ·é…ç½®æ–‡ä»¶ä¸­æ·»åŠ  IDF_PATH â€” ESP-IDF ç¼–ç¨‹æŒ‡å— v3.3.1 æ–‡æ¡£ (espressif.com)</a>;</li><li>å®‰è£…ä¾èµ–çš„Python è½¯ä»¶åŒ…ï¼š<code>python2.7 -m pip install --user -r D\:/South/iAts_pro/lib/esp-idf/requirements</code>;</li><li>ç¤ºä¾‹å·¥ç¨‹ï¼š<code>cp -r D\:/South/iAts_pro/lib/esp-idf/examples/get-started/hello_world/ .</code>;</li><li>é…ç½®ï¼š<code>make menuconfig</code>ï¼›</li><li>ç¼–è¯‘ã€çƒ§å†™ã€ç›‘è§†ã€‚</li></ol><h2 id="6ã€ç¨‹åºç¼–å†™"><a href="#6ã€ç¨‹åºç¼–å†™" class="headerlink" title="6ã€ç¨‹åºç¼–å†™"></a>6ã€ç¨‹åºç¼–å†™</h2><p><strong>å‚è€ƒ</strong>ï¼š<a href="https://docs.espressif.com/projects/esp-idf/zh_CN/v5.3/esp32/get-started/index.html">å¿«é€Ÿå…¥é—¨ - ESP32 - â€” ESP-IDF ç¼–ç¨‹æŒ‡å— v5.3 æ–‡æ¡£ (espressif.com)</a></p><h3 id="1ã€æ—¥å¿—æ‰“å°"><a href="#1ã€æ—¥å¿—æ‰“å°" class="headerlink" title="1ã€æ—¥å¿—æ‰“å°"></a>1ã€æ—¥å¿—æ‰“å°</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;esp_log.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">const</span> <span class="type">char</span> *TAG = <span class="string">&quot;MAIN APP&quot;</span>;</span><br><span class="line"></span><br><span class="line">ESP_LOGI(TAG,<span class="string">&quot;test&quot;</span>);</span><br><span class="line"><span class="comment">//ESP_LOGW();</span></span><br><span class="line"><span class="comment">//ESP_LOGE();</span></span><br></pre></td></tr></table></figure><h3 id="2-ã€å¤šä»»åŠ¡"><a href="#2-ã€å¤šä»»åŠ¡" class="headerlink" title="2 ã€å¤šä»»åŠ¡"></a>2 ã€å¤šä»»åŠ¡</h3><h3 id="3ã€Timer-æ¶ˆæ¯é˜Ÿåˆ—"><a href="#3ã€Timer-æ¶ˆæ¯é˜Ÿåˆ—" class="headerlink" title="3ã€Timer+æ¶ˆæ¯é˜Ÿåˆ—"></a>3ã€Timer+æ¶ˆæ¯é˜Ÿåˆ—</h3><h3 id="4ã€æ–‡ä»¶ç³»ç»Ÿ"><a href="#4ã€æ–‡ä»¶ç³»ç»Ÿ" class="headerlink" title="4ã€æ–‡ä»¶ç³»ç»Ÿ"></a>4ã€æ–‡ä»¶ç³»ç»Ÿ</h3><p>â€‹åç»­ä¾›http serviceä½¿ç”¨ï¼Œå­˜å‚¨htmlç­‰æ–‡ä»¶ã€‚spiffsæ–‡ä»¶ç³»ç»Ÿç§»æ¤ï¼Œå¤åˆ¶åˆ†åŒºè¡¨<code>esp-idf/examples/storage/spiffs/partitions.csv</code>ï¼Œåˆ°é¡¹ç›®æ–‡ä»¶å¤¹ä¸‹ï¼Œ<code>idf.py menuconfig</code>è®¾ç½®å‚æ•°ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">CONFIG_PARTITION_TABLE_CUSTOM=y</span><br><span class="line">CONFIG_PARTITION_TABLE_CUSTOM_FILENAME=<span class="string">&quot;partitions.csv&quot;</span></span><br><span class="line">CONFIG_PARTITION_TABLE_FILENAME=<span class="string">&quot;partition.csv&quot;</span></span><br></pre></td></tr></table></figure><h3 id="5ã€NVS-éæ˜“å¤±æ€§å­˜å‚¨"><a href="#5ã€NVS-éæ˜“å¤±æ€§å­˜å‚¨" class="headerlink" title="5ã€NVS-éæ˜“å¤±æ€§å­˜å‚¨"></a>5ã€NVS-éæ˜“å¤±æ€§å­˜å‚¨</h3><p>â€‹KeyMapï¼Œä¾›Wifiè´¦å·å¯†ç å­˜å‚¨ä½¿ç”¨</p><h3 id="6ã€GPIO"><a href="#6ã€GPIO" class="headerlink" title="6ã€GPIO"></a>6ã€GPIO</h3><h3 id="7ã€I2C"><a href="#7ã€I2C" class="headerlink" title="7ã€I2C"></a>7ã€I2C</h3><h3 id="8ã€SPI"><a href="#8ã€SPI" class="headerlink" title="8ã€SPI"></a>8ã€SPI</h3><p>â€‹é«˜é€Ÿã€å…¨åŒå·¥ã€åŒæ­¥</p><h3 id="9ã€AP-mode-http-service"><a href="#9ã€AP-mode-http-service" class="headerlink" title="9ã€AP mode + http service"></a>9ã€AP mode + http service</h3><ol><li><p>SSID ä¸ passwdåœ¨menuconfigä¸­é…ç½®</p></li><li><p>http service å‚è€ƒï¼šesp-idf&#x2F;examples&#x2F;protocols&#x2F;http_service</p><p>ç¼–å†™setting.htmlæ–‡ä»¶ï¼Œæ·»åŠ åˆ°main&#x2F;CMakeLists.txtâ€“&gt;EMBED_FILES  â€œsetting.htmlâ€ï¼Œåˆ†åŒºè¡¨æ·»åŠ spiffsï¼Œç”¨äºå­˜å‚¨setting.htmlæ–‡ä»¶</p></li></ol><p>HTTPä¸HTTPSè¯·æ±‚æœåŠ¡å™¨æ•°æ®ï¼š</p><p>HTTP:å‚è€ƒesp-idf&#x2F;examples&#x2F;protocols&#x2F;http_request</p><p>å¿ƒçŸ¥å¤©æ°”ã€è‹å®æ—¶é—´ã€Bç«™ç²‰ä¸æ•°</p><p>HTTPS: è·å–ç½‘ç«™caè¯ä¹¦ï¼šopenssl s_client-showcerts-connect api seniverse.com:443 &lt;&#x2F;dev&#x2F;null    å¤åˆ¶â€”-BEGIN CERTIFICATEâ€”åå†…å®¹åˆ°pemæ–‡ä»¶</p><p>Makefileæ·»åŠ è¯ä¹¦EMBED_TXTFILES â€œserver_root_cert.pemâ€</p><p>main&#x2F;component.mkæ·»åŠ COMPONENT_EMBED_TXTFILES :&#x3D;server_root_cert.pem</p><h3 id="10ã€STA-mode-wifi-connect"><a href="#10ã€STA-mode-wifi-connect" class="headerlink" title="10ã€STA mode + wifi connect"></a>10ã€STA mode + wifi connect</h3><p>STAå‚è€ƒï¼šesp-idf&#x2F;examples&#x2F;wifi&#x2F;getting_start&#x2F;station</p><p>STA scan</p><h3 id="11ã€æ˜¾ç¤ºå­—åº“å›¾æ ‡"><a href="#11ã€æ˜¾ç¤ºå­—åº“å›¾æ ‡" class="headerlink" title="11ã€æ˜¾ç¤ºå­—åº“å›¾æ ‡"></a>11ã€æ˜¾ç¤ºå­—åº“å›¾æ ‡</h3><p>å›¾æ ‡â€“&gt;å–æ¨¡â€”&gt;æ•°ç»„</p><p>å­—åº“ï¼šå­—ä½“æ–‡ä»¶.TTFâ€”-&gt;LVGLå·¥å…·ï¼šLvglFontToolâ€“&gt;åŠ å…¥å¸¸ç”¨æ±‰å­—â€”&gt;XBFå­—ä½“ï¼Œå¤–éƒ¨binæ–‡ä»¶</p><p>å­—åº“ä¸‹è½½åˆ°Flash:</p><ul><li>æ·»åŠ åˆ†åŒºï¼ˆpartitions.csvï¼‰:storages1, 0x40, 0x01, 0x15D000, 0x2000000</li><li>idf.py menuconfig ä¿®æ”¹flashå¤§å°ä¸ºå®é™…å¤§å°</li><li>ä¸‹è½½å­—ä½“åº“åˆ°flashï¼špython esptool.py â€“chip esp32 â€“port &#x2F;dev&#x2F;ttyUSB0 â€“baud</li></ul><p> write_flash -z 0x15D000 DesktopScreenFont.bin</p><p>ç”»ç¬”ç›¸å…³å®ç°ï¼Œå°†å›¾æ ‡æ–‡å­—æ”¾åœ¨åŒä¸€ä¸ªé¡µé¢</p><h2 id="7ã€å…³äºESP-IDF"><a href="#7ã€å…³äºESP-IDF" class="headerlink" title="7ã€å…³äºESP-IDF"></a>7ã€å…³äºESP-IDF</h2><h3 id="1ã€ç›¸å…³æœ¯è¯­ï¼š"><a href="#1ã€ç›¸å…³æœ¯è¯­ï¼š" class="headerlink" title="1ã€ç›¸å…³æœ¯è¯­ï¼š"></a>1ã€ç›¸å…³æœ¯è¯­ï¼š</h3><ol><li><strong>SMP</strong>ï¼ˆå¯¹ç§°å¤šå¤„ç†ï¼‰ï¼›</li><li><strong>ESP-IDF FreeRTOS</strong>ï¼šæ˜¯åŸºäºåŸç”Ÿ ï¼ˆVanillaï¼‰FreeRTOS v10.5.1 çš„ FreeRTOS å®ç°ï¼Œå…¶ä¸­åŒ…å«æ”¯æŒ SMP çš„å¤§é‡æ›´æ–°ã€‚æœ€å¤šæ”¯æŒä¸¤ä¸ªæ ¸ï¼ˆå³<em>åŒæ ¸</em> SMPï¼‰ï¼Œä½†åœ¨è®¾è®¡ä¸Šå¯¹è¿™ç§åœºæ™¯è¿›è¡Œäº†ä¼˜åŒ–ï¼›</li><li><strong>Amazon SMP FreeRTOS</strong>ï¼šæ˜¯ç”± Amazon å®˜æ–¹æ”¯æŒçš„ FreeRTOS SMP å®ç°ï¼Œèƒ½å¤Ÿæ”¯æŒ <em>N æ ¸</em>ï¼Œå³åŒæ ¸ä»¥ä¸Šï¼›</li><li><strong>æ ¸äº²å’Œæ€§</strong>ï¼šå°½ç®¡ SMP ç³»ç»Ÿæ”¯æŒçº¿ç¨‹åˆ‡æ¢æ ¸ï¼Œä½†åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œçº¿ç¨‹å¿…é¡»æˆ–åº”è¯¥ä»…åœ¨ç‰¹å®šæ ¸ä¸Šè¿è¡Œã€‚å› æ­¤ï¼Œåœ¨ SMP ç³»ç»Ÿä¸­ï¼Œçº¿ç¨‹ä¹Ÿå…·å¤‡æ ¸äº²å’Œæ€§ï¼ŒæŒ‡å®šçº¿ç¨‹åœ¨å“ªä¸ªç‰¹å®šæ ¸ä¸Šè¿è¡Œï¼›</li><li><strong>PRO_CPU</strong>å’Œ<strong>APP_CPU</strong>ï¼šæ ¸ 0 å’Œæ ¸ 1åˆ«åï¼Œåæ˜ äº†å…¸å‹ ESP-IDF åº”ç”¨ç¨‹åºä½¿ç”¨è¿™ä¸¤ä¸ª CPU çš„æ–¹å¼ã€‚è´Ÿè´£å¤„ç† Wi-Fi æˆ–è“ç‰™ç­‰åè®®ç›¸å…³å¤„ç†ç¨‹åºçš„ä»»åŠ¡é€šå¸¸ä¼šåˆ†é…ç»™æ ¸ 0ï¼Œè€Œå¤„ç†åº”ç”¨ç¨‹åºå…¶ä½™éƒ¨åˆ†çš„ä»»åŠ¡ä¼šåˆ†é…ç»™æ ¸ 1ï¼›</li><li>ä»»åŠ¡åˆ›å»ºï¼šå†…å­˜åŠ¨æ€&#x2F;é™æ€åˆ†é…ï¼Œæ ¸äº²å’Œæ€§ï¼›</li><li><strong>Vanilla FreeRTOS è°ƒåº¦å™¨</strong>ï¼š<strong>å…·æœ‰æ—¶é—´åˆ†ç‰‡å’Œå›ºå®šä¼˜å…ˆçº§çš„æŠ¢å å¼è°ƒåº¦å™¨</strong>ï¼›</li><li><strong>ä¸´ç•ŒåŒº</strong> (Critical Section)ï¼šåœ¨ SMP ç³»ç»Ÿä¸­ï¼Œä»…<strong>ç¦ç”¨ä¸­æ–­</strong>å¹¶ä¸èƒ½æ„æˆä¸´ç•ŒåŒºï¼Œå› ä¸ºå­˜åœ¨å…¶ä»–æ ¸æ„å‘³ç€å…±äº«èµ„æºä»å¯ä»¥åŒæ—¶è®¿é—®ã€‚å› æ­¤ï¼ŒIDF FreeRTOS ä¸­çš„ä¸´ç•ŒåŒºä½¿ç”¨<strong>è‡ªæ—‹é”</strong>å®ç°ï¼Œè‡ªæ—‹é”å¯ä»¥é™æ€æˆ–åŠ¨æ€åˆ†é…ï¼›</li><li></li></ol>]]></content>
      
      
      
        <tags>
            
            <tag> åµŒå…¥å¼å¼€å‘ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Type-C</title>
      <link href="/2024/08/30/type-c/"/>
      <url>/2024/08/30/type-c/</url>
      
        <content type="html"><![CDATA[<h1 id="1ã€å‚è€ƒèµ„æ–™"><a href="#1ã€å‚è€ƒèµ„æ–™" class="headerlink" title="1ã€å‚è€ƒèµ„æ–™"></a>1ã€å‚è€ƒèµ„æ–™</h1><p><a href="https://blog.csdn.net/AirCity123/article/details/103554177">Type-Cåè®®ç®€ä»‹ï¼ˆCCæ£€æµ‹åŸç†)</a></p><h1 id="2ã€å®é™…åº”ç”¨"><a href="#2ã€å®é™…åº”ç”¨" class="headerlink" title="2ã€å®é™…åº”ç”¨"></a>2ã€å®é™…åº”ç”¨</h1><h2 id="1ã€5Vå–ç”µ"><a href="#1ã€5Vå–ç”µ" class="headerlink" title="1ã€5Vå–ç”µ"></a>1ã€5Vå–ç”µ</h2>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Git</title>
      <link href="/2024/07/23/git/"/>
      <url>/2024/07/23/git/</url>
      
        <content type="html"><![CDATA[<p>â€‹<a href="https://www.runoob.com/git/git-tutorial.html">Git æ•™ç¨‹ | èœé¸Ÿæ•™ç¨‹ (runoob.com)</a></p><h1 id="1ã€-Git-ç®€ä»‹"><a href="#1ã€-Git-ç®€ä»‹" class="headerlink" title="1ã€ Git ç®€ä»‹"></a>1ã€ Git ç®€ä»‹</h1><p>â€‹Git æ˜¯ä¸€ä¸ªå¼€æºçš„<strong>åˆ†å¸ƒå¼ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿ</strong>ï¼Œç”¨äºæ•æ·é«˜æ•ˆåœ°å¤„ç†ä»»ä½•æˆ–å°æˆ–å¤§çš„é¡¹ç›®ã€‚Git æ˜¯ Linus Torvalds ä¸ºäº†å¸®åŠ©ç®¡ç† Linux å†…æ ¸å¼€å‘è€Œå¼€å‘çš„ä¸€ä¸ªå¼€æ”¾æºç çš„ç‰ˆæœ¬æ§åˆ¶è½¯ä»¶ã€‚Git ä¸å¸¸ç”¨çš„ç‰ˆæœ¬æ§åˆ¶å·¥å…· CVS, Subversion ç­‰ä¸åŒï¼Œå®ƒé‡‡ç”¨äº†<strong>åˆ†å¸ƒå¼ç‰ˆæœ¬åº“</strong>çš„æ–¹å¼ï¼Œ<strong>ä¸å¿…æœåŠ¡å™¨ç«¯è½¯ä»¶æ”¯æŒ</strong>ã€‚</p><p>â€‹Git ä¸ä»…ä»…æ˜¯ä¸ªç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿï¼Œå®ƒä¹Ÿæ˜¯ä¸ª<strong>å†…å®¹ç®¡ç†ç³»ç»Ÿ</strong>(CMS)ï¼Œ<strong>å·¥ä½œç®¡ç†ç³»ç»Ÿ</strong>ç­‰ã€‚å¦‚æœä½ æ˜¯ä¸€ä¸ªå…·æœ‰ä½¿ç”¨ SVN èƒŒæ™¯çš„äººï¼Œä½ éœ€è¦åšä¸€å®šçš„æ€æƒ³è½¬æ¢ï¼Œæ¥é€‚åº” Git æä¾›çš„ä¸€äº›æ¦‚å¿µå’Œç‰¹å¾ã€‚Git ä¸ SVN åŒºåˆ«ç‚¹ï¼š</p><ul><li><strong>Git æ˜¯åˆ†å¸ƒå¼çš„ï¼ŒSVN ä¸æ˜¯</strong>ï¼šè¿™æ˜¯ Git å’Œå…¶å®ƒéåˆ†å¸ƒå¼çš„ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿï¼Œä¾‹å¦‚ SVNï¼ŒCVS ç­‰ï¼Œæœ€æ ¸å¿ƒçš„åŒºåˆ«ã€‚</li><li><strong>Git æŠŠå†…å®¹æŒ‰å…ƒæ•°æ®æ–¹å¼å­˜å‚¨ï¼Œè€Œ SVN æ˜¯æŒ‰æ–‡ä»¶ï¼š</strong>æ‰€æœ‰çš„èµ„æºæ§åˆ¶ç³»ç»Ÿéƒ½æ˜¯æŠŠæ–‡ä»¶çš„å…ƒä¿¡æ¯éšè—åœ¨ä¸€ä¸ªç±»ä¼¼ .svnã€.cvs ç­‰çš„æ–‡ä»¶å¤¹é‡Œã€‚</li><li><strong>Git åˆ†æ”¯å’Œ SVN çš„åˆ†æ”¯ä¸åŒï¼š</strong>åˆ†æ”¯åœ¨ SVN ä¸­ä¸€ç‚¹éƒ½ä¸ç‰¹åˆ«ï¼Œå…¶å®å®ƒå°±æ˜¯ç‰ˆæœ¬åº“ä¸­çš„å¦å¤–ä¸€ä¸ªç›®å½•ã€‚</li><li><strong>Git æ²¡æœ‰ä¸€ä¸ªå…¨å±€çš„ç‰ˆæœ¬å·ï¼Œè€Œ SVN æœ‰ï¼š</strong>ç›®å‰ä¸ºæ­¢è¿™æ˜¯è·Ÿ SVN ç›¸æ¯” Git ç¼ºå°‘çš„æœ€å¤§çš„ä¸€ä¸ªç‰¹å¾ã€‚</li><li><strong>Git çš„å†…å®¹å®Œæ•´æ€§è¦ä¼˜äº SVNï¼š</strong>Git çš„å†…å®¹å­˜å‚¨ä½¿ç”¨çš„æ˜¯ SHA-1 å“ˆå¸Œç®—æ³•ã€‚è¿™èƒ½ç¡®ä¿ä»£ç å†…å®¹çš„å®Œæ•´æ€§ï¼Œç¡®ä¿åœ¨é‡åˆ°ç£ç›˜æ•…éšœå’Œç½‘ç»œé—®é¢˜æ—¶é™ä½å¯¹ç‰ˆæœ¬åº“çš„ç ´åã€‚</li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> è½¯ä»¶å¼€å‘ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>TI-RTOS</title>
      <link href="/2024/07/19/ti-rtos/"/>
      <url>/2024/07/19/ti-rtos/</url>
      
        <content type="html"><![CDATA[<p><a href="https://blog.csdn.net/little_grapes/article/details/121484599">ç”µæºæ§åˆ¶ï¼ˆä¸‰ç§ä½åŠŸè€—æ¨¡å¼ï¼šsleepã€stopã€standbyå¾…æœº)</a>  </p><h1 id="1ã€å­¦ä¹ "><a href="#1ã€å­¦ä¹ " class="headerlink" title="1ã€å­¦ä¹ "></a>1ã€å­¦ä¹ </h1><h2 id="1ã€ä»»åŠ¡"><a href="#1ã€ä»»åŠ¡" class="headerlink" title="1ã€ä»»åŠ¡"></a>1ã€ä»»åŠ¡</h2><p><strong>â‘ åˆ›å»ºä»»åŠ¡ï¼š</strong><br>ï¼ˆ1ï¼‰Task_Handle Task_creat(Task_FuncPtr,const Tak_Param *params,Eror_Blovck *eb);<br>ï¼ˆ2ï¼‰Task_Struct taskStruct;<br>     void Task_construct(Task_Struct *structP,Task_FuncPtr fxn,const Task_Params *params,Error-Block *eb);<br> PSï¼šTask_Handle ä¸ Task_Struct å¯ä»¥ç›¸äº’è½¬æ¢<br>    Task_Handle Task_handle(Task_struct *structP);<br>    Task_Struct *Task_struct(Task_Handle handle);<br> TI-RTOS ä¸­ä¸èƒ½åœ¨ä¸­æ–­å‡½æ•°ä¸­åˆ›å»ºä»»åŠ¡<br><strong>â‘¡åˆ é™¤ä»»åŠ¡ï¼š</strong><br>ï¼ˆ1ï¼‰Void Task_delete(Task_Handle *handleP); &#x2F;&#x2F;æŒ‡å‘ä»»åŠ¡å®ä¾‹æŒ‡é’ˆ<br>ï¼ˆ2ï¼‰Void Task_destruct(Task_Struct *structP);&#x2F;&#x2F;æŒ‡å‘ä»»åŠ¡ Task_Struct ç»“æ„æŒ‡é’ˆ<br> PSï¼šåˆ é™¤ä»»åŠ¡ä¹‹å‰ï¼Œä¸€å®šè¦å°†æ‰€æœ‰å ç”¨çš„èµ„æºéƒ½é‡Šæ”¾æ‰<br><strong>â‘¢ä»»åŠ¡æŠ¢å ï¼š</strong><br>ï¼ˆ1ï¼‰Key &#x3D; Task_disable();&#x2F;&#x2F;æ­¤æ—¶ä»»ä½•é«˜ä¼˜å…ˆçº§ä»»åŠ¡éƒ½æ— æ³•è¿›è¡ŒæŠ¢å ï¼Œä½†æ˜¯ HWI å’Œ SWI ä»å¯ä»¥æŠ¢å <br>      &#x2F;&#x2F; ä¸´ç•ŒåŒºä»£ç <br>      â€¦.<br>     Task_restore(key);<br>ï¼ˆ2ï¼‰Void Task_sleep(UInt32 nticks)  &#x2F;&#x2F;ç³»ç»Ÿ tick æ•°<br>  &#x2F;&#x2F;ä¸è¦åœ¨main()ã€idleã€ Hwiï¼ŒSwi å’Œ disable&#x2F;restore ç»“æ„ä¸­è°ƒç”¨<br>ï¼ˆ3ï¼‰Void Task_yield();<br><strong>â‘£æ›´æ”¹ä»»åŠ¡ä¼˜å…ˆçº§ï¼š</strong><br>  Task_setPri();</p><h2 id="2ã€ä»»åŠ¡é—´åŒæ­¥"><a href="#2ã€ä»»åŠ¡é—´åŒæ­¥" class="headerlink" title="2ã€ä»»åŠ¡é—´åŒæ­¥"></a>2ã€ä»»åŠ¡é—´åŒæ­¥</h2><h3 id="1ã€ä¿¡å·é‡"><a href="#1ã€ä¿¡å·é‡" class="headerlink" title="1ã€ä¿¡å·é‡"></a>1ã€ä¿¡å·é‡</h3><p>â€‹äºŒå€¼ä¿¡å·é‡ï¼ˆå¯ç”¨&amp;ä¸å¯ç”¨ï¼‰æˆ–è®°æ•°ä¿¡å·é‡ã€‚é»˜è®¤ä¸ºè®°æ•°ä¿¡å·é‡ï¼ˆæ ¹æ®å®é™…èµ„æºæ•°æ¥ç¡®å®šï¼‰</p><p>â€‹semParams.mode &#x3D;ï¼ˆSemaphore_Mode_COUNTING | Semaphore_Mode_BINARYï¼‰</p><p>FIFOæ–¹å¼æ’é˜Ÿ<br>                                 |ï¼ˆSemaphore_Mode_COUNTING_PRIORITY | Semaphore_Mode_BINARY_PRIORITYï¼‰ä¼˜å…ˆçº§æ’é˜Ÿ<br>åˆ›å»ºã€åˆ é™¤ä¿¡å·é‡ï¼š<br>PS:å…ˆåˆå§‹åŒ–å‚æ•°Void Semaphore_Params_init(Semaphore_Params *params);ç„¶åè®¾ç½®æ¨¡å¼ï¼ˆä¸è®¾ç½®åˆ™é»˜è®¤ï¼‰<br>ï¼ˆ1ï¼‰Semaphore_Handle Semaphore_create(Int count,Semaphore_Params *attrs,Error_Block *eb);<br>     Void Semaphore_delete(Samaphore_Handle *handleP);<br>ï¼ˆ2ï¼‰Void Semaphore_construct(Semaphore_Struct *structP,Int count,const Semaphore_Params *params);<br>     Void Semaphore_destruct(Semaphore_Struct *structP);<br>ï¼ˆ3ï¼‰Semsphonre_Handle Semaphore_handle(Semaphore_Struct *structP);&#x2F;&#x2F;Semaphore_handleå‡½æ•°ä»Semaphore_Structç»“æ„ä¸­è·å¾—Semaphore_Handleä¿¡æ¯<br>     Semaphore_Struct *Sempahore_struct(Semaphore_Handle handel);  &#x2F;&#x2F;Semaphore_structå‡½æ•°ä»Semaphore_Handleè·å¾—Semaphore_Structç»“æ„æŒ‡é’ˆ<br>ä¿¡å·ç”³è¯·ä¸é‡Šæ”¾ï¼š<br>ï¼ˆ1ï¼‰Bool Semaphore_pend(Semaphore_Handle handle,UInt32 timeout);&#x2F;&#x2F;ç”³è¯·ï¼ˆtimeout&#x3D;BIOS_WAIT_DOREVERä¸€ç›´ç­‰å¾…ä¿¡å·é‡å¯ç”¨ï¼›time&#x3D;BIOS_NO_WAITæ²¡æœ‰å¯ç”¨ä¿¡å·é‡ï¼Œç«‹å³è¿”å›ï¼‰<br>ï¼ˆ2ï¼‰Void Semaphore_post(Semaphore_Handle handle);&#x2F;&#x2F;é‡Šæ”¾<br>ï¼ˆ3ï¼‰Int Semaphore_getCount(Semaphore_Hnadle handle);&#x2F;&#x2F;æŸ¥è¯¢å½“å‰ä¿¡å·countå€¼<br>â‘¡äº‹ä»¶ï¼šäºŒå€¼ï¼›ä»»åŠ¡ä¸å…¶å®ƒçº¿ç¨‹ OR ä»»åŠ¡ä¸å…¶ä»–SYS&#x2F;BIOSå¯¹è±¡ï¼ˆåŒ…æ‹¬ä¿¡å·é‡ã€é‚®ç®±ã€æ¶ˆæ¯é˜Ÿåˆ—ç­‰ï¼‰ä¹‹é—´é€šä¿¡ã€‚ä»»åŠ¡å¯ä»¥ç­‰å¾…äº‹ä»¶ï¼Œä»»åŠ¡ã€HWIã€SWIæˆ–SYS&#x2F;BIOSå¯¹è±¡å¯ä»¥å‘å¸ƒäº‹ä»¶ï¼›<br>        å¯¹è±¡å…ˆæ³¨å†Œäº‹ä»¶å¯¹è±¡ã€‚<br>        Event_post()&#x2F;&#x2F;å¯¹åº”IDäº‹ä»¶å¯ç”¨<br>        æ ¹æ®andMask OR orMaskè°ƒç”¨Event_pend()&#x2F;&#x2F;å¯¹åº”IDäº‹ä»¶ä¸å¯ç”¨<br>      æ¯ä¸ªå¯¹è±¡å®ä¾‹å¯ç®¡ç†32ä¸ªäº‹ä»¶<br>        ä»»åŠ¡æ‰èƒ½è°ƒç”¨Event_pend();Event_post()æ‰€æœ‰çº¿ç¨‹å¯è°ƒç”¨<br>åˆ›å»º&#x2F;åˆ é™¤äº‹ä»¶å¯¹è±¡ï¼š<br>ï¼ˆ1ï¼‰Void Event_construct(Event_Struct *structP, const Event_Params *params);<br>     Void Event_destruct(Event_Struct *structP);<br>ï¼ˆ2ï¼‰Event_Handle Event_create(const Event_Params *params, Error_Block *eb);<br>     Void Event_delete(Event_Handle *handleP);<br>  PS:Event_Handle ä¸ Event_Struct ç»“æ„æŒ‡é’ˆå¯ä»¥ç›¸äº’è½¬æ¢<br>      Event_Handle Event_handle(Event_Struct *structP)<br>      Event_Struct *Event_struct(Event_Handle handle)<br>äº‹ä»¶pend&#x2F;post:<br>ï¼ˆ1ï¼‰UInt Event_pend(Event_Handle handle, UInt andMask, UInt orMask, UInt32 timeout);&#x2F;&#x2F;timeout&#x3D;BIOS_WAIT_FOREVER|å…·ä½“æ—¶é—´|BIOS_NO_WAIT<br>ï¼ˆ2ï¼‰Void Event_post(Event_Handle handle, UInt eventMask);&#x2F;&#x2F;å¤šä¸ªäº‹ä»¶å¯ä»¥é€šè¿‡â€œ+â€æˆ–â€œ|â€è¿›è¡Œè¿æ¥<br>ï¼ˆ3ï¼‰UInt Event_getPostedEvents(Event_Handle handle);<br>â‘¢é˜Ÿåˆ—ï¼š åŒå‘é“¾æ¥åˆ—è¡¨ï¼šQueue_next æˆ– Queue_prev çš„è°ƒç”¨å¯ä»¥åœ¨ Queue ä¸Šè¿ç»­å¾ªç¯ã€‚ä¿®æ”¹é˜Ÿåˆ—å‰ç¦ç”¨ä¸­æ–­çš„APIï¼šâ€åŸå­â€ï¼›ä¸ç¦ç”¨ä¸­æ–­çš„API:â€éåŸå­çš„â€<br>é˜Ÿåˆ—åˆ›å»º&#x2F;åˆ é™¤ï¼š<br>     å…ˆåˆå§‹åŒ–å‚æ•°ï¼šVoid Queue_Params_init(Queue_Params *params)<br>ï¼ˆ1ï¼‰Queue_Handle Queue_create(const Queue_Params *params, Error_Block *eb);<br>     Void Queue_delete(Queue_Handle *handleP);<br>ï¼ˆ2ï¼‰Void Queue_construct(Queue_Struct *structP, const Queue_Params *params);<br>     Void Queue_destruct(Queue_Struct *structP);<br>  PSï¼šQueue_Handle ä¸ Queue_Struct ç»“æ„è¿›è¡Œäº’ç›¸è½¬æ¢ï¼š<br>      Queue_Handle Queue_handle(Queue_Struct *structP)ï¼›Queue_Struct *Queue_struct(Queue_Handle handle)<br>é˜Ÿåˆ—æ“ä½œï¼š<br>ï¼ˆ1ï¼‰Void Queue_enqueue(Queue_Handle handle, Queue_Elem *elem);&#x2F;&#x2F;å°†æŒ‡å®šçš„å…ƒç´ åŠ å…¥åˆ°é˜Ÿåˆ—åé¢<br>ï¼ˆ2ï¼‰Ptr Queue_dequeue(Queue_Handle handle);&#x2F;&#x2F;ä»é˜Ÿåˆ—ä¸Šåˆ é™¤ç¬¬ä¸€ä¸ªå…ƒç´ å¹¶è¿”å›(è¿”å›å€¼ä¸ºæŒ‡å‘å…ƒç´ çš„æŒ‡é’ˆ)ï¼ˆè°ƒç”¨ Queue_dequeue()ä¹‹å‰ï¼Œä½¿ç”¨Queue_empty()è¿›è¡Œåˆ¤æ–­ï¼Œå†å†³å®šæ˜¯å¦è°ƒç”¨ Queue_dequeue()ï¼‰<br>ï¼ˆ3ï¼‰Bool Queue_empty(Queue_Handle handle)<br>ï¼ˆ4ï¼‰Ptr Queue_head(Queue_Handle handle);&#x2F;&#x2F;è¿”å›æŒ‡å‘é˜Ÿåˆ—ç¬¬ä¸€ä¸ªå…ƒç´ çš„æŒ‡é’ˆ;è°ƒç”¨ Queue_head ()ä¹‹å‰ï¼Œä½¿ç”¨ Queue_empty()è¿›è¡Œåˆ¤æ–­ï¼Œå†å†³å®šæ˜¯å¦è°ƒç”¨ Queue_head()<br>éå†é˜Ÿåˆ—ï¼š<br>ï¼ˆ1ï¼‰Ptr Queue_prev(Queue_Elem *qelem);&#x2F;&#x2F;æ•°è¿”å› qelem(é˜Ÿåˆ—ä¸­çš„å…ƒç´ æŒ‡é’ˆ)ä¹‹å‰å…ƒç´ æŒ‡é’ˆã€‚<br>ï¼ˆ2ï¼‰Ptr Queue_next(Queue_Elem *qelem);&#x2F;&#x2F;è¿”å› qelem ä¹‹åå…ƒç´ æŒ‡é’ˆ<br>æ’å…¥åˆ é™¤å…ƒç´ ï¼š<br>ï¼ˆ1ï¼‰Void Queue_insert(Queue_Elem *qelem, Queue_Elem *elem);&#x2F;&#x2F;å°† elem å…ƒç´ æ’å…¥åˆ° qelem å…ƒç´ çš„å‰é¢<br>ï¼ˆ2ï¼‰Void Queue_remove(Queue_Elem *qelem);&#x2F;&#x2F;ä»é˜Ÿåˆ—ä¸­åˆ é™¤æŒ‡å®šçš„å…ƒç´ <br>â‘£é‚®ç®±ï¼š<br>é‚®ç®±åˆ›å»º&#x2F;åˆ é™¤ï¼š<br>    Void Mailbox_Params_init(Mailbox_Params *params);&#x2F;&#x2F;åˆå§‹åŒ–é‚®ç®±å‚æ•°<br>ï¼ˆ1ï¼‰Mailbox_Handle Mailbox_create(SizeT msgSize, UInt numMsgs, const Mailbox_Params *params, Error_Block *eb);&#x2F;&#x2F;ç©ºé—´å¤§å°ä¸ºï¼ˆmsgSize * numMsgsï¼‰<br>     Void Mailbox_delete(Mailbox_Handle *handleP)<br>ï¼ˆ2ï¼‰Void Mailbox_construct(Mailbox_Struct *structP, SizeT msgSize, UInt numMsgs, constMailbox_Params *params, Error_Block *eb)<br>     Void Mailbox_destruct(Mailbox_Struct *structP)<br>é‚®ä»¶å‘é€&#x2F;æ¥å—ï¼š<br>ï¼ˆ1ï¼‰Bool Mailbox_pend(Mailbox_Handle handle, Ptr msg, UInt32 timeout);&#x2F;&#x2F;å°†é‚®ç®±ç¬¬ä¸€ä¸ªæ¶ˆæ¯æ‹·è´å‡ºæ¥<br>ï¼ˆ2ï¼‰Bool Mailbox_post(Mailbox_Handle handle, Ptr msg, UInt32 timeout);&#x2F;&#x2F;å°†æ¶ˆæ¯æ‹·è´åˆ°é‚®ç®±(æå‰æ£€æŸ¥æ˜¯å¦æœ‰ç©ºä½)<br>  SizeT Mailbox_getMsgSize(Mailbox_Handle handle);&#x2F;&#x2F;é‚®ç®±å¯¹è±¡å•ä¸ªæ¶ˆæ¯æ‰€å ç”¨çš„ç©ºé—´å¤§å°<br>  Int Mailbox_getNumFreeMsgs(Mailbox_Handle handle);&#x2F;&#x2F;é‚®ç®±å¯¹è±¡å½“å‰ç©ºé—²æ¶ˆæ¯ä¸ªæ•°<br>  Int Mailbox_getNumPendingMsgs(Mailbox_Handle handle);&#x2F;&#x2F;é‚®ç®±å¯¹è±¡å½“å‰å†…éƒ¨æ¶ˆæ¯ä¸ªæ•°ï¼Œå³è¢«å ç”¨äº†å¤šå°‘ä¸ªæ¶ˆæ¯<br>ä¸‰ã€HWI<br>å››ã€SWI<br>äº”ã€é—¨ï¼šè®¾å¤‡ç¦æ­¢å¹¶å‘è®¿é—®ä¸´ç•ŒåŒºä»£ç <br>        Gate_enter()è¿”å›çš„ key è¢«ä¼ ç»™ Gate_leave()ï¼ŒæŠ¢å æ‰ä¼šæ¢å¤<br>ä¸ƒã€æ—¶é—´æœåŠ¡ï¼š<br>            ti.sysbios.knl.Clockæ¨¡å—<br>            ti.sysbios.hal,Timeræ¨¡å—<br>            ti.sysbios.hal.Secondsæ¨¡å—<br>   SYS&#x2F;BIOSä¸­ï¼Œç³»ç»Ÿ Clock ç®¡ç†æ‰€æœ‰çš„æ—¶é—´æœåŠ¡ï¼›tick å‘¨æœŸå†³å®šç³»ç»Ÿçš„å¿ƒè·³ï¼›Clock.tickPeriod æ—¶é—´å•ä½æ˜¯å¾®ç§’</p><h2 id="3ã€RTOS-å…¸å‹çº¿ç¨‹ï¼šISRä¸­æ–­æœåŠ¡ä¾‹ç¨‹ã€ä»»åŠ¡ã€idleç©ºé—²"><a href="#3ã€RTOS-å…¸å‹çº¿ç¨‹ï¼šISRä¸­æ–­æœåŠ¡ä¾‹ç¨‹ã€ä»»åŠ¡ã€idleç©ºé—²" class="headerlink" title="3ã€RTOS(å…¸å‹çº¿ç¨‹ï¼šISRä¸­æ–­æœåŠ¡ä¾‹ç¨‹ã€ä»»åŠ¡ã€idleç©ºé—²)"></a>3ã€<a href="https://blog.csdn.net/Chase_xkx/article/details/127227335">RTOS(å…¸å‹çº¿ç¨‹ï¼šISRä¸­æ–­æœåŠ¡ä¾‹ç¨‹ã€ä»»åŠ¡ã€idleç©ºé—²)</a></h2><p><strong>è°ƒåº¦è¿›ç¨‹</strong>ï¼šæŠ¢å (Preempted)å¼ï¼ˆæ­£åœ¨è¿è¡Œçš„çº¿ç¨‹å°†ä¸€ç›´æŒç»­åˆ°ï¼šâ‘ å®Œæˆï¼›â‘¡è¾ƒé«˜ä¼˜å…ˆçº§çš„çº¿ç¨‹å‡†å¤‡å°±ç»ªï¼›â‘¢çº¿ç¨‹åœ¨ç­‰å¾…èµ„æºæ—¶æ”¾å¼ƒå¤„ç†å™¨ï¼‰ã€æ—¶é—´ç‰‡  ï¼ˆæ¯ä¸€çº¿ç¨‹éƒ½æœ‰è¦æ‰§è¡Œçš„æ§½ï¼‰</p><p><strong>çº¿ç¨‹å®‰å…¨</strong>ï¼šä¸€æ®µä»£ç ä»¥ä¿è¯å¤šä¸ªçº¿ç¨‹åŒæ—¶æ­£ç¡®è®¿é—®ï¼ˆè¯»å–ã€å†™å…¥ï¼‰çš„æ–¹å¼æ“ä½œå…±äº«æ•°æ®ç»“æ„ï¼Œåˆ™è¯¥ä»£ç æ®µæ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚</p><p><strong>Blocked</strong>: ä»»åŠ¡æ­£åœ¨ç­‰å¾…èµ„æºä¸”æœªæ¶ˆè€—ä»»ä½•CPUï¼Œåˆ™é˜»æ­¢è¯¥ä»»åŠ¡ã€‚</p><p><strong>è£¸æœº</strong>ï¼šåˆå§‹åŒ–ã€è¶…çº§å¾ªç¯çŠ¶æ€æœºã€ISR  </p><p><strong>è½¯å®æ—¶ä¸ç¡¬å®æ—¶</strong>:å°½å¯èƒ½å¿«åœ°å®Œæˆ&amp;è§„å®šçš„æ—¶é—´å†…å¿…é¡»å®Œæˆ</p><p><strong>å®æ—¶æ“ä½œç³»ç»Ÿç»„ä»¶</strong>ï¼šè®¡åˆ’è¿›ç¨‹ï¼šä¿è¯æœ€é«˜ä¼˜å…ˆçº§çº¿ç¨‹æ­£åœ¨è¿è¡Œçš„æŠ¢å å¼è®¡åˆ’è¿›ç¨‹ã€‚</p><p><strong>é€šä¿¡æœºåˆ¶</strong>ï¼š<strong>ä¿¡å·é‡</strong>ã€<strong>æ¶ˆæ¯é˜Ÿåˆ—</strong>ã€é˜Ÿåˆ—ç­‰ã€‚<br>å…³é”®åŒºåŸŸæœºåˆ¶ï¼šäº’æ–¥ä½“ã€é—¨ã€é”ç­‰ã€‚<br>â€‹è®¡æ—¶æœåŠ¡ï¼šæ—¶é’Ÿã€å®šæ—¶å™¨ç­‰ã€‚<br>â€‹ç”µæºç®¡ç†ï¼šå¯¹äºä½åŠŸè€—è®¾å¤‡ï¼Œç”µæºç®¡ç†é€šå¸¸æ˜¯RTOSçš„ä¸€éƒ¨åˆ†ï¼Œå› ä¸ºå®ƒçŸ¥é“è®¾å¤‡çš„çŠ¶æ€ã€‚<br>å†…å­˜ç®¡ç†ï¼šå¯å˜å¤§å°çš„å †ã€å›ºå®šå¤§å°çš„å †ç­‰ã€‚<br>â€‹å¤–è®¾é©±åŠ¨å™¨ï¼šUARTã€SPIã€I2Cç­‰ã€‚<br>â€‹åè®®æ ˆï¼šè“ç‰™ã€æ— çº¿ç½‘ç»œç­‰ã€‚<br>â€‹æ–‡æ¡£ç³»ç»Ÿï¼šFatFsç­‰ã€‚<br>â€‹è®¾å¤‡ç®¡ç†ï¼šå¼‚å¸¸å¤„ç†ã€å¯åŠ¨ç­‰ã€‚    </p><p><strong>POSIX</strong>ï¼ˆPortable Operating System Interfaceï¼‰ï¼šå¯ç§»æ¤æ“ä½œç³»ç»Ÿæ¥å£ã€‚æ˜¯ä¸€ä¸ªæ“ä½œç³»ç»Ÿå…¼å®¹æ€§å±‚ï¼Œå…è®¸åº”ç”¨è¿›ç¨‹åœ¨æ“ä½œç³»ç»Ÿä¹‹é—´è½»æ¾ç§»æ¤ã€‚  </p>]]></content>
      
      
      
        <tags>
            
            <tag> RTOS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Cè¯­è¨€</title>
      <link href="/2024/07/19/c-yu-yan/"/>
      <url>/2024/07/19/c-yu-yan/</url>
      
        <content type="html"><![CDATA[<p>â€‹<a href="https://blog.csdn.net/weixin_43831728/article/details/104537195?spm=1001.2101.3001.6650.1&utm_medium=distribute.pc_relevant.none-task-blog-2~default~CTRLIST~Rate-1-104537195-blog-126960941.235%5Ev38%5Epc_relevant_sort&depth_1-utm_source=distribute.pc_relevant.none-task-blog-2~default~CTRLIST~Rate-1-104537195-blog-126960941.235%5Ev38%5Epc_relevant_sort&utm_relevant_index=2"> ã€ŠCå’ŒæŒ‡é’ˆã€‹æ€»ç»“</a>  </p><p>â€‹<a href="https://blog.51cto.com/u_14114084/3652776">#Pragma Pack(n)å†…å­˜åˆ†é…</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> åµŒå…¥å¼å¼€å‘ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç”µå­äº§å“å¤–å£³åˆ¶ä½œ-Solidworks</title>
      <link href="/2024/07/14/dian-zi-chan-pin-wai-ke-zhi-zuo-solidworks/"/>
      <url>/2024/07/14/dian-zi-chan-pin-wai-ke-zhi-zuo-solidworks/</url>
      
        <content type="html"><![CDATA[<h1 id="1ã€å­¦ä¹ "><a href="#1ã€å­¦ä¹ " class="headerlink" title="1ã€å­¦ä¹ "></a>1ã€å­¦ä¹ </h1><p><a href="https://www.bilibili.com/video/BV1DW4y1K7Ww?p=1&vd_source=c2fe15d5282e5de556b5fccfc70e9600">å®£å¯¼è¯¾ï¼šä¸€èµ·è®¾è®¡æ¡Œé¢å°å±å¹•å¤–å£³ï¼_å“”å“©å“”å“©_bilibili</a></p><h2 id="1ã€ç»˜åˆ¶å±å¹•"><a href="#1ã€ç»˜åˆ¶å±å¹•" class="headerlink" title="1ã€ç»˜åˆ¶å±å¹•"></a>1ã€ç»˜åˆ¶å±å¹•</h2><ul><li>ç³»ç»Ÿè®¾ç½®â€“&gt;è‰å›¾â€“&gt;é€‰ä¸­<strong>åœ¨åˆ›å»ºè‰å›¾ä»¥åŠç¼–è¾‘è‰å›¾æ—¶è‡ªåŠ¨æ—‹è½¬è¯•å›¾ä»¥å‚ç›´äºè‰å›¾åŸºå‡†é¢</strong>;</li><li>ç³»ç»Ÿè®¾ç½®â€“&gt;å¤–éƒ¨å‚è€ƒâ€“&gt;é€‰ä¸­å½“ç¼–è¾‘è£…é…ä½“æ—¶ï¼Œ<strong>å…è®¸é›¶ä»¶å…·æœ‰å¤šä¸ªå…³è”</strong>ï¼›</li><li>æ ¹æ®æ‰‹å†Œå’Œå®é™…æµ‹é‡ç»˜åˆ¶ç®€æ˜“å±å¹•é›¶ä»¶</li><li>ç»˜åˆ¶æ˜¾ç¤ºåŒºåŸŸï¼šå¹³é¢ä¸Šç»˜åˆ¶è‰å›¾â€“&gt;<strong>åŒ…è¦†</strong>ï¼ˆåˆ»ç”»ã€æ ·æ¡æ›²çº¿ã€é€‰æ‹©åŒ…è¦†è‰å›¾çš„é¢ï¼‰ï¼Œè®¾ç½®é¢çš„é¢œè‰²ã€‚</li><li>è¾¹çº¿æå–åˆ°è‰å›¾ï¼š<strong>è½¬æ¢å®ä½“å¼•ç”¨</strong>â€“&gt;é€‰ä¸­è¾¹çº¿â€“&gt;åŒ…è¦†ï¼›</li></ul><h2 id="2ã€ç»˜åˆ¶ç”µæ± "><a href="#2ã€ç»˜åˆ¶ç”µæ± " class="headerlink" title="2ã€ç»˜åˆ¶ç”µæ± "></a>2ã€ç»˜åˆ¶ç”µæ± </h2><ul><li>ç®€åŒ–ç”µæ± ï¼Œç»˜åˆ¶æˆªé¢â€“&gt;<strong>æ‹‰ä¼¸å‡¸å°</strong>ï¼›</li><li>æ‰¹é‡æ·»åŠ åœ†è§’ï¼š<strong>çº¿æ¶å›¾</strong>æ¨¡å¼â€“&gt;æ¡†é€‰æ‰€æœ‰è¾¹çº¿â€“&gt;<strong>åœ†è§’</strong>;</li><li>æ·»åŠ ç”µçº¿ï¼š<strong>å‚è€ƒå‡ ä½•ä½“</strong>â€“&gt;<strong>åŸºå‡†é¢</strong>ï¼Œæ‰¾åˆ°åˆé€‚çš„åŸºå‡†é¢ï¼›è‰å›¾ç»˜åˆ¶ä¸€æ®µåœ†å¼§â€“&gt;<strong>æ‰«æ</strong>(åœ†å½¢è½®å»“)ï¼›<strong>çº¿æ€§é˜µåˆ—</strong>å¤åˆ¶å¦ä¸€æ¡ç”µçº¿ï¼Œç»˜åˆ¶å®Œæ¯•å¯ä»¥éšè—åŸºå‡†é¢ï¼›</li></ul><h2 id="3ã€å¯¼å…¥ç”µè·¯æ¿"><a href="#3ã€å¯¼å…¥ç”µè·¯æ¿" class="headerlink" title="3ã€å¯¼å…¥ç”µè·¯æ¿"></a>3ã€å¯¼å…¥ç”µè·¯æ¿</h2><ul><li>å¯¼å‡ºSTEPæ–‡ä»¶</li><li>å¦å­˜ä¸ºSLDPRTé›¶ä»¶æ ¼å¼æ–‡ä»¶ï¼Œæ‰“å¼€æ—¶ä¸è¿›è¡Œç‰¹å¾è¯†åˆ«ï¼›</li></ul><h2 id="4ã€ç®€å•è£…é…"><a href="#4ã€ç®€å•è£…é…" class="headerlink" title="4ã€ç®€å•è£…é…"></a>4ã€ç®€å•è£…é…</h2><ul><li>æ–°å»ºè£…é…ä½“ï¼Œå¯¼å…¥é›¶ä»¶ï¼›</li><li><strong>é…åˆ</strong>ï¼Œæ ‡å‡†ã€é«˜çº§ï¼ˆ<strong>å®½åº¦é…åˆ</strong>å¯å®ç°å·¦å³ç­‰å®½ï¼‰ï¼›</li><li>è®¾è®¡å¤–å£³ï¼Œç”»è‰ç¨¿ï¼š</li></ul><p><a href="https://imgse.com/i/pkTuxsS"><img src="https://s21.ax1x.com/2024/07/19/pkTuxsS.md.webp" class="lazyload placeholder" data-srcset="https://s21.ax1x.com/2024/07/19/pkTuxsS.md.webp" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="pkTuxsS.md.webp"></a></p><h2 id="5ã€ç»˜åˆ¶å‰å£³"><a href="#5ã€ç»˜åˆ¶å‰å£³" class="headerlink" title="5ã€ç»˜åˆ¶å‰å£³"></a>5ã€ç»˜åˆ¶å‰å£³</h2><ul><li>åœ¨è£…é…ä½“ä¸­ï¼Œ<strong>æ’å…¥é›¶éƒ¨ä»¶</strong>â€“&gt;<strong>æ–°é›¶ä»¶</strong>;</li><li><strong>æ‹‰ä¼¸åˆ‡é™¤</strong>ç»˜åˆ¶å‰é¢æ¿ï¼Œç”»å±å¹•æ§½ï¼ˆå±å¹•â€“&gt;<strong>è½¬æ¢å®ä½“å¼•ç”¨</strong>â€“&gt;ä½œä¸ºæ„é€ çº¿â€“&gt;<strong>ç­‰è·å®ä½“</strong>ï¼Œ0.1mmï¼‰ï¼›</li><li>é¢æ¿å¢åŠ åœ†è§’ï¼Œ<strong>è½®å»“</strong>â€“&gt;<strong>æ›²ç‡è¿ç»­</strong>ï¼›</li><li>å¢åŠ å‰å£³åšåº¦ï¼Œå‰å£³èƒŒé¢â€“&gt;è‰å›¾ç»˜åˆ¶â€“&gt;<strong>è½¬æ¢å®ä½“å¼•ç”¨</strong>â€“&gt;<strong>æ‹‰ä¼¸å‡¸å°</strong>ï¼ˆè–„å£ç‰¹å¾ï¼Œæˆå½¢åˆ°ä¸€é¢ï¼‰ï¼›</li><li>è¾¹çº¿åœ†è§’å¤„ç†ï¼›</li></ul><h2 id="6ã€ç»˜åˆ¶å‹æ¿"><a href="#6ã€ç»˜åˆ¶å‹æ¿" class="headerlink" title="6ã€ç»˜åˆ¶å‹æ¿"></a>6ã€ç»˜åˆ¶å‹æ¿</h2><ul><li>æ–°å»ºé›¶ä»¶ï¼Œç»˜åˆ¶å‹æ¿</li><li>æ£€æŸ¥å¹²æ¶‰ï¼Œ ï¼ˆé€šè¿‡å‰–ç‰‡è§†å›¾æ£€æŸ¥ç”µè·¯æ¿ä¸Šæœ€é«˜å…ƒä»¶ï¼‰ï¼Œè§£å†³å¹²æ¶‰ï¼ˆåˆ‡é™¤ï¼‰ï¼›</li><li>ç»˜åˆ¶å±å¹•æ’çº¿ï¼Œæ£€æŸ¥å¹²æ¶‰ï¼ˆ<strong>å­¤ç«‹</strong>ï¼‰ï¼›</li><li>ç»˜åˆ¶å‹æ¿ä¸ç”µè·¯æ¿çš„æ”¯æ’‘ï¼Œå¹¶é™åˆ¶ç”µè·¯æ¿ä½ç½®ï¼›</li></ul><h2 id="7ã€ç»˜åˆ¶åå£³ã€èºä¸å­”"><a href="#7ã€ç»˜åˆ¶åå£³ã€èºä¸å­”" class="headerlink" title="7ã€ç»˜åˆ¶åå£³ã€èºä¸å­”"></a>7ã€ç»˜åˆ¶åå£³ã€èºä¸å­”</h2><ul><li>æ–°å»ºåå£³é›¶ä»¶â€”&gt;ç‚¹å‡»å‰å£³èƒŒé¢è¿›å…¥è‰å›¾â€“&gt;<strong>è½¬æ¢å®ä½“å¼•ç”¨</strong>â€“&gt;é€‰æ‹©å‰å£³åˆé€‚çš„é¢â€”&gt;æ‹‰ä¼¸å‡¸å°â€”&gt;åå£³èƒŒéƒ¨åœ†è§’</li><li>é€‰å‹åˆé€‚çš„èºä¸(2mmæ²‰å¤´è‡ªæ”»èºä¸)â€”&gt;ç¼–è¾‘åå£³â€“&gt;<strong>å¼‚æ€§å­”å‘å¯¼</strong>ï¼ˆé”¥å½¢æ²‰å¤´å­”ã€GBã€å¼€æ§½åŠæ²‰å¤´æœ¨èºé’‰ã€M2ã€ç´§å¯†ã€å®Œå…¨è´¯ç©¿ï¼‰â€“&gt;ç¡®å®šå­”ä½ç½®(è¾…åŠ©çŸ©å½¢)</li><li>ç»˜åˆ¶å‰å£³èºä¸åº•å­”ï¼šå‰å£³èƒŒéƒ¨è‰å›¾ç»˜åˆ¶ä¸¤ä¸ªåŒå¿ƒåœ†ï¼ˆåº•å­”1.8mm@M2ï¼‰â€“&gt;<strong>è£å‰ªå®ä½“</strong>è£å‰ªå¹²æ¶‰éƒ¨åˆ†â€“&gt;æ‹‰ä¼¸ï¼›</li><li>ç”Ÿæˆèºä¸ï¼š<strong>è¿ˆè¿ªå·¥å…·é›†</strong>ç”Ÿæˆ&#x2F;è‡ªç»˜ï¼›è¿ˆè¿ª:æ ‡å‡†ä»¶åº“â€“&gt;é€šç”¨æ ‡å‡†ä»¶åº“ï¼Œå¯ä»¥ä¿®æ”¹èºä¸å‚æ•°ï¼›</li><li>æŠ½å£³ï¼Œç•™å‡ºæ”¾ç½®ç”µæ± æ§½ï¼šï¼ˆ<strong>é€€å›æ¡</strong>é€€å›å¼‚æ€§å­”ç‰¹å¾ï¼‰â€“&gt;<strong>æŠ½å£³</strong>â€“&gt;é€€å›æ¡æ¢å¤ï¼ˆæ­¤æ—¶å¯¼è‡´å­”è½®å»“å¼‚å¸¸ï¼‰â€“&gt;è‰å›¾æ‹‰ä¼¸ï¼ˆ<strong>çˆ¶å­å…³ç³»è§£å†³</strong>ï¼šå…ˆä¾èµ–ï¼Œå†å–æ¶ˆä¾èµ–ï¼Œé€‰ä¸­ä½¿å›ºå®šï¼‰â€”&gt;é€€å›æ¡é€€å›å¼‚æ€§å­”ç‰¹å¾â€“&gt;<strong>å‡¸å°æ‹‰ä¼¸</strong>ï¼ˆ<strong>æˆå½¢åˆ°å®ä½“</strong>ï¼‰â€”&gt;é€€å›æ¢å¤</li></ul><h2 id="8ã€ç»˜åˆ¶æ”¯æ¶"><a href="#8ã€ç»˜åˆ¶æ”¯æ¶" class="headerlink" title="8ã€ç»˜åˆ¶æ”¯æ¶"></a>8ã€ç»˜åˆ¶æ”¯æ¶</h2><ul><li>é€‰è½´@M2ä¸é”ˆé’¢<strong>æ»šèŠ±é”€è½´</strong></li><li>åœ¨åå£³é¢ä¸Šæ–°å»ºé›¶ä»¶â€”&gt;é€‰ä¸­æ”¯æ¶æ§½é¢â€”&gt;è½¬æ¢å®ä½“å¼•ç”¨â€”&gt;æ‹‰ä¼¸å‡¸å°â€“&gt;åœ†è§’ï¼›</li><li>è£…é…ä½“ä¸­æ–°å»ºé›¶ä»¶éƒ½æœ‰<strong>åœ¨ä½é…åˆ</strong>ï¼ˆåˆ é™¤å³å¯ï¼‰â€“&gt;ä½¿å›ºå®š</li></ul><h2 id="9ã€ç”Ÿäº§ç»„è£…"><a href="#9ã€ç”Ÿäº§ç»„è£…" class="headerlink" title="9ã€ç”Ÿäº§ç»„è£…"></a>9ã€ç”Ÿäº§ç»„è£…</h2><ul><li>3Dæ‰“å°</li><li>å–·æ¼†ï¼ˆåšåº¦ä¼šæ€åŠ ï¼‰</li></ul><h1 id="2ã€å¸¸ç”¨æ“ä½œåŠå¸¸è§é—®é¢˜è§£å†³"><a href="#2ã€å¸¸ç”¨æ“ä½œåŠå¸¸è§é—®é¢˜è§£å†³" class="headerlink" title="2ã€å¸¸ç”¨æ“ä½œåŠå¸¸è§é—®é¢˜è§£å†³"></a>2ã€å¸¸ç”¨æ“ä½œåŠå¸¸è§é—®é¢˜è§£å†³</h1><ol><li>è‰å›¾ç»˜åˆ¶æ—¶é¼ æ ‡åˆ°åŸç‚¹ä¸å‡¸æ˜¾ï¼šè®¾ç½®â€“&gt;è‰å›¾â€“&gt;å‡ ä½•å…³ç³»&#x2F;æ•æ‰â€“&gt;æ¿€æ´»æ•æ‰ï¼›</li><li>è¯„ä¼°â€“&gt;æµ‹é‡ï¼›</li><li>3Dæ‰“å°åˆ¶é€ æœ€è–„åšåº¦<strong>0.8mm</strong>ï¼›</li><li>è£…é…è¦ç•™æœ‰åˆ¶é€ è¯¯å·®eg: 0.1mm@3Dæ‰“å°ï¼›</li><li></li></ol>]]></content>
      
      
      
        <tags>
            
            <tag> æœºæ¢°è®¾è®¡ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ExpressLRS</title>
      <link href="/2024/07/14/expresslrs/"/>
      <url>/2024/07/14/expresslrs/</url>
      
        <content type="html"><![CDATA[<h1 id="1ã€ELRSå·¥ç¨‹ç¼–è¯‘åŠå›ºä»¶ä¸‹è½½"><a href="#1ã€ELRSå·¥ç¨‹ç¼–è¯‘åŠå›ºä»¶ä¸‹è½½" class="headerlink" title="1ã€ELRSå·¥ç¨‹ç¼–è¯‘åŠå›ºä»¶ä¸‹è½½"></a>1ã€ELRSå·¥ç¨‹ç¼–è¯‘åŠå›ºä»¶ä¸‹è½½</h1><p><em><strong>å‚è€ƒï¼š</strong></em><a href="https://blog.csdn.net/lida2003/article/details/132518813">ExpressLRSå¼€æºä¹‹æ¥æ”¶æœºå›ºä»¶ç¼–è¯‘çƒ§å½•æ­¥éª¤_elrs configurator-CSDNåšå®¢</a></p><p>â€‹vscode+platformIO+Arduinoæ¡†æ¶ï¼Œæœ¬æ¬¡ä½¿ç”¨<strong>ExpressLRS-3.3.2</strong>ç‰ˆæœ¬ï¼Œåˆ†åˆ«ç¼–è¯‘äº†DIY-915-ESP32-TXï¼ˆå¼€æºç¡¬ä»¶ï¼‰ã€DIY-915-esp8285-RXï¼ˆå¼€æºç¡¬ä»¶ï¼‰ã€BETAFPV-915-RXï¼ˆeps8285ï¼‰ã€‚</p><ul><li><p>DIY-915-ESP32-TXä¿®æ”¹äº†<code>DIY 900 E19.json</code>ä¸­<code>&quot;misc_fan_en&quot;: 4,  &quot;led_green&quot;: 27</code>;</p></li><li><p>DIY-915-esp8285-RXä¿®æ”¹äº†<code>Generic 900.json</code>ä¸­<code>&quot;radio_dio1&quot;: 5</code>ä¸º<code>&quot;power_rxen&quot;: 5</code>ï¼ˆåº”ä¸ºE32æ¨¡å—æ”¶å‘æ§åˆ¶æ”¹ä¸ºå¤–éƒ¨å¼•è„šæ§åˆ¶ï¼‰ï¼›</p></li><li><p>æœ€å¥½åœ¨å¤–ç½‘æƒ…å†µä¸‹ç¼–è¯‘ï¼Œå›ºä»¶çƒ§å½•å‡ºé”™å¯ä»¥ä½¿ç”¨<code>flash_download_tool</code>è¿›è¡Œå…¨ç‰‡æ“¦é™¤ï¼Œæˆ–è€…ç”¨è¯¥å·¥å…·çƒ§å½•ç¼–è¯‘ç”Ÿæˆçš„å›ºä»¶ï¼Œå¦‚ä¸‹å›¾ï¼š</p><p><a href="https://imgse.com/i/pkozHlq"><img src="https://s21.ax1x.com/2024/07/19/pkozHlq.md.webp" class="lazyload placeholder" data-srcset="https://s21.ax1x.com/2024/07/19/pkozHlq.md.webp" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="pkozHlq.md.webp"></a></p></li></ul><h1 id="2ã€å¸¸è§é—®é¢˜"><a href="#2ã€å¸¸è§é—®é¢˜" class="headerlink" title="2ã€å¸¸è§é—®é¢˜"></a>2ã€å¸¸è§é—®é¢˜</h1><ol><li>elrsæ¥æ”¶æœºå¼€å¯SBUSè¾“å‡ºé£æ§æ— åé¦ˆï¼šåœ¨TXä¸é£æ§RXé—´ä¸²è”1Kç”µé˜»ï¼›</li></ol>]]></content>
      
      
      
        <tags>
            
            <tag> èˆªæ¨¡ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>esp32s3</title>
      <link href="/2024/07/13/esp32s3/"/>
      <url>/2024/07/13/esp32s3/</url>
      
        <content type="html"><![CDATA[<h1 id="1ã€ä¹é‘«ESP32S3"><a href="#1ã€ä¹é‘«ESP32S3" class="headerlink" title="1ã€ä¹é‘«ESP32S3"></a>1ã€ä¹é‘«ESP32S3</h1><ol><li><a href="https://www.espressif.com.cn/zh-hans/products/socs/esp32-s3">ESP32-S3 Wi-Fi &amp; BLE 5 SoCï½œä¹é‘«ç§‘æŠ€ (espressif.com.cn)</a></li><li><a href="https://docs.espressif.com/projects/esp-idf/zh_CN/stable/esp32s3/get-started/index.html">å¿«é€Ÿå…¥é—¨ - ESP32-S3 - â€” ESP-IDF ç¼–ç¨‹æŒ‡å— v5.2.2 æ–‡æ¡£ (espressif.com)</a></li></ol><h1 id="2ã€ç«‹åˆ›-esp32s3R8N8å¼€å‘æ¿"><a href="#2ã€ç«‹åˆ›-esp32s3R8N8å¼€å‘æ¿" class="headerlink" title="2ã€ç«‹åˆ›-esp32s3R8N8å¼€å‘æ¿"></a>2ã€ç«‹åˆ›-esp32s3R8N8å¼€å‘æ¿</h1><p><a href="https://lceda001.feishu.cn/wiki/PICgwjcDsiN7TjkWw5tc3OzbnHb">ã€ç«‹åˆ›Â·ESP32S3R8N8ã€‘å¼€å‘æ¿ - é£ä¹¦äº‘æ–‡æ¡£ (feishu.cn)</a></p><h1 id="3ã€åˆå®™-esp32s3å¼€å‘æ¿"><a href="#3ã€åˆå®™-esp32s3å¼€å‘æ¿" class="headerlink" title="3ã€åˆå®™-esp32s3å¼€å‘æ¿"></a>3ã€åˆå®™-esp32s3å¼€å‘æ¿</h1><p><a href="https://wiki.luatos.com/chips/esp32s3/index.html">ğŸ“¡ ESP32-S3 - LuatOS æ–‡æ¡£</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> åµŒå…¥å¼å¼€å‘ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>linuxå¸¸ç”¨å‘½ä»¤åŠæ ‘è“æ´¾ä½¿ç”¨</title>
      <link href="/2024/07/11/linux-chang-yong-ming-ling-ji-shu-mei-pai-shi-yong/"/>
      <url>/2024/07/11/linux-chang-yong-ming-ling-ji-shu-mei-pai-shi-yong/</url>
      
        <content type="html"><![CDATA[<h1 id="1ã€æ ‘è“æ´¾"><a href="#1ã€æ ‘è“æ´¾" class="headerlink" title="1ã€æ ‘è“æ´¾"></a>1ã€æ ‘è“æ´¾</h1><h2 id="1ã€å¸¸ç”¨å‘½ä»¤"><a href="#1ã€å¸¸ç”¨å‘½ä»¤" class="headerlink" title="1ã€å¸¸ç”¨å‘½ä»¤"></a>1ã€å¸¸ç”¨å‘½ä»¤</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//æŸ¥çœ‹æ ‘è“æ´¾ä¿¡æ¯</span></span><br><span class="line"><span class="number">1.</span> pinout</span><br><span class="line"><span class="number">2.</span> cat /proc/device-tree/model</span><br><span class="line"></span><br><span class="line"><span class="comment">//æŸ¥çœ‹cpu</span></span><br><span class="line"><span class="number">1</span>ã€cat /proc/cpuinfo</span><br><span class="line"></span><br><span class="line"><span class="comment">//æ‰“å°æ¸©åº¦</span></span><br><span class="line"><span class="number">1</span>ã€echo $[$(cat /sys/class/thermal/thermal_zone0/temp)/<span class="number">1000</span>]</span><br></pre></td></tr></table></figure><h2 id="2ã€æ ‘è“æ´¾ä½¿ç”¨æ‘„åƒå¤´"><a href="#2ã€æ ‘è“æ´¾ä½¿ç”¨æ‘„åƒå¤´" class="headerlink" title="2ã€æ ‘è“æ´¾ä½¿ç”¨æ‘„åƒå¤´"></a>2ã€æ ‘è“æ´¾ä½¿ç”¨æ‘„åƒå¤´</h2><p>[å¾®é›ªç”µå­RPi Camera V2](<a href="https://www.waveshare.net/wiki/RPi_Camera_V2#.E8.BD.AF.E4.BB.B6.E9.85.8D.E7.BD.AE">RPi Camera V2 - Waveshare Wiki</a>)</p><h2 id="3ã€å®‰è£…ä¸­æ–‡è¾“å…¥æ³•"><a href="#3ã€å®‰è£…ä¸­æ–‡è¾“å…¥æ³•" class="headerlink" title="3ã€å®‰è£…ä¸­æ–‡è¾“å…¥æ³•"></a>3ã€å®‰è£…ä¸­æ–‡è¾“å…¥æ³•</h2><p><a href="https://blog.csdn.net/f245775274/article/details/136246989?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522172053845616800225522603%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&request_id=172053845616800225522603&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduend~default-1-136246989-null-null.142%5Ev100%5Epc_search_result_base9&utm_term=%E6%A0%91%E8%8E%93%E6%B4%BE%E6%80%8E%E4%B9%88%E5%AE%89%E8%A3%85%E4%B8%AD%E6%96%87%E8%BE%93%E5%85%A5%E6%B3%95&spm=1018.2226.3001.4187">æ ‘è“æ´¾æ€ä¹ˆå®‰è£…ä¸­æ–‡è¾“å…¥æ³•</a></p><h2 id="4ã€æ–‡ä»¶ä¼ è¾“"><a href="#4ã€æ–‡ä»¶ä¼ è¾“" class="headerlink" title="4ã€æ–‡ä»¶ä¼ è¾“"></a>4ã€æ–‡ä»¶ä¼ è¾“</h2><h3 id="1ã€FTP"><a href="#1ã€FTP" class="headerlink" title="1ã€FTP"></a>1ã€FTP</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">FTP</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å®‰è£…vsftpdæœåŠ¡å™¨</span></span><br><span class="line">sudo apt-get install vsftpd</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å¯åŠ¨ftpæœåŠ¡</span></span><br><span class="line">sudo service vsftpd start </span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">é‡å¯</span></span><br><span class="line">sudo reboot</span><br></pre></td></tr></table></figure><p><em><strong>ps</strong></em>: <a href="https://blog.csdn.net/u014691333/article/details/115227957">ftpä¸Šä¼ æ–‡ä»¶å‡ºé”™ï¼š550 Permission denied</a></p><h3 id="2ã€-Samba"><a href="#2ã€-Samba" class="headerlink" title="2ã€ Samba"></a>2ã€ Samba</h3><p><a href="https://developer.baidu.com/article/details/3248075">æ ‘è“æ´¾ä¸Šçš„Samba NASç³»ç»Ÿï¼šæ­å»ºæ­¥éª¤ä¸å®ç”¨æŒ‡å—</a></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get update</span><br><span class="line">sudo apt-get install samba</span><br><span class="line">sudo gedit /etc/samba/smb.conf</span><br><span class="line">#æœ«å°¾æ·»åŠ </span><br><span class="line">[share]</span><br><span class="line">comment = samba home directory</span><br><span class="line">path = /home/xxx/xxx</span><br><span class="line">public = yes</span><br><span class="line">browseable = yes</span><br><span class="line">read only = no</span><br><span class="line">writable = yes</span><br><span class="line">create mask = 0777</span><br><span class="line">directory mask = 0777</span><br><span class="line">available = yes</span><br><span class="line">security = share</span><br><span class="line">#é‡å¯</span><br><span class="line">sudo service smbd restart</span><br><span class="line">sudo ufw allow samba</span><br></pre></td></tr></table></figure><p>windowsç³»ç»Ÿæ­¤ç”µè„‘â€”å³å‡»â€”&gt;æ˜ å°„ç½‘ç»œé©±åŠ¨å™¨</p><h3 id="3ã€ssh"><a href="#3ã€ssh" class="headerlink" title="3ã€ssh"></a>3ã€ssh</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">å®‰è£…</span></span><br><span class="line">sudo apt-get install openssh-server</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">æŸ¥çœ‹æ˜¯å¦å¼€å¯</span></span><br><span class="line">ps -e|grep ssh</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">å¼€å¯æœåŠ¡</span></span><br><span class="line">sudo /etc/init.d/ssh start</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">rootç™»å½•ssh</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">ç»™rootè®¾ç½®å¯†ç </span></span><br><span class="line">sudo passwd root   #æ­¤æ—¶å¯åˆ‡æ¢rootæƒé™:su  #é€€å‡ºroot:exit</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">rootç™»å½•æç¤ºæƒé™é—®é¢˜ï¼Œä¿®æ”¹:</span> </span><br><span class="line">vim etc/ssh/sshd_config</span><br><span class="line">PermitRootLogin yes</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">é‡å¯ssh</span></span><br><span class="line">sudo /etc/init.d/ssh restart</span><br></pre></td></tr></table></figure><p>vscodeå®‰è£…Remote-SSHæ’ä»¶ï¼Œé…ç½®configæ–‡ä»¶</p><h2 id="5ã€OELDæ˜¾ç¤º"><a href="#5ã€OELDæ˜¾ç¤º" class="headerlink" title="5ã€OELDæ˜¾ç¤º"></a>5ã€OELDæ˜¾ç¤º</h2><ul><li><p><strong>â€“</strong>&gt;<a href="https://github.com/rm-hull/luma.examples">luma.examples</a></p></li><li><p><a href="https://blog.csdn.net/2202_75762088/article/details/134625775">è¿›é˜¶ç¯‡â€”â€”æ ‘è“æ´¾OLEDæ¨¡å—çš„ä½¿ç”¨ å¤§é‡ä¾‹ç¨‹è¯¦è§£</a></p></li><li><p><a href="https://blog.csdn.net/2202_75762088/article/details/134625775">è§£å†³è¿è¡Œpip installæ—¶æç¤ºé”™è¯¯ï¼šerror: externally-managed-environment</a>, ä½¿ç”¨&#96;&#96;&#96;sudo apt-get install python-luma.oledè§£å†³;</p></li></ul><h2 id="6ã€å¼€æœºè‡ªåŠ¨è¿è¡Œpythonè„šæœ¬"><a href="#6ã€å¼€æœºè‡ªåŠ¨è¿è¡Œpythonè„šæœ¬" class="headerlink" title="6ã€å¼€æœºè‡ªåŠ¨è¿è¡Œpythonè„šæœ¬"></a>6ã€å¼€æœºè‡ªåŠ¨è¿è¡Œpythonè„šæœ¬</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo nano /etc/rc.local</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">åœ¨exit0å‰å¢åŠ ä¸€è¡Œ</span></span><br><span class="line">sudo python3 /home/pi/stats.py &amp;</span><br></pre></td></tr></table></figure><p><a href="https://blog.csdn.net/qq_43698730/article/details/121323743">æ ‘è“æ´¾å¼€æœºè‡ªåŠ¨è¿è¡Œpythonç¨‹åºçš„ä¸¤ç§æ–¹å¼</a></p><h1 id="2ã€Linuxå¸¸ç”¨å‘½ä»¤"><a href="#2ã€Linuxå¸¸ç”¨å‘½ä»¤" class="headerlink" title="2ã€Linuxå¸¸ç”¨å‘½ä»¤"></a>2ã€Linuxå¸¸ç”¨å‘½ä»¤</h1><p><a href="https://wwww.linuxcool.com/">Liunxå‘½ä»¤å¤§å…¨</a></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//æŸ¥çœ‹IPåœ°å€</span></span><br><span class="line"><span class="number">1</span>ã€hostname -I</span><br><span class="line"></span><br><span class="line"><span class="comment">//ç›‘æ§ç³»ç»Ÿä¿¡æ¯</span></span><br><span class="line"><span class="number">1</span>ã€top</span><br><span class="line"><span class="number">2</span>ã€htop</span><br><span class="line"></span><br><span class="line"><span class="comment">//å®‰è£….debæ–‡ä»¶</span></span><br><span class="line"><span class="number">1</span>ã€sudo dpkg -i xxxxx.deb</span><br><span class="line"></span><br><span class="line"><span class="comment">//å¸è½½.debæ–‡ä»¶</span></span><br><span class="line"><span class="number">1</span>ã€sudo dpkg -r xxxxx</span><br><span class="line"></span><br><span class="line"><span class="comment">//æŸ¥çœ‹å·²å®‰è£….debæ–‡ä»¶ï¼ˆè¿‡æ»¤:å«&quot;a&quot;çš„æ–‡ä»¶ï¼‰</span></span><br><span class="line"><span class="number">1</span>ã€sudo dpkg -l|grep <span class="string">&quot;a&quot;</span></span><br></pre></td></tr></table></figure><h1 id="3ã€æ ‘è“æ´¾å°ç”µè„‘"><a href="#3ã€æ ‘è“æ´¾å°ç”µè„‘" class="headerlink" title="3ã€æ ‘è“æ´¾å°ç”µè„‘"></a>3ã€æ ‘è“æ´¾å°ç”µè„‘</h1><p>â€‹æ ‘è“æ´¾4B4GV1.2ï¼Œ7å¯¸ISPæ— è§¦æ‘¸å±å¹•ï¼Œæ ‘è“æ´¾å®˜æ–¹æ¡Œé¢ç‰ˆå¸¦æ¨èè½¯ä»¶ç‰ˆæœ¬ã€‚</p><p><a href="https://imgtu.com/i/cXqGPU"><img src="https://z3.ax1x.com/2021/04/23/cXqGPU.md.jpg" class="lazyload placeholder" data-srcset="https://z3.ax1x.com/2021/04/23/cXqGPU.md.jpg" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="cXqGPU.md.jpg" style="zoom: 150%;" /></a></p><p><a href="https://imgtu.com/i/cXq0Vx"><img src="https://z3.ax1x.com/2021/04/23/cXq0Vx.md.jpg" class="lazyload placeholder" data-srcset="https://z3.ax1x.com/2021/04/23/cXq0Vx.md.jpg" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="cXq0Vx.md.jpg" style="zoom:150%;" /></a></p><p><a href="https://imgtu.com/i/cXqDIK"><img src="https://z3.ax1x.com/2021/04/23/cXqDIK.md.jpg" class="lazyload placeholder" data-srcset="https://z3.ax1x.com/2021/04/23/cXqDIK.md.jpg" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="cXqDIK.md.jpg" style="zoom:150%;" /></a></p><h1 id="4ã€åŒç³»ç»Ÿ"><a href="#4ã€åŒç³»ç»Ÿ" class="headerlink" title="4ã€åŒç³»ç»Ÿ"></a>4ã€åŒç³»ç»Ÿ</h1><h2 id="1ã€ç³»ç»Ÿåˆ†åŒº"><a href="#1ã€ç³»ç»Ÿåˆ†åŒº" class="headerlink" title="1ã€ç³»ç»Ÿåˆ†åŒº"></a>1ã€ç³»ç»Ÿåˆ†åŒº</h2><p>â€‹è‹¥å­˜å‚¨ç©ºé—´å……è¶³ä¸”ä¸ºå¤§å®¹é‡ç¡¬ç›˜æ—¶ï¼Œå¯ä»¥å°†å®‰è£…Linux_Ubuntuç³»ç»Ÿçš„ç¡¬ç›˜åˆ†åŒºä¸ºå››ä¸ªåˆ†åŒºï¼Œåˆ†åˆ«ä¸º<strong>efi</strong>ï¼ˆUbuntuç³»ç»Ÿå¼•å¯¼åŒºï¼‰ã€<strong>swap</strong>ï¼ˆå†…å­˜äº¤æ¢ç©ºé—´ï¼Œå†…å­˜æ•°æ®æº¢å‡ºæˆ–è®¡ç®—æœºå‡†å¤‡ä¼‘çœ æ—¶ä¼šå°†æ•°æ®å­˜å…¥è¯¥åŒºï¼‰ã€<strong>ext4.&#x2F;<strong>ï¼ˆUbuntuæ ¹éƒ¨æŒ‚è½½ç‚¹ï¼Œå¯ä»¥å¯¹æ¯”ç†è§£ä¸ºWindowsç³»ç»Ÿä¸‹çš„Cç³»ç»Ÿç›˜ï¼‰ã€</strong>ext4.&#x2F;home</strong>ï¼ˆUbuntuæ ¹éƒ¨å­æŒ‚è½½ç‚¹ï¼Œç”¨äºå­˜æ”¾ç”¨æˆ·æ•°æ®ï¼Œå¯ä»¥å¯¹æ¯”ç†è§£ä¸ºWindowsç³»ç»Ÿä¸‹çš„éç³»ç»Ÿç›˜ï¼‰ã€‚</p><p>â€‹å‚è€ƒï¼š<a href="https://blog.csdn.net/Jcb1906824038/article/details/134950127">Windows&#x2F;LinuxåŒç³»ç»Ÿå®‰è£…ï¼ˆåŒç³»ç»Ÿç‹¬ç«‹åˆ†ç›˜ï¼‰-CSDNåšå®¢</a></p><h2 id="2ã€åŒç³»ç»Ÿåˆ é™¤ä¸€ä¸ªç³»ç»Ÿ"><a href="#2ã€åŒç³»ç»Ÿåˆ é™¤ä¸€ä¸ªç³»ç»Ÿ" class="headerlink" title="2ã€åŒç³»ç»Ÿåˆ é™¤ä¸€ä¸ªç³»ç»Ÿ"></a>2ã€åŒç³»ç»Ÿåˆ é™¤ä¸€ä¸ªç³»ç»Ÿ</h2><p>â€‹åˆ é™¤ç³»ç»Ÿåˆ†åŒºï¼ˆåŒ…æ‹¬è¯¥ç³»ç»Ÿå¯¹åº”çš„EFIå¼•å¯¼ï¼‰ã€‚</p><p>â€‹å‚è€ƒï¼š<a href="https://blog.csdn.net/lele_god/article/details/109046860">Windows+UbuntuåŒç³»ç»Ÿå¦‚ä½•å½»åº•åˆ é™¤Ubuntuæ“ä½œç³»ç»Ÿ_winå’Œubuntuç³»ç»Ÿæ€ä¹ˆåˆ é™¤ubuntuç³»ç»Ÿ-CSDNåšå®¢</a></p><h1 id="5ã€è™šæ‹Ÿæœº"><a href="#5ã€è™šæ‹Ÿæœº" class="headerlink" title="5ã€è™šæ‹Ÿæœº"></a>5ã€è™šæ‹Ÿæœº</h1><p>â€‹å‚è€ƒï¼š<a href="https://blog.csdn.net/KRISNAT/article/details/124100113">è¶…è¯¦ç»†VMwareå®‰è£…Ubuntuè™šæ‹Ÿæœºæ­¥éª¤_vmwareè™šæ‹Ÿæœºå®‰è£…ubuntuæ•™ç¨‹-CSDNåšå®¢</a></p><p>â€‹<a href="https://blog.csdn.net/qq_27462573/article/details/130484723">ç”µè„‘æœ¬æœºè¿äº†VPN åœ¨è™šæ‹Ÿæœºä¸­æ²¡æœ‰è¿æ¥ å¦‚ä½•è™šæ‹Ÿæœºå…±äº«ä¸»æœºVPNè¿æ¥-CSDNåšå®¢</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å†…å­˜ç®¡ç†-å †æ ˆ</title>
      <link href="/2024/07/05/nei-cun-guan-li-dui-zhan/"/>
      <url>/2024/07/05/nei-cun-guan-li-dui-zhan/</url>
      
        <content type="html"><![CDATA[<h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><ul><li>The data stored on the stack is static, of fixed size, and a fixed life cycle, and cannot be referenced across the stack.</li><li>The data stored on the heap is dynamic, not fixed size, not fixed life cycle, and can be referensced across stacks.</li></ul><h1 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h1><ol><li><a href="https://webdeveloper.beehiiv.com/p/memory-management-every-programmer-know">Memory Management Every Developer Should Know</a></li></ol>]]></content>
      
      
      
        <tags>
            
            <tag> è®¡ç®—æœº </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hexoåšå®¢æ­å»º</title>
      <link href="/2023/12/24/hexo-bo-ke-da-jian/"/>
      <url>/2023/12/24/hexo-bo-ke-da-jian/</url>
      
        <content type="html"><![CDATA[<h1 id="1ã€èƒŒæ™¯-ç›®æ ‡"><a href="#1ã€èƒŒæ™¯-ç›®æ ‡" class="headerlink" title="1ã€èƒŒæ™¯&amp;ç›®æ ‡"></a>1ã€èƒŒæ™¯&amp;ç›®æ ‡</h1><p>ç”±äºå¾ˆé•¿æ—¶é—´æ²¡æœ‰è®°å½•ã€æ›´æ¢githubè´¦å·ã€æœ¬åœ°ç”µè„‘é‡ç½®ã€ä½¿ç”¨çš„<a href="https://blinkfox.github.io/">ä¸»é¢˜</a>æœ‰æ‰€æ›´æ–°ç­‰åŸå› ï¼Œ<a href="https://xuzhiwei-create.github.io/">åŸæ¥çš„åšå®¢</a>æ˜¾å¾—æœ‰ç‚¹æ‚ä¹±ï¼Œæ‰€ä»¥è¶ç©ºé—²æ—¶é—´é‡æ–°åšä¸€ä¸‹ï¼Œæ­£å¥½ç»è¿‡ä¸€æ®µæ—¶é—´å­¦ä¹ ï¼Œå¯¹ç›¸å…³æ¦‚å¿µæœ‰äº†æ›´æ·±çš„äº†è§£ã€‚</p><p>â€‹<strong>Hexo</strong> æ˜¯ä¸€ä¸ªå¿«é€Ÿã€ç®€æ´ä¸”é«˜æ•ˆçš„åšå®¢æ¡†æ¶ã€‚Hexo ä½¿ç”¨ Markdownï¼ˆæˆ–å…¶ä»–æ¸²æŸ“å¼•æ“ï¼‰è§£ææ–‡ç« ï¼Œåœ¨å‡ ç§’å†…ï¼Œå³å¯åˆ©ç”¨é“ä¸½çš„ä¸»é¢˜ç”Ÿæˆé™æ€ç½‘é¡µã€‚HexoåŸºäºNode.jsï¼Œæ”¯æŒå¤šè¿›ç¨‹ï¼Œå‡ ç™¾ç¯‡æ–‡ç« ä¹Ÿå¯ä»¥ç§’ç”Ÿæˆã€‚ æ”¯æŒGitHub Flavored Markdownå’Œæ‰€æœ‰Octopressçš„æ’ä»¶ã€‚ Hexoæ”¯æŒEJSã€Swigå’ŒStylusã€‚é€šè¿‡æ’ä»¶æ”¯æŒHamlã€Jadeå’ŒLessã€‚</p><p>â€‹ä¹‹å‰ç¬¬ä¸€æ¬¡æ­å»ºçš„åšå®¢æ€»ç»“ï¼š</p><p>â€‹é¦–å…ˆç”µè„‘ä¸Šä¸‹è½½ï¼Œgitå’Œnodeï¼ˆç‰ˆæœ¬ä¸è¦å¤ªé«˜12.å‡ çš„å°±å¯ä»¥äº†ï¼‰ï¼Œåœ¨æœ¬åœ°å»ºç«‹ä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œç”¨æ¥æ”¾ç½®è¦éƒ¨ç½²åˆ°githubä¸Šçš„å†…å®¹ï¼Œæ–°å»ºgithubä»“åº“ï¼Œæ³¨æ„å‘½åè§„èŒƒï¼ˆä¸ç”¨æˆ·åä¸€è‡´.github.io),æ‰§è¡Œhexoå‘½ä»¤ï¼ˆhexo newâ€â€æ–°å»ºåšå®¢ï¼Œhexo gç”Ÿæˆåšå®¢ï¼Œhexo s æœ¬åœ°é¢„è§ˆï¼Œhexo déƒ¨ç½²åˆ°githubï¼‰åšå®¢æ–‡ä»¶å­˜åœ¨sourseæ–‡ä»¶å¤¹çš„postä¸­ï¼Œæ¥ä¸‹æ¥å°±å¯ä»¥æ ¹æ®è‡ªå·±çš„å–œå¥½ï¼Œå®‰è£…ç›¸å…³åŠŸèƒ½ï¼Œåšå®¢çš„é…ç½®æ–‡ä»¶ä¸ºæ ¹ç›®å½•ä¸‹çš„config.ymlæ–‡ä»¶ï¼Œä¸»é¢˜çš„é…ç½®æ–‡ä»¶ä¸ºæ ¹ç›®å½•ä¸‹çš„themesæ–‡ä»¶å¤¹ä¸­çš„config.ymlæ–‡ä»¶ï¼ˆä¸è¦ææ··ï¼‰ï¼Œè¿™é‡Œæˆ‘é€‰ç”¨çš„æ˜¯nextä¸»é¢˜æ–¹æ¡ˆã€‚</p><p>[<img src="https://z3.ax1x.com/2021/04/11/c0sRAI.md.png" class="lazyload placeholder" data-srcset="https://z3.ax1x.com/2021/04/11/c0sRAI.md.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="c0sRAI.md.png" style="zoom:150%;" /></p><h1 id="2ã€å‚è€ƒ-å·¥å…·"><a href="#2ã€å‚è€ƒ-å·¥å…·" class="headerlink" title="2ã€å‚è€ƒ&amp;å·¥å…·"></a>2ã€å‚è€ƒ&amp;å·¥å…·</h1><ol><li><p><a href="https://hexo.io/zh-cn/">Hexoæ¡†æ¶</a></p></li><li><p><a href="https://blinkfox.github.io/2018/09/28/qian-duan/hexo-bo-ke-zhu-ti-zhi-hexo-theme-matery-de-jie-shao/">Hexoä¸»é¢˜ä¹‹hexo-theme-materyçš„ä»‹ç»</a></p></li><li><p><a href="https://zhuanlan.zhihu.com/p/60578464">ä½¿ç”¨ Hexo+GitHub æ­å»ºä¸ªäººå…è´¹åšå®¢æ•™ç¨‹</a></p></li><li><p><a href="https://imgse.com/">è·¯è¿‡å›¾åºŠ:imgse</a>@<a href="mailto:&#120;&#x75;&#x7a;&#x68;&#105;&#x77;&#101;&#x69;&#x72;&#x6f;&#x40;&#x31;&#x36;&#51;&#46;&#x63;&#x6f;&#x6d;">&#120;&#x75;&#x7a;&#x68;&#105;&#x77;&#101;&#x69;&#x72;&#x6f;&#x40;&#x31;&#x36;&#51;&#46;&#x63;&#x6f;&#x6d;</a> â€”&gt; ä½¿ç”¨picGo+giteeå»ºç«‹å›¾åºŠ<a href="https://blog.csdn.net/duleilewuhen/article/details/139478827">åˆ©ç”¨ PicGo æ­å»ºåŸºäº gitee çš„ä¸ªäººå›¾åºŠï¼Œè¯¦ç»†æ”»ç•¥ï¼_picgo gitee-CSDNåšå®¢</a></p></li></ol><p>å¼€å§‹å‡†å¤‡å°†Hexoé™æ€åšå®¢éƒ¨ç½²åœ¨giteeçš„gitpageä¸Šã€‚</p><p><a href="https://imgse.com/i/pkozwwD"><img src="https://s21.ax1x.com/2024/07/19/pkozwwD.md.webp" class="lazyload placeholder" data-srcset="https://s21.ax1x.com/2024/07/19/pkozwwD.md.webp" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="pkozwwD.md.webp"></a></p><p>ä½†æ˜¯ç»è¿‡äº†è§£ï¼Œé™¤äº†è®¿é—®é€Ÿåº¦å¿«å¤–ï¼Œå­˜åœ¨å¾ˆå¤šç¼ºé™·ï¼Œè¿˜è¦å®åè®¤çœŸã€‚ä»¥ä¸‹æ˜¯å‡ ç§æ–¹æ¡ˆå¯¹æ¯”</p><p><a href="https://imgse.com/i/pkozdeO"><img src="https://s21.ax1x.com/2024/07/19/pkozdeO.md.webp" class="lazyload placeholder" data-srcset="https://s21.ax1x.com/2024/07/19/pkozdeO.md.webp" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="pkozdeO.md.webp"></a></p><h1 id="3ã€åœ¨æ ‘è“æ´¾ä¸Šæ­å»ºhexoåšå®¢"><a href="#3ã€åœ¨æ ‘è“æ´¾ä¸Šæ­å»ºhexoåšå®¢" class="headerlink" title="3ã€åœ¨æ ‘è“æ´¾ä¸Šæ­å»ºhexoåšå®¢"></a>3ã€åœ¨æ ‘è“æ´¾ä¸Šæ­å»ºhexoåšå®¢</h1><ol><li><p>å®‰è£…gitï¼Œå®‰è£…nodejsï¼ˆå†…éƒ¨å«npmï¼‰;</p></li><li><p>gitè¿æ¥Github;</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git config --global user.name &quot;GitHub ç”¨æˆ·å&quot;</span><br><span class="line">git config --global user.email &quot;GitHub é‚®ç®±&quot;</span><br></pre></td></tr></table></figure></li><li><p>åˆ›å»ºSSHå¯†é’¥<code>ssh-keygen -t rsa -C &quot;GitHub é‚®ç®±&quot;</code>ï¼Œæ·»åŠ å…¬é’¥<code>id_rsa.pub</code>åˆ°Githubï¼Œæµ‹è¯•SSHæ˜¯å¦è¿æ¥æˆåŠŸ<code>ssh -T git@github.com</code>ï¼›</p></li><li><p>åˆ›å»ºGithubä»“åº“ï¼Œä»“åº“å<code>ç”¨æˆ·å.github.io</code>;</p></li><li><p>æœ¬åœ°å®‰è£…Hexoåšå®¢</p></li></ol><ul><li><p><strong>PS</strong>: npmé€Ÿåº¦æ…¢ï¼ˆä¸¤ç§æ–¹æ³•ï¼Œæ¨èç¬¬ä¸€ç§ï¼‰</p><ol><li>æ¢æº:<code> npm config set registry https://registry.npmmirror.com</code>ã€‚ï¼ˆ<strong>nrmæ˜¯npmæºç®¡ç†å™¨</strong>ï¼Œå®‰è£…nrmï¼š<code>npm install -g nrm</code>ï¼ŒæŸ¥çœ‹å¯é€‰æºï¼š<code>nrm ls</code>,æµ‹è¯•æºï¼š<code>nrm test</code>,åˆ‡æ¢æºï¼š<code>nrm use xxx(eg.taobao)</code>ï¼‰</li><li>ç”¨cnpmæ›¿æ¢npmï¼š<code>sudo npm install -g cnpm --registry=https://registry.npm.taobao.org</code></li></ol></li><li><p><strong>æ“ä½œæ­¥éª¤</strong>ï¼š</p><ol><li><p>å®‰è£…hexoåšå®¢<code>sudo npm install -g hexo-cli</code></p></li><li><p>åˆå§‹åŒ–ï¼ˆåœ¨åšå®¢ç©ºæ–‡ä»¶å¤¹ä¸­ï¼‰<code>hexo init</code>å¹¶å®‰è£…ç»„ä»¶<code>npm install</code></p></li><li><p>æµ‹è¯•ï¼Œå¯åŠ¨æœ¬åœ°æœåŠ¡å™¨é¢„è§ˆ<code>hexo generate</code> <code>hexo server</code></p></li><li><p>éƒ¨ç½²Hexoåˆ°Github Pagesä¸Šã€‚</p><ul><li><p>å®‰è£…hexo-deployer-git <code>npm install hexo-deployer-git --save</code></p></li><li><p>ä¿®æ”¹_config.ymlæ–‡ä»¶æœ«å°¾deployå†…å®¹</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">deploy:</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">&#x27;git&#x27;</span></span><br><span class="line">  <span class="attr">repository:</span> <span class="string">git@github.com:former-south-wind/former-south-wind.github.io.git</span></span><br><span class="line">  <span class="attr">branch:</span> <span class="string">main</span></span><br></pre></td></tr></table></figure></li><li><p>éƒ¨ç½²<code>hexo deployer</code></p></li></ul></li></ol></li></ul><h1 id="4ã€ä¸»é¢˜"><a href="#4ã€ä¸»é¢˜" class="headerlink" title="4ã€ä¸»é¢˜"></a>4ã€ä¸»é¢˜</h1><p>  <a href="https://hexo-theme-bamboo.netlify.app/">Bamboo</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> å‰ç«¯ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æœ¬ç§‘æ¯•è®¾--åŸºäºSTM32/Jetsonå¹³å°çš„æ— äººæœºç›®æ ‡è·Ÿè¸ª</title>
      <link href="/2022/11/04/ben-ke-bi-she-ji-yu-stm32-jetson-ping-tai-de-wu-ren-ji-mu-biao-gen-zong/"/>
      <url>/2022/11/04/ben-ke-bi-she-ji-yu-stm32-jetson-ping-tai-de-wu-ren-ji-mu-biao-gen-zong/</url>
      
        <content type="html"><![CDATA[<h1 id="1ã€èµ„æ–™"><a href="#1ã€èµ„æ–™" class="headerlink" title="1ã€èµ„æ–™"></a>1ã€èµ„æ–™</h1><p><a href="https://bbs.csdn.net/topics/607199151?utm_source=702048761">æˆ‘çš„NVIDIAå¼€å‘è€…ä¹‹æ—…â€”â€”Jetsonå¹³å°ä¸ŠåŸºäºYOLOV5-TRT-DeepSortç›®æ ‡æ£€æµ‹è·Ÿè¸ªåº”ç”¨</a></p><p><a href="https://zhuanlan.zhihu.com/p/520887006">ä½¿ç”¨é«˜é€Ÿè§†è§‰åé¦ˆçš„æ— äººæœºè‡ªä¸»ç›®æ ‡è·Ÿè¸ª</a></p><p>äºšåšæ™ºèƒ½</p><p><a href="https://www.jianshu.com/p/a9579f469f84">SLAMç³»åˆ—</a></p><p><a href="https://www.cnblogs.com/jins-note/p/10215511.html">KCFè·Ÿè¸ªç®—æ³•åŸç† å…¥é—¨è¯¦è§£</a><br>æ— äººæœºä¸é£æ§åè®®<br><a href="https://space.bilibili.com/453020436">UPä¸»ï¼šOpenJetson</a><br>**UPï¼šæ™¨å“¥æé£æœº<br><a href="https://blog.csdn.net/qq_45589658/article/details/109440786">CIFAR100æ•°æ®é›†ä»‹ç»åŠä½¿ç”¨æ–¹æ³•</a><br><a href="http://link.zhihu.com/?target=https://kns.cnki.net/KCMS/detail/detail.aspx?dbcode=CMFD&dbname=CMFDTEMP&filename=1019626215.nh&v=MDMxMzNwRWJQSVI4ZVgxTHV4WVM3RGgxVDNxVHJXTTFGckNVUjdxZlp1ZG9GeTNuVkw3TVZGMjZGN1c2R05QTnE=">åŸºäºæ·±åº¦å­¦ä¹ çš„æ— äººæœºå•ç›®æ ‡è¯†åˆ«ä¸è·Ÿè¸ªç®—æ³•ç ”ç©¶</a><br><a href="https://www.bilibili.com/video/av68085629/?vd_source=c2fe15d5282e5de556b5fccfc70e9600">jetson nano æ§åˆ¶å¤§ç–†tello å®ç°æ— äººæœºè¿½é€ç›®æ ‡</a><br>å¯ä»¥ç§Ÿè‹±ä¼Ÿè¾¾GPU</p><h1 id="2ã€å®é™…æ“ä½œ"><a href="#2ã€å®é™…æ“ä½œ" class="headerlink" title="2ã€å®é™…æ“ä½œ"></a>2ã€å®é™…æ“ä½œ</h1><p><a href="https://gitee.com/an-qianjun/kcf-algorithm-uav-tracking">KCFç³»åˆ—ç®—æ³•æ— äººæœºè·Ÿè¸ª: è‡ªå·±æ­å»ºçš„æ— äººæœºè·Ÿè¸ªå®éªŒï¼Œä¸»è¦è®²è½¯ä»¶ï¼Œç¡¬ä»¶çš„éœ€è¦ç­‰ç­‰ï¼Œä¸ºåˆå­¦è€…æä¾›å­¦ä¹ å»ºè®®åŠéœ€è¦å­¦ä¹ çš„å†…å®¹ï¼Œè®²è§£ä½¿ç”¨åˆ°çš„ä»£ç ç­‰ (gitee.com)</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> é¡¹ç›® </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¼€æºèˆªæ¨¡é¥æ§å™¨--èè‰æ§</title>
      <link href="/2021/08/14/kai-yuan-hang-mo-yao-kong-qi-luo-li-kong/"/>
      <url>/2021/08/14/kai-yuan-hang-mo-yao-kong-qi-luo-li-kong/</url>
      
        <content type="html"><![CDATA[<p>â€‹å¤§ä¸€æ—¶åšäº†å¼€æºé¡¹ç›®ï¼Œèè‰3ä»£èˆªæ¨¡é¥æ§å™¨ï¼Œè™½ç„¶åšçš„ä¸ç®—å¤ªä¸‘ï¼Œä½†è¿˜æ˜¯æœ‰ç‚¹å¤ªå¤§äº†ï¼Œæ´æ´æ¿ç„Šçš„ï¼Œè¿˜æœ‰ç‚¹ä¸ç¨³å®šï¼Œè¿™æ¬¡æ‰¾äº†å‡ºæ¥ï¼Œå‡†å¤‡ç”»å—æ¿å­å†åšä¸€éï¼ˆç°åœ¨çœ‹æ¥JLCçš„10*10æ¿å­æ˜¯çœŸå°ï¼Œä¸ºäº†è–…ç¾Šæ¯›ï¼Œåšçš„æœ‰ç‚¹ä¸‘ï¼Œé™åˆ¶äº†å¤ªå¤šï¼‰è¿™æ˜¯ä¹‹å‰çš„ï¼ˆçº¯æ‰‹å·¥åˆ‡å‰²æ‰“ç£¨çš„äºšå…‹åŠ›ï¼Œä¹Ÿè¿˜ä¸é”™ï¼‰<a href="https://imgtu.com/i/f66RN6"><img src="https://z3.ax1x.com/2021/08/14/f66RN6.jpg" class="lazyload placeholder" data-srcset="https://z3.ax1x.com/2021/08/14/f66RN6.jpg" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="f66RN6.jpg"></a></p><p>â€‹ä¸‹é¢ä¸‰å¼ å›¾æ˜¯ä»Šå¤©ç”»çš„ï¼ˆå—æ¿å­é™åˆ¶ï¼ŒæŒ¤çš„å¾ˆç´§å‡‘ï¼Œå†è¯´ä¹Ÿæ²¡å¿…è¦å†èŠ±40å¤šå—é’±æ‰“å‡ å¼ ç©çš„æ¿å­ï¼Œå¦å¤–JLCçœŸè‰¯å¿ƒï¼Œç‚¹èµï¼ï¼‰ã€‚ç«‹åˆ›EDAç”»çš„ï¼Œæ¥ä¸‹æ¥å‡†å¤‡å­¦ä¹ ç”¨ADç”»ã€‚</p><p><a href="https://imgtu.com/i/f66HHI"><img src="https://z3.ax1x.com/2021/08/14/f66HHI.png" class="lazyload placeholder" data-srcset="https://z3.ax1x.com/2021/08/14/f66HHI.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="f66HHI.png"></a></p><p><a href="https://imgtu.com/i/f6cur9"><img src="https://z3.ax1x.com/2021/08/14/f6cur9.png" class="lazyload placeholder" data-srcset="https://z3.ax1x.com/2021/08/14/f6cur9.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="f6cur9.png"></a></p><p>â€‹é€šè¿‡æŒ‰ç…§äº§å“è®¾è®¡çš„è¿½æ±‚å»åšä¸€ä»¶ä¸œè¥¿ï¼Œè™½ç„¶æ„Ÿè§‰å¾ˆå¥½ï¼Œä½†ç¡®å®æœ‰ç‚¹æµªè´¹æ—¶é—´ï¼Œå› ä¸ºç°åœ¨è‡ªå·±çš„èƒ½åŠ›å·®çš„å¤ªå¤šäº†ï¼Œä¸èƒ½è¿½æ±‚äºè¡¨é¢ï¼Œè¦ä¸“å¿ƒçš„ç ”ç©¶æœ¬è´¨çš„æŠ€æœ¯ã€‚</p><p><a href="http://www.moz8.com/forum.php?mod=viewthread&tid=142710">PS:åŸç‰ˆèè‰æ•™ç¨‹ï¼šï¼ˆæ„Ÿè°¢å¼€æºå¤§ç¥ï¼‰</a></p><p>â€‹æˆå“ï¼š</p><p><a href="https://imgtu.com/i/heulX6"><img src="https://z3.ax1x.com/2021/08/25/heulX6.jpg" class="lazyload placeholder" data-srcset="https://z3.ax1x.com/2021/08/25/heulX6.jpg" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="heulX6.jpg"></a></p><p>â€‹12é€šé“æ¥æ”¶æœºï¼š</p><p><a href="https://imgtu.com/i/heKKUg"><img src="https://z3.ax1x.com/2021/08/25/heKKUg.jpg" class="lazyload placeholder" data-srcset="https://z3.ax1x.com/2021/08/25/heKKUg.jpg" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="heKKUg.jpg"></a></p>]]></content>
      
      
      
        <tags>
            
            <tag> èˆªæ¨¡ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>STM32</title>
      <link href="/2021/08/12/stm32/"/>
      <url>/2021/08/12/stm32/</url>
      
        <content type="html"><![CDATA[<p>â€‹<a href="https://www.fangzhenxiu.com/post/6947348/">STM32å­¦ä¹ ç¬”è®°</a>  </p><p>â€‹<a href="https://blog.csdn.net/huang_527/article/details/127719181">åµŒå…¥å¼STM32æ·±å…¥ä¹‹RTOSç¼–ç¨‹</a>  </p><h1 id="1ã€èŠ¯ç‰‡é€‰å‹"><a href="#1ã€èŠ¯ç‰‡é€‰å‹" class="headerlink" title="1ã€èŠ¯ç‰‡é€‰å‹"></a>1ã€èŠ¯ç‰‡é€‰å‹</h1><p><a href="https://imgtu.com/i/f0LXkj"><img src="https://z3.ax1x.com/2021/08/12/f0LXkj.png" class="lazyload placeholder" data-srcset="https://z3.ax1x.com/2021/08/12/f0LXkj.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="f0LXkj.png"></a></p><p><a href="https://imgtu.com/i/f0OiBF"><img src="https://z3.ax1x.com/2021/08/12/f0OiBF.png" class="lazyload placeholder" data-srcset="https://z3.ax1x.com/2021/08/12/f0OiBF.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="f0OiBF.png"></a></p><h1 id="2ã€ä¸²å£"><a href="#2ã€ä¸²å£" class="headerlink" title="2ã€ä¸²å£"></a>2ã€ä¸²å£</h1><p>â€‹<strong>USART</strong> ï¼šUniversalSychronous Asychronous Receiver&#x2F;Transmitterï¼Œé€šç”¨åŒæ­¥å¼‚æ­¥æ¥æ”¶å™¨&#x2F;å‘é€å™¨ï¼Œèƒ½å®Œæˆå¼‚æ­¥å’ŒåŒæ­¥é€šä¿¡ã€‚</p><p>â€‹<strong>USRT</strong> ï¼šUniversalSychronous Receiver&#x2F;Transmitterï¼Œé€šç”¨åŒæ­¥æ¥æ”¶å™¨&#x2F;å‘é€å™¨ï¼Œèƒ½å¤Ÿå®ŒæˆåŒæ­¥é€šä¿¡ã€‚</p><p>æ­¤å¤–ä¸²å£è¿˜æœ‰<strong>UART</strong>:UniversalAsychronous Receiver&#x2F;Transmitterï¼Œé€šç”¨å¼‚æ­¥æ¥æ”¶å™¨&#x2F;å‘é€å™¨ï¼Œèƒ½å¤Ÿå®Œæˆå¼‚æ­¥é€šä¿¡ã€‚</p><p>a.å¼‚æ­¥é€šè®¯           Asynchronous</p><p>b.åŒæ­¥é€šè®¯           Synchronous</p><p>c.åŠåŒå·¥æ¨¡å¼        Single Wire(Half-Duple)</p><p>d.å¤šå¤„ç†å™¨é€šè®¯MultiprocessorCommunication</p><p>e.çº¢å¤–é€šè®¯           IrDA</p><p>f.å±€åŸŸäº’è”ç½‘         LIN</p><p>g.æ™ºèƒ½å¡æ¨¡å¼        SmartCard</p><p>h.æ™ºèƒ½å¡+æ—¶é’Ÿ   SmartCard with Card Clock</p>]]></content>
      
      
      
        <tags>
            
            <tag> åµŒå…¥å¼å¼€å‘ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>OpenHD-æ ‘è“æ´¾æ•°å­—å›¾ä¼ </title>
      <link href="/2021/08/03/openhd-shu-mei-pai-shu-zi-tu-chuan/"/>
      <url>/2021/08/03/openhd-shu-mei-pai-shu-zi-tu-chuan/</url>
      
        <content type="html"><![CDATA[<h1 id="1ã€OpenHD"><a href="#1ã€OpenHD" class="headerlink" title="1ã€OpenHD"></a>1ã€OpenHD</h1><p><a href="https://imgse.com/i/pkT3kKP"><img src="https://s21.ax1x.com/2024/07/19/pkT3kKP.md.webp" class="lazyload placeholder" data-srcset="https://s21.ax1x.com/2024/07/19/pkT3kKP.md.webp" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="pkT3kKP.md.webp"></a></p><p>â€‹ezå›ºä»¶ï¼Œè¿˜æœ‰rubyå›ºä»¶</p>]]></content>
      
      
      
        <tags>
            
            <tag> èˆªæ¨¡ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ESP8266</title>
      <link href="/2021/07/25/esp8266/"/>
      <url>/2021/07/25/esp8266/</url>
      
        <content type="html"><![CDATA[<h1 id="1ã€esp8266ç³»åˆ—æ¨¡å—"><a href="#1ã€esp8266ç³»åˆ—æ¨¡å—" class="headerlink" title="1ã€esp8266ç³»åˆ—æ¨¡å—"></a>1ã€esp8266ç³»åˆ—æ¨¡å—</h1><p>â€‹ESP8266 ç³»åˆ—æ¨¡ç»„æ˜¯æ·±åœ³å¸‚å®‰ä¿¡å¯ç§‘æŠ€æœ‰é™å…¬å¸å¼€å‘çš„ä¸€ç³»åˆ—åŸºäºä¹é‘«ESP8266EXçš„ä½åŠŸè€—UART-WiFièŠ¯ç‰‡æ¨¡ç»„ï¼Œå¯ä»¥æ–¹ä¾¿åœ°è¿›è¡ŒäºŒæ¬¡å¼€å‘ï¼Œæ¥å…¥äº‘ç«¯æœåŠ¡ï¼Œå®ç°æ‰‹æœº3&#x2F;4Gå…¨çƒéšæ—¶éšåœ°çš„æ§åˆ¶ï¼ŒåŠ é€Ÿäº§å“åŸå‹è®¾è®¡ã€‚</p><p>ã€€ã€€æ¨¡å—æ ¸å¿ƒå¤„ç†å™¨ ESP8266 åœ¨è¾ƒå°å°ºå¯¸å°è£…ä¸­é›†æˆäº†ä¸šç•Œé¢†å…ˆçš„ Tensilica L106 è¶…ä½åŠŸè€— 32 ä½å¾®å‹ MCUï¼Œå¸¦æœ‰ 16 ä½ç²¾ç®€æ¨¡å¼ï¼Œä¸»é¢‘æ”¯æŒ 80 MHz å’Œ 160 MHzï¼Œæ”¯æŒ RTOSï¼Œé›†æˆ Wi-Fi MAC&#x2F; BB&#x2F;RF&#x2F;PA&#x2F;LNAï¼Œæ¿è½½å¤©çº¿ã€‚æ”¯æŒæ ‡å‡†çš„ IEEE802.11 b&#x2F;g&#x2F;n åè®®ï¼Œå®Œæ•´çš„ TCP&#x2F;IP åè®®æ ˆã€‚ç”¨æˆ·å¯ä»¥ä½¿ç”¨è¯¥æ¨¡å—ä¸ºç°æœ‰çš„è®¾å¤‡æ·»åŠ è”ç½‘åŠŸèƒ½ï¼Œä¹Ÿå¯ä»¥æ„å»ºç‹¬ç«‹çš„ç½‘ç»œæ§åˆ¶å™¨ã€‚</p><pre><code> **ç‰¹ç‚¹:**</code></pre><ul><li>802.11 b&#x2F;g&#x2F;n</li><li>å†…ç½®Tensilica L106 è¶…ä½åŠŸè€— 32 ä½å¾®å‹ MCUï¼Œä¸»é¢‘æ”¯æŒ 80 MHz å’Œ160 MHzï¼Œæ”¯æŒ RTOS</li><li>å†…ç½®10 bité«˜ç²¾åº¦ADC</li><li>å†…ç½®TCP&#x2F;IPåè®®æ ˆ</li><li>å†…ç½®TR å¼€å…³ã€balunã€LNAã€åŠŸç‡æ”¾å¤§å™¨å’ŒåŒ¹é…ç½‘ç»œ</li><li>å†…ç½®PLLã€ç¨³å‹å™¨å’Œç”µæºç®¡ç†ç»„ä»¶ï¼Œ802.11b æ¨¡å¼ä¸‹+18 dBmçš„è¾“å‡ºåŠŸç‡</li><li>A-MPDU ã€ A-MSDU çš„èšåˆå’Œ 0.4 sçš„ä¿æŠ¤é—´éš”</li><li>Wi-Fi @ 2.4 GHzï¼Œæ”¯æŒ WPA&#x2F;WPA2 å®‰å…¨æ¨¡å¼</li><li>æ”¯æŒATæœ¬åœ°å‡çº§åŠäº‘ç«¯OTAå‡çº§</li><li>æ”¯æŒ STA&#x2F;AP&#x2F;STA+AP å·¥ä½œæ¨¡å¼</li><li>æ”¯æŒ Smart Config åŠŸèƒ½ï¼ˆåŒ…æ‹¬ Android å’Œ IOS è®¾å¤‡ï¼‰</li><li>HSPI ã€UARTã€I2Cã€I2Sã€IR Remote Controlã€PWMã€GPIO</li><li>æ·±åº¦ç¡çœ ä¿æŒç”µæµä¸º 20 uAï¼Œå…³æ–­ç”µæµå°äº 5 uA</li><li>2 ms ä¹‹å†…å”¤é†’ã€è¿æ¥å¹¶ä¼ é€’æ•°æ®åŒ…</li><li>å¾…æœºçŠ¶æ€æ¶ˆè€—åŠŸç‡å°äº1.0 mW (DTIM3)</li><li>å·¥ä½œæ¸©åº¦èŒƒå›´ï¼šè¯¦æƒ…è¯·è§å…·ä½“å‹å·è§„æ ¼ä¹¦</li></ul><p><a href="https://imgtu.com/i/fCFrdK"><img src="https://z3.ax1x.com/2021/08/02/fCFrdK.png" class="lazyload placeholder" data-srcset="https://z3.ax1x.com/2021/08/02/fCFrdK.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="fCFrdK.png"  /></a></p><h1 id="2ã€å›ºä»¶ä¸‹è½½é”™è¯¯è¿›è¡Œæ“¦é™¤"><a href="#2ã€å›ºä»¶ä¸‹è½½é”™è¯¯è¿›è¡Œæ“¦é™¤" class="headerlink" title="2ã€å›ºä»¶ä¸‹è½½é”™è¯¯è¿›è¡Œæ“¦é™¤"></a>2ã€å›ºä»¶ä¸‹è½½é”™è¯¯è¿›è¡Œæ“¦é™¤</h1><p>â€‹ESPtool.pyæ˜¯ä¸€ä¸ªpythonå¼€å‘çš„é’ˆå¯¹ESP8266çš„å°å·¥å…·ï¼Œå¯ä»¥å®ç°åº•å±‚çš„æ“ä½œï¼Œå¼¥è¡¥ESP8266å®˜æ–¹å·¥å…·çš„ä¸è¶³ã€‚flashçš„å°å·¥å…·ï¼Œå¯ä»¥å¼¥è¡¥ESP8266å®˜æ–¹å·¥å…·çš„ä¸è¶³ã€‚å®ƒä¹Ÿæ˜¯ä¸€ä¸ªå¼€æºé¡¹ç›®ï¼Œé¡¹ç›®åœ¨githubä¸Šè¿›è¡Œæ‰˜ç®¡ï¼š<a href="https://github.com/themadinventor/esptool">https://github.com/themadinventor/esptool</a></p><p>â€‹è™½ç„¶å¯ä»¥ç›´æ¥ä»githubä¸Šä¸‹è½½ä½¿ç”¨ï¼Œä½†æ˜¯æ›´å¥½çš„æ–¹æ³•æ˜¯é€šè¿‡ç½‘ç»œçš„æ–¹å¼è¿›è¡Œå®‰è£…ï¼Œè¿™æ ·ä¸ä¼šç¼ºå°‘ä¾èµ–æ¨¡å—ï¼Œå‡å°‘è¿è¡Œä¸­çš„æ•…éšœã€‚ä¸‹é¢å°±ä»‹ç»å®ƒçš„å®‰è£…æ–¹æ³•ã€‚</p><ol><li><p>å› ä¸ºesptool.pyéœ€è¦ä½¿ç”¨python2ï¼Œæ‰€ä»¥æˆ‘ä»¬å…ˆéœ€è¦å®‰è£…python2ï¼Œå¹¶å°†pythonåŠ å…¥ç³»ç»Ÿè·¯å¾„ï¼ˆpathï¼‰ã€‚</p></li><li><p>å®‰è£…pythonçš„åŒ…ç®¡ç†å™¨pipï¼Œé€šå¸¸æ˜¯ä½¿ç”¨get-pip.pyè¿›è¡Œå®‰è£…ã€‚åœ¨ <a href="https://pip.pypa.io/en/latest/installing/">https://pip.pypa.io/en/latest/installing/</a> å¯ä»¥æ‰¾åˆ°å®‰è£…çš„è¯´æ˜å’Œéœ€è¦ä¸‹è½½çš„æ–‡ä»¶ï¼ŒæŒ‰ç…§è¯´æ˜å¯ä»¥å¾ˆå®¹æ˜“å®‰è£…pipã€‚ï¼ˆå¦‚æœåŒæ—¶å®‰è£…äº†python2å’Œpython3ï¼Œpipå¯èƒ½é»˜è®¤æ˜¯pip3ï¼Œéœ€è¦ç”¨pip2æ¥ä»£æ›¿ä¸‹é¢çš„pipï¼Œåœ¨Linuxä¸Šéœ€è¦ç”¨sudoæƒé™å®‰è£…ï¼‰ã€‚</p></li><li><p>ç”¨pipå®‰è£…esptool<br><code>pip install esptool</code></p></li><li><p>å› ä¸ºesptooléœ€è¦ä½¿ç”¨ä¸²å£ï¼Œæ‰€ä»¥è¿˜éœ€è¦å®‰è£…pyserialã€‚</p></li></ol><p><code>pip install pyserial</code></p><ol start="5"><li>å®‰è£…åï¼Œåœ¨Linuxä¸‹ï¼Œé€šå¸¸å°±å¯ä»¥ç›´æ¥è¿è¡Œesptool.pyï¼Œåœ¨Windwosä¸‹ï¼Œesptoolä¸€èˆ¬å®‰è£…åœ¨python2\Scripts\ç›®å½•ä¸‹ï¼Œéœ€è¦è¾“å…¥å®Œæ•´ç›®å½•æ‰èƒ½è¿è¡Œï¼Œå¦‚ï¼š</li></ol><p><code>c:\Python27\Scripts\esptool.py</code></p><p>â€‹å¦‚æœä¸æ¸…æ¥šesptool.pyçš„ç”¨æ³•ï¼Œå¯ä»¥è¾“å…¥-hæŸ¥çœ‹å¸®åŠ©ï¼Œå¦‚</p><p> <code>esptool.py -h</code></p><p>â€‹ç”šè‡³å¯ä»¥æŸ¥çœ‹æŸä¸ªç”¨æ³•çš„å¸®åŠ©ï¼š</p><p> <code>esptool.py read_flash -h</code></p><ol start="6"><li>æ“¦é™¤flashã€‚<br>é¦–å…ˆè¦ç¡®è®¤ä¸€ä¸‹8266æ‰€è¿æ¥çš„ä¸²å£å·ï¼Œè¦ä»¥ä¸²å£å·ä½œä¸ºæŒ‡ä»¤çš„å‚æ•°ï¼Œå¦‚æˆ‘çš„è®¾å¤‡æ˜¯åœ¨COM4ï¼Œæˆ‘è¿è¡Œçš„æŒ‡ä»¤å°±æ˜¯esptool.py â€“port COM4 erase_flash<br><img src="http://bbs.eeworld.com.cn/data/attachment/forum/201608/14/002734julv7tylu4hae44a.png.thumb.jpg" class="lazyload placeholder" data-srcset="http://bbs.eeworld.com.cn/data/attachment/forum/201608/14/002734julv7tylu4hae44a.png.thumb.jpg" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="img"><br>æ­¤å¤„éœ€è¦æ³¨æ„ï¼Œæ‰§è¡Œæ“¦é™¤çš„æŒ‡ä»¤å‰ï¼Œéœ€è¦åƒçƒ§å½•å›ºä»¶ä¸€æ ·ï¼Œè®©8266è¿›å…¥å‡çº§æ¨¡å¼ï¼Œå³æŒ‰ä½æ¿ä¸Šçš„flashé”®ä¸æ”¾ï¼ŒæŒ‰ä¸‹rsté”®ï¼Œç­‰å¾…ä¸¤ç§’ï¼Œæ¾å¼€rsté”®ï¼Œå†æ¾å¼€flashé”®ã€‚å¦åˆ™ä¼šå‡ºç°å¦‚ä¸‹çš„é”™è¯¯æç¤ºï¼š<img src="http://bbs.eeworld.com.cn/forum.php?mod=image&aid=253737&size=300x300&key=d2d7d3e3ef4b0dda&nocache=yes&type=fixnone" class="lazyload placeholder" data-srcset="http://bbs.eeworld.com.cn/forum.php?mod=image&aid=253737&size=300x300&key=d2d7d3e3ef4b0dda&nocache=yes&type=fixnone" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="img"  />è¿™æ ·flashçš„æ“¦é™¤å·¥ä½œå°±å®Œæˆäº†ï¼Œé‡æ–°å†çƒ§å½•å›ºä»¶ä¹‹åå³å¯è§£å†³å›ºä»¶è¿è¡Œå¼‚å¸¸çš„é—®é¢˜ã€‚</li></ol><h1 id="3ã€ç¯å¢ƒå‡†å¤‡ï¼ˆArduinoå¼€å‘ï¼‰"><a href="#3ã€ç¯å¢ƒå‡†å¤‡ï¼ˆArduinoå¼€å‘ï¼‰" class="headerlink" title="3ã€ç¯å¢ƒå‡†å¤‡ï¼ˆArduinoå¼€å‘ï¼‰"></a>3ã€ç¯å¢ƒå‡†å¤‡ï¼ˆArduinoå¼€å‘ï¼‰</h1><h2 id="1ã€ç¡¬ä»¶å‡†å¤‡"><a href="#1ã€ç¡¬ä»¶å‡†å¤‡" class="headerlink" title="1ã€ç¡¬ä»¶å‡†å¤‡"></a>1ã€ç¡¬ä»¶å‡†å¤‡</h2><p>GPIO0å†³å®šæ¿å­å¤„äºä»€ä¹ˆæ¨¡å¼ï¼ˆä¸Šç”µä½ç”µå¹³ä¸ºè¿›å…¥ä¸‹è½½æ¨¡å¼ï¼‰</p><h3 id="1ã€ESP-01ç³»åˆ—"><a href="#1ã€ESP-01ç³»åˆ—" class="headerlink" title="1ã€ESP-01ç³»åˆ—"></a>1ã€ESP-01ç³»åˆ—</h3><p><a href="https://imgtu.com/i/WhEJnU"><img src="https://z3.ax1x.com/2021/07/26/WhEJnU.md.png" class="lazyload placeholder" data-srcset="https://z3.ax1x.com/2021/07/26/WhEJnU.md.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="WhEJnU.md.png" style="zoom: 80%;" /></a><a href="https://imgtu.com/i/fCZ14f"><img src="https://z3.ax1x.com/2021/08/02/fCZ14f.png" class="lazyload placeholder" data-srcset="https://z3.ax1x.com/2021/08/02/fCZ14f.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="fCZ14f.png" style="zoom: 80%;" /></a></p><h3 id="2ã€ç”¨çš„æœ€å¤šçš„12F"><a href="#2ã€ç”¨çš„æœ€å¤šçš„12F" class="headerlink" title="2ã€ç”¨çš„æœ€å¤šçš„12F"></a>2ã€ç”¨çš„æœ€å¤šçš„12F</h3><p><a href="https://imgtu.com/i/Whud4e"><img src="https://z3.ax1x.com/2021/07/26/Whud4e.md.png" class="lazyload placeholder" data-srcset="https://z3.ax1x.com/2021/07/26/Whud4e.md.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="Whud4e.md.png"></a><br>SMD-22å°è£…ï¼ŒGPIO0-GPIO16å…±17ä¸ªé€šç”¨IOå£ï¼Œä¸€ä¸ªå•é€šé“ADCï¼ŒGPIO6-GPIO11ç”¨äºè¿æ¥å¤–éƒ¨flashï¼Œä¸å¯ç”¨ï¼Œæ”¯æŒSPIæ€»çº¿é€šä¿¡ï¼šGPIO12-GPIO15ï¼Œæ”¯æŒI2Cæ€»çº¿ï¼šGPIO4-GPIO5,ä¸²å£é€šä¿¡ï¼šGPIO1-GPIO3ã€‚</p><ul><li><p>12Fä¸€èˆ¬D0-D8ï¼ˆé™¤D3å£å³GPIO0ä¸‹è½½ç”¨ï¼‰ï¼›</p></li><li><p>D0ï¼šINPUTï¼ˆè¾“å…¥ï¼‰ã€OUTPUTï¼ˆè¾“å‡ºï¼‰ã€INPUT_PULLDOWNï¼ˆè¾“å…¥ï¼Œé»˜è®¤ä¸‹æ‹‰ï¼Œä½ç”µå¹³ï¼‰ï¼›</p></li><li><p>å…¶ä½™IOå£ï¼šINPUTï¼ˆè¾“å…¥ï¼‰ã€OTPUTï¼ˆè¾“å‡ºï¼‰ã€INPUT_PULLUPï¼ˆè¾“å…¥ï¼Œé»˜è®¤ä¸Šæ‹‰ï¼Œé«˜ç”µå¹³ï¼‰ï¼›</p></li></ul><p><a href="https://imgtu.com/i/WhEdhR"><img src="https://z3.ax1x.com/2021/07/26/WhEdhR.md.png" class="lazyload placeholder" data-srcset="https://z3.ax1x.com/2021/07/26/WhEdhR.md.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="WhEdhR.md.png"></a></p><p>æ³¨æ„ï¼šçƒ§å½•æ¨¡å¼GPIO0æ¥åœ°ï¼Œæ­£å¸¸æ¨¡å¼GPIOæ‚¬ç©ºã€‚</p><h3 id="3ã€NodeMcuï¼ˆESP-12Få¼€å‘æ¿ï¼‰"><a href="#3ã€NodeMcuï¼ˆESP-12Få¼€å‘æ¿ï¼‰" class="headerlink" title="3ã€NodeMcuï¼ˆESP-12Få¼€å‘æ¿ï¼‰"></a>3ã€NodeMcuï¼ˆESP-12Få¼€å‘æ¿ï¼‰</h3><p><a href="https://imgtu.com/i/WhKk5D"><img src="https://z3.ax1x.com/2021/07/26/WhKk5D.md.png" class="lazyload placeholder" data-srcset="https://z3.ax1x.com/2021/07/26/WhKk5D.md.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="WhKk5D.md.png"  /></a><br><a href="https://imgtu.com/i/WhKla8"><img src="https://z3.ax1x.com/2021/07/26/WhKla8.md.png" class="lazyload placeholder" data-srcset="https://z3.ax1x.com/2021/07/26/WhKla8.md.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="WhKla8.md.png"  /></a></p><h3 id="4ã€8266-12E"><a href="#4ã€8266-12E" class="headerlink" title="4ã€8266-12E"></a>4ã€8266-12E</h3><p><a href="https://imgtu.com/i/fCJX6I"><img src="https://z3.ax1x.com/2021/08/02/fCJX6I.jpg" class="lazyload placeholder" data-srcset="https://z3.ax1x.com/2021/08/02/fCJX6I.jpg" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="fCJX6I.jpg" style="zoom: 50%;" /></a></p><h2 id="2ã€è½¯ä»¶å‡†å¤‡"><a href="#2ã€è½¯ä»¶å‡†å¤‡" class="headerlink" title="2ã€è½¯ä»¶å‡†å¤‡"></a>2ã€è½¯ä»¶å‡†å¤‡</h2><h3 id="1ã€Arduinoå®‰è£…-8266åŒ…å®‰è£…"><a href="#1ã€Arduinoå®‰è£…-8266åŒ…å®‰è£…" class="headerlink" title="1ã€Arduinoå®‰è£…+8266åŒ…å®‰è£…"></a>1ã€Arduinoå®‰è£…+8266åŒ…å®‰è£…</h3><p><a href="https://imgtu.com/i/fCmCY6"><img src="https://z3.ax1x.com/2021/08/02/fCmCY6.png" class="lazyload placeholder" data-srcset="https://z3.ax1x.com/2021/08/02/fCmCY6.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="fCmCY6.png"></a></p><h3 id="2ã€èŠ¯ç‰‡æ£€æµ‹ç¨‹åº"><a href="#2ã€èŠ¯ç‰‡æ£€æµ‹ç¨‹åº" class="headerlink" title="2ã€èŠ¯ç‰‡æ£€æµ‹ç¨‹åº"></a>2ã€èŠ¯ç‰‡æ£€æµ‹ç¨‹åº</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *    æµ‹è¯•ESP8266 demo,æ‰“å°ESP8266æ¨¡å—ä¿¡æ¯</span></span><br><span class="line"><span class="comment"> *    1.æ‰“å°Arduino Core For ESP8266 ç‰ˆæœ¬</span></span><br><span class="line"><span class="comment"> *    2.æ‰“å°Flashçš„å”¯ä¸€æ€§èŠ¯ç‰‡id</span></span><br><span class="line"><span class="comment"> *    3.æ‰“å°Flashå®é™…å¤§å°</span></span><br><span class="line"><span class="comment"> *    4.æ‰“å°IDEé…ç½®çš„ä½¿ç”¨Flashå¤§å°</span></span><br><span class="line"><span class="comment"> *    5.æ‰“å°IDEé…ç½®çš„Flashè¿æ¥é€šä¿¡çš„é¢‘ç‡</span></span><br><span class="line"><span class="comment"> *    6.æ‰“å°Flashè¿æ¥æ¨¡å¼ï¼šQIO QOUT DIO DOUTï¼Œå¯ä»¥ç†è§£ä¸ºFlashä¼ è¾“é€Ÿç‡</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span> &#123;</span><br><span class="line">  Serial.begin(<span class="number">115200</span>);</span><br><span class="line">  <span class="comment">//ä½¿èƒ½è½¯ä»¶çœ‹é—¨ç‹—çš„è§¦å‘é—´éš”</span></span><br><span class="line">  <span class="comment">//è§„å®šæ—¶é—´ï¼ˆ5Sï¼‰å†…ä¸å–‚ç‹—ï¼Œç³»ç»Ÿå¤ä½</span></span><br><span class="line">  ESP.wdtEnable(<span class="number">5000</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="comment">//å–‚ç‹—</span></span><br><span class="line">  ESP.wdtFeed();</span><br><span class="line">  FlashMode_t ideMode = ESP.getFlashChipMode();</span><br><span class="line">  String coreVersion = ESP.getCoreVersion();</span><br><span class="line">  Serial.print(F(<span class="string">&quot;Arduino Core For ESP8266 Version: &quot;</span>));</span><br><span class="line">  Serial.println(coreVersion);</span><br><span class="line">  Serial.<span class="built_in">printf</span>(<span class="string">&quot;Flash real idï¼ˆå”¯ä¸€æ ‡è¯†ç¬¦ï¼‰:   %08X\n&quot;</span>, ESP.getFlashChipId());</span><br><span class="line">  Serial.<span class="built_in">printf</span>(<span class="string">&quot;Flash å®é™…å¤§å°: %u KBytes\n&quot;</span>, ESP.getFlashChipRealSize()/<span class="number">1024</span>);</span><br><span class="line">  Serial.<span class="built_in">printf</span>(<span class="string">&quot;IDEé…ç½®Flashå¤§å°: %u KBytes,å¾€å¾€å°äºå®é™…å¤§å°\n&quot;</span>, ESP.getFlashChipSize()/<span class="number">1024</span>);</span><br><span class="line">  Serial.<span class="built_in">printf</span>(<span class="string">&quot;IDEé…ç½®Flashé¢‘ç‡ : %u MHz\n&quot;</span>, ESP.getFlashChipSpeed()/<span class="number">1000000</span>);</span><br><span class="line">  Serial.<span class="built_in">printf</span>(<span class="string">&quot;Flash ide mode:  %s\n\n&quot;</span>, (ideMode == FM_QIO ? <span class="string">&quot;QIO&quot;</span> : ideMode == FM_QOUT ? <span class="string">&quot;QOUT&quot;</span> : ideMode == FM_DIO ? <span class="string">&quot;DIO&quot;</span> : ideMode == FM_DOUT ? <span class="string">&quot;DOUT&quot;</span> : <span class="string">&quot;UNKNOWN&quot;</span>));  </span><br><span class="line">  delay(<span class="number">1000</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://z3.ax1x.com/2021/07/26/WhVRqU.md.png" class="lazyload placeholder" data-srcset="https://z3.ax1x.com/2021/07/26/WhVRqU.md.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="WhVRqU.md.png"></p><h1 id="4ã€ç›¸å…³å¤–è®¾ä½¿ç”¨"><a href="#4ã€ç›¸å…³å¤–è®¾ä½¿ç”¨" class="headerlink" title="4ã€ç›¸å…³å¤–è®¾ä½¿ç”¨"></a>4ã€ç›¸å…³å¤–è®¾ä½¿ç”¨</h1><h2 id="1ã€è®¡æ—¶å’Œå»¶æ—¶"><a href="#1ã€è®¡æ—¶å’Œå»¶æ—¶" class="headerlink" title="1ã€è®¡æ—¶å’Œå»¶æ—¶"></a>1ã€è®¡æ—¶å’Œå»¶æ—¶</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">*     è®¡æ—¶å’Œå»¶æ—¶ï¼š</span></span><br><span class="line"><span class="comment">*     delay(ms);</span></span><br><span class="line"><span class="comment">*     delayMicroseconds(us);å»¶æ—¶ä¸­ä¸èƒ½åšå…¶ä»–äº‹</span></span><br><span class="line"><span class="comment">*     millis(); //è¿”å›é‡å¯åæ‰€ç»è¿‡çš„æ¯«ç§’æ•°</span></span><br><span class="line"><span class="comment">*     micros(); //è¿”å›é‡å¯åæ‰€ç»è¿‡çš„å¾®ç§’æ•°</span></span><br><span class="line"><span class="comment">**/</span></span><br><span class="line"><span class="type">long</span> debouncdDelay = <span class="number">60</span>;<span class="comment">//å»¶æ—¶é—´éš”</span></span><br><span class="line"><span class="type">long</span> lastDebounceTime = <span class="number">0</span>; <span class="comment">//æœ€è¿‘è®°å½•çš„ä¸€æ¬¡æ—¶é—´</span></span><br><span class="line"><span class="comment">// åˆ¤æ–­æ—¶é—´é—´éš”æ˜¯å¦å¤§äºè®¾å®šçš„æ—¶é—´é—´éš”ã€‚</span></span><br><span class="line"><span class="keyword">if</span>(millis()-lastDebounceTime&gt;debouncdDelay)&#123;</span><br><span class="line">    lastDebounceTime = millis();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="2ã€IOå£ï¼ˆBlinkï¼‰"><a href="#2ã€IOå£ï¼ˆBlinkï¼‰" class="headerlink" title="2ã€IOå£ï¼ˆBlinkï¼‰"></a>2ã€IOå£ï¼ˆBlinkï¼‰</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * LEDç¯é—ªçƒå®éªŒ</span></span><br><span class="line"><span class="comment"> * 12Eæ¨¡å—ï¼ŒLEDåœ¨GPIO2å£ï¼Œå³NodeMCUçš„D4</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span> &#123;</span><br><span class="line">    pinMode(D4, OUTPUT);   <span class="comment">// åˆå§‹åŒ–D1å¼•è„šä¸ºè¾“å‡ºå¼•è„š</span></span><br><span class="line">&#125; </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span> &#123;</span><br><span class="line">    digitalWrite(D4, LOW); <span class="comment">// äº®ç¯</span></span><br><span class="line">    delay(<span class="number">1000</span>); <span class="comment">// å»¶æ—¶1s</span></span><br><span class="line">    digitalWrite(D4, HIGH);<span class="comment">// ç­ç¯</span></span><br><span class="line">    delay(<span class="number">1000</span>); <span class="comment">// å»¶æ—¶1s</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="3ã€ä¸­æ–­"><a href="#3ã€ä¸­æ–­" class="headerlink" title="3ã€ä¸­æ–­"></a>3ã€ä¸­æ–­</h2><p>ï¼ˆé™¤äº†DO&#x2F;GPIO16ï¼Œä¸­æ–­å¯ä»¥ç»‘åˆ°ä»»æ„GPIOè„šï¼‰</p><p>ç›¸å…³å‡½æ•°ï¼š</p><ol><li><code>attachInterrupt(pin,function,mode);</code> åœ¨æŒ‡å®šå¼•è„šè®¾ç½®ä¸ºå“åº”ä¸­æ–­ã€‚pin:è¦è®¾ç½®çš„ä¸­æ–­å·ï¼Œfunction:ä¸­æ–­æ—¶æ‰§è¡Œçš„å‡½æ•°ï¼Œä¸å¸¦ä»»ä½•å‚æ•°ï¼Œæ— è¿”å›,Interrupt type&#x2F;mode:ä¸­æ–­è§¦å‘æ¡ä»¶ï¼ˆCHANGE:æ”¹å˜æ²¿ï¼›RISINGï¼šä¸Šå‡æ²¿ï¼›FALLINGï¼šä¸‹é™æ²¿ï¼‰</li><li><code>detachInterrupt(pin);</code> ç¦ç”¨æŒ‡å®šGPIOå¼•è„šä¸Šçš„ä¸­æ–­ã€‚pin:è¦ç¦ç”¨çš„ä¸­æ–­çš„GPIOå¼•è„šï¼Œæ— è¿”å›å€¼ã€‚</li><li><code>digitalPinToInterrupt(pin);</code> è·å–æŒ‡å®šGPIOå¼•è„šçš„ä¸­æ–­å·ã€‚</li></ol><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åŠŸèƒ½æè¿°ï¼šESP8266ä¸­æ–­æ¼”ç¤º</span></span><br><span class="line"><span class="comment"> * D2å£æ¥ä¸‹æ‹‰ç”µé˜»åˆ°åœ°ï¼ŒåŒæ—¶ä¹Ÿé€šè¿‡ä¸€ä¸ªæŒ‰é”®å¼€å…³æ¥åˆ°VCC</span></span><br><span class="line"><span class="comment"> * å½“å¼€å…³æŒ‰ä¸‹ï¼ŒD2æ¥åˆ°ä¸Šå‡æ²¿ï¼Œå¼€å¯ä¸­æ–­ï¼Œè¿›å…¥ä¸­æ–­å‡½æ•°</span></span><br><span class="line"><span class="comment"> */</span> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span> &#123;</span><br><span class="line"> Serial.begin(<span class="number">115200</span>);<span class="comment">//è®¾ç½®ä¸²å£æ³¢ç‰¹ç‡</span></span><br><span class="line"> attachInterrupt(digitalPinToInterrupt(D2), InterruptFunc, RISING);<span class="comment">//è®¾ç½®ä¸­æ–­å·ã€å“åº”å‡½æ•°ã€è§¦å‘æ–¹å¼</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ä¸­æ–­å“åº”å‡½æ•°</span></span><br><span class="line"><span class="comment"> */</span> </span><br><span class="line">ICACHE_RAM_ATTR <span class="type">void</span> <span class="title function_">InterruptFunc</span><span class="params">()</span>&#123;</span><br><span class="line"> Serial.println(<span class="string">&quot;Hello ESP8266&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="4ã€æ¨¡æ‹Ÿè¾“å…¥ï¼ˆADCï¼‰"><a href="#4ã€æ¨¡æ‹Ÿè¾“å…¥ï¼ˆADCï¼‰" class="headerlink" title="4ã€æ¨¡æ‹Ÿè¾“å…¥ï¼ˆADCï¼‰"></a>4ã€æ¨¡æ‹Ÿè¾“å…¥ï¼ˆADCï¼‰</h2><p>esp8266åªç”¨ä¸€ä¸ª10ä½ADCé€šé“ï¼ˆå’ŒèŠ¯ç‰‡ä¾›ç”µç”µå‹å¤ç”¨ï¼šå³å¯è®¾ç½®ä¸ºæµ‹é‡ç³»ç»Ÿç”µå‹æˆ–è€…å¤–éƒ¨ç”µå‹ï¼‰</p><h3 id="1ã€æµ‹é‡å¤–éƒ¨ç”µå‹"><a href="#1ã€æµ‹é‡å¤–éƒ¨ç”µå‹" class="headerlink" title="1ã€æµ‹é‡å¤–éƒ¨ç”µå‹"></a>1ã€æµ‹é‡å¤–éƒ¨ç”µå‹</h3><ul><li>æ–¹æ³•ï¼š<code>analogRead(A0);</code></li><li>0-1.0V</li><li>æµ‹é‡ç²¾åº¦ï¼š10ä½ADCï¼š0~$2^{10}$â€‹â€‹â€‹</li><li>æ³¨æ„ï¼šå¼€å‘æ¿ä¸Šåšäº†ç”µé˜»åˆ†å‹å™¨ï¼Œä½¿å…¶èƒ½å¤Ÿæµ‹é‡0 ~ 3.3Vï¼ˆ220Kä¸100Kç”µé˜»åˆ†å‹ï¼‰</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åŠŸèƒ½æè¿°ï¼šESP8266 ADC è¯»å–å¤–éƒ¨ç”µå‹</span></span><br><span class="line"><span class="comment"> * åœ¨ä¸²å£è°ƒè¯•å™¨æŸ¥çœ‹æ•ˆæœ</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span> &#123;</span><br><span class="line">  Serial.begin(<span class="number">115200</span>);<span class="comment">//é…ç½®æ³¢ç‰¹ç‡</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span> &#123;</span><br><span class="line">  Serial.print(<span class="string">&quot;ADC Value: &quot;</span>);</span><br><span class="line">  Serial.println(analogRead(A0));<span class="comment">//è¾“å‡º0-1023 å¯¹åº” å¤–éƒ¨è¾“å…¥ç”µå‹ 0-1.0v</span></span><br><span class="line">  <span class="comment">//å»¶æ—¶1s</span></span><br><span class="line">  delay(<span class="number">1000</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2ã€æµ‹é‡ç³»ç»Ÿå¤–éƒ¨ç”µå‹"><a href="#2ã€æµ‹é‡ç³»ç»Ÿå¤–éƒ¨ç”µå‹" class="headerlink" title="2ã€æµ‹é‡ç³»ç»Ÿå¤–éƒ¨ç”µå‹"></a>2ã€æµ‹é‡ç³»ç»Ÿå¤–éƒ¨ç”µå‹</h3><ul><li><p>æ–¹æ³•ï¼š ESP.getVcc()      </p></li><li><p>å•ä½ï¼š mv</p></li><li><p>ADCå¼•è„šè¦æ‚¬ç©ºã€‚è¯»å–å‰è¦æ›´æ”¹ADCæ¨¡å¼ï¼ˆåœ¨#includeè¡Œåé¢ï¼‰<code>ADC_TOUT</code> (å¯¹å¤–éƒ¨ç”µå‹ï¼‰ï¼Œ<code>ADC_VCC</code>ï¼ˆå¯¹ç³»ç»Ÿç”µå‹ï¼‰ï¼Œé»˜è®¤è¯»å–å¤–éƒ¨</p>  <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åŠŸèƒ½æè¿°ï¼šESP8266 ADC è¯»å–ç³»ç»Ÿç”µå‹</span></span><br><span class="line"><span class="comment"> * åœ¨ä¸²å£è°ƒè¯•å™¨æŸ¥çœ‹æ•ˆæœ</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">ADC_MODE(ADC_VCC);<span class="comment">//è®¾ç½®ADCæ¨¡å¼ä¸ºè¯»å–ç³»ç»Ÿç”µå‹</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span> &#123;</span><br><span class="line">  Serial.begin(<span class="number">115200</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span> &#123;</span><br><span class="line">  Serial.print(<span class="string">&quot;ESP8266å½“å‰ç³»ç»Ÿç”µå‹(mV): &quot;</span>);</span><br><span class="line">  Serial.println(ESP.getVcc());</span><br><span class="line">  delay(<span class="number">1000</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h2 id="5ã€æ¨¡æ‹Ÿè¾“å‡ºï¼ˆPWMï¼‰"><a href="#5ã€æ¨¡æ‹Ÿè¾“å‡ºï¼ˆPWMï¼‰" class="headerlink" title="5ã€æ¨¡æ‹Ÿè¾“å‡ºï¼ˆPWMï¼‰"></a>5ã€æ¨¡æ‹Ÿè¾“å‡ºï¼ˆPWMï¼‰</h2><ul><li><p><code>analogWrite(pin,val)</code>åœ¨æŒ‡å®šå¼•è„šä¸Šå¯ç”¨PWMï¼›pin:GPIO;    val:ä¸€èˆ¬0 ~ PWMRANGE,é»˜è®¤PWMRANGE&#x3D;1023;æ— è¿”å›å€¼ï¼›<code>analogWrite(pin,0)</code>ç›¸å½“äºç¦ç”¨æŒ‡å®šå¼•è„šä¸Šçš„PWMï¼›</p></li><li><p><code>analogWriteRange(new_range)</code>  æ”¹å˜PWMRANGEæ•°å€¼ï¼›new_range:æ–°çš„PWMRANGEæ•°å€¼ï¼›æ— è¿”å›å€¼ï¼›ï¼ˆå¯ä»¥è°ƒèŠ‚PWMç²¾åº¦ï¼‰ï¼›</p></li><li><p><code>analogWriteFreq(new_frequency)</code>  æ”¹å˜PWMé¢‘ç‡ï¼›é»˜è®¤1KHz</p><ul><li><p>Arduino For ESP8266çš„PWMé¢‘ç‡èŒƒå›´ä¸º100Hz ~40KHz:</p><p>  æºç ï¼š</p>  <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">static</span> <span class="type">uint16_t</span> analogFreq = <span class="number">1000</span>;</span><br><span class="line"><span class="keyword">extern</span> <span class="type">void</span> __analogWriteFreq(<span class="type">uint32_t</span> freq) &#123;</span><br><span class="line">  <span class="keyword">if</span> (freq &lt; <span class="number">100</span>) &#123;</span><br><span class="line">    analogFreq = <span class="number">100</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (freq &gt; <span class="number">40000</span>) &#123;</span><br><span class="line">    analogFreq = <span class="number">40000</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    analogFreq = freq;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul></li></ul><p>ä¾‹ç¨‹ï¼ˆå‘¼å¸ç¯ï¼‰</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åŠŸèƒ½æè¿°ï¼šESP8266 PWMæ¼”ç¤ºä¾‹ç¨‹</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PIN_LED D6</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span> &#123;</span><br><span class="line">  pinMode(PIN_LED,OUTPUT);</span><br><span class="line">  analogWrite(PIN_LED,<span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="keyword">for</span>(<span class="type">int</span> val=<span class="number">0</span>;val&lt;<span class="number">1024</span>;val++)&#123;</span><br><span class="line">     <span class="comment">//å ç©ºæ¯”ä¸æ–­å¢å¤§  äº®åº¦æ¸äº®</span></span><br><span class="line"> analogWrite(PIN_LED,val);</span><br><span class="line"> delay(<span class="number">2</span>);</span><br><span class="line">  &#125; </span><br><span class="line">  <span class="keyword">for</span>(<span class="type">int</span> val=<span class="number">1023</span>;val&gt;=<span class="number">0</span>;val--)&#123;</span><br><span class="line">     <span class="comment">//å ç©ºæ¯”ä¸æ–­å˜å°  äº®åº¦æ¸æš—</span></span><br><span class="line"> analogWrite(PIN_LED,<span class="number">1023</span>);</span><br><span class="line"> delay(<span class="number">2</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="6ã€ä¸²å£é€šä¿¡"><a href="#6ã€ä¸²å£é€šä¿¡" class="headerlink" title="6ã€ä¸²å£é€šä¿¡"></a>6ã€ä¸²å£é€šä¿¡</h2><p>ä¸ä¼ ç»ŸArduinoè®¾å¤‡å®Œå…¨ä¸€æ ·ã€‚é™¤ç¡¬ä»¶FIFOï¼ˆ128å­—èŠ‚ç”¨äºTXå’ŒRXï¼‰ä¹‹å¤–ï¼Œç¡¬ä»¶ä¸²å£è¿˜æœ‰é¢å¤–çš„256å­—èŠ‚çš„TXå’ŒRXç¼“å­˜ã€‚å‘é€å’Œæ¥å—å…¨éƒ¨ç”±ä¸­æ–­é©±åŠ¨ã€‚å½“FIFO&#x2F;ç¼“å­˜æ»¡æ—¶ï¼ŒWriteå‡½æ•°ä¼šé˜»å¡å·¥ç¨‹ä»£ç æ‰§è¡Œï¼Œç­‰å¾…ç©ºé—²ç©ºé—´ã€‚å½“FIFO&#x2F;ç¼“å­˜ç©ºæ—¶ï¼Œreadå‡½æ•°ä¹Ÿä¼šé˜»å¡å·¥ç¨‹ä»£ç çš„æ‰§è¡Œï¼Œç­‰å¾…ä¸²å£æ•°æ®è¿›æ¥ã€‚</p><ul><li><p>NodeMcuä¸Šæœ‰ä¸¤ç»„ä¸²å£ï¼ŒSerialå’ŒSerial1ï¼ˆéƒ½æ˜¯ç¡¬ä»¶ä¸²å£ï¼‰ã€‚</p><ul><li><p><strong>Serialä½¿ç”¨UART0</strong>ï¼Œé»˜è®¤GPIO1ï¼ˆTXï¼‰å’ŒGPIO3ï¼ˆRXï¼‰ï¼›Serial.beginæ‰§è¡Œä¹‹åï¼Œè°ƒç”¨<code>Serial.swap()</code>å¯ä»¥å°†Serialé‡æ–°æ˜ å°„åˆ°GPIO15ï¼ˆTXï¼‰å’ŒGPIO13ï¼ˆRXï¼‰ã€‚å¯æ¥å›è°ƒç”¨ã€‚ä¸€èˆ¬é»˜è®¤</p>  <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åŠŸèƒ½æè¿°ï¼šESP8266 Serialæ˜ å°„ä¾‹ç¨‹</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span> &#123;</span><br><span class="line">  Serial.begin(<span class="number">115200</span>);</span><br><span class="line">  Serial.println(<span class="string">&quot;GPIO1(TX),GPIO3(RX)&quot;</span>);</span><br><span class="line">  <span class="comment">//è°ƒç”¨æ˜ å°„æ–¹æ³•</span></span><br><span class="line">  Serial.swap();</span><br><span class="line">  Serial.println(<span class="string">&quot;GPIO15(TX),GPIO13(RX)&quot;</span>);</span><br><span class="line">  <span class="comment">//é‡æ–°æ˜ å°„å›æ¥</span></span><br><span class="line">  Serial.swap();</span><br><span class="line">  Serial.println(<span class="string">&quot;GPIO1(TX),GPIO3(RX)&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p><strong>Serial1ä½¿ç”¨UART1</strong>ï¼Œé»˜è®¤å¯¹åº”GPIO2ï¼ˆTXï¼‰ã€‚Serial1ä¸èƒ½æ¥æ”¶æ•°æ®ï¼ˆRXè¢«flashèŠ¯ç‰‡å ç”¨ï¼‰,<code>Serial1.begin(baudrate)</code>ã€‚</p>  <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span> &#123;</span><br><span class="line">  Serial.begin(<span class="number">115200</span>);</span><br><span class="line">  Serial.println(<span class="string">&quot;Hello Serial&quot;</span>);</span><br><span class="line">  Serial1.begin(<span class="number">115200</span>);</span><br><span class="line">  Serial1.println(<span class="string">&quot;Hello Serial1&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul></li><li><p>è‹¥ä¸ç”¨Serial1ä¸”ä¸æ˜ å°„ä¸²å£ï¼Œå¯å°†UART0çš„TXæ˜ å°„åˆ°GPIO2ï¼šåœ¨<code>Serial.begin()</code>ä¹‹åè°ƒç”¨<code>Serial.set_tx(2)</code>æˆ–è€…ç›´æ¥è°ƒç”¨<code>Serial.begin(baud,config,mode,2)</code> ;</p></li><li><p>é»˜è®¤å½“è°ƒç”¨Serial.beginåï¼Œå°†ç¦ç”¨WIFIåº“çš„è¯Šæ–­è¾“å‡ºï¼Œå†æ¬¡å¯åŠ¨ï¼š<code>Serial.setDebugOutput(true)</code>è‹¥å°†è°ƒè¯•è¾“å‡ºæ˜ å°„åˆ°Serial1æ—¶ï¼š<code>Serial1.setDebugOutput(true)</code> ;</p></li><li><p><code>Serial.setRxBufferSize(size_t size)</code>å®šä¹‰æ¥æ”¶ç¼“å†²åŒºå¤§å°ï¼Œé»˜è®¤256ï¼›</p></li><li><p>Serialå’ŒSerial1å¯¹è±¡éƒ½æ”¯æŒ5ï¼Œ6ï¼Œ7ï¼Œ8ä¸ªæ•°æ®ä½ï¼Œå¥‡æ•°ï¼ˆOï¼‰ï¼Œå¶æ•°ï¼ˆEï¼‰å’Œæ— ï¼ˆNï¼‰å¥‡å¶æ ¡éªŒï¼Œ1æˆ–2ä¸ªåœæ­¢ä½ï¼š<code>Serial.begin(baudrate,SERIAL_8N1)</code></p></li><li><p>è·å–å½“å‰æ³¢ç‰¹ç‡è®¾ç½®ï¼š<code>Serial.baudRate()</code>æˆ–<code>Serial1.baudRate()</code></p></li><li><p><a href="https://github.com/plerup/espsoftwareserial">ESP8266è½¯ä»¶ä¸²å£åŠŸèƒ½</a></p></li><li><p>æ£€æµ‹è¿›å…¥Serialçš„æœªçŸ¥æ³¢ç‰¹ç‡çš„æ•°æ®ï¼š<code>Serial.detectBaudrate(time_t timeoutMillis)</code> : å°è¯•åœ¨timeoutMillis msçš„æ—¶é—´å†…æ£€æµ‹æ³¢ç‰¹ç‡ï¼Œæ£€æµ‹æˆåŠŸè¿”å›æ³¢ç‰¹ç‡ï¼Œå¤±è´¥è¿”å›0ã€‚<code>detectBaudrate()</code>æ–¹æ³•åœ¨<code>Serial.begin()</code>ä¹‹å‰è°ƒç”¨ã€‚å¯ä½¿ç”¨<code>Serial.begin(detectedBaudrate)</code></p></li></ul><p>ç¤ºä¾‹ï¼ˆWIFIè¿æ¥ï¼‰ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * statinæ¨¡å¼ä¸‹ï¼Œåˆ›å»ºä¸€ä¸ªè¿æ¥åˆ°å¯æ¥å…¥ç‚¹ï¼ˆwifiçƒ­ç‚¹ï¼‰ï¼Œå¹¶ä¸”æ‰“å°IPåœ°å€</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="keyword">define</span> AP_SSID <span class="string">&quot;xxxxx&quot;</span> <span class="comment">//è¿™é‡Œæ”¹æˆä½ çš„wifiåå­—</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> AP_PSW  <span class="string">&quot;xxxxx&quot;</span><span class="comment">//è¿™é‡Œæ”¹æˆä½ çš„wifiå¯†ç </span></span></span><br><span class="line"><span class="comment">//ä»¥ä¸‹ä¸‰ä¸ªå®šä¹‰ä¸ºè°ƒè¯•å®šä¹‰</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DebugBegin(baud_rate)    Serial.begin(baud_rate)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DebugPrintln(message)    Serial.println(message)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DebugPrint(message)    Serial.print(message)</span></span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span>&#123;</span><br><span class="line">  <span class="comment">//è®¾ç½®ä¸²å£æ³¢ç‰¹ç‡ï¼Œä»¥ä¾¿æ‰“å°ä¿¡æ¯</span></span><br><span class="line">  DebugBegin(<span class="number">115200</span>);</span><br><span class="line">  <span class="comment">//å»¶æ—¶2s ä¸ºäº†æ¼”ç¤ºæ•ˆæœ</span></span><br><span class="line">  delay(<span class="number">2000</span>);</span><br><span class="line">  DebugPrintln(<span class="string">&quot;Setup start&quot;</span>);</span><br><span class="line">  <span class="comment">//å¯åŠ¨STAæ¨¡å¼ï¼Œå¹¶è¿æ¥åˆ°wifiç½‘ç»œ</span></span><br><span class="line">  WiFi.begin(AP_SSID, AP_PSW);</span><br><span class="line"> </span><br><span class="line">  DebugPrint(String(<span class="string">&quot;Connecting to &quot;</span>)+AP_SSID);</span><br><span class="line">  <span class="comment">//åˆ¤æ–­ç½‘ç»œçŠ¶æ€æ˜¯å¦è¿æ¥ä¸Šï¼Œæ²¡è¿æ¥ä¸Šå°±å»¶æ—¶500msï¼Œå¹¶ä¸”æ‰“å‡ºä¸€ä¸ªç‚¹ï¼Œæ¨¡æ‹Ÿè¿æ¥è¿‡ç¨‹</span></span><br><span class="line">  <span class="comment">//ç¬”è€…æ‰©å±•ï¼šåŠ å…¥ç½‘ç»œä¸€ç›´éƒ½è¿ä¸ä¸Š æ˜¯å¦å¯ä»¥åšä¸ªåˆ¤æ–­ï¼Œç”±ä½ ä»¬è‡ªå·±å®ç°</span></span><br><span class="line">  <span class="keyword">while</span> (WiFi.status() != WL_CONNECTED)&#123;</span><br><span class="line">    delay(<span class="number">500</span>);</span><br><span class="line">    DebugPrint(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  DebugPrintln(<span class="string">&quot;&quot;</span>);</span><br><span class="line"> </span><br><span class="line">  DebugPrint(<span class="string">&quot;Connected, IP address: &quot;</span>);</span><br><span class="line">  <span class="comment">//è¾“å‡ºstation IPåœ°å€ï¼Œè¿™é‡Œçš„IPåœ°å€ç”±DHCPåˆ†é…</span></span><br><span class="line">  DebugPrintln(WiFi.localIP());</span><br><span class="line">  DebugPrintln(<span class="string">&quot;Setup End&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="7ã€ESP8266ä¸EEPROM"><a href="#7ã€ESP8266ä¸EEPROM" class="headerlink" title="7ã€ESP8266ä¸EEPROM"></a>7ã€ESP8266ä¸EEPROM</h1><h2 id="1ã€å†™æ•°æ®"><a href="#1ã€å†™æ•°æ®" class="headerlink" title="1ã€å†™æ•°æ®"></a>1ã€å†™æ•°æ®</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * åŠŸèƒ½æè¿°ï¼šè¯¥ä»£ç å‘EEPROMå†™å…¥100å­—èŠ‚æ•°æ®</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;EEPROM.h&gt;</span></span></span><br><span class="line"><span class="type">int</span> addr = <span class="number">0</span>; <span class="comment">//EEPROMæ•°æ®åœ°å€</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span> </span><br><span class="line">&#123;</span><br><span class="line">  Serial.begin(<span class="number">9600</span>);</span><br><span class="line">  Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  Serial.println(<span class="string">&quot;Start write&quot;</span>);</span><br><span class="line"></span><br><span class="line">  EEPROM.begin(<span class="number">100</span>);  <span class="comment">//ç”³è¯·sizeå¤§å°çš„å†…å­˜å¤§å°</span></span><br><span class="line">  <span class="keyword">for</span>(addr = <span class="number">0</span>; addr&lt;<span class="number">100</span>; addr++)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="type">int</span> data = addr;</span><br><span class="line">    EEPROM.write(addr, data); <span class="comment">//å†™æ•°æ®</span></span><br><span class="line">  &#125;</span><br><span class="line">  EEPROM.end(); <span class="comment">//å†™å…¥flashå¹¶é‡Šæ”¾å†…å­˜ç©ºé—´  ä¿å­˜æ›´æ”¹çš„æ•°æ®</span></span><br><span class="line"></span><br><span class="line">  Serial.println(<span class="string">&quot;End write&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span> </span><br><span class="line">&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="2ã€è¯»æ•°æ®"><a href="#2ã€è¯»æ•°æ®" class="headerlink" title="2ã€è¯»æ•°æ®"></a>2ã€è¯»æ•°æ®</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * åŠŸèƒ½æè¿°ï¼šè¯¥ä»£ç ä»EEPROMè¯»å–100å­—èŠ‚æ•°æ®</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;EEPROM.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> addr = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span> </span><br><span class="line">&#123;</span><br><span class="line">  Serial.begin(<span class="number">9600</span>);</span><br><span class="line">  Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  Serial.println(<span class="string">&quot;Start read&quot;</span>);</span><br><span class="line"></span><br><span class="line">  EEPROM.begin(<span class="number">100</span>); </span><br><span class="line">  <span class="keyword">for</span>(addr = <span class="number">0</span>; addr&lt;<span class="number">100</span>; addr++)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="type">int</span> data = EEPROM.read(addr); <span class="comment">//è¯»æ•°æ®</span></span><br><span class="line">    Serial.print(data);</span><br><span class="line">    Serial.print(<span class="string">&quot; &quot;</span>);</span><br><span class="line">    delay(<span class="number">2</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//é‡Šæ”¾å†…å­˜</span></span><br><span class="line">  EEPROM.end();</span><br><span class="line">  Serial.println(<span class="string">&quot;End read&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span> </span><br><span class="line">&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="3ã€æ¸…é™¤æ•°æ®"><a href="#3ã€æ¸…é™¤æ•°æ®" class="headerlink" title="3ã€æ¸…é™¤æ•°æ®"></a>3ã€æ¸…é™¤æ•°æ®</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">   EEPROM Clear</span></span><br><span class="line"><span class="comment">   Sets all of the bytes of the EEPROM to 0.</span></span><br><span class="line"><span class="comment">   This example code is in the public domain.</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;EEPROM.h&gt;</span></span></span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span> &#123;</span><br><span class="line">  EEPROM.begin(<span class="number">100</span>);</span><br><span class="line">  <span class="comment">// write a 0 to all 100 bytes of the EEPROM</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">100</span>; i++) &#123;</span><br><span class="line">    EEPROM.write(i, <span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//é‡Šæ”¾å†…å­˜</span></span><br><span class="line">  EEPROM.end();</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="4ã€ç»“æ„ä½“æ“ä½œ"><a href="#4ã€ç»“æ„ä½“æ“ä½œ" class="headerlink" title="4ã€ç»“æ„ä½“æ“ä½œ"></a>4ã€ç»“æ„ä½“æ“ä½œ</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * åŠŸèƒ½æè¿°ï¼šeepromç»“æ„ä½“æ“ä½œ</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;EEPROM.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DEFAULT_STASSID <span class="string">&quot;danpianjicainiao&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DEFAULT_STAPSW  <span class="string">&quot;boge&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">config_type</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">  <span class="type">char</span> stassid[<span class="number">32</span>];</span><br><span class="line">  <span class="type">char</span> stapsw[<span class="number">64</span>];</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">config_type config;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * ä¿å­˜å‚æ•°åˆ°EEPROM</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">saveConfig</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  Serial.println(<span class="string">&quot;Save config!&quot;</span>);</span><br><span class="line">  Serial.print(<span class="string">&quot;stassid:&quot;</span>);</span><br><span class="line">  Serial.println(config.stassid);</span><br><span class="line">  Serial.print(<span class="string">&quot;stapsw:&quot;</span>);</span><br><span class="line">  Serial.println(config.stapsw);</span><br><span class="line"></span><br><span class="line">  EEPROM.begin(<span class="number">1024</span>);</span><br><span class="line">  <span class="type">uint8_t</span> *p = (<span class="type">uint8_t</span>*)(&amp;config);</span><br><span class="line">  <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="keyword">sizeof</span>(config); i++)</span><br><span class="line">  &#123;</span><br><span class="line">    EEPROM.write(i, *(p + i));</span><br><span class="line">  &#125;</span><br><span class="line">  EEPROM.commit();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * ä»EEPROMåŠ è½½å‚æ•°</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">loadConfig</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  EEPROM.begin(<span class="number">1024</span>);</span><br><span class="line">  <span class="type">uint8_t</span> *p = (<span class="type">uint8_t</span>*)(&amp;config);</span><br><span class="line">  <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="keyword">sizeof</span>(config); i++)</span><br><span class="line">  &#123;</span><br><span class="line">    *(p + i) = EEPROM.read(i);</span><br><span class="line">  &#125;</span><br><span class="line">  EEPROM.commit();</span><br><span class="line">  Serial.println(<span class="string">&quot;-----Read config-----&quot;</span>);</span><br><span class="line">  Serial.print(<span class="string">&quot;stassid:&quot;</span>);</span><br><span class="line">  Serial.println(config.stassid);</span><br><span class="line">  Serial.print(<span class="string">&quot;stapsw:&quot;</span>);</span><br><span class="line">  Serial.println(config.stapsw);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">*åˆå§‹åŒ–</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span> &#123;</span><br><span class="line">  ESP.wdtEnable(<span class="number">5000</span>);</span><br><span class="line">  <span class="built_in">strcpy</span>(config.stassid, DEFAULT_STASSID);</span><br><span class="line">  <span class="built_in">strcpy</span>(config.stapsw, DEFAULT_STAPSW);</span><br><span class="line">  saveConfig();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">*ä¸»å¾ªç¯</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span> &#123;</span><br><span class="line">  ESP.wdtFeed();</span><br><span class="line">  loadConfig();</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="8ã€SPIé€šä¿¡"><a href="#8ã€SPIé€šä¿¡" class="headerlink" title="8ã€SPIé€šä¿¡"></a>8ã€SPIé€šä¿¡</h1><h2 id="1ã€æ¦‚è¿°"><a href="#1ã€æ¦‚è¿°" class="headerlink" title="1ã€æ¦‚è¿°"></a>1ã€æ¦‚è¿°</h2><p>â€‹ä¸²è¡Œå¤–è®¾æ¥å£ï¼ˆSerial Peripheral Interfaceï¼‰ï¼Œé«˜é€Ÿã€å…¨åŒå·¥ã€åŒæ­¥é€šä¿¡æ€»çº¿ï¼ˆåŒä¸€æ—¶åˆ»åªæœ‰ä¸€ä¸»ä¸€ä»è¿›è¡Œé€šä¿¡ï¼‰ï¼Œå››çº¿ï¼ˆMISO:ä¸»å…¥ä»å‡ºï¼›MOSIï¼šä¸»å‡ºä»å…¥ï¼›SCKï¼šåŒæ­¥æ—¶é’Ÿä¿¡å·ï¼›SSæˆ–CSï¼šç‰‡é€‰ä½¿èƒ½ï¼‰ã€‚ï¼ˆQuad SPI&#x3D;2Dual SPI&#x3D;4æ ‡å‡†SPIï¼‰ã€‚</p><h2 id="2ã€ESP8266-SPIç±»åº“æˆå‘˜å‡½æ•°"><a href="#2ã€ESP8266-SPIç±»åº“æˆå‘˜å‡½æ•°" class="headerlink" title="2ã€ESP8266 SPIç±»åº“æˆå‘˜å‡½æ•°"></a>2ã€ESP8266 SPIç±»åº“æˆå‘˜å‡½æ•°</h2><p>SPI.hå¤´æ–‡ä»¶ä¸­ï¼Œè¯¥ç±»åº“åªæä¾›ä¸»è®¾å¤‡API</p><ol><li><code>SPI.begin()</code>  åˆå§‹åŒ–SPIé€šä¿¡ï¼›æ— å‚ï¼Œæ— è¿”å›å€¼ï¼›</li><li><code>SPI.end()</code>å…³é—­SPIé€šä¿¡ï¼›æ— å‚ï¼Œæ— è¿”å›å€¼ï¼›</li><li><code>SPI.setBitOrder(order)</code>è®¾ç½®æ•°æ®ä¼ è¾“é¡ºåºï¼›<ul><li>å‚æ•°ï¼ˆorderï¼‰ï¼š<ul><li>~ LSBFIRSTï¼Œä½ä½åœ¨å‰ï¼›</li><li>~ MSBFIRSTï¼Œé«˜ä½åœ¨å‰ï¼›</li></ul></li><li>æ— è¿”å›å€¼ï¼›</li></ul></li><li><code>SPI.setClockDivider(divider)</code>è®¾ç½®é€šä¿¡æ—¶é’Ÿï¼ˆç”±ç³»ç»Ÿæ—¶é’Ÿåˆ†é¢‘ï¼‰<ul><li>å‚æ•°ï¼ˆdividerï¼‰:<ul><li>~ SPI_CLOCK_DIV2, 2åˆ†é¢‘ï¼›</li><li>~ SPI_CLOCK_DIV4, 4åˆ†é¢‘ï¼›</li><li>~ SPI_CLOCK_DIV8, 8åˆ†é¢‘ï¼›</li><li>~ SPI_CLOCK_DIV16, 16åˆ†é¢‘ï¼›</li><li>~ SPI_CLOCK_DIV32, 32åˆ†é¢‘ï¼›</li><li>~ SPI_CLOCK_DIV64, 64åˆ†é¢‘ï¼›</li><li>~ SPI_CLOCK_DIV128, 128åˆ†é¢‘ï¼›</li></ul></li><li>æ— è¿”å›å€¼ï¼›</li></ul></li><li><code>SPI.setDataMode(mode)</code>è®¾ç½®æ•°æ®æ¨¡å¼<ul><li>å‚æ•°ï¼ˆmodeï¼‰:<ul><li>~ SPI_MODE0;å³ï¼šCPOL&#x3D;0,CPHA&#x3D;0</li><li>~ SPI_MODE1;                å³ï¼šCPOL&#x3D;0,CPHA&#x3D;1</li><li>~ SPI_MODE2;                å³ï¼šCPOL&#x3D;1,CPHA&#x3D;0</li><li>~ SPI_MODE3;                å³ï¼šCPOL&#x3D;1,CPHA&#x3D;1</li></ul></li><li>æ— è¿”å›å€¼</li><li>è¡¥å……ï¼šå››ç§æ¨¡å¼ï¼Œå³SPIç›¸ä½ï¼ˆCPHAï¼‰å’Œææ€§ï¼ˆCPOLï¼‰åˆ†åˆ«ä¸º0æˆ–1;<ul><li>CPOLï¼šå³SPIç©ºé—²æ—¶ï¼ŒSCLKçš„ç”µå¹³ï¼ˆ1é«˜ï¼Œ0ä½ï¼‰ï¼›</li><li>CPHAï¼šå³SPIåœ¨SCLKçš„ç¬¬å‡ ä¸ªè¾¹æ²¿å¼€å§‹é‡‡æ ·ï¼ˆ0ç¬¬ä¸€ä¸ªï¼Œ1ç¬¬äºŒä¸ªï¼‰ï¼›</li></ul></li></ul></li><li><code>SPI.transfer(val)</code>ä¼ è¾“1Bçš„æ•°æ®ã€‚å…¨åŒå·¥ï¼Œå‘1Bæ”¶1Bæ•°æ®</li><li><code>SPI.transfer16(val)</code>ä¼ è¾“2Bæ•°æ®ï¼Œä»æœºè¿”å›2Bä½œä¸ºè¿”å›å€¼ï¼›</li><li><code>SPI.transferBuf(buf,count)</code>ä¼ è¾“ä¸€ä¸ªç¼“å†²åŒºæ•°æ®ï¼Œå‚æ•°ä¸ºå‘é€çš„ç¼“å†²åŒºbufï¼ˆ<code>uint8_t*</code>æ•°æ®ï¼‰ï¼Œcountä½ç¼“å†²åŒºå¤§å°ï¼Œæ— è¿”å›å€¼ï¼ˆä½†ä»æœºä¼ è¾“æ¥çš„æ•°æ®ä¼šæ›¿æ¢æ‰bufç¼“å†²åŒºçš„æ•°æ®ï¼‰</li><li><code>SPI.pins(sck,miso,mosi,ss)</code>åˆ‡æ¢SPIå¼•è„šæ˜ å°„ï¼Œéœ€åœ¨<code>SPI.begin()</code>å‰è°ƒç”¨</li></ol><h2 id="3ã€SPIå¯„å­˜å™¨"><a href="#3ã€SPIå¯„å­˜å™¨" class="headerlink" title="3ã€SPIå¯„å­˜å™¨"></a>3ã€SPIå¯„å­˜å™¨</h2><p>æ‰€æœ‰SPIè®¾ç½®éƒ½æ˜¯ç”±Arduino SPIæ§åˆ¶å¯„å­˜å™¨ï¼ˆSPCRï¼‰å†³å®šã€‚è¯¥å¯„å­˜å™¨å°±æ˜¯MCUå†…å­˜çš„ä¸€ä¸ªå­—èŠ‚ï¼Œå¯è¯»å†™ã€‚å¯„å­˜å™¨æä¾›æœåŠ¡ï¼šæ§åˆ¶ã€æ•°æ®ã€çŠ¶æ€ã€‚</p><ol><li><p>æ§åˆ¶å¯„å­˜å™¨ï¼ˆSPCRï¼‰ï¼š</p><p>8ä½ï¼Œï¼ˆå¦‚å•ç‰‡æœºçš„ä¸­æ–­å…è®¸æ§åˆ¶å¯„å­˜å™¨IEã€ä¸­æ–­ä¼˜å…ˆçº§æ§åˆ¶å¯„å­˜å™¨IPã€å®šæ—¶å™¨&#x2F;è®¡æ•°å™¨æ§åˆ¶å¯„å­˜å™¨ï¼‰</p><p><a href="https://imgtu.com/i/fFaWEn"><img src="https://z3.ax1x.com/2021/08/03/fFaWEn.png" class="lazyload placeholder" data-srcset="https://z3.ax1x.com/2021/08/03/fFaWEn.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="fFaWEn.png"></a></p></li><li><p>æ•°æ®å¯„å­˜å™¨ï¼ˆSPDRï¼‰ï¼š</p><p>ï¼ˆå¦‚ä¸²è¡Œå£é”å­˜å™¨SBUFï¼Œä»…holdä½ä¸€ä¸ªå­—èŠ‚ï¼‰</p></li><li><p>çŠ¶æ€å¯„å­˜å™¨ï¼ˆSPSRï¼‰:</p><p>â€‹æ ¹æ®å¤šç§å¾®æ§åˆ¶å™¨çš„æ¡ä»¶æ”¹å˜å…¶çŠ¶æ€</p></li></ol><h1 id="10ã€Ticker-â€”ESP8266å®šæ—¶åº“"><a href="#10ã€Ticker-â€”ESP8266å®šæ—¶åº“" class="headerlink" title="10ã€Ticker â€”ESP8266å®šæ—¶åº“"></a>10ã€Ticker â€”ESP8266å®šæ—¶åº“</h1><h2 id="1ã€æ¦‚è¿°-1"><a href="#1ã€æ¦‚è¿°-1" class="headerlink" title="1ã€æ¦‚è¿°"></a>1ã€æ¦‚è¿°</h2><ul><li>ç”¨äºè§„å®šæ—¶é—´åè°ƒç”¨å‡½æ•°ï¼›</li></ul><p><a href="https://imgtu.com/i/fAfIxg"><img src="https://z3.ax1x.com/2021/08/04/fAfIxg.png" class="lazyload placeholder" data-srcset="https://z3.ax1x.com/2021/08/04/fAfIxg.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="fAfIxg.png"></a></p><ul><li>ä¸€ä¸ªæ–¹æ³•çš„ç¤ºä¾‹ï¼ˆä¸ºäº†è¯´æ˜ä¸‰ä¸ªå‚æ•°æ—¶çš„æ„ä¹‰ï¼Œä¸¤ä¸ªå‚æ•°æ—¶å¥½ç†è§£ï¼‰</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ¯éš”xxæ¯«ç§’å‘¨æœŸæ€§æ‰§è¡Œ</span></span><br><span class="line"><span class="comment"> * @param seconds ç§’æ•°</span></span><br><span class="line"><span class="comment"> * @param callback å›è°ƒå‡½æ•°</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">attach_ms</span><span class="params">(<span class="type">float</span> seconds, <span class="type">callback_function_t</span> callback)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ¯éš”xxæ¯«ç§’å‘¨æœŸæ€§æ‰§è¡Œ</span></span><br><span class="line"><span class="comment"> * @param seconds ç§’æ•°</span></span><br><span class="line"><span class="comment"> * @param callback å›è°ƒå‡½æ•°</span></span><br><span class="line"><span class="comment"> * @param arg å›è°ƒå‡½æ•°çš„å‚æ•°</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">attach_ms</span><span class="params">(<span class="type">uint32_t</span> milliseconds, <span class="type">void</span> (*callback)(TArg), TArg arg)</span></span><br></pre></td></tr></table></figure><ul><li>ä¸å»ºè®®ä½¿ç”¨Tickerå›è°ƒå‡½æ•°æ¥é˜»å¡IOæ“ä½œï¼ˆç½‘ç»œã€ä¸²å£ã€æ–‡ä»¶ï¼‰ï¼›å¯ä»¥åœ¨Tickerå›è°ƒå‡½æ•°ä¸­è®¾ç½®ä¸€ä¸ªæ ‡è®°ï¼Œåœ¨loopå‡½æ•°ä¸­æ£€æµ‹è¿™ä¸ªæ ‡è®°ï¼›</li><li>å¯¹äºargï¼Œå¿…é¡»æ—¶char, short, int, float, void* , char* ä¹‹ä¸€ï¼›</li></ul><h2 id="2ã€ç¤ºä¾‹"><a href="#2ã€ç¤ºä¾‹" class="headerlink" title="2ã€ç¤ºä¾‹"></a>2ã€ç¤ºä¾‹</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ä»£ç åŠŸèƒ½ï¼šæ¿è½½LEDå¼€å§‹0.3ç§’é—ªï¼Œé—ª20æ¬¡å¼€å§‹ä»¥0.1ç§’å¿«é—ªï¼Œæ€»å…±é—ª120æ¬¡åæœ€åå¸¸äº® </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Ticker.h&gt;</span></span></span><br><span class="line">Ticker flipper;</span><br><span class="line"><span class="type">int</span> count = <span class="number">0</span>;</span><br><span class="line"><span class="type">void</span> <span class="title function_">flip</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="type">int</span> state = digitalRead(LED_BUILTIN);  <span class="comment">// get the current state of GPIO1 pin</span></span><br><span class="line">  digitalWrite(LED_BUILTIN, !state);     <span class="comment">// set pin to the opposite state</span></span><br><span class="line">  ++count;</span><br><span class="line">  <span class="comment">// å½“ç¿»è½¬æ¬¡æ•°è¾¾åˆ°20æ¬¡çš„æ—¶å€™ï¼Œåˆ‡æ¢ledçš„é—ªçƒé¢‘ç‡ï¼Œæ¯éš”0.1sç¿»è½¬ä¸€æ¬¡</span></span><br><span class="line">  <span class="keyword">if</span> (count == <span class="number">20</span>) &#123;</span><br><span class="line">    flipper.attach(<span class="number">0.1</span>, flip);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// å½“æ¬¡æ•°è¾¾åˆ°120æ¬¡çš„æ—¶å€™å…³é—­ticker</span></span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span> (count == <span class="number">120</span>) &#123;</span><br><span class="line">    flipper.detach();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="comment">//LED_BUILTIN å¯¹åº”æ¿è½½LEDçš„IOå£</span></span><br><span class="line">  pinMode(LED_BUILTIN, OUTPUT);</span><br><span class="line">  digitalWrite(LED_BUILTIN, LOW);</span><br><span class="line">  <span class="comment">//æ¯éš”0.3s ç¿»è½¬ä¸€ä¸‹ledçŠ¶æ€</span></span><br><span class="line">  flipper.attach(<span class="number">0.3</span>, flip);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">*æ¿è½½LEDæ¯éš”25msç­ï¼Œæ¯éš”26msäº®</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Ticker.h&gt;</span></span></span><br><span class="line">Ticker tickerSetHigh;</span><br><span class="line">Ticker tickerSetLow;</span><br><span class="line"><span class="type">void</span> <span class="title function_">setPin</span><span class="params">(<span class="type">int</span> state)</span> &#123;</span><br><span class="line">  digitalWrite(LED_BUILTIN, state);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span> &#123;</span><br><span class="line">  pinMode(LED_BUILTIN, OUTPUT);</span><br><span class="line">  digitalWrite(LED_BUILTIN, LOW);</span><br><span class="line">  <span class="comment">// æ¯éš”25msè°ƒç”¨ä¸€æ¬¡ setPin(0)</span></span><br><span class="line">  tickerSetLow.attach_ms(<span class="number">25</span>, setPin, <span class="number">0</span>);</span><br><span class="line">  <span class="comment">// æ¯éš”26msè°ƒç”¨ä¸€æ¬¡ setPin(1)</span></span><br><span class="line">  tickerSetHigh.attach_ms(<span class="number">26</span>, setPin, <span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="11ã€Arduino-Core-For-ESP8266"><a href="#11ã€Arduino-Core-For-ESP8266" class="headerlink" title="11ã€Arduino Core For ESP8266"></a>11ã€Arduino Core For ESP8266</h1><ul><li><p>æºç ï¼š<a href="https://github.com/esp8266/Arduino">Arduino Core For ESP8266 github</a></p></li><li><p>èµ„æ–™ï¼š<a href="https://arduino-esp8266.readthedocs.io/en/latest/index.html">ESP8266 Arduino Core </a></p></li><li><p>æ¦‚è¿°ï¼š</p></li></ul><p><a href="https://imgtu.com/i/fECKd1"><img src="https://z3.ax1x.com/2021/08/04/fECKd1.png" class="lazyload placeholder" data-srcset="https://z3.ax1x.com/2021/08/04/fECKd1.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="fECKd1.png" style="zoom: 150%;" /></a></p><h1 id="12ã€ESP8266å·¥ä½œæ¨¡å¼ä¸ESP8266WIFIåº“"><a href="#12ã€ESP8266å·¥ä½œæ¨¡å¼ä¸ESP8266WIFIåº“" class="headerlink" title="12ã€ESP8266å·¥ä½œæ¨¡å¼ä¸ESP8266WIFIåº“"></a>12ã€ESP8266å·¥ä½œæ¨¡å¼ä¸ESP8266WIFIåº“</h1><h2 id="1ã€ESP8266å·¥ä½œæ¨¡å¼"><a href="#1ã€ESP8266å·¥ä½œæ¨¡å¼" class="headerlink" title="1ã€ESP8266å·¥ä½œæ¨¡å¼"></a>1ã€ESP8266å·¥ä½œæ¨¡å¼</h2><ol><li><p>Stationæ¨¡å¼ï¼ˆSTAï¼‰ï¼š</p><p>ESP8266æ¨¡å—è¿æ¥WIFIç½‘ç»œï¼ˆé€šè¿‡æ¥å…¥ç‚¹ï¼ˆAccess Pointï¼‰ï¼‰</p><p><strong>ç‰¹ç‚¹</strong>ï¼š</p><ul><li>è¿æ¥ä¸¢å¤±ï¼ŒESP8266ä¼šè‡ªåŠ¨é‡è¿æœ€è¿‘ä½¿ç”¨çš„æ¥å…¥ç‚¹ï¼ˆä¼šå‡ºé—®é¢˜ï¼Œè¿ä¸ä¸Šï¼‰ï¼›</li><li>æ¨¡å—é‡å¯ä¹Ÿä¼šè¿™æ ·ï¼›</li><li>ESP8266å°†æœ€åä½¿ç”¨çš„æ¥å…¥ç‚¹è®¤è¯ä¿¡æ¯ï¼ˆssid , pswï¼‰ä¿å­˜åˆ°Flashï¼ˆéæ˜“å¤±æ€§ï¼‰å­˜å‚¨å™¨ä¸­ï¼›</li><li>è‹¥åœ¨Arduino IDEä¿®æ”¹ä»£ç ï¼Œä½†ä¸æ›´æ”¹WIFIå·¥ä½œæ¨¡å¼æˆ–æ¥å…¥ç‚¹è®¤è¯ä¿¡æ¯ï¼ŒESP8266ä½¿ç”¨ä¿å­˜åœ¨Flashä¸Šçš„æ•°æ®é‡æ–°è¿æ¥ã€‚</li></ul></li><li><p>APæ¨¡å¼ï¼ˆsoft-APï¼‰:</p><p>(Access Point) ESP8266ä½œä¸ºæ¥å…¥ç‚¹å»ºç«‹WIFIç½‘ç»œï¼Œä¾›Stationæ¨¡å¼ä¸‹çš„æ¨¡å—è¿æ¥</p><p><strong>ç‰¹ç‚¹</strong>ï¼š</p><ul><li>APæ¨¡å¼å¯ç”¨ä½œSTAæ¨¡å¼çš„æ¨¡å—ä¹‹é—´äº¤æ¢ä¸­è½¬ç«™ï¼ˆè®©æ¨¡å—å¤„äºåŒä¸€WIFIç½‘ç»œä¸‹ï¼‰ï¼›</li><li>å¯å…ˆåœ¨APæ¨¡å¼ä¸‹å‘å‡ºWIFIä¿¡å·ï¼Œæ‰‹æœºè¿æ¥ï¼Œé«˜é€Ÿè¯¥æ¨¡å—å®¶é‡Œçš„WIFIè®¤è¯ä¿¡æ¯ï¼Œæ¨¡å—è½¬ä¸ºSTAæ¨¡å¼ï¼Œè¿æ¥ç›®æ ‡WIFIã€‚</li></ul></li><li><p>APå…¼STAæ¨¡å¼ï¼š</p><p>ä»¥ä¸Šä¸¤ç§æ¨¡å¼çš„æ•´åˆï¼ˆåº”è¯¥æ˜¯åšè½¯è·¯ç”±é‚£ä¸ªæ„æ€ï¼‰</p></li></ol><h2 id="2ã€ESP8266WIFIåº“"><a href="#2ã€ESP8266WIFIåº“" class="headerlink" title="2ã€ESP8266WIFIåº“"></a>2ã€ESP8266WIFIåº“</h2><p>æ¦‚è¿°ï¼š</p><p><a href="https://imgtu.com/i/fEDZ5Q"><img src="https://z3.ax1x.com/2021/08/04/fEDZ5Q.png" class="lazyload placeholder" data-srcset="https://z3.ax1x.com/2021/08/04/fEDZ5Q.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="fEDZ5Q.png"></a></p><p><strong>ç›¸å…³çŸ¥è¯†</strong>ï¼š</p><ol><li><p>åå­—é‡Œå¸¦Secureã€SSLã€TLSçš„ï¼Œå’Œå®‰å…¨æ ¡éªŒæœ‰å…³ï¼ˆhttpsï¼‰ï¼›</p></li><li><p>å¸¦Clientï¼Œå’Œtcpå®¢æˆ·ç«¯ï¼ˆå‘é€ç«¯ï¼‰æœ‰å…³ï¼›</p></li><li><p>å¸¦Serverï¼Œå’ŒtcpæœåŠ¡ç«¯ï¼ˆæ¥æ”¶ç«¯ï¼‰æœ‰å…³ï¼›</p></li><li><p>å¸¦8266ï¼Œé’ˆå¯¹ESP8266çš„ä»£ç å°è£…ï¼›</p></li><li><p>å¸¦Scanï¼Œå’ŒWIFIæ‰«ææœ‰å…³ï¼›</p></li><li><p>å¸¦STAï¼Œå’ŒESP8266 Stationæ¨¡å¼æœ‰å…³ï¼›</p></li><li><p>å¸¦APï¼Œå’ŒESP8266 APæ¨¡å¼ï¼ˆAPçƒ­ç‚¹ï¼‰æœ‰å…³ï¼›</p></li><li><p>ESP8266WiFiGenericï¼ˆ8266æ¨¡å—é€šç”¨åº“ï¼‰åŒ…æ‹¬ï¼šå¤„ç†ç¨‹åºæ¥ç®¡ç†WIFIäº‹ä»¶ï¼Œå¦‚è¿æ¥ã€æ–­å¼€æˆ–è·å¾—ipï¼ŒWIFIæ¨¡å¼çš„å˜åŒ–ï¼Œç®¡ç†æ¨¡å—ç¡çœ æ¨¡å¼çš„åŠŸèƒ½ï¼Œä»¥ipåœ°å€è§£æhostNameç­‰ï¼›</p></li><li><p>ESP8266WiFiGType.hæ–‡ä»¶ï¼Œä¸»è¦ç”¨æ¥å®šä¹‰å„ç§é…ç½®é€‰é¡¹ï¼Œå¦‚WIFIå·¥ä½œæ¨¡å¼ï¼ˆWiFiModeï¼‰,WiFiç¡çœ æ¨¡å¼ï¼ˆWiFiSleep Typeï¼‰,wifiç‰©ç†æ¨¡å¼ï¼ˆWiFiPhyModeï¼‰,wifiäº‹ä»¶ï¼ˆWiFiEventï¼‰ï¼Œwifiæ–­å¼€åŸå› ç­‰ï¼›</p></li><li><p>ESP8266WiFiåº“ä¸ä»…ä»…å±€é™äºESP8266WIFi.hå’ŒESP8266WiFi.cppè¿™ä¸¤ä¸ªæ–‡ä»¶ï¼Œä½†ä»–ä»¬æ˜¯æœ€æ ¸å¿ƒçš„ç»Ÿä¸€å…¥å£ï¼›</p></li><li><p>WiFiUdpåº“ï¼Œåœ¨ESP8266WiFiåŠŸèƒ½åŸºç¡€ä¸ŠåŒ…è£…äº†UDPå¹¿æ’­åè®®ï¼Œé€‚ç”¨äºUDPé€šä¿¡ï¼Œéœ€å¦åŠ å¤´æ–‡ä»¶</p><p><strong>å¼•å…¥<code>#include&lt;ESP8266WiFi.h&gt;</code>ä¸€æ­¥åˆ°ä½</strong></p></li></ol><p><strong>è¯¦è§£</strong>ï¼š</p><h3 id="1ã€WIFIé€šç”¨åŠŸèƒ½åº“ï¼ˆESP8266WiFiGenericï¼‰ï¼š"><a href="#1ã€WIFIé€šç”¨åŠŸèƒ½åº“ï¼ˆESP8266WiFiGenericï¼‰ï¼š" class="headerlink" title="1ã€WIFIé€šç”¨åŠŸèƒ½åº“ï¼ˆESP8266WiFiGenericï¼‰ï¼š"></a>1ã€WIFIé€šç”¨åŠŸèƒ½åº“ï¼ˆESP8266WiFiGenericï¼‰ï¼š</h3><p><a href="https://imgtu.com/i/fErOte"><img src="https://z3.ax1x.com/2021/08/04/fErOte.png" class="lazyload placeholder" data-srcset="https://z3.ax1x.com/2021/08/04/fErOte.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="fErOte.png"></a></p><h3 id="2ã€STAåº“ï¼ˆESP8266WiFiSTAï¼‰ï¼š"><a href="#2ã€STAåº“ï¼ˆESP8266WiFiSTAï¼‰ï¼š" class="headerlink" title="2ã€STAåº“ï¼ˆESP8266WiFiSTAï¼‰ï¼š"></a>2ã€STAåº“ï¼ˆESP8266WiFiSTAï¼‰ï¼š</h3><ol><li><p>é…ç½®è¿æ¥ï¼š</p><p><strong>æ³¨æ„</strong>ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">WiFi.mode(WIFI_STA);<span class="comment">//æœ€å¥½äººä¸ºåŠ ä¸ŠSTAè®¾ç½®ï¼ˆè™½ç„¶é»˜è®¤æ˜¯STAæ¨¡å¼ï¼‰</span></span><br><span class="line">WiFi.disconnect();<span class="comment">//æœ€å¥½è°ƒç”¨ä¸€ä¸‹æ–­è¿</span></span><br><span class="line"><span class="comment">/*å¦‚æœä¹‹å‰å¤„äºAPæ¨¡å¼ï¼Œå†è°ƒbegin()å¯èƒ½ä¼šè¿›å…¥STA+softApæ¨¡å¼</span></span><br><span class="line"><span class="comment">*å¯æ£€æµ‹å½“å‰æ¨¡å¼ï¼ˆWiFi.getMode()ï¼‰</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><ul><li>åˆ‡æ¢åˆ°STAæ¨¡å¼ï¼ˆ<code>begin()</code>ï¼‰</li></ul><p><strong>æºç ï¼š</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* åˆ‡æ¢å·¥ä½œæ¨¡å¼åˆ°STAæ¨¡å¼ï¼Œå¹¶è‡ªåŠ¨è¿æ¥åˆ°æœ€è¿‘æ¥å…¥çš„wifiçƒ­ç‚¹</span></span><br><span class="line"><span class="comment">* @param void</span></span><br><span class="line"><span class="comment">* @return void</span></span><br><span class="line"><span class="comment">* @note è°ƒç”¨è¿™ä¸ªæ–¹æ³•å°±ä¼šåˆ‡æ¢åˆ°STAæ¨¡å¼ï¼Œå¹¶ä¸”è¿æ¥åˆ°æœ€è¿‘ä½¿ç”¨çš„æ¥å…¥ç‚¹ï¼ˆä¼šä»flashä¸­è¯»å–ä¹‹å‰å­˜å‚¨çš„é…ç½®ä¿¡æ¯ï¼‰</span></span><br><span class="line"><span class="comment">* å¦‚æœæ²¡æœ‰é…ç½®ä¿¡æ¯ï¼Œé‚£ä¹ˆè¿™ä¸ªæ–¹æ³•åŸºæœ¬ä¸Šæ²¡æœ‰ä»€ä¹ˆç”¨ã€‚</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">wl_status_t</span> <span class="title function_">begin</span><span class="params">()</span></span><br></pre></td></tr></table></figure><p><strong>åº”ç”¨ï¼š</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">WiFi.begin();</span><br></pre></td></tr></table></figure><ul><li>åˆ‡æ¢åˆ°STAæ¨¡å¼ï¼ˆ<code>begin(ssid,psw)</code>ï¼‰</li></ul><p><strong>åº”ç”¨ï¼š</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">WiFi.begin(AP_SSID, AP_PSW);</span><br></pre></td></tr></table></figure><ul><li>åˆ‡æ¢åˆ°STAæ¨¡å¼ï¼ˆ<code>begin(ssid,psw,channel,bssid,connect)</code>ï¼‰</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* åˆ‡æ¢å·¥ä½œæ¨¡å¼åˆ°STAæ¨¡å¼ï¼Œå¹¶æ ¹æ®connectå±æ€§æ¥åˆ¤æ–­æ˜¯å¦è¿æ¥wifi</span></span><br><span class="line"><span class="comment">* @param ssid       wifiçƒ­ç‚¹åå­—</span></span><br><span class="line"><span class="comment">* @param password   wifiçƒ­ç‚¹å¯†ç </span></span><br><span class="line"><span class="comment">* @param channel    wifiçƒ­ç‚¹çš„é€šé“å·ï¼Œç”¨ç‰¹å®šé€šä¿¡é€šä¿¡ï¼Œå¯é€‰å‚æ•°</span></span><br><span class="line"><span class="comment">* @param bssid      wifiçƒ­ç‚¹çš„macåœ°å€ï¼Œå¯é€‰å‚æ•°</span></span><br><span class="line"><span class="comment">* @param connect    booleanå‚æ•°ï¼Œé»˜è®¤ç­‰äºtrueï¼Œå½“è®¾ç½®ä¸ºfalseï¼Œä¸ä¼šå»è¿æ¥wifiçƒ­ç‚¹ï¼Œä¼šå»ºç«‹moduleä¿å­˜ä¸Šé¢å‚æ•°</span></span><br><span class="line"><span class="comment">* @return wl_status_t  wifiçŠ¶æ€</span></span><br><span class="line"><span class="comment">* @note è°ƒç”¨è¿™ä¸ªæ–¹æ³•å°±ä¼šåˆ‡æ¢åˆ°STAæ¨¡å¼ã€‚</span></span><br><span class="line"><span class="comment">*       å¦‚æœconnectç­‰äºtrueï¼Œä¼šè¿æ¥åˆ°ssidçš„wifiçƒ­ç‚¹ã€‚</span></span><br><span class="line"><span class="comment">*       å¦‚æœconnectç­‰äºfalseï¼Œä¸ä¼šè¿æ¥åˆ°ssidçš„wifiçƒ­ç‚¹ï¼Œä¼šå»ºç«‹moduleä¿å­˜ä¸Šé¢å‚æ•°ã€‚</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">wl_status_t</span> <span class="title function_">begin</span><span class="params">(<span class="type">char</span>* ssid, <span class="type">char</span> *passphrase = <span class="literal">NULL</span>, <span class="type">int32_t</span> channel =<span class="number">0</span>, <span class="type">const</span> <span class="type">uint8_t</span>* bssid = <span class="literal">NULL</span>, <span class="type">bool</span> connect = <span class="literal">true</span></span></span><br><span class="line"><span class="params"></span></span><br></pre></td></tr></table></figure><ul><li>é…ç½®IPä¿¡æ¯ï¼ˆ<code>config(local_ip,gateway,subnet,dns1,dns2)</code>ï¼‰</li></ul><p><strong>æºç ï¼š</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* ç¦æ­¢DHCP clientï¼Œè®¾ç½®station æ¨¡å¼ä¸‹çš„IPé…ç½®</span></span><br><span class="line"><span class="comment">* @param  local_ip    stationå›ºå®šçš„ipåœ°å€(è¿æ¥å¿«)</span></span><br><span class="line"><span class="comment">* @param  gateway     ç½‘å…³</span></span><br><span class="line"><span class="comment">* @param  subnet      å­ç½‘æ©ç ï¼ˆå‰3ä¸ªå‚æ•°éƒ½è®¾ç½®ä¸º0.0.0.0ï¼Œåˆ™é‡å¯DHCPï¼‰</span></span><br><span class="line"><span class="comment">* @param  dns1ï¼Œdns2  å¯é€‰å‚æ•°å®šä¹‰åŸŸåæœåŠ¡å™¨ï¼ˆdnsï¼‰çš„ipåœ°å€ï¼Œè¿™äº›åŸŸåæœåŠ¡å™¨</span></span><br><span class="line"><span class="comment">*                     ç»´æŠ¤ä¸€ä¸ªåŸŸåç›®å½•ï¼ˆå¦‚www.google.co.ukï¼‰ï¼Œå¹¶å°†å®ƒä»¬ç¿»è¯‘æˆipåœ°å€  </span></span><br><span class="line"><span class="comment">* @return booleanå€¼ï¼Œå¦‚æœé…ç½®æˆåŠŸï¼Œè¿”å›trueï¼›</span></span><br><span class="line"><span class="comment">*         å¦‚æœé…ç½®æ²¡æˆåŠŸï¼ˆæ¨¡å—æ²¡å¤„äºstationæˆ–è€…station+soft APæ¨¡å¼ï¼‰ï¼Œè¿”å›falseï¼›</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">bool</span> <span class="title function_">config</span><span class="params">(IPAddress local_ip, IPAddress gateway, IPAddress subnet, IPAddress dns1 = (<span class="type">uint32_t</span>)<span class="number">0x00000000</span>, IPAddress dns2 = (<span class="type">uint32_t</span>)<span class="number">0x00000000</span>)</span></span><br></pre></td></tr></table></figure></li><li><p>ç®¡ç†è¿æ¥ï¼š</p><ul><li>é‡æ–°è¿æ¥ç½‘ç»œï¼ˆ<code>reconnect()</code>ï¼‰</li></ul><p><strong>æºç ï¼š</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* æ–­å¼€è¿æ¥å¹¶ä¸”é‡æ–°è¿æ¥stationåˆ°åŒä¸€ä¸ªAP</span></span><br><span class="line"><span class="comment">* @param void</span></span><br><span class="line"><span class="comment">* @return false or true</span></span><br><span class="line"><span class="comment">*         è¿”å›falseï¼Œæ„å‘³ç€ESP8266ä¸å¤„äºSTAæ¨¡å¼æˆ–è€…è¯´Stationåœ¨æ­¤ä¹‹å‰æ²¡æœ‰è¿æ¥åˆ°ä¸€ä¸ªå¯æ¥å…¥ç‚¹ã€‚</span></span><br><span class="line"><span class="comment">*         è¿”å›trueï¼Œæ„å‘³ç€å·²ç»æˆåŠŸé‡æ–°å¯åŠ¨è¿æ¥ï¼Œä½†æ˜¯ç”¨æˆ·ä»åº”è¯¥å»æ£€æµ‹ç½‘ç»œè¿æ¥çŠ¶æ€æŒ‡å¯¼WL_CONNECTEDã€‚</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">bool</span> <span class="title function_">reconnect</span><span class="params">()</span></span><br></pre></td></tr></table></figure><p><strong>åº”ç”¨ï¼š</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">WiFi.reconnect();</span><br><span class="line"><span class="keyword">while</span> (WiFi.status() != WL_CONNECTED)</span><br><span class="line">&#123;</span><br><span class="line">  delay(<span class="number">500</span>);</span><br><span class="line">  Serial.print(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>æ–­å¼€ç½‘ç»œè¿æ¥ï¼ˆ<code>disconnect()</code>ï¼‰</li></ul><p><strong>æºç ï¼š</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* æ–­å¼€wifiè¿æ¥ï¼Œè®¾ç½®å½“å‰é…ç½®SSIDå’Œpwdä¸ºnull</span></span><br><span class="line"><span class="comment">* @param wifioff å¯é€‰å‚æ•°ï¼Œè®¾ç½®ä¸ºtrueï¼Œé‚£ä¹ˆå°±ä¼šå…³é—­Stationæ¨¡å¼</span></span><br><span class="line"><span class="comment">* @return false or true è¿”å›wl_status_tçŠ¶æ€</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">bool</span> <span class="title function_">disconnect</span><span class="params">(<span class="type">bool</span> wifioff = <span class="literal">false</span>)</span>;</span><br></pre></td></tr></table></figure><ul><li>æ˜¯å¦è¿æ¥ç½‘ç»œï¼ˆ<code>isConnected()</code>ï¼‰</li></ul><p><strong>æºç ï¼š</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* åˆ¤æ–­STAæ¨¡å¼ä¸‹æ˜¯å¦è¿æ¥ä¸ŠAP</span></span><br><span class="line"><span class="comment">* @return å¦‚æœSTAè¿æ¥ä¸ŠAPï¼Œé‚£ä¹ˆå°±è¿”å›true</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">bool</span> <span class="title function_">isConnected</span><span class="params">()</span>;</span><br></pre></td></tr></table></figure><ul><li>è®¾ç½®æ˜¯å¦è‡ªåŠ¨è¿æ¥åˆ°æœ€è¿‘æ¥å…¥ç‚¹ï¼ˆ<code>setAutoConnect(bool autoReconnect)</code>ï¼‰</li></ul><p><strong>æºç ï¼š</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* å½“ç”µæºå¯åŠ¨åï¼Œè®¾ç½®ESP8266åœ¨STAæ¨¡å¼ä¸‹æ˜¯å¦è‡ªåŠ¨è¿æ¥flashä¸­å­˜å‚¨çš„AP</span></span><br><span class="line"><span class="comment">* @param autoConnect bool é»˜è®¤æ˜¯è‡ªåŠ¨è¿æ¥</span></span><br><span class="line"><span class="comment">* @return è¿”å›ä¿å­˜çŠ¶æ€ true or false</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">bool</span> <span class="title function_">setAutoConnect</span><span class="params">(<span class="type">bool</span> autoConnect)</span>;</span><br></pre></td></tr></table></figure><ul><li>åˆ¤æ–­æ˜¯å¦è‡ªåŠ¨è®¾ç½®è‡ªåŠ¨è¿æ¥ï¼ˆ<code>getAutoConnect()</code>ï¼‰</li></ul><p><strong>æºç ï¼š</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* æ£€æµ‹ESP8266 stationæ¨¡å¼ä¸‹æ˜¯å¦å¯åŠ¨è‡ªåŠ¨è¿æ¥</span></span><br><span class="line"><span class="comment">* @return è¿”å›è‡ªåŠ¨è¿æ¥çŠ¶æ€ true or false</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">bool</span> <span class="title function_">getAutoConnect</span><span class="params">()</span>;</span><br></pre></td></tr></table></figure><ul><li>è®¾ç½®æ˜¯å¦è‡ªåŠ¨é‡è¿åˆ°æœ€è¿‘æ¥å…¥ç‚¹ï¼ˆ<code>setAutoReconnect(bool autoReconnect)</code>ï¼‰</li></ul><p><strong>æºç ï¼š</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* è®¾ç½®å½“æ–­å¼€è¿æ¥çš„æ—¶å€™æ˜¯å¦è‡ªåŠ¨é‡è¿</span></span><br><span class="line"><span class="comment">*  ç½‘ç»œæ–­å¼€åå†è®¾ç½®æ— æ•ˆ</span></span><br><span class="line"><span class="comment">* @param autoConnect bool</span></span><br><span class="line"><span class="comment">* @return è¿”å›ä¿å­˜çŠ¶æ€ true or false</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">bool</span> <span class="title function_">setAutoReconnect</span><span class="params">(<span class="type">bool</span> autoReconnect)</span>;</span><br></pre></td></tr></table></figure><ul><li>åˆ¤æ–­ç½‘ç»œè¿æ¥çŠ¶æ€ï¼ˆ<code>waitForConnectResult()</code>ï¼‰</li></ul><p><strong>æºç ï¼š</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* ç­‰å¾…ç›´åˆ°ESP8266è¿æ¥APè¿”å›ç»“æœ</span></span><br><span class="line"><span class="comment">* @return uint8_t è¿æ¥ç»“æœ</span></span><br><span class="line"><span class="comment">*         1.WL_CONNECTED æˆåŠŸè¿æ¥</span></span><br><span class="line"><span class="comment">*         2.WL_NO_SSID_AVAIL  åŒ¹é…SSIDå¤±è´¥ï¼ˆè´¦å·é”™è¯¯ï¼‰</span></span><br><span class="line"><span class="comment">*         3.WL_CONNECT_FAILED pswé”™è¯¯</span></span><br><span class="line"><span class="comment">*         4.WL_IDLE_STATUS å½“wi-fiæ­£åœ¨ä¸åŒçš„çŠ¶æ€ä¸­å˜åŒ–</span></span><br><span class="line"><span class="comment">*         5.WL_DISCONNECTED è¿™ä¸ªæ¨¡å—æ²¡æœ‰é…ç½®STAæ¨¡å¼</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">uint8_t</span> <span class="title function_">waitForConnectResult</span><span class="params">()</span>;</span><br></pre></td></tr></table></figure></li><li><p>stationä¿¡æ¯ï¼š</p><ul><li>è·å–macåœ°å€<ul><li><code>macAddress(macAddr)</code></li><li><code>macAddress()</code></li></ul></li></ul><p><strong>æºç ï¼š</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è·å–ESP stationä¸‹çš„Macåœ°å€</span></span><br><span class="line"><span class="comment"> * @param mac   uint8_tæ•°ç»„çš„æŒ‡é’ˆï¼Œæ•°ç»„é•¿åº¦ä¸ºMacåœ°å€çš„é•¿åº¦ï¼Œè¿™é‡Œä¸º6</span></span><br><span class="line"><span class="comment"> * @return      è¿”å›uint8_tæ•°ç»„çš„æŒ‡é’ˆ</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">uint8_t</span> * <span class="title function_">macAddress</span><span class="params">(<span class="type">uint8_t</span>* mac)</span>;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è·å–ESP stationä¸‹çš„Macåœ°å€</span></span><br><span class="line"><span class="comment"> * @return  è¿”å›Stringçš„Macåœ°å€</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">String <span class="title function_">macAddress</span><span class="params">()</span>;</span><br></pre></td></tr></table></figure><p><strong>åº”ç”¨ï¼š</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å®ä¾‹ä»£ç 1 è¿™åªæ˜¯éƒ¨åˆ†ä»£ç  ä¸èƒ½ç›´æ¥ä½¿ç”¨</span></span><br><span class="line"><span class="keyword">if</span> (WiFi.status() == WL_CONNECTED)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">uint8_t</span> macAddr[<span class="number">6</span>];</span><br><span class="line">  WiFi.macAddress(macAddr);</span><br><span class="line">  Serial.<span class="built_in">printf</span>(<span class="string">&quot;Connected, mac address: %02x:%02x:%02x:%02x:%02x:%02x\n&quot;</span>, macAddr[<span class="number">0</span>], macAddr[<span class="number">1</span>], macAddr[<span class="number">2</span>], macAddr[<span class="number">3</span>], macAddr[<span class="number">4</span>], macAddr[<span class="number">5</span>]);</span><br><span class="line">  <span class="comment">//Connected, mac address: 5C:CF:7F:08:11:17</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//å®ä¾‹ä»£ç 2 è¿™åªæ˜¯éƒ¨åˆ†ä»£ç  ä¸èƒ½ç›´æ¥ä½¿ç”¨</span></span><br><span class="line"><span class="keyword">if</span> (WiFi.status() == WL_CONNECTED)</span><br><span class="line">&#123;</span><br><span class="line">  Serial.<span class="built_in">printf</span>(<span class="string">&quot;Connected, mac address: %s\n&quot;</span>, WiFi.macAddress().c_str());</span><br><span class="line">  Connected, mac address: <span class="number">5</span>C:CF:<span class="number">7F</span>:<span class="number">08</span>:<span class="number">11</span>:<span class="number">17</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>è·å–ipåœ°å€ï¼ˆ<code>localIP()</code>ï¼‰</li></ul><p><strong>æºç ï¼š</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è¿”å›ESP8266 STAæ¨¡å¼ä¸‹çš„IPåœ°å€</span></span><br><span class="line"><span class="comment"> * @return IPåœ°å€</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">IPAddress <span class="title function_">localIP</span><span class="params">()</span>;</span><br></pre></td></tr></table></figure><p><strong>åº”ç”¨ï¼š</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (WiFi.status() == WL_CONNECTED)</span><br><span class="line">&#123;</span><br><span class="line">  Serial.print(<span class="string">&quot;Connected, IP address: &quot;</span>);</span><br><span class="line">  Serial.println(WiFi.localIP());</span><br><span class="line">  <span class="comment">//Connected, IP address: 192.168.1.10</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>è·å–å­ç½‘æ©ç ï¼ˆ<code>subnetMask()</code>ï¼‰</li></ul><p><strong>æºç ï¼š</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è·å–å­ç½‘æ©ç çš„åœ°å€</span></span><br><span class="line"><span class="comment"> * @return è¿”å›å­ç½‘æ©ç çš„IPåœ°å€</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">IPAddress <span class="title function_">subnetMask</span><span class="params">()</span>;</span><br></pre></td></tr></table></figure><p><strong>åº”ç”¨ï¼š</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Serial.print(<span class="string">&quot;Subnet mask: &quot;</span>);</span><br><span class="line">Serial.println(WiFi.subnetMask());</span><br><span class="line"><span class="comment">//Subnet mask: 255.255.255.0</span></span><br></pre></td></tr></table></figure><ul><li>è·å–ç½‘å…³åœ°å€ï¼ˆ<code>getwayIP()</code>ï¼‰</li></ul><p><strong>æºç ï¼š</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è·å–ç½‘å…³IPåœ°å€</span></span><br><span class="line"><span class="comment"> * @return è¿”å›ç½‘å…³IPåœ°å€</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">IPAddress <span class="title function_">gatewayIP</span><span class="params">()</span>;</span><br></pre></td></tr></table></figure><p><strong>åº”ç”¨ï¼š</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å®ä¾‹ä»£ç  è¿™åªæ˜¯éƒ¨åˆ†ä»£ç  ä¸èƒ½ç›´æ¥ä½¿ç”¨</span></span><br><span class="line">Serial.<span class="built_in">printf</span>(<span class="string">&quot;Gataway IP: %s\n&quot;</span>, WiFi.gatewayIP().toString().c_str());</span><br><span class="line"><span class="comment">//Gataway IP: 192.168.1.9</span></span><br></pre></td></tr></table></figure><ul><li>è·å–dnsåœ°å€ï¼ˆ<code>dnsIP()</code>ï¼‰</li></ul><p><strong>æºç ï¼š</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è·å–DNS ipåœ°å€</span></span><br><span class="line"><span class="comment"> * @param dns_no dnsåºåˆ—å·</span></span><br><span class="line"><span class="comment"> * @return è¿”å›DNSæœåŠ¡çš„IPåœ°å€</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">IPAddress <span class="title function_">dnsIP</span><span class="params">(<span class="type">uint8_t</span> dns_no = <span class="number">0</span>)</span>;</span><br></pre></td></tr></table></figure><p><strong>åº”ç”¨ï¼š</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Serial.print(<span class="string">&quot;DNS #1, #2 IP: &quot;</span>);</span><br><span class="line">WiFi.dnsIP().printTo(Serial);</span><br><span class="line">Serial.print(<span class="string">&quot;, &quot;</span>);</span><br><span class="line">WiFi.dnsIP(<span class="number">1</span>).printTo(Serial);</span><br><span class="line">Serial.println();</span><br><span class="line"><span class="comment">//DNS #1, #2 IP: 62.179.1.60, 62.179.1.61</span></span><br></pre></td></tr></table></figure><ul><li>è·å–hoståå­—ï¼ˆ<code>hostname()</code>ï¼‰</li></ul><p><strong>æºç ï¼š</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è·å–ESP8266 station DHCPçš„ä¸»æœºå</span></span><br><span class="line"><span class="comment"> * @return ä¸»æœºå</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">String <span class="title function_">hostname</span><span class="params">()</span>;</span><br></pre></td></tr></table></figure><ul><li>è®¾ç½®hoståå­—ï¼ˆ<code>hostname(hostname)</code>ï¼‰ï¼ˆ3ç§ï¼‰</li></ul><p><strong>æºç ï¼š</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è®¾ç½®ESP8266 station DHCPçš„ä¸»æœºå</span></span><br><span class="line"><span class="comment"> * @param aHostname æœ€å¤§é•¿åº¦:32</span></span><br><span class="line"><span class="comment"> * @return ok</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">bool</span> <span class="title function_">hostname</span><span class="params">(<span class="type">char</span>* aHostname)</span>;</span><br><span class="line"><span class="type">bool</span> <span class="title function_">hostname</span><span class="params">(<span class="type">const</span> <span class="type">char</span>* aHostname)</span>;</span><br><span class="line"><span class="type">bool</span> <span class="title function_">hostname</span><span class="params">(String aHostname)</span>;</span><br></pre></td></tr></table></figure><p><strong>åº”ç”¨ï¼š</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Serial.<span class="built_in">printf</span>(<span class="string">&quot;Default hostname: %s\n&quot;</span>, WiFi.hostname().c_str());</span><br><span class="line">WiFi.hostname(<span class="string">&quot;Station_Tester_02&quot;</span>);</span><br><span class="line">Serial.<span class="built_in">printf</span>(<span class="string">&quot;New hostname: %s\n&quot;</span>, WiFi.hostname().c_str());</span><br><span class="line"><span class="comment">//Default hostname: ESP_081117</span></span><br><span class="line"><span class="comment">//New hostname: Station_Tester_02</span></span><br></pre></td></tr></table></figure><ul><li>è·å–å½“å‰wifiè¿æ¥çŠ¶æ€ï¼ˆ<code>status()</code>ï¼‰</li></ul><p><strong>æºç ï¼š</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è¿”å›wifiçš„è¿æ¥çŠ¶æ€</span></span><br><span class="line"><span class="comment"> * @return è¿”å›wl_status_tä¸­å®šä¹‰çš„å…¶ä¸­ä¸€å€¼ï¼Œwl_status_tåœ¨ wl_definitions.hä¸­å®šä¹‰</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">wl_status_t</span> <span class="title function_">status</span><span class="params">()</span>;</span><br></pre></td></tr></table></figure><ul><li>è·å–wifiç½‘ç»œåå­—ï¼ˆ<code>SSID()</code>ï¼‰</li></ul><p><strong>æºç ï¼š</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è¿”å›å½“å‰é€šä¿¡ç½‘ç»œçš„SSID</span></span><br><span class="line"><span class="comment"> * @return SSID</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">String <span class="title function_">SSID</span><span class="params">()</span> <span class="type">const</span>;</span><br></pre></td></tr></table></figure><p><strong>åº”ç”¨ï¼š</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å®ä¾‹ä»£ç  è¿™åªæ˜¯éƒ¨åˆ†ä»£ç  ä¸èƒ½ç›´æ¥ä½¿ç”¨</span></span><br><span class="line">Serial.<span class="built_in">printf</span>(<span class="string">&quot;SSID: %s\n&quot;</span>, WiFi.SSID().c_str());</span><br><span class="line"><span class="comment">//SSID: sensor-net</span></span><br></pre></td></tr></table></figure><ul><li>è·å–wifiç½‘ç»œå¯†ç ï¼ˆ<code>psk()</code>ï¼‰</li></ul><p><strong>æºç ï¼š</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è¿”å›å½“å‰é€šä¿¡ç½‘ç»œçš„å¯†ç </span></span><br><span class="line"><span class="comment"> * @return psk</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">String <span class="title function_">psk</span><span class="params">()</span> <span class="type">const</span>;</span><br></pre></td></tr></table></figure><ul><li>è·å–wifiç½‘ç»œmacaddressï¼ˆ<code>BSSID()</code>ï¼‰</li></ul><p><strong>æºç ï¼š</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è¿”å›å½“å‰é€šä¿¡ç½‘ç»œçš„macåœ°å€</span></span><br><span class="line"><span class="comment"> * @return bssid uint8_t *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">uint8_t</span> * <span class="title function_">BSSID</span><span class="params">()</span>;</span><br><span class="line">String <span class="title function_">BSSIDstr</span><span class="params">()</span>;</span><br></pre></td></tr></table></figure><p><strong>åº”ç”¨ï¼š</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Serial.<span class="built_in">printf</span>(<span class="string">&quot;BSSID: %s\n&quot;</span>, WiFi.BSSIDstr().c_str());</span><br><span class="line"><span class="comment">//BSSID: 00:1A:70E:C1:68</span></span><br></pre></td></tr></table></figure><ul><li>è·å–wifiç½‘ç»œçš„ä¿¡å·å¼ºåº¦ï¼ˆ<code>RSSI()</code>ï¼‰</li></ul><p><strong>æºç ï¼š</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Return the current network RSSI.è¿”å›å½“å‰é€šä¿¡ç½‘ç»œçš„ä¿¡å·å¼ºåº¦ï¼Œå•ä½æ˜¯dBm</span></span><br><span class="line"><span class="comment"> * @return  RSSI value</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">int32_t</span> <span class="title function_">RSSI</span><span class="params">()</span>;</span><br></pre></td></tr></table></figure><p><strong>åº”ç”¨ï¼š</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Serial.<span class="built_in">printf</span>(<span class="string">&quot;RSSI: %d dBm\n&quot;</span>, WiFi.RSSI());</span><br><span class="line"><span class="comment">//RSSI: -68 dBm</span></span><br></pre></td></tr></table></figure></li><li><p>æ™ºèƒ½é…ç½®ï¼š</p><ul><li>è¿›å…¥æ™ºèƒ½é…ç½®åŠŸèƒ½ï¼ˆ<code>beginSmartConfig()</code>ï¼‰</li><li>æŸ¥è¯¢æ™ºèƒ½é…ç½®çŠ¶æ€ï¼ˆ<code>smartConfigDone()</code>ï¼‰</li><li>åœæ­¢æ™ºèƒ½é…ç½®åŠŸèƒ½ï¼ˆ<code>stopSmartConfig()</code>ï¼‰</li><li><code>WiFi.beginWPSConfig()</code></li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">bool</span> <span class="title function_">beginWPSConfig</span><span class="params">(<span class="type">void</span>)</span>;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å¯åŠ¨ SmartConfig</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">bool</span> <span class="title function_">beginSmartConfig</span><span class="params">()</span>;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åœæ­¢ SmartConfig</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">bool</span> <span class="title function_">stopSmartConfig</span><span class="params">()</span>;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æŸ¥æ‰¾SmartConfigçŠ¶æ€æ¥å†³å®šæ˜¯å¦åœæ­¢é…ç½®</span></span><br><span class="line"><span class="comment"> * @return smartConfig Done</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">bool</span> <span class="title function_">smartConfigDone</span><span class="params">()</span>;</span><br></pre></td></tr></table></figure></li></ol><h3 id="3ã€APåº“ï¼ˆESP8266WIFIAPï¼‰"><a href="#3ã€APåº“ï¼ˆESP8266WIFIAPï¼‰" class="headerlink" title="3ã€APåº“ï¼ˆESP8266WIFIAPï¼‰"></a>3ã€APåº“ï¼ˆESP8266WIFIAPï¼‰</h3><ol><li>é…ç½®soft-AP:<ul><li>å¯åŠ¨å¼€æ”¾å¼wifiç½‘ç»œï¼ˆ<code>softAP(ssid)</code>ï¼‰</li><li>å¯åŠ¨æ ¡éªŒå¼wifiç½‘ç»œï¼ˆ<code>softAP(ssid,password,channel,hidden)</code>ï¼‰</li><li>é…ç½®apç½‘ç»œä¿¡æ¯ï¼ˆ<code>softAPConfig(local_ip,gateway,subnet)</code>ï¼‰</li></ul></li><li>ç®¡ç†ç½‘ç»œï¼š<ul><li>è·å–è¿æ¥åˆ°APä¸Šçš„stationçš„æ•°ç›®ï¼ˆ<code>softAPgetStationNum()</code>ï¼‰</li><li>å…³é—­APæ¨¡å¼ï¼ˆ<code>softAPdisconnect(bool wifi off)</code>ï¼‰</li></ul></li><li>ç½‘ç»œä¿¡æ¯ï¼š<ul><li>è·å–apçš„IPåœ°å€ï¼ˆ<code>softAPIP()</code>ï¼‰</li><li>è·å–apçš„macåœ°å€ï¼ˆ<code>softAPmacAddress()</code>ï¼‰</li></ul></li></ol><h3 id="4ã€WiFiæ‰«æåº“ï¼ˆESP8266WiFiScanï¼‰"><a href="#4ã€WiFiæ‰«æåº“ï¼ˆESP8266WiFiScanï¼‰" class="headerlink" title="4ã€WiFiæ‰«æåº“ï¼ˆESP8266WiFiScanï¼‰:"></a>4ã€WiFiæ‰«æåº“ï¼ˆESP8266WiFiScanï¼‰:</h3><p>ä¸€èˆ¬ä½¿ç”¨å¼‚æ­¥æ‰«æï¼ˆä¸å½±å“ä»£ç è¿è¡Œï¼‰</p><ol><li><p>æ‰«ææ“ä½œï¼š</p><ul><li><p>åŒæ­¥æ‰«æå‘¨è¾¹æœ‰æ•ˆwifiç½‘ç»œï¼ˆ<code>scanNetworks()</code>ï¼‰</p><p><strong>æºç ï¼š</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Start scan WiFi networks available</span></span><br><span class="line"><span class="comment"> * @param async         run in async mode(æ˜¯å¦å¯åŠ¨å¼‚æ­¥æ‰«æ)</span></span><br><span class="line"><span class="comment"> * @param show_hidden   show hidden networks(æ˜¯å¦æ‰«æéšè—ç½‘ç»œ)</span></span><br><span class="line"><span class="comment"> * @param channel       scan only this channel (0 for all channels)(æ˜¯å¦æ‰«æç‰¹å®šé€šé“)</span></span><br><span class="line"><span class="comment"> * @param ssid*         scan for only this ssid (NULL for all ssid&#x27;s)(æ˜¯å¦æ‰«æç‰¹å®šçš„SSID)</span></span><br><span class="line"><span class="comment"> * @return Number of discovered networks</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">int8_t</span> <span class="title function_">scanNetworks</span><span class="params">(<span class="type">bool</span> async = <span class="literal">false</span>, <span class="type">bool</span> show_hidden = <span class="literal">false</span>, uint8 channel = <span class="number">0</span>, uint8* ssid = <span class="literal">NULL</span>)</span>;</span><br></pre></td></tr></table></figure><p><strong>åº”ç”¨ï¼š</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å®ä¾‹ä»£ç  è¿™åªæ˜¯éƒ¨åˆ†ä»£ç  ä¸èƒ½ç›´æ¥ä½¿ç”¨</span></span><br><span class="line"><span class="comment">//åŒæ­¥æ‰«æ</span></span><br><span class="line"><span class="type">int</span> n = WiFi.scanNetworks();<span class="comment">//ä¸éœ€è¦å¡«ä»»ä½•å‚æ•°</span></span><br><span class="line">Serial.println(<span class="string">&quot;scan done&quot;</span>);</span><br><span class="line"><span class="keyword">if</span> (n == <span class="number">0</span>) &#123;</span><br><span class="line">    Serial.println(<span class="string">&quot;no networks found&quot;</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    Serial.println(<span class="string">&quot; networks found&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>å¼‚æ­¥æ‰«æå‘¨è¾¹æœ‰æ•ˆwifiç½‘ç»œï¼ŒåŒ…æ‹¬éšè—ç½‘ç»œï¼ˆ<code>scanNetworks(bool async,bool show_hiden)</code>ï¼‰</p><p><strong>åº”ç”¨ï¼š</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å®ä¾‹ä»£ç  è¿™åªæ˜¯éƒ¨åˆ†ä»£ç  ä¸èƒ½ç›´æ¥ä½¿ç”¨</span></span><br><span class="line"><span class="comment">//å¼‚æ­¥æ‰«æ</span></span><br><span class="line">WiFi.scanNetworks(<span class="literal">true</span>);</span><br><span class="line"><span class="comment">// print out Wi-Fi network scan result uppon completion</span></span><br><span class="line"><span class="type">int</span> n = WiFi.scanComplete();</span><br><span class="line"><span class="keyword">if</span>(n &gt;= <span class="number">0</span>)&#123;</span><br><span class="line">  Serial.<span class="built_in">printf</span>(<span class="string">&quot;%d network(s) found\n&quot;</span>, n);</span><br><span class="line">  <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++)&#123;</span><br><span class="line">     Serial.<span class="built_in">printf</span>(<span class="string">&quot;%d: %s, Ch:%d (%ddBm) %s\n&quot;</span>, i+<span class="number">1</span>, WiFi.SSID(i).c_str(), WiFi.channel(i), WiFi.RSSI(i), WiFi.encryptionType(i) == ENC_TYPE_NONE ? <span class="string">&quot;open&quot;</span> : <span class="string">&quot;&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//æ‰“å°ä¸€æ¬¡ç»“æœä¹‹åæŠŠç¼“å­˜ä¸­çš„æ•°æ®æ¸…æ‰</span></span><br><span class="line">  WiFi.scanDelete();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>æ£€æµ‹å¼‚æ­¥æ‰«æçš„ç»“æœï¼ˆ<code>scanComplete()</code>ï¼‰</p><p><strong>æºç ï¼š</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * called to get the scan state in Async mode(å¼‚æ­¥æ‰«æçš„ç»“æœå‡½æ•°)</span></span><br><span class="line"><span class="comment"> * @return scan result or status</span></span><br><span class="line"><span class="comment"> *          -1 if scan not find</span></span><br><span class="line"><span class="comment"> *          -2 if scan not triggered</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">int8_t</span> <span class="title function_">scanComplete</span><span class="params">()</span>;</span><br></pre></td></tr></table></figure></li><li><p>ä»å†…å­˜ä¸­åˆ é™¤æœ€è¿‘æ‰«æç»“æœï¼ˆ<code>scanDelete()</code>ï¼‰</p><p>å¦‚æœä¸åˆ é™¤ï¼Œåˆ™ä¼šå åŠ ä¸Šæ¬¡æ‰«æç»“æœï¼›</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * delete last scan result from RAM(ä»å†…å­˜ä¸­åˆ é™¤æœ€è¿‘çš„æ‰«æç»“æœ)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">scanDelete</span><span class="params">()</span>;</span><br></pre></td></tr></table></figure></li><li><p>å¼‚æ­¥æ‰«æå‘¨è¾¹wifiç½‘ç»œï¼Œå¹¶å›è°ƒç»“æœï¼ˆ<code>scanNetworkAsync(onComplete,show_hidden)</code>ï¼‰</p><p><strong>æºç ï¼š</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Starts scanning WiFi networks available in async mode</span></span><br><span class="line"><span class="comment"> * @param onComplete    the event handler executed when the scan is done</span></span><br><span class="line"><span class="comment"> * @param show_hidden   show hidden networks</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">scanNetworksAsync</span><span class="params">(<span class="built_in">std</span>::function&lt;<span class="type">void</span>(<span class="type">int</span>)&gt; onComplete, <span class="type">bool</span> show_hidden = <span class="literal">false</span>)</span>;</span><br></pre></td></tr></table></figure><p><strong>åº”ç”¨ï¼š</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å®ä¾‹ä»£ç </span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;ESP8266WiFi.h&quot;</span></span></span><br><span class="line"><span class="type">void</span> <span class="title function_">prinScanResult</span><span class="params">(<span class="type">int</span> networksFound)</span></span><br><span class="line">&#123;</span><br><span class="line">  Serial.<span class="built_in">printf</span>(<span class="string">&quot;%d network(s) found\n&quot;</span>, networksFound);</span><br><span class="line">  <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; networksFound; i++)</span><br><span class="line">  &#123;</span><br><span class="line">    Serial.<span class="built_in">printf</span>(<span class="string">&quot;%d: %s, Ch:%d (%ddBm) %s\n&quot;</span>, i + <span class="number">1</span>, WiFi.SSID(i).c_str(), WiFi.channel(i), WiFi.RSSI(i), WiFi.encryptionType(i) == ENC_TYPE_NONE ? <span class="string">&quot;open&quot;</span> : <span class="string">&quot;&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  Serial.begin(<span class="number">115200</span>);</span><br><span class="line">  Serial.println();</span><br><span class="line"> </span><br><span class="line">  WiFi.mode(WIFI_STA);</span><br><span class="line">  WiFi.disconnect();</span><br><span class="line">  delay(<span class="number">100</span>);</span><br><span class="line"> </span><br><span class="line">  WiFi.scanNetworksAsync(prinScanResult);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span> &#123;&#125;</span><br><span class="line"><span class="comment">//åº”è¯¥ä¼šæ‰“å°å¦‚ä¸‹ç±»ä¼¼çš„æ˜¾ç¤º</span></span><br><span class="line"><span class="comment">//5 network(s) found</span></span><br><span class="line"><span class="comment">//1: Tech_D005107, Ch:6 (-72dBm)</span></span><br><span class="line"><span class="comment">//2: HP-Print-A2-Photosmart 7520, Ch:6 (-79dBm)</span></span><br><span class="line"><span class="comment">//3: ESP_0B09E3, Ch:9 (-89dBm) open</span></span><br><span class="line"><span class="comment">//4: Hack-4-fun-net, Ch:9 (-91dBm)</span></span><br><span class="line"><span class="comment">//5: UPC Wi-Free, Ch:11 (-79dBm)</span></span><br></pre></td></tr></table></figure></li></ul></li><li><p>æ‰«æç»“æœï¼š</p><ul><li><p>è·å–wifiç½‘ç»œåå­—ï¼ˆ<code>SSID(int networkltem)</code>ï¼‰</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Return the SSID discovered during the network scan.</span></span><br><span class="line"><span class="comment"> * @param i     specify from which network item want to get the information</span></span><br><span class="line"><span class="comment"> * @return       ssid string of the specified item on the networks scanned list</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">String <span class="title function_">SSID</span><span class="params">(<span class="type">uint8_t</span> networkItem)</span>;</span><br></pre></td></tr></table></figure></li><li><p>è·å–wifiç½‘ç»œä¿¡å·å¼ºåº¦ï¼ˆ<code>RSS(int networkltem)</code>ï¼‰</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Return the RSSI of the networks discovered during the scanNetworks(ä¿¡å·å¼ºåº¦)</span></span><br><span class="line"><span class="comment"> * @param i specify from which network item want to get the information</span></span><br><span class="line"><span class="comment"> * @return  signed value of RSSI of the specified item on the networks scanned list</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">int32_t</span> <span class="title function_">RSSI</span><span class="params">(<span class="type">uint8_t</span> networkItem)</span>;</span><br></pre></td></tr></table></figure></li><li><p>è·å–wifiç½‘ç»œåŠ å¯†æ–¹å¼ï¼ˆ<code>encryption Type(int networkltem)</code>ï¼‰</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Return the encryption type of the networks discovered during the scanNetworks(åŠ å¯†æ–¹å¼)</span></span><br><span class="line"><span class="comment"> * @param i specify from which network item want to get the information</span></span><br><span class="line"><span class="comment"> * @return  encryption type (enum wl_enc_type) of the specified item on the networks scanned list</span></span><br><span class="line"><span class="comment"> * ............ Values map to 802.11 encryption suites.....................</span></span><br><span class="line"><span class="comment"> *    AUTH_OPEN          ----&gt;     ENC_TYPE_WEP  = 5,</span></span><br><span class="line"><span class="comment"> *    AUTH_WEP           ----&gt;     ENC_TYPE_TKIP = 2,</span></span><br><span class="line"><span class="comment"> *    AUTH_WPA_PSK       ----&gt;     ENC_TYPE_CCMP = 4,</span></span><br><span class="line"><span class="comment"> * ........... except these two, 7 and 8 are reserved in 802.11-2007.......</span></span><br><span class="line"><span class="comment"> *    AUTH_WPA2_PSK      ----&gt;     ENC_TYPE_NONE = 7,</span></span><br><span class="line"><span class="comment"> *    AUTH_WPA_WPA2_PSK  ----&gt;     ENC_TYPE_AUTO = 8</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">uint8_t</span> <span class="title function_">encryptionType</span><span class="params">(<span class="type">uint8_t</span> networkItem)</span>;</span><br></pre></td></tr></table></figure></li><li><p>è·å–wifiç½‘ç»œmacåœ°å€ï¼ˆ<code>BSSID(int networkltem)</code>ï¼‰</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * return MAC / BSSID of scanned wifi (ç‰©ç†åœ°å€)</span></span><br><span class="line"><span class="comment"> * @param i specify from which network item want to get the information</span></span><br><span class="line"><span class="comment"> * @return uint8_t * MAC / BSSID of scanned wifi</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">uint8_t</span> * <span class="title function_">BSSID</span><span class="params">(<span class="type">uint8_t</span> networkItem)</span>;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * return MAC / BSSID of scanned wifi (ç‰©ç†åœ°å€)</span></span><br><span class="line"><span class="comment"> * @param i specify from which network item want to get the information</span></span><br><span class="line"><span class="comment"> * @return uint8_t * MAC / BSSID of scanned wifi</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">String <span class="title function_">BSSIDstr</span><span class="params">(<span class="type">uint8_t</span> networkItem)</span>;</span><br></pre></td></tr></table></figure></li><li><p>è·å–æ•´ä½“ç½‘ç»œä¿¡æ¯ï¼Œåå­—ï¼Œä¿¡å·å¼ºåº¦ç­‰ï¼ˆ<code>getNetworkInfo</code>ï¼‰</p><p>å…¥å‚å‰é¢å¤šæ•°åŠ äº†&amp;ï¼Œæ„å‘³ç€è°ƒå®Œå‡½æ•°åå¤–é¢è·å–åˆ°çš„è¯¦ç»†æ´—ä¿¡æ¯ï¼›</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * loads all infos from a scanned wifi in to the ptr parameters</span></span><br><span class="line"><span class="comment"> * @param networkItem uint8_t</span></span><br><span class="line"><span class="comment"> * @param ssid  const char**</span></span><br><span class="line"><span class="comment"> * @param encryptionType uint8_t *</span></span><br><span class="line"><span class="comment"> * @param RSSI int32_t *</span></span><br><span class="line"><span class="comment"> * @param BSSID uint8_t **</span></span><br><span class="line"><span class="comment"> * @param channel int32_t *</span></span><br><span class="line"><span class="comment"> * @param isHidden bool *</span></span><br><span class="line"><span class="comment"> * @return (true if ok)</span></span><br><span class="line"><span class="comment"> */</span>        </span><br><span class="line"><span class="type">bool</span> <span class="title function_">getNetworkInfo</span><span class="params">(<span class="type">uint8_t</span> networkItem, String &amp;ssid, <span class="type">uint8_t</span> &amp;encryptionType, <span class="type">int32_t</span> &amp;RSSI, <span class="type">uint8_t</span>* &amp;BSSID, <span class="type">int32_t</span> &amp;channel, <span class="type">bool</span> &amp;isHidden)</span>;</span><br></pre></td></tr></table></figure></li><li><p>è·å–wifiç½‘ç»œé€šé“å·</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * return channel of scanned wifi(é€šé“å·)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">int32_t</span> <span class="title function_">channel</span><span class="params">(<span class="type">uint8_t</span> networkItem)</span>;</span><br></pre></td></tr></table></figure></li><li><p>åˆ¤æ–­wifiç½‘ç»œæ˜¯å¦æ˜¯éšè—ç½‘ç»œ</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * return if the scanned wifi is Hidden (no SSID)(åˆ¤æ–­æ‰«æåˆ°çš„wifiæ˜¯å¦æ˜¯éšè—wifi)</span></span><br><span class="line"><span class="comment"> * @param networkItem specify from which network item want to get the information</span></span><br><span class="line"><span class="comment"> * @return bool (true == hidden)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">bool</span> <span class="title function_">isHidden</span><span class="params">(<span class="type">uint8_t</span> networkItem)</span>;</span><br></pre></td></tr></table></figure></li></ul></li></ol><h3 id="5ã€TCPå®¢æˆ·ç«¯ï¼ˆWiFiClientï¼‰"><a href="#5ã€TCPå®¢æˆ·ç«¯ï¼ˆWiFiClientï¼‰" class="headerlink" title="5ã€TCPå®¢æˆ·ç«¯ï¼ˆWiFiClientï¼‰:"></a>5ã€TCPå®¢æˆ·ç«¯ï¼ˆWiFiClientï¼‰:</h3><p><strong>TCPä¸HTTPå…³ç³»ï¼š</strong></p><p>TCPæ˜¯åº•å±‚é€šè®¯åè®®ï¼Œå®šä¹‰çš„æ˜¯æ•°æ®ä¼ è¾“å’Œè¿æ¥æ–¹å¼çš„è§„èŒƒï¼›</p><p>HTTPæ˜¯åº”ç”¨å±‚åè®®ï¼Œå®šä¹‰çš„æ˜¯ä¼ è¾“æ•°æ®çš„å†…å®¹è§„èŒƒï¼›</p><p>HTTPåè®®ä¸­çš„æ•°æ®æ˜¯åˆ©ç”¨TCPåè®®ä¼ è¾“çš„ï¼Œæ‰€ä»¥æ”¯æŒHTTPå°±æ”¯æŒTCPã€‚</p><ol><li>è¿æ¥æ“ä½œï¼š<ul><li>å¯åŠ¨tcpè¿æ¥ï¼ˆ<code>connect(host,port)</code>ï¼‰</li><li>åˆ¤æ–­clientæ˜¯å¦è¿˜åœ¨è¿æ¥ï¼ˆ<code>connected()</code>ï¼‰</li><li>åœæ­¢tcpè¿æ¥ï¼ˆ<code>stop()</code>ï¼‰</li></ul></li><li>å‘é€httpè¯·æ±‚æ“ä½œï¼š<ul><li><code>print()</code></li><li><code>println()</code></li><li><code>write()</code></li></ul></li><li>å“åº”æ“ä½œï¼š<ul><li>åˆ¤æ–­æ˜¯å¦æœ‰å“åº”æ•°æ®ï¼ˆ<code>available()</code>ï¼‰</li><li>æŸ¥æ‰¾å“åº”æ•°æ®æŸä¸ªå­—ç¬¦ä¸²ï¼ˆ<code>find()</code>ï¼‰</li><li>è¯»å–å“åº”æ•°æ®ç›´åˆ°æŸä¸ªå­—ç¬¦ä¸²ï¼Œä¼šæ¸…é™¤æ‰ï¼ˆ<code>readStringUntil</code>ï¼‰</li><li>è¯»å–å“åº”æ•°æ®ä¸­çš„ä¸€ä¸ªå­—ç¬¦ï¼Œä¸æ¸…é™¤ï¼ˆ<code>peek()</code>ï¼‰</li><li>è¯»å–å›ºå®šå¤§å°çš„å“åº”æ•°æ®ï¼Œä¸æ¸…é™¤ï¼ˆ<code>peekBytes(buf,size)</code>ï¼‰</li><li>è¯»å–å“åº”æ•°æ®ä¸­çš„ä¸€ä¸ªå­—ç¬¦ï¼Œæ¸…æ‰ï¼ˆ<code>read()</code>ï¼‰</li><li>è¯»å–å›ºå®šå¤§å°çš„å“åº”æ•°æ®ï¼Œæ¸…æ‰ï¼ˆ<code>read(buf,size)</code>ï¼‰</li><li>æ¸…æ‰ç¼“å†²åŒºï¼ˆ<code>flush()</code>ï¼‰</li></ul></li><li>æ™®é€šè®¾ç½®ï¼š<code>setNoDelay()</code></li></ol><h3 id="6ã€TCPå®¢æˆ·ç«¯ï¼ˆWiFiClientSecure-httpsï¼‰"><a href="#6ã€TCPå®¢æˆ·ç«¯ï¼ˆWiFiClientSecure-httpsï¼‰" class="headerlink" title="6ã€TCPå®¢æˆ·ç«¯ï¼ˆWiFiClientSecure httpsï¼‰:"></a>6ã€TCPå®¢æˆ·ç«¯ï¼ˆWiFiClientSecure httpsï¼‰:</h3><h3 id="7ã€TCPæœåŠ¡ç«¯ï¼ˆWiFiServerï¼‰"><a href="#7ã€TCPæœåŠ¡ç«¯ï¼ˆWiFiServerï¼‰" class="headerlink" title="7ã€TCPæœåŠ¡ç«¯ï¼ˆWiFiServerï¼‰:"></a>7ã€TCPæœåŠ¡ç«¯ï¼ˆWiFiServerï¼‰:</h3><ol><li>ç®¡ç†server:<ol><li>è®¾ç½®tcp server:<ul><li>æ–°å¢tcp serverï¼ˆ<code>WiFiServer server(port)</code>ï¼‰</li><li>å¯åŠ¨tcp serverï¼ˆ<code>begin()</code>ï¼‰</li><li>å…³é—­å°åŒ…åˆå¹¶å‘é€åŠŸèƒ½ï¼ˆ<code>setNoDelay(true)</code>ï¼‰</li></ul></li><li>åœæ­¢server:<ul><li><code>close()</code></li><li><code>stop()</code>ï¼ˆå†…éƒ¨å®ç°ç›´æ¥è°ƒç”¨close()ï¼‰</li></ul></li><li>serverçŠ¶æ€ :   <code>server.status()</code></li></ol></li><li>ç­‰å¾…WiFiClientè®¿é—®ï¼š<ul><li>åˆ¤æ–­æ˜¯å¦æœ‰æ–°çš„clientè¿æ¥è¿›æ¥ï¼ˆ<code>available()</code>ï¼‰</li><li>åˆ¤æ–­æ˜¯å¦æœ‰clientè¿æ¥ï¼ˆ<code>has Client()</code>ï¼‰</li></ul></li><li>è¯»å–WiFiClientçš„è¯·æ±‚ï¼šå‚è€ƒWiFiClienté‡Œé¢çš„å“åº”æ–¹æ³•</li></ol><h3 id="8ã€TCPæœåŠ¡ç«¯ï¼ˆWiFiServerSecure-httpsï¼‰"><a href="#8ã€TCPæœåŠ¡ç«¯ï¼ˆWiFiServerSecure-httpsï¼‰" class="headerlink" title="8ã€TCPæœåŠ¡ç«¯ï¼ˆWiFiServerSecure httpsï¼‰"></a>8ã€TCPæœåŠ¡ç«¯ï¼ˆWiFiServerSecure httpsï¼‰</h3><h3 id="9ã€ESP8266WiFiåº“è‡ªå¸¦æ–¹æ³•ï¼š"><a href="#9ã€ESP8266WiFiåº“è‡ªå¸¦æ–¹æ³•ï¼š" class="headerlink" title="9ã€ESP8266WiFiåº“è‡ªå¸¦æ–¹æ³•ï¼š"></a>9ã€ESP8266WiFiåº“è‡ªå¸¦æ–¹æ³•ï¼š</h3><ul><li>è°ƒç”¨è°ƒè¯•ä¿¡æ¯ï¼ˆ<code>printDiag(serial)</code>ï¼‰</li></ul><p><strong>æ€»ç»“ï¼š</strong><img src="https://z3.ax1x.com/2021/08/05/fedfFe.png" class="lazyload placeholder" data-srcset="https://z3.ax1x.com/2021/08/05/fedfFe.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="fedfFe.png">](<a href="https://imgtu.com/i/fedfFe">https://imgtu.com/i/fedfFe</a>)</p><h2 id="3ã€ç¤ºä¾‹"><a href="#3ã€ç¤ºä¾‹" class="headerlink" title="3ã€ç¤ºä¾‹"></a>3ã€ç¤ºä¾‹</h2><h3 id="1ã€APæ¨¡å¼"><a href="#1ã€APæ¨¡å¼" class="headerlink" title="1ã€APæ¨¡å¼"></a>1ã€APæ¨¡å¼</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *    APæ¨¡å¼ä¸‹ï¼Œæ¼”ç¤ºAP å‡½æ•°æ–¹æ³•çš„ä½¿ç”¨(æœ€å¤šè¿æ¥4ä¸ª)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="keyword">define</span> AP_SSID <span class="string">&quot;AP_Test&quot;</span> <span class="comment">//è¿™é‡Œæ”¹æˆä½ çš„APåå­—</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> AP_PSW  <span class="string">&quot;12345678&quot;</span> <span class="comment">//è¿™é‡Œæ”¹æˆä½ çš„APå¯†ç  8ä½ä»¥ä¸Š</span></span></span><br><span class="line"><span class="comment">//ä»¥ä¸‹ä¸‰ä¸ªå®šä¹‰ä¸ºè°ƒè¯•å®šä¹‰</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DebugBegin(baud_rate)    Serial.begin(baud_rate)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DebugPrintln(message)    Serial.println(message)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DebugPrint(message)    Serial.print(message)</span></span><br><span class="line"> </span><br><span class="line">IPAddress <span class="title function_">local_IP</span><span class="params">(<span class="number">192</span>,<span class="number">168</span>,<span class="number">4</span>,<span class="number">1</span>)</span>;</span><br><span class="line">IPAddress <span class="title function_">gateway</span><span class="params">(<span class="number">192</span>,<span class="number">168</span>,<span class="number">4</span>,<span class="number">1</span>)</span>;</span><br><span class="line">IPAddress <span class="title function_">subnet</span><span class="params">(<span class="number">255</span>,<span class="number">255</span>,<span class="number">255</span>,<span class="number">0</span>)</span>;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span>&#123;</span><br><span class="line">  <span class="comment">//è®¾ç½®ä¸²å£æ³¢ç‰¹ç‡ï¼Œä»¥ä¾¿æ‰“å°ä¿¡æ¯</span></span><br><span class="line">  DebugBegin(<span class="number">115200</span>);</span><br><span class="line">  <span class="comment">//å»¶æ—¶2s ä¸ºäº†æ¼”ç¤ºæ•ˆæœ</span></span><br><span class="line">  delay(<span class="number">2000</span>);</span><br><span class="line">  DebugPrint(<span class="string">&quot;Setting soft-AP configuration ... &quot;</span>);</span><br><span class="line">  <span class="comment">//é…ç½®APä¿¡æ¯</span></span><br><span class="line">  WiFi.mode(WIFI_AP);</span><br><span class="line">  DebugPrintln(WiFi.softAPConfig(local_IP, gateway, subnet) ? <span class="string">&quot;Ready&quot;</span> : <span class="string">&quot;Failed!&quot;</span>);</span><br><span class="line">  <span class="comment">//å¯åŠ¨APæ¨¡å¼ï¼Œå¹¶è®¾ç½®è´¦å·å’Œå¯†ç </span></span><br><span class="line">  DebugPrint(<span class="string">&quot;Setting soft-AP ... &quot;</span>);</span><br><span class="line">  boolean result = WiFi.softAP(AP_SSID, AP_PSW);</span><br><span class="line">  <span class="keyword">if</span>(result)&#123;</span><br><span class="line">    DebugPrintln(<span class="string">&quot;Ready&quot;</span>);</span><br><span class="line">    <span class="comment">//è¾“å‡º soft-ap ipåœ°å€</span></span><br><span class="line">    DebugPrintln(String(<span class="string">&quot;Soft-AP IP address = &quot;</span>) + WiFi.softAPIP().toString());</span><br><span class="line">    <span class="comment">//è¾“å‡º soft-ap macåœ°å€</span></span><br><span class="line">    DebugPrintln(String(<span class="string">&quot;MAC address = &quot;</span>) + WiFi.softAPmacAddress().c_str());</span><br><span class="line">  &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    DebugPrintln(<span class="string">&quot;Failed!&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  DebugPrintln(<span class="string">&quot;Setup End&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="comment">//ä¸æ–­æ‰“å°å½“å‰çš„stationä¸ªæ•°</span></span><br><span class="line">  DebugPrintln(String(<span class="string">&quot;Stations connected =&quot;</span>) + WiFi.softAPgetStationNum());</span><br><span class="line">  delay(<span class="number">3000</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2ã€STAæ¨¡å¼"><a href="#2ã€STAæ¨¡å¼" class="headerlink" title="2ã€STAæ¨¡å¼"></a>2ã€STAæ¨¡å¼</h3><p>1. </p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Demo1ï¼š</span></span><br><span class="line"><span class="comment"> *    statinæ¨¡å¼ä¸‹ï¼Œåˆ›å»ºä¸€ä¸ªè¿æ¥åˆ°å¯æ¥å…¥ç‚¹ï¼ˆwifiçƒ­ç‚¹ï¼‰ï¼Œå¹¶ä¸”æ‰“å°IPåœ°å€</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="keyword">define</span> AP_SSID <span class="string">&quot;XU-ChinaNet&quot;</span> <span class="comment">//è¿™é‡Œæ”¹æˆä½ çš„wifiåå­—</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> AP_PSW  <span class="string">&quot;15358228063&quot;</span><span class="comment">//è¿™é‡Œæ”¹æˆä½ çš„wifiå¯†ç </span></span></span><br><span class="line"><span class="comment">//ä»¥ä¸‹ä¸‰ä¸ªå®šä¹‰ä¸ºè°ƒè¯•å®šä¹‰</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DebugBegin(baud_rate)    Serial.begin(baud_rate)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DebugPrintln(message)    Serial.println(message)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DebugPrint(message)    Serial.print(message)</span></span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span>&#123;</span><br><span class="line">  <span class="comment">//è®¾ç½®ä¸²å£æ³¢ç‰¹ç‡ï¼Œä»¥ä¾¿æ‰“å°ä¿¡æ¯</span></span><br><span class="line">  DebugBegin(<span class="number">115200</span>);</span><br><span class="line">  <span class="comment">//å»¶æ—¶2s ä¸ºäº†æ¼”ç¤ºæ•ˆæœ</span></span><br><span class="line">  delay(<span class="number">2000</span>);</span><br><span class="line">  DebugPrintln(<span class="string">&quot;Setup start&quot;</span>);</span><br><span class="line">  <span class="comment">//å¯åŠ¨STAæ¨¡å¼ï¼Œå¹¶è¿æ¥åˆ°wifiç½‘ç»œ</span></span><br><span class="line">  WiFi.mode(WIFI_STA);<span class="comment">//æœ€å¥½äººä¸ºåŠ ä¸ŠSTAè®¾ç½®ï¼ˆè™½ç„¶é»˜è®¤æ˜¯STAæ¨¡å¼ï¼‰</span></span><br><span class="line">  WiFi.disconnect();<span class="comment">//æœ€å¥½è°ƒç”¨ä¸€ä¸‹æ–­è¿</span></span><br><span class="line">  WiFi.begin(AP_SSID, AP_PSW);</span><br><span class="line">  DebugPrint(String(<span class="string">&quot;Connecting to &quot;</span>)+AP_SSID);</span><br><span class="line">  <span class="comment">//åˆ¤æ–­ç½‘ç»œçŠ¶æ€æ˜¯å¦è¿æ¥ä¸Šï¼Œæ²¡è¿æ¥ä¸Šå°±å»¶æ—¶500msï¼Œå¹¶ä¸”æ‰“å‡ºä¸€ä¸ªç‚¹ï¼Œæ¨¡æ‹Ÿè¿æ¥è¿‡ç¨‹</span></span><br><span class="line">  <span class="comment">//ç¬”è€…æ‰©å±•ï¼šåŠ å…¥ç½‘ç»œä¸€ç›´éƒ½è¿ä¸ä¸Š æ˜¯å¦å¯ä»¥åšä¸ªåˆ¤æ–­ï¼Œç”±ä½ ä»¬è‡ªå·±å®ç°</span></span><br><span class="line">  <span class="keyword">while</span> (WiFi.status() != WL_CONNECTED)&#123;</span><br><span class="line">    delay(<span class="number">500</span>);</span><br><span class="line">    DebugPrint(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  DebugPrintln(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  DebugPrint(<span class="string">&quot;Connected, IP address: &quot;</span>);</span><br><span class="line">  <span class="comment">//è¾“å‡ºstation IPåœ°å€ï¼Œè¿™é‡Œçš„IPåœ°å€ç”±DHCPåˆ†é…</span></span><br><span class="line">  DebugPrintln(WiFi.localIP());</span><br><span class="line">  DebugPrintln(<span class="string">&quot;Setup End&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>2. </p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Demo2ï¼šå›ºå®šIP</span></span><br><span class="line"><span class="comment"> *    statinæ¨¡å¼ä¸‹ï¼Œé…ç½®IPåœ°å€ï¼Œç½‘å…³åœ°å€ï¼Œå­ç½‘æ©ç ï¼Œå¹¶ä¸”æ‰“å°IPåœ°å€</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="keyword">define</span> AP_SSID <span class="string">&quot;XU-ChinaNet&quot;</span> <span class="comment">//è¿™é‡Œæ”¹æˆä½ çš„wifiåå­—</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> AP_PSW  <span class="string">&quot;15358228063&quot;</span><span class="comment">//è¿™é‡Œæ”¹æˆä½ çš„wifiå¯†ç </span></span></span><br><span class="line"><span class="comment">//ä»¥ä¸‹ä¸‰ä¸ªå®šä¹‰ä¸ºè°ƒè¯•å®šä¹‰</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DebugBegin(baud_rate)    Serial.begin(baud_rate)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DebugPrintln(message)    Serial.println(message)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DebugPrint(message)    Serial.print(message)</span></span><br><span class="line"> </span><br><span class="line">IPAddress <span class="title function_">staticIP</span><span class="params">(<span class="number">192</span>,<span class="number">168</span>,<span class="number">1</span>,<span class="number">22</span>)</span>;<span class="comment">//å›ºå®šIPåœ°å€</span></span><br><span class="line">IPAddress <span class="title function_">gateway</span><span class="params">(<span class="number">192</span>,<span class="number">168</span>,<span class="number">1</span>,<span class="number">9</span>)</span>;<span class="comment">//ç½‘å…³åœ°å€</span></span><br><span class="line">IPAddress <span class="title function_">subnet</span><span class="params">(<span class="number">255</span>,<span class="number">255</span>,<span class="number">255</span>,<span class="number">0</span>)</span>;<span class="comment">//å­ç½‘æ©ç åœ°å€</span></span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span>&#123;</span><br><span class="line">  <span class="comment">//è®¾ç½®ä¸²å£æ³¢ç‰¹ç‡ï¼Œä»¥ä¾¿æ‰“å°ä¿¡æ¯</span></span><br><span class="line">  DebugBegin(<span class="number">115200</span>);</span><br><span class="line">  <span class="comment">//å»¶æ—¶2s ä¸ºäº†æ¼”ç¤ºæ•ˆæœ</span></span><br><span class="line">  delay(<span class="number">2000</span>);</span><br><span class="line">  DebugPrintln(<span class="string">&quot;Setup start&quot;</span>);</span><br><span class="line">  <span class="comment">//å¯åŠ¨STAæ¨¡å¼ï¼Œå¹¶è¿æ¥åˆ°wifiç½‘ç»œ</span></span><br><span class="line">  WiFi.begin(AP_SSID, AP_PSW);</span><br><span class="line">  DebugPrint(String(<span class="string">&quot;Connecting to &quot;</span>)+AP_SSID);</span><br><span class="line">  <span class="comment">//é…ç½®ç½‘ç»œ</span></span><br><span class="line">  WiFi.config(staticIP,gateway,subnet);</span><br><span class="line">  <span class="comment">//åˆ¤æ–­ç½‘ç»œçŠ¶æ€æ˜¯å¦è¿æ¥ä¸Šï¼Œæ²¡è¿æ¥ä¸Šå°±å»¶æ—¶500msï¼Œå¹¶ä¸”æ‰“å‡ºä¸€ä¸ªç‚¹ï¼Œæ¨¡æ‹Ÿè¿æ¥è¿‡ç¨‹</span></span><br><span class="line">  <span class="comment">//ç¬”è€…æ‰©å±•ï¼šåŠ å…¥ç½‘ç»œä¸€ç›´éƒ½è¿ä¸ä¸Š æ˜¯å¦å¯ä»¥åšä¸ªåˆ¤æ–­ï¼Œç”±ä½ ä»¬è‡ªå·±å®ç°</span></span><br><span class="line">  <span class="keyword">while</span> (WiFi.status() != WL_CONNECTED)&#123;</span><br><span class="line">    delay(<span class="number">500</span>);</span><br><span class="line">    DebugPrint(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  DebugPrintln(<span class="string">&quot;&quot;</span>);</span><br><span class="line"> </span><br><span class="line">  DebugPrint(<span class="string">&quot;Connected, IP address: &quot;</span>);</span><br><span class="line">  <span class="comment">//è¾“å‡ºstation IPåœ°å€ï¼Œè¿™é‡Œçš„IPåœ°å€ç†è®ºä¸Šå°±æ˜¯ä¸Šé¢é…ç½®çš„</span></span><br><span class="line">  DebugPrintln(WiFi.localIP());</span><br><span class="line">  DebugPrintln(<span class="string">&quot;Setup End&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>3. </p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Demo3ï¼š</span></span><br><span class="line"><span class="comment"> *    statinæ¨¡å¼ä¸‹ï¼Œåˆ›å»ºä¸€ä¸ªè¿æ¥åˆ°å¯æ¥å…¥ç‚¹ï¼ˆwifiçƒ­ç‚¹ï¼‰ï¼Œå¹¶ä¸”æ‰“å°stationä¿¡æ¯</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="keyword">define</span> AP_SSID <span class="string">&quot;XU-ChinaNet&quot;</span> <span class="comment">//è¿™é‡Œæ”¹æˆä½ çš„wifiåå­—</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> AP_PSW  <span class="string">&quot;15358228063&quot;</span><span class="comment">//è¿™é‡Œæ”¹æˆä½ çš„wifiå¯†ç </span></span></span><br><span class="line"><span class="comment">//ä»¥ä¸‹ä¸‰ä¸ªå®šä¹‰ä¸ºè°ƒè¯•å®šä¹‰</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DebugBegin(baud_rate)    Serial.begin(baud_rate)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DebugPrintln(message)    Serial.println(message)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DebugPrint(message)    Serial.print(message)</span></span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span>&#123;</span><br><span class="line">  <span class="comment">//è®¾ç½®ä¸²å£æ³¢ç‰¹ç‡ï¼Œä»¥ä¾¿æ‰“å°ä¿¡æ¯</span></span><br><span class="line">  DebugBegin(<span class="number">115200</span>);</span><br><span class="line">  <span class="comment">//å»¶æ—¶2s ä¸ºäº†æ¼”ç¤ºæ•ˆæœ</span></span><br><span class="line">  delay(<span class="number">2000</span>);</span><br><span class="line">  DebugPrintln(<span class="string">&quot;Setup start&quot;</span>);</span><br><span class="line">  <span class="comment">//å¯åŠ¨STAæ¨¡å¼ï¼Œå¹¶è¿æ¥åˆ°wifiç½‘ç»œ</span></span><br><span class="line">  WiFi.begin(AP_SSID, AP_PSW);</span><br><span class="line">  <span class="comment">//è®¾ç½®è‡ªåŠ¨è¿æ¥</span></span><br><span class="line">  WiFi.setAutoConnect(<span class="literal">true</span>);</span><br><span class="line">  <span class="comment">//è®¾ç½®è‡ªåŠ¨é‡è¿</span></span><br><span class="line">  WiFi.setAutoReconnect(<span class="literal">true</span>);</span><br><span class="line">  DebugPrint(String(<span class="string">&quot;Connecting to &quot;</span>)+AP_SSID);</span><br><span class="line">  <span class="comment">//åˆ¤æ–­ç½‘ç»œçŠ¶æ€æ˜¯å¦è¿æ¥ä¸Šï¼Œæ²¡è¿æ¥ä¸Šå°±å»¶æ—¶500msï¼Œå¹¶ä¸”æ‰“å‡ºä¸€ä¸ªç‚¹ï¼Œæ¨¡æ‹Ÿè¿æ¥è¿‡ç¨‹</span></span><br><span class="line">  <span class="comment">//ç¬”è€…æ‰©å±•ï¼šåŠ å…¥ç½‘ç»œä¸€ç›´éƒ½è¿ä¸ä¸Š æ˜¯å¦å¯ä»¥åšä¸ªåˆ¤æ–­ï¼Œç”±ä½ ä»¬è‡ªå·±å®ç°</span></span><br><span class="line">  <span class="keyword">while</span> (WiFi.status() != WL_CONNECTED)&#123;</span><br><span class="line">    delay(<span class="number">500</span>);</span><br><span class="line">    DebugPrint(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  DebugPrintln(<span class="string">&quot;&quot;</span>);</span><br><span class="line"> </span><br><span class="line">  DebugPrintln(<span class="string">&quot;rint Network Info:&quot;</span>);</span><br><span class="line">  <span class="keyword">if</span> (WiFi.status() == WL_CONNECTED)&#123;</span><br><span class="line">     <span class="comment">//è¾“å‡ºmacåœ°å€</span></span><br><span class="line">     DebugPrintln(String(<span class="string">&quot;Connected, mac address: &quot;</span>)+WiFi.macAddress().c_str());</span><br><span class="line">     </span><br><span class="line">     <span class="comment">//è¾“å‡ºstation IPåœ°å€ï¼Œè¿™é‡Œçš„IPåœ°å€ç”±DHCPåˆ†é…</span></span><br><span class="line">     DebugPrintln(String(<span class="string">&quot;Connected, IP address: &quot;</span>)+WiFi.localIP().toString());</span><br><span class="line">     </span><br><span class="line">     <span class="comment">//è¾“å‡ºå­ç½‘æ©ç åœ°å€</span></span><br><span class="line">     DebugPrintln(String(<span class="string">&quot;Subnet mask: &quot;</span>)+WiFi.subnetMask().toString());</span><br><span class="line">     </span><br><span class="line">     <span class="comment">//è¾“å‡ºç½‘å…³ IPåœ°å€</span></span><br><span class="line">     DebugPrintln(String(<span class="string">&quot;Gataway IP: &quot;</span>)+WiFi.gatewayIP().toString());</span><br><span class="line">     </span><br><span class="line">     <span class="comment">//è¾“å‡ºhostname</span></span><br><span class="line">     DebugPrintln(String(<span class="string">&quot;Default hostname: &quot;</span>)+WiFi.hostname());</span><br><span class="line">     <span class="comment">//è®¾ç½®æ–°çš„hostname</span></span><br><span class="line">     WiFi.hostname(<span class="string">&quot;Station_host_123&quot;</span>);</span><br><span class="line">     DebugPrintln(String(<span class="string">&quot;New hostname: &quot;</span>)+WiFi.hostname());</span><br><span class="line">     </span><br><span class="line">     <span class="comment">//è¾“å‡ºSSID</span></span><br><span class="line">     DebugPrintln(String(<span class="string">&quot;SSID: &quot;</span>)+WiFi.SSID());</span><br><span class="line"> </span><br><span class="line">     <span class="comment">//è¾“å‡ºpsk</span></span><br><span class="line">     DebugPrintln(String(<span class="string">&quot;psk: &quot;</span>)+WiFi.psk());</span><br><span class="line">     </span><br><span class="line">     <span class="comment">//è¾“å‡ºBSSID</span></span><br><span class="line">     DebugPrintln(String(<span class="string">&quot;BSSID: &quot;</span>)+WiFi.BSSIDstr());</span><br><span class="line">     </span><br><span class="line">     <span class="comment">//è¾“å‡ºRSSI</span></span><br><span class="line">     DebugPrintln(String(<span class="string">&quot;RSSI: &quot;</span>) + WiFi.RSSI() + <span class="string">&quot; dBm&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  DebugPrintln(<span class="string">&quot;Setup End&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3ã€æ‰«æï¼š"><a href="#3ã€æ‰«æï¼š" class="headerlink" title="3ã€æ‰«æï¼š"></a>3ã€æ‰«æï¼š</h3><p>1. </p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Demoï¼š</span></span><br><span class="line"><span class="comment"> *    STAæ¨¡å¼ä¸‹ï¼Œæ¼”ç¤ºåŒæ­¥æ‰«æScan wifiåŠŸèƒ½</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="comment">//ä»¥ä¸‹ä¸‰ä¸ªå®šä¹‰ä¸ºè°ƒè¯•å®šä¹‰</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DebugBegin(baud_rate)    Serial.begin(baud_rate)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DebugPrintln(message)    Serial.println(message)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DebugPrint(message)    Serial.print(message)</span></span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="comment">//è®¾ç½®ä¸²å£æ³¢ç‰¹ç‡ï¼Œä»¥ä¾¿æ‰“å°ä¿¡æ¯</span></span><br><span class="line">  DebugBegin(<span class="number">115200</span>);</span><br><span class="line">  <span class="comment">//å»¶æ—¶5s ä¸ºäº†æ¼”ç¤ºæ•ˆæœ</span></span><br><span class="line">  delay(<span class="number">5000</span>);</span><br><span class="line">  <span class="comment">// æˆ‘ä¸æƒ³åˆ«äººè¿æ¥æˆ‘ï¼Œåªæƒ³åšä¸ªç«™ç‚¹</span></span><br><span class="line">  WiFi.mode(WIFI_STA);</span><br><span class="line">  <span class="comment">//æ–­å¼€è¿æ¥</span></span><br><span class="line">  WiFi.disconnect();</span><br><span class="line">  delay(<span class="number">100</span>);</span><br><span class="line">  DebugPrintln(<span class="string">&quot;Setup done&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span> &#123;</span><br><span class="line">  DebugPrintln(<span class="string">&quot;scan start&quot;</span>);</span><br><span class="line">  <span class="comment">// åŒæ­¥æ‰«æï¼Œç­‰å¾…è¿”å›ç»“æœ</span></span><br><span class="line">  <span class="type">int</span> n = WiFi.scanNetworks();</span><br><span class="line">  DebugPrintln(<span class="string">&quot;scan done&quot;</span>);</span><br><span class="line">  <span class="keyword">if</span> (n == <span class="number">0</span>)&#123;</span><br><span class="line">    DebugPrintln(<span class="string">&quot;no networks found&quot;</span>);</span><br><span class="line">  &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    DebugPrint(n);</span><br><span class="line">    DebugPrintln(<span class="string">&quot; networks found&quot;</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; ++i)&#123;</span><br><span class="line">      DebugPrint(i + <span class="number">1</span>);</span><br><span class="line">      DebugPrint(<span class="string">&quot;: &quot;</span>);</span><br><span class="line">      <span class="comment">//æ‰“å°wifiè´¦å·</span></span><br><span class="line">      DebugPrint(WiFi.SSID(i));</span><br><span class="line">      DebugPrint(<span class="string">&quot;,&quot;</span>);</span><br><span class="line">      DebugPrint(String(<span class="string">&quot;Ch:&quot;</span>)+WiFi.channel(i));</span><br><span class="line">      DebugPrint(<span class="string">&quot;,&quot;</span>);</span><br><span class="line">      DebugPrint(WiFi.isHidden(i)?<span class="string">&quot;hide&quot;</span>:<span class="string">&quot;show&quot;</span>);</span><br><span class="line">      DebugPrint(<span class="string">&quot; (&quot;</span>);</span><br><span class="line">      <span class="comment">//æ‰“å°wifiä¿¡å·å¼ºåº¦</span></span><br><span class="line">      DebugPrint(WiFi.RSSI(i));</span><br><span class="line">      DebugPrint(<span class="string">&quot;dBm&quot;</span>);</span><br><span class="line">      DebugPrint(<span class="string">&quot;)&quot;</span>);</span><br><span class="line">      <span class="comment">//æ‰“å°wifiåŠ å¯†æ–¹å¼</span></span><br><span class="line">      DebugPrintln((WiFi.encryptionType(i) == ENC_TYPE_NONE)?<span class="string">&quot;open&quot;</span>:<span class="string">&quot;*&quot;</span>);</span><br><span class="line">      delay(<span class="number">10</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  DebugPrintln(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  <span class="comment">// å»¶æ—¶5sä¹‹åå†æ¬¡æ‰«æ</span></span><br><span class="line">  delay(<span class="number">5000</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>2. </p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Demoï¼š</span></span><br><span class="line"><span class="comment"> *    STAæ¨¡å¼ä¸‹ï¼Œæ¼”ç¤ºå¼‚æ­¥æ‰«æScan wifiåŠŸèƒ½</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="comment">//ä»¥ä¸‹ä¸‰ä¸ªå®šä¹‰ä¸ºè°ƒè¯•å®šä¹‰</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DebugBegin(baud_rate)    Serial.begin(baud_rate)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DebugPrintln(message)    Serial.println(message)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DebugPrint(message)    Serial.print(message)</span></span><br><span class="line"><span class="comment">//å®šä¹‰ä¸€ä¸ªæ‰«ææ—¶é—´é—´éš”</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SCAN_PERIOD 5000</span></span><br><span class="line"><span class="type">long</span> lastScanMillis;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="comment">//è®¾ç½®ä¸²å£æ³¢ç‰¹ç‡ï¼Œä»¥ä¾¿æ‰“å°ä¿¡æ¯</span></span><br><span class="line">  DebugBegin(<span class="number">115200</span>);</span><br><span class="line">  <span class="comment">//å»¶æ—¶5s ä¸ºäº†æ¼”ç¤ºæ•ˆæœ</span></span><br><span class="line">  delay(<span class="number">5000</span>);</span><br><span class="line">  <span class="comment">// æˆ‘ä¸æƒ³åˆ«äººè¿æ¥æˆ‘ï¼Œåªæƒ³åšä¸ªç«™ç‚¹</span></span><br><span class="line">  WiFi.mode(WIFI_STA);</span><br><span class="line">  <span class="comment">//æ–­å¼€è¿æ¥</span></span><br><span class="line">  WiFi.disconnect();</span><br><span class="line">  delay(<span class="number">100</span>);</span><br><span class="line">  DebugPrintln(<span class="string">&quot;Setup done&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span> &#123;</span><br><span class="line"> </span><br><span class="line"> <span class="type">long</span> currentMillis = millis();</span><br><span class="line"> <span class="comment">//è§¦å‘æ‰«æ</span></span><br><span class="line"> <span class="keyword">if</span> (currentMillis - lastScanMillis &gt; SCAN_PERIOD)&#123;</span><br><span class="line">    WiFi.scanNetworks(<span class="literal">true</span>);</span><br><span class="line">    Serial.print(<span class="string">&quot;\nScan start ... &quot;</span>);</span><br><span class="line">    lastScanMillis = currentMillis;</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// åˆ¤æ–­æ˜¯å¦æœ‰æ‰«æç»“æœ</span></span><br><span class="line">  <span class="type">int</span> n = WiFi.scanComplete();</span><br><span class="line">  <span class="keyword">if</span>(n &gt;= <span class="number">0</span>)&#123;</span><br><span class="line">    Serial.<span class="built_in">printf</span>(<span class="string">&quot;%d network(s) found\n&quot;</span>, n);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++)&#123;</span><br><span class="line">      Serial.<span class="built_in">printf</span>(<span class="string">&quot;%d: %s, Ch:%d (%ddBm) %s\n&quot;</span>, i+<span class="number">1</span>, WiFi.SSID(i).c_str(), WiFi.channel(i), WiFi.RSSI(i), WiFi.encryptionType(i) == ENC_TYPE_NONE ? <span class="string">&quot;open&quot;</span> : <span class="string">&quot;&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//æ‰“å°å®Œä¸€æ¬¡æ‰«æç»“æœä¹‹å  åˆ é™¤å†…å­˜ä¿å­˜ç»“æœ</span></span><br><span class="line">    WiFi.scanDelete();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>3. </p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Demoï¼š</span></span><br><span class="line"><span class="comment"> *    STAæ¨¡å¼ä¸‹ï¼Œæ¼”ç¤ºå¼‚æ­¥æ‰«æScan wifiåŠŸèƒ½</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="comment">//ä»¥ä¸‹ä¸‰ä¸ªå®šä¹‰ä¸ºè°ƒè¯•å®šä¹‰</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DebugBegin(baud_rate)    Serial.begin(baud_rate)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DebugPrintln(message)    Serial.println(message)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DebugPrint(message)    Serial.print(message)</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ‰“å°æ‰«æç»“æœ</span></span><br><span class="line"><span class="comment"> * @param networksFound ç»“æœä¸ªæ•°</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">prinScanResult</span><span class="params">(<span class="type">int</span> networksFound)</span>&#123;</span><br><span class="line">  Serial.<span class="built_in">printf</span>(<span class="string">&quot;%d network(s) found\n&quot;</span>, networksFound);</span><br><span class="line">  <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; networksFound; i++)</span><br><span class="line">  &#123;</span><br><span class="line">    Serial.<span class="built_in">printf</span>(<span class="string">&quot;%d: %s, Ch:%d (%ddBm) %s\n&quot;</span>, i + <span class="number">1</span>, WiFi.SSID(i).c_str(), WiFi.channel(i), WiFi.RSSI(i), WiFi.encryptionType(i) == ENC_TYPE_NONE ? <span class="string">&quot;open&quot;</span> : <span class="string">&quot;&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="comment">//è®¾ç½®ä¸²å£æ³¢ç‰¹ç‡ï¼Œä»¥ä¾¿æ‰“å°ä¿¡æ¯</span></span><br><span class="line">  DebugBegin(<span class="number">115200</span>);</span><br><span class="line">  <span class="comment">//å»¶æ—¶5s ä¸ºäº†æ¼”ç¤ºæ•ˆæœ</span></span><br><span class="line">  delay(<span class="number">5000</span>);</span><br><span class="line">  <span class="comment">// æˆ‘ä¸æƒ³åˆ«äººè¿æ¥æˆ‘ï¼Œåªæƒ³åšä¸ªç«™ç‚¹</span></span><br><span class="line">  WiFi.mode(WIFI_STA);</span><br><span class="line">  <span class="comment">//æ–­å¼€è¿æ¥</span></span><br><span class="line">  WiFi.disconnect();</span><br><span class="line">  delay(<span class="number">100</span>);</span><br><span class="line">  DebugPrintln(<span class="string">&quot;Setup done&quot;</span>);</span><br><span class="line">  Serial.print(<span class="string">&quot;\nScan start ... &quot;</span>);</span><br><span class="line">  WiFi.scanNetworksAsync(prinScanResult);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4ã€é€šç”¨åº“å¤„ç†äº‹ä»¶ï¼š"><a href="#4ã€é€šç”¨åº“å¤„ç†äº‹ä»¶ï¼š" class="headerlink" title="4ã€é€šç”¨åº“å¤„ç†äº‹ä»¶ï¼š"></a>4ã€é€šç”¨åº“å¤„ç†äº‹ä»¶ï¼š</h3><ol><li>å®˜æ–¹ç¤ºä¾‹ï¼š(APæ¨¡å¼)</li></ol><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    This sketch shows how to use WiFi event handlers.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    In this example, ESP8266 works in AP mode.</span></span><br><span class="line"><span class="comment">    Three event handlers are demonstrated:</span></span><br><span class="line"><span class="comment">    - station connects to the ESP8266 AP</span></span><br><span class="line"><span class="comment">    - station disconnects from the ESP8266 AP</span></span><br><span class="line"><span class="comment">    - ESP8266 AP receives a probe request from a station</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* ssid     = <span class="string">&quot;ap-ssid&quot;</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* password = <span class="string">&quot;ap-password&quot;</span>;</span><br><span class="line"></span><br><span class="line">WiFiEventHandler stationConnectedHandler;</span><br><span class="line">WiFiEventHandler stationDisconnectedHandler;</span><br><span class="line">WiFiEventHandler probeRequestPrintHandler;</span><br><span class="line">WiFiEventHandler probeRequestBlinkHandler;</span><br><span class="line"></span><br><span class="line"><span class="type">bool</span> blinkFlag;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span> &#123;</span><br><span class="line">  Serial.begin(<span class="number">115200</span>);</span><br><span class="line">  pinMode(LED_BUILTIN, OUTPUT);</span><br><span class="line">  digitalWrite(LED_BUILTIN, HIGH);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ä¸ä¿å­˜ä»»ä½•wifié…ç½®åˆ°flash</span></span><br><span class="line">  WiFi.persistent(<span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å»ºç«‹ä¸€ä¸ªAP</span></span><br><span class="line">  WiFi.mode(WIFI_AP);</span><br><span class="line">  WiFi.softAP(ssid, password);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// æ³¨å†Œäº‹ä»¶å¤„ç†å™¨</span></span><br><span class="line">  <span class="comment">// å›è°ƒå‡½æ•°ä¼šåœ¨äº‹ä»¶å‘ç”Ÿæ—¶è¢«è°ƒç”¨</span></span><br><span class="line">  <span class="comment">// onStationConnectedå‡½æ•°ä¼šåœ¨æ¯ä¸€æ¬¡æœ‰stationè¿æ¥æ—¶è°ƒç”¨</span></span><br><span class="line">  stationConnectedHandler = WiFi.onSoftAPModeStationConnected(&amp;onStationConnected);</span><br><span class="line">  <span class="comment">// onStationDisconnectedå‡½æ•°ä¼šåœ¨æ¯ä¸€æ¬¡æœ‰stationæ–­å¼€æ—¶è°ƒç”¨</span></span><br><span class="line">  stationDisconnectedHandler = WiFi.onSoftAPModeStationDisconnected(&amp;onStationDisconnected);</span><br><span class="line">  <span class="comment">// onProbeRequestPrintå’ŒonProbeRequestBlinkå‡½æ•°ä¼šåœ¨æ¯ä¸€æ¬¡æ”¶åˆ°æ¢é’ˆè¯·æ±‚æ—¶è°ƒç”¨</span></span><br><span class="line">  <span class="comment">// onProbeRequestPrintä¼šæ‰“å°stationçš„macåœ°å€å’Œä¿¡å·å¼ºåº¦åˆ°ä¸²å£ç›‘è§†å™¨</span></span><br><span class="line">  <span class="comment">// onProbeRequestBlinkä¼šé—ªçƒLED</span></span><br><span class="line">  probeRequestPrintHandler = WiFi.onSoftAPModeProbeRequestReceived(&amp;onProbeRequestPrint);</span><br><span class="line">  probeRequestBlinkHandler = WiFi.onSoftAPModeProbeRequestReceived(&amp;onProbeRequestBlink);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">onStationConnected</span><span class="params">(<span class="type">const</span> WiFiEventSoftAPModeStationConnected&amp; evt)</span> &#123;</span><br><span class="line">  Serial.print(<span class="string">&quot;Station connected: &quot;</span>);</span><br><span class="line">  Serial.println(macToString(evt.mac));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">onStationDisconnected</span><span class="params">(<span class="type">const</span> WiFiEventSoftAPModeStationDisconnected&amp; evt)</span> &#123;</span><br><span class="line">  Serial.print(<span class="string">&quot;Station disconnected: &quot;</span>);</span><br><span class="line">  Serial.println(macToString(evt.mac));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">onProbeRequestPrint</span><span class="params">(<span class="type">const</span> WiFiEventSoftAPModeProbeRequestReceived&amp; evt)</span> &#123;</span><br><span class="line">  Serial.print(<span class="string">&quot;Probe request from: &quot;</span>);</span><br><span class="line">  Serial.print(macToString(evt.mac));</span><br><span class="line">  Serial.print(<span class="string">&quot; RSSI: &quot;</span>);</span><br><span class="line">  Serial.println(evt.rssi);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">onProbeRequestBlink</span><span class="params">(<span class="type">const</span> WiFiEventSoftAPModeProbeRequestReceived&amp;)</span> &#123;</span><br><span class="line">  <span class="comment">// æˆ‘ä»¬ä¸èƒ½åœ¨äº‹ä»¶å¤„ç†å‡½æ•°ä¸­è°ƒç”¨å»¶æ—¶å‡½æ•°æˆ–è€…å…¶ä»–é˜»å¡å‡½æ•°</span></span><br><span class="line">  <span class="comment">// å› æ­¤è¿™é‡Œè®¾ç½®ä¸€ä¸ªæ ‡å¿—ä½</span></span><br><span class="line">  blinkFlag = <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (millis() &gt; <span class="number">10000</span> &amp;&amp; probeRequestPrintHandler) &#123;</span><br><span class="line">    <span class="comment">// 10sä¹‹åï¼Œç¦æ­¢ onProbeRequestPrint</span></span><br><span class="line">    Serial.println(<span class="string">&quot;Not printing probe requests any more (LED should still blink)&quot;</span>);</span><br><span class="line">    probeRequestPrintHandler = WiFiEventHandler();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (blinkFlag) &#123;</span><br><span class="line">    blinkFlag = <span class="literal">false</span>;</span><br><span class="line">    digitalWrite(LED_BUILTIN, LOW);</span><br><span class="line">    delay(<span class="number">100</span>);</span><br><span class="line">    digitalWrite(LED_BUILTIN, HIGH);</span><br><span class="line">  &#125;</span><br><span class="line">  delay(<span class="number">10</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">String <span class="title function_">macToString</span><span class="params">(<span class="type">const</span> <span class="type">unsigned</span> <span class="type">char</span>* mac)</span> &#123;</span><br><span class="line">  <span class="type">char</span> buf[<span class="number">20</span>];</span><br><span class="line">  <span class="built_in">snprintf</span>(buf, <span class="keyword">sizeof</span>(buf), <span class="string">&quot;%02x:%02x:%02x:%02x:%02x:%02x&quot;</span>,</span><br><span class="line">           mac[<span class="number">0</span>], mac[<span class="number">1</span>], mac[<span class="number">2</span>], mac[<span class="number">3</span>], mac[<span class="number">4</span>], mac[<span class="number">5</span>]);</span><br><span class="line">  <span class="keyword">return</span> String(buf);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="2"><li>stationæ¨¡å¼ï¼š</li></ol><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">char</span> *ssid = <span class="string">&quot;********&quot;</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">char</span> *password = <span class="string">&quot;********&quot;</span>;</span><br><span class="line"></span><br><span class="line">WiFiEventHandler STAConnected;</span><br><span class="line">WiFiEventHandler STADisconnected;</span><br><span class="line">WiFiEventHandler STAGotIP;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">ConnectedHandler</span><span class="params">(<span class="type">const</span> WiFiEventStationModeConnected &amp;event)</span></span><br><span class="line">&#123;</span><br><span class="line">    Serial.println(WiFi.status());</span><br><span class="line">    Serial.println(<span class="string">&quot;æ¨¡å—è¿æ¥åˆ°ç½‘ç»œ&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">DisconnectedHandler</span><span class="params">(<span class="type">const</span> WiFiEventStationModeDisconnected &amp;event)</span></span><br><span class="line">&#123;</span><br><span class="line">    Serial.println(WiFi.status());</span><br><span class="line">    Serial.println(<span class="string">&quot;æ¨¡å—ä»ç½‘ç»œæ–­å¼€&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    Serial.begin(<span class="number">115200</span>);</span><br><span class="line">    Serial.println();</span><br><span class="line"></span><br><span class="line">    STAConnected = WiFi.onStationModeConnected(ConnectedHandler);</span><br><span class="line">    STADisconnected = WiFi.onStationModeDisconnected(DisconnectedHandler);</span><br><span class="line">    STAGotIP = WiFi.onStationModeGotIP([](<span class="type">const</span> WiFiEventStationModeGotIP &amp;event) &#123;</span><br><span class="line">        Serial.println(WiFi.status());</span><br><span class="line">        Serial.println(<span class="string">&quot;æ¨¡å—è·å¾—IP&quot;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    WiFi.mode(WIFI_STA);</span><br><span class="line">    WiFi.begin(ssid, password);</span><br><span class="line">    Serial.println(WiFi.status());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    delay(<span class="number">5000</span>); <span class="comment">//ç­‰å¾…5ç§’</span></span><br><span class="line">    WiFi.disconnect(); <span class="comment">//æ–­å¼€å½“å‰ç½‘ç»œè¿æ¥</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="5ã€TCPå®¢æˆ·ç«¯ï¼ˆclientï¼‰"><a href="#5ã€TCPå®¢æˆ·ç«¯ï¼ˆclientï¼‰" class="headerlink" title="5ã€TCPå®¢æˆ·ç«¯ï¼ˆclientï¼‰"></a>5ã€TCPå®¢æˆ·ç«¯ï¼ˆclientï¼‰</h3><ol><li>æ¼”è§†WiFiClientä¸TCP serverä¹‹é—´é€šä¿¡åŠŸèƒ½ï¼ˆä½¿ç”¨TCPè°ƒè¯•åŠ©æ‰‹ï¼ˆTCP&#x2F;UDP Socketè°ƒè¯•å·¥å…·ï¼‰ï¼‰åœ¨TCPè°ƒè¯•åŠ©æ‰‹ä¸Šå»ºç«‹ä¸€ä¸ªTCP server, IPåœ°å€æ˜¯192.168.1.102ï¼Œç«¯å£å·æ˜¯8234ã€‚</li></ol><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Demoï¼š</span></span><br><span class="line"><span class="comment"> *    STAæ¨¡å¼ä¸‹ï¼Œæ¼”ç¤ºWiFiClientä¸TCP serverä¹‹é—´çš„é€šä¿¡åŠŸèƒ½</span></span><br><span class="line"><span class="comment"> *    æœ¬å®éªŒéœ€è¦è·ŸTCPè°ƒè¯•åŠ©æ‰‹ä¸€èµ·ä½¿ç”¨ã€‚</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="comment">//ä»¥ä¸‹ä¸‰ä¸ªå®šä¹‰ä¸ºè°ƒè¯•å®šä¹‰</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DebugBegin(baud_rate)    Serial.begin(baud_rate)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DebugPrintln(message)    Serial.println(message)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DebugPrint(message)    Serial.print(message)</span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="keyword">define</span> AP_SSID <span class="string">&quot;XU-ChinaNet&quot;</span> <span class="comment">//è¿™é‡Œæ”¹æˆä½ çš„wifiåå­—</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> AP_PSW  <span class="string">&quot;15358228063&quot;</span><span class="comment">//è¿™é‡Œæ”¹æˆä½ çš„wifiå¯†ç </span></span></span><br><span class="line"> </span><br><span class="line"><span class="type">const</span> <span class="type">uint16_t</span> port = <span class="number">8234</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">char</span> * host = <span class="string">&quot;192.168.1.8&quot;</span>; <span class="comment">// ip or dns</span></span><br><span class="line">WiFiClient client;<span class="comment">//åˆ›å»ºä¸€ä¸ªtcp clientè¿æ¥</span></span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="comment">//è®¾ç½®ä¸²å£æ³¢ç‰¹ç‡ï¼Œä»¥ä¾¿æ‰“å°ä¿¡æ¯</span></span><br><span class="line">  DebugBegin(<span class="number">115200</span>);</span><br><span class="line">  <span class="comment">//å»¶æ—¶5s ä¸ºäº†æ¼”ç¤ºæ•ˆæœ</span></span><br><span class="line">  delay(<span class="number">5000</span>);</span><br><span class="line">  <span class="comment">// æˆ‘ä¸æƒ³åˆ«äººè¿æ¥æˆ‘ï¼Œåªæƒ³åšä¸ªç«™ç‚¹</span></span><br><span class="line">  WiFi.mode(WIFI_STA);</span><br><span class="line">  WiFi.begin(AP_SSID,AP_PSW);</span><br><span class="line"> </span><br><span class="line">  DebugPrint(<span class="string">&quot;Wait for WiFi... &quot;</span>);</span><br><span class="line">  <span class="comment">//ç­‰å¾…wifiè¿æ¥æˆåŠŸ</span></span><br><span class="line">  <span class="keyword">while</span> (WiFi.status() != WL_CONNECTED) &#123;</span><br><span class="line">    Serial.print(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">    delay(<span class="number">500</span>);</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  DebugPrintln(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  DebugPrintln(<span class="string">&quot;WiFi connected&quot;</span>);</span><br><span class="line">  DebugPrint(<span class="string">&quot;IP address: &quot;</span>);</span><br><span class="line">  DebugPrintln(WiFi.localIP());</span><br><span class="line"> </span><br><span class="line">  delay(<span class="number">500</span>);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span> &#123;</span><br><span class="line">  </span><br><span class="line">  DebugPrint(<span class="string">&quot;connecting to &quot;</span>);</span><br><span class="line">  DebugPrintln(host);</span><br><span class="line"> </span><br><span class="line">  <span class="keyword">if</span> (!client.connect(host, port)) &#123;</span><br><span class="line">    DebugPrintln(<span class="string">&quot;connection failed&quot;</span>);</span><br><span class="line">    DebugPrintln(<span class="string">&quot;wait 5 sec...&quot;</span>);</span><br><span class="line">    delay(<span class="number">5000</span>);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// å‘é€æ•°æ®åˆ°Tcp server</span></span><br><span class="line">  DebugPrintln(<span class="string">&quot;Send this data to server&quot;</span>);</span><br><span class="line">  client.println(String(<span class="string">&quot;Send this data to server&quot;</span>));</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//è¯»å–ä»serverè¿”å›åˆ°å“åº”æ•°æ®</span></span><br><span class="line">  String line = client.readStringUntil(<span class="string">&#x27;\r&#x27;</span>);</span><br><span class="line">  DebugPrintln(line);</span><br><span class="line"> </span><br><span class="line">  DebugPrintln(<span class="string">&quot;closing connection&quot;</span>);</span><br><span class="line">  client.stop();</span><br><span class="line"> </span><br><span class="line">  DebugPrintln(<span class="string">&quot;wait 5 sec...&quot;</span>);</span><br><span class="line">  delay(<span class="number">5000</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ol start="2"><li><p>é€šè¿‡TCP clientåŒ…è£…Httpè¯·æ±‚åè®®å»è°ƒç”¨å¤©æ°”æ¥å£è·å–å¤©æ°”ä¿¡æ¯</p><p>ï¼ˆä½¿ç”¨ArduinoJsonåº“ï¼Œå°½é‡ä½¿ç”¨5.Xç‰ˆæœ¬ï¼‰</p></li></ol><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Demoï¼š</span></span><br><span class="line"><span class="comment"> *    æ¼”ç¤ºHttpè¯·æ±‚å¤©æ°”æ¥å£ä¿¡æ¯</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ArduinoJson.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="comment">//ä»¥ä¸‹ä¸‰ä¸ªå®šä¹‰ä¸ºè°ƒè¯•å®šä¹‰</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DebugBegin(baud_rate)    Serial.begin(baud_rate)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DebugPrintln(message)    Serial.println(message)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DebugPrint(message)    Serial.print(message)</span></span><br><span class="line"> </span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* ssid     = <span class="string">&quot;TP-LINK_5344&quot;</span>;         <span class="comment">// XXXXXX -- ä½¿ç”¨æ—¶è¯·ä¿®æ”¹ä¸ºå½“å‰ä½ çš„ wifi ssid</span></span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* password = <span class="string">&quot;6206908you11011010&quot;</span>;         <span class="comment">// XXXXXX -- ä½¿ç”¨æ—¶è¯·ä¿®æ”¹ä¸ºå½“å‰ä½ çš„ wifi å¯†ç </span></span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* host = <span class="string">&quot;api.seniverse.com&quot;</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* APIKEY = <span class="string">&quot;wcmquevztdy1jpca&quot;</span>;        <span class="comment">//API KEY</span></span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* city = <span class="string">&quot;guangzhou&quot;</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* language = <span class="string">&quot;zh-Hans&quot;</span>;<span class="comment">//zh-Hans ç®€ä½“ä¸­æ–‡  ä¼šæ˜¾ç¤ºä¹±ç </span></span><br><span class="line">  </span><br><span class="line"><span class="type">const</span> <span class="type">unsigned</span> <span class="type">long</span> BAUD_RATE = <span class="number">115200</span>;                   <span class="comment">// serial connection speed</span></span><br><span class="line"><span class="type">const</span> <span class="type">unsigned</span> <span class="type">long</span> HTTP_TIMEOUT = <span class="number">5000</span>;               <span class="comment">// max respone time from server</span></span><br><span class="line"><span class="type">const</span> <span class="type">size_t</span> MAX_CONTENT_SIZE = <span class="number">1000</span>;                   <span class="comment">// max size of the HTTP response</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">// æˆ‘ä»¬è¦ä»æ­¤ç½‘é¡µä¸­æå–çš„æ•°æ®çš„ç±»å‹</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">WeatherData</span> &#123;</span></span><br><span class="line">  <span class="type">char</span> city[<span class="number">16</span>];<span class="comment">//åŸå¸‚åç§°</span></span><br><span class="line">  <span class="type">char</span> weather[<span class="number">32</span>];<span class="comment">//å¤©æ°”ä»‹ç»ï¼ˆå¤šäº‘...ï¼‰</span></span><br><span class="line">  <span class="type">char</span> temp[<span class="number">16</span>];<span class="comment">//æ¸©åº¦</span></span><br><span class="line">  <span class="type">char</span> udate[<span class="number">32</span>];<span class="comment">//æ›´æ–°æ—¶é—´</span></span><br><span class="line">&#125;;</span><br><span class="line">  </span><br><span class="line">WiFiClient client;</span><br><span class="line"><span class="type">char</span> response[MAX_CONTENT_SIZE];</span><br><span class="line"><span class="type">char</span> endOfHeaders[] = <span class="string">&quot;\r\n\r\n&quot;</span>;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="comment">// put your setup code here, to run once:</span></span><br><span class="line">  WiFi.mode(WIFI_STA);     <span class="comment">//è®¾ç½®esp8266 å·¥ä½œæ¨¡å¼</span></span><br><span class="line">  DebugBegin(BAUD_RATE);</span><br><span class="line">  DebugPrint(<span class="string">&quot;Connecting to &quot;</span>);<span class="comment">//å†™å‡ å¥æç¤ºï¼Œå“ˆå“ˆ</span></span><br><span class="line">  DebugPrintln(ssid);</span><br><span class="line">  WiFi.begin(ssid, password);   <span class="comment">//è¿æ¥wifi</span></span><br><span class="line">  WiFi.setAutoConnect(<span class="literal">true</span>);</span><br><span class="line">  <span class="keyword">while</span> (WiFi.status() != WL_CONNECTED) &#123;</span><br><span class="line">    <span class="comment">//è¿™ä¸ªå‡½æ•°æ˜¯wifiè¿æ¥çŠ¶æ€ï¼Œè¿”å›wifié“¾æ¥çŠ¶æ€</span></span><br><span class="line">    delay(<span class="number">500</span>);</span><br><span class="line">    DebugPrint(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  DebugPrintln(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  DebugPrintln(<span class="string">&quot;WiFi connected&quot;</span>);</span><br><span class="line">  delay(<span class="number">500</span>);</span><br><span class="line">  DebugPrintln(<span class="string">&quot;IP address: &quot;</span>);</span><br><span class="line">  DebugPrintln(WiFi.localIP());<span class="comment">//WiFi.localIP()è¿”å›8266è·å¾—çš„ipåœ°å€</span></span><br><span class="line">  client.setTimeout(HTTP_TIMEOUT);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="comment">// put your main code here, to run repeatedly:</span></span><br><span class="line">  <span class="comment">//åˆ¤æ–­tcp clientæ˜¯å¦å¤„äºè¿æ¥çŠ¶æ€ï¼Œä¸æ˜¯å°±å»ºç«‹è¿æ¥</span></span><br><span class="line">  <span class="keyword">while</span> (!client.connected())&#123;</span><br><span class="line">     <span class="keyword">if</span> (!client.connect(host, <span class="number">80</span>))&#123;</span><br><span class="line">         DebugPrintln(<span class="string">&quot;connection....&quot;</span>);</span><br><span class="line">         delay(<span class="number">500</span>);</span><br><span class="line">     &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//å‘é€httpè¯·æ±‚ å¹¶ä¸”è·³è¿‡å“åº”å¤´ ç›´æ¥è·å–å“åº”body</span></span><br><span class="line">  <span class="keyword">if</span> (sendRequest(host, city, APIKEY) &amp;&amp; skipResponseHeaders()) &#123;</span><br><span class="line">    <span class="comment">//æ¸…é™¤ç¼“å†²</span></span><br><span class="line">    clrEsp8266ResponseBuffer();</span><br><span class="line">    <span class="comment">//è¯»å–å“åº”æ•°æ®</span></span><br><span class="line">    readReponseContent(response, <span class="keyword">sizeof</span>(response));</span><br><span class="line">    WeatherData weatherData;</span><br><span class="line">    <span class="keyword">if</span> (parseUserData(response, &amp;weatherData)) &#123;</span><br><span class="line">      printUserData(&amp;weatherData);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  delay(<span class="number">5000</span>);<span class="comment">//æ¯5sè°ƒç”¨ä¸€æ¬¡</span></span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* @å‘é€httpè¯·æ±‚æŒ‡ä»¤</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">bool</span> <span class="title function_">sendRequest</span><span class="params">(<span class="type">const</span> <span class="type">char</span>* host, <span class="type">const</span> <span class="type">char</span>* cityid, <span class="type">const</span> <span class="type">char</span>* apiKey)</span> &#123;</span><br><span class="line">  <span class="comment">// We now create a URI for the request</span></span><br><span class="line">  <span class="comment">//å¿ƒçŸ¥å¤©æ°”  å‘é€httpè¯·æ±‚</span></span><br><span class="line">  String GetUrl = <span class="string">&quot;/v3/weather/now.json?key=&quot;</span>;</span><br><span class="line">  GetUrl += apiKey;</span><br><span class="line">  GetUrl += <span class="string">&quot;&amp;location=&quot;</span>;</span><br><span class="line">  GetUrl += city;</span><br><span class="line">  GetUrl += <span class="string">&quot;&amp;language=&quot;</span>;</span><br><span class="line">  GetUrl += language;</span><br><span class="line">  <span class="comment">// This will send the request to the server</span></span><br><span class="line">  client.print(String(<span class="string">&quot;GET &quot;</span>) + GetUrl + <span class="string">&quot; HTTP/1.1\r\n&quot;</span> +</span><br><span class="line">               <span class="string">&quot;Host: &quot;</span> + host + <span class="string">&quot;\r\n&quot;</span> +</span><br><span class="line">               <span class="string">&quot;Connection: close\r\n\r\n&quot;</span>);</span><br><span class="line">  DebugPrintln(<span class="string">&quot;create a request:&quot;</span>);</span><br><span class="line">  DebugPrintln(String(<span class="string">&quot;GET &quot;</span>) + GetUrl + <span class="string">&quot; HTTP/1.1\r\n&quot;</span> +</span><br><span class="line">               <span class="string">&quot;Host: &quot;</span> + host + <span class="string">&quot;\r\n&quot;</span> +</span><br><span class="line">               <span class="string">&quot;Connection: close\r\n&quot;</span>);</span><br><span class="line">  delay(<span class="number">1000</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line">  </span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* @Desc è·³è¿‡ HTTP å¤´ï¼Œä½¿æˆ‘ä»¬åœ¨å“åº”æ­£æ–‡çš„å¼€å¤´</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">bool</span> <span class="title function_">skipResponseHeaders</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="comment">// HTTP headers end with an empty line</span></span><br><span class="line">  <span class="type">bool</span> ok = client.find(endOfHeaders);</span><br><span class="line">  <span class="keyword">if</span> (!ok) &#123;</span><br><span class="line">    DebugPrintln(<span class="string">&quot;No response or invalid response!&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> ok;</span><br><span class="line">&#125;</span><br><span class="line">  </span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* @Desc ä»HTTPæœåŠ¡å™¨å“åº”ä¸­è¯»å–æ­£æ–‡</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">readReponseContent</span><span class="params">(<span class="type">char</span>* content, <span class="type">size_t</span> maxSize)</span> &#123;</span><br><span class="line">  <span class="type">size_t</span> length = client.readBytes(content, maxSize);</span><br><span class="line">  delay(<span class="number">100</span>);</span><br><span class="line">  DebugPrintln(<span class="string">&quot;Get the data from Internet!&quot;</span>);</span><br><span class="line">  content[length] = <span class="number">0</span>;</span><br><span class="line">  DebugPrintln(content);</span><br><span class="line">  DebugPrintln(<span class="string">&quot;Read data Over!&quot;</span>);</span><br><span class="line">  client.flush();<span class="comment">//æ¸…é™¤ä¸€ä¸‹ç¼“å†²</span></span><br><span class="line">&#125;</span><br><span class="line">  </span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @Desc è§£ææ•°æ® Jsonè§£æ</span></span><br><span class="line"><span class="comment"> * æ•°æ®æ ¼å¼å¦‚ä¸‹ï¼š</span></span><br><span class="line"><span class="comment"> * &#123;</span></span><br><span class="line"><span class="comment"> *    &quot;results&quot;: [</span></span><br><span class="line"><span class="comment"> *        &#123;</span></span><br><span class="line"><span class="comment"> *            &quot;location&quot;: &#123;</span></span><br><span class="line"><span class="comment"> *                &quot;id&quot;: &quot;WX4FBXXFKE4F&quot;,</span></span><br><span class="line"><span class="comment"> *                &quot;name&quot;: &quot;åŒ—äº¬&quot;,</span></span><br><span class="line"><span class="comment"> *                &quot;country&quot;: &quot;CN&quot;,</span></span><br><span class="line"><span class="comment"> *                &quot;path&quot;: &quot;åŒ—äº¬,åŒ—äº¬,ä¸­å›½&quot;,</span></span><br><span class="line"><span class="comment"> *                &quot;timezone&quot;: &quot;Asia/Shanghai&quot;,</span></span><br><span class="line"><span class="comment"> *                &quot;timezone_offset&quot;: &quot;+08:00&quot;</span></span><br><span class="line"><span class="comment"> *            &#125;,</span></span><br><span class="line"><span class="comment"> *            &quot;now&quot;: &#123;</span></span><br><span class="line"><span class="comment"> *                &quot;text&quot;: &quot;å¤šäº‘&quot;,</span></span><br><span class="line"><span class="comment"> *                &quot;code&quot;: &quot;4&quot;,</span></span><br><span class="line"><span class="comment"> *                &quot;temperature&quot;: &quot;23&quot;</span></span><br><span class="line"><span class="comment"> *            &#125;,</span></span><br><span class="line"><span class="comment"> *            &quot;last_update&quot;: &quot;2017-09-13T09:51:00+08:00&quot;</span></span><br><span class="line"><span class="comment"> *        &#125;</span></span><br><span class="line"><span class="comment"> *    ]</span></span><br><span class="line"><span class="comment"> *&#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">bool</span> <span class="title function_">parseUserData</span><span class="params">(<span class="type">char</span>* content, <span class="keyword">struct</span> WeatherData* weatherData)</span> &#123;</span><br><span class="line"><span class="comment">//    -- æ ¹æ®æˆ‘ä»¬éœ€è¦è§£æçš„æ•°æ®æ¥è®¡ç®—JSONç¼“å†²åŒºæœ€ä½³å¤§å°</span></span><br><span class="line"><span class="comment">//   å¦‚æœä½ ä½¿ç”¨StaticJsonBufferæ—¶æ‰éœ€è¦</span></span><br><span class="line"><span class="comment">//    const size_t BUFFER_SIZE = 1024;</span></span><br><span class="line"><span class="comment">//   åœ¨å †æ ˆä¸Šåˆ†é…ä¸€ä¸ªä¸´æ—¶å†…å­˜æ± </span></span><br><span class="line"><span class="comment">//    StaticJsonBuffer&lt;BUFFER_SIZE&gt; jsonBuffer;</span></span><br><span class="line"><span class="comment">//    -- å¦‚æœå †æ ˆçš„å†…å­˜æ± å¤ªå¤§ï¼Œä½¿ç”¨ DynamicJsonBuffer jsonBuffer ä»£æ›¿</span></span><br><span class="line">  DynamicJsonBuffer jsonBuffer;</span><br><span class="line">   </span><br><span class="line">  JsonObject&amp; root = jsonBuffer.parseObject(content);</span><br><span class="line">   </span><br><span class="line">  <span class="keyword">if</span> (!root.success()) &#123;</span><br><span class="line">    DebugPrintln(<span class="string">&quot;JSON parsing failed!&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line">    </span><br><span class="line">  <span class="comment">//å¤åˆ¶æˆ‘ä»¬æ„Ÿå…´è¶£çš„å­—ç¬¦ä¸²</span></span><br><span class="line">  <span class="built_in">strcpy</span>(weatherData-&gt;city, root[<span class="string">&quot;results&quot;</span>][<span class="number">0</span>][<span class="string">&quot;location&quot;</span>][<span class="string">&quot;name&quot;</span>]);</span><br><span class="line">  <span class="built_in">strcpy</span>(weatherData-&gt;weather, root[<span class="string">&quot;results&quot;</span>][<span class="number">0</span>][<span class="string">&quot;now&quot;</span>][<span class="string">&quot;text&quot;</span>]);</span><br><span class="line">  <span class="built_in">strcpy</span>(weatherData-&gt;temp, root[<span class="string">&quot;results&quot;</span>][<span class="number">0</span>][<span class="string">&quot;now&quot;</span>][<span class="string">&quot;temperature&quot;</span>]);</span><br><span class="line">  <span class="built_in">strcpy</span>(weatherData-&gt;udate, root[<span class="string">&quot;results&quot;</span>][<span class="number">0</span>][<span class="string">&quot;last_update&quot;</span>]);</span><br><span class="line">  <span class="comment">//  -- è¿™ä¸æ˜¯å¼ºåˆ¶å¤åˆ¶ï¼Œä½ å¯ä»¥ä½¿ç”¨æŒ‡é’ˆï¼Œå› ä¸ºä»–ä»¬æ˜¯æŒ‡å‘â€œå†…å®¹â€ç¼“å†²åŒºå†…ï¼Œæ‰€ä»¥ä½ éœ€è¦ç¡®ä¿</span></span><br><span class="line">  <span class="comment">//   å½“ä½ è¯»å–å­—ç¬¦ä¸²æ—¶å®ƒä»åœ¨å†…å­˜ä¸­</span></span><br><span class="line">  <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line">   </span><br><span class="line"><span class="comment">// æ‰“å°ä»JSONä¸­æå–çš„æ•°æ®</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">printUserData</span><span class="params">(<span class="type">const</span> <span class="keyword">struct</span> WeatherData* weatherData)</span> &#123;</span><br><span class="line">  DebugPrintln(<span class="string">&quot;Print parsed data :&quot;</span>);</span><br><span class="line">  DebugPrint(<span class="string">&quot;City : &quot;</span>);</span><br><span class="line">  DebugPrint(weatherData-&gt;city);</span><br><span class="line">  DebugPrint(<span class="string">&quot;, \t&quot;</span>);</span><br><span class="line">  DebugPrint(<span class="string">&quot;Weather : &quot;</span>);</span><br><span class="line">  DebugPrint(weatherData-&gt;weather);</span><br><span class="line">  DebugPrint(<span class="string">&quot;,\t&quot;</span>);</span><br><span class="line">  DebugPrint(<span class="string">&quot;Temp : &quot;</span>);</span><br><span class="line">  DebugPrint(weatherData-&gt;temp);</span><br><span class="line">  DebugPrint(<span class="string">&quot; C&quot;</span>);</span><br><span class="line">  DebugPrint(<span class="string">&quot;,\t&quot;</span>);</span><br><span class="line">  DebugPrint(<span class="string">&quot;Last Updata : &quot;</span>);</span><br><span class="line">  DebugPrint(weatherData-&gt;udate);</span><br><span class="line">  DebugPrintln(<span class="string">&quot;\r\n&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">   </span><br><span class="line"><span class="comment">// å…³é—­ä¸HTTPæœåŠ¡å™¨è¿æ¥</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">stopConnect</span><span class="params">()</span> &#123;</span><br><span class="line">  DebugPrintln(<span class="string">&quot;Disconnect&quot;</span>);</span><br><span class="line">  client.stop();</span><br><span class="line">&#125;</span><br><span class="line">  </span><br><span class="line"><span class="type">void</span> <span class="title function_">clrEsp8266ResponseBuffer</span><span class="params">(<span class="type">void</span>)</span>&#123;</span><br><span class="line">    <span class="built_in">memset</span>(response, <span class="number">0</span>, MAX_CONTENT_SIZE);      <span class="comment">//æ¸…ç©º</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="6ã€TCPæœåŠ¡ç«¯ï¼ˆserverï¼‰"><a href="#6ã€TCPæœåŠ¡ç«¯ï¼ˆserverï¼‰" class="headerlink" title="6ã€TCPæœåŠ¡ç«¯ï¼ˆserverï¼‰"></a>6ã€TCPæœåŠ¡ç«¯ï¼ˆserverï¼‰</h3><ol><li>8266ä½œä¸ºWiFiServerç«¯ï¼Œæ‰“å¼€TCPè°ƒè¯•åŠ©æ‰‹ï¼Œæ¨¡æ‹ŸTCP Clientçš„è¯·æ±‚ï¼›</li></ol><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Demoï¼š</span></span><br><span class="line"><span class="comment"> *    æ¼”ç¤ºWiFiServeråŠŸèƒ½</span></span><br><span class="line"><span class="comment"> *    æ‰“å¼€TCPè°ƒè¯•åŠ©æ‰‹ æ¨¡æ‹ŸTCP clientè¯·æ±‚</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="comment">//å®šä¹‰æœ€å¤šå¤šå°‘ä¸ªclientå¯ä»¥è¿æ¥æœ¬server(ä¸€èˆ¬ä¸è¦è¶…è¿‡4ä¸ª)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MAX_SRV_CLIENTS 1</span></span><br><span class="line"><span class="comment">//ä»¥ä¸‹ä¸‰ä¸ªå®šä¹‰ä¸ºè°ƒè¯•å®šä¹‰</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DebugBegin(baud_rate)    Serial.begin(baud_rate)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DebugPrintln(message)    Serial.println(message)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DebugPrint(message)    Serial.print(message)</span></span><br><span class="line"> </span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* ssid = <span class="string">&quot;TP-LINK_5344&quot;</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* password = <span class="string">&quot;6206908you11011010&quot;</span>;</span><br><span class="line"> </span><br><span class="line"><span class="comment">//åˆ›å»ºserver ç«¯å£å·æ˜¯23</span></span><br><span class="line">WiFiServer <span class="title function_">server</span><span class="params">(<span class="number">23</span>)</span>;</span><br><span class="line"><span class="comment">//ç®¡ç†clients</span></span><br><span class="line">WiFiClient serverClients[MAX_SRV_CLIENTS];</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span> &#123;</span><br><span class="line">  DebugBegin(<span class="number">115200</span>);</span><br><span class="line">  WiFi.mode(WIFI_STA);</span><br><span class="line">  WiFi.begin(ssid, password);</span><br><span class="line">  DebugPrint(<span class="string">&quot;\nConnecting to &quot;</span>); </span><br><span class="line">  DebugPrintln(ssid);</span><br><span class="line">  <span class="type">uint8_t</span> i = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">while</span> (WiFi.status() != WL_CONNECTED &amp;&amp; i++ &lt; <span class="number">20</span>) &#123;</span><br><span class="line">    delay(<span class="number">500</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (i == <span class="number">21</span>) &#123;</span><br><span class="line">    DebugPrint(<span class="string">&quot;Could not connect to&quot;</span>); </span><br><span class="line">    DebugPrintln(ssid);</span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>) &#123;</span><br><span class="line">      delay(<span class="number">500</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//å¯åŠ¨server</span></span><br><span class="line">  server.begin();</span><br><span class="line">  <span class="comment">//å…³é—­å°åŒ…åˆå¹¶åŒ…åŠŸèƒ½ï¼Œä¸ä¼šå»¶æ—¶å‘é€æ•°æ®</span></span><br><span class="line">  server.setNoDelay(<span class="literal">true</span>);</span><br><span class="line"> </span><br><span class="line">  DebugPrint(<span class="string">&quot;Ready! Use &#x27;telnet &quot;</span>);</span><br><span class="line">  DebugPrint(WiFi.localIP());</span><br><span class="line">  DebugPrintln(<span class="string">&quot; 23&#x27; to connect&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="type">uint8_t</span> i;</span><br><span class="line">  <span class="comment">//æ£€æµ‹æ˜¯å¦æœ‰æ–°çš„clientè¯·æ±‚è¿›æ¥</span></span><br><span class="line">  <span class="keyword">if</span> (server.hasClient()) &#123;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; MAX_SRV_CLIENTS; i++) &#123;</span><br><span class="line">      <span class="comment">//é‡Šæ”¾æ—§æ— æ•ˆæˆ–è€…æ–­å¼€çš„client</span></span><br><span class="line">      <span class="keyword">if</span> (!serverClients[i] || !serverClients[i].connected()) &#123;</span><br><span class="line">        <span class="keyword">if</span> (serverClients[i]) &#123;</span><br><span class="line">          serverClients[i].stop();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//åˆ†é…æœ€æ–°çš„client</span></span><br><span class="line">        serverClients[i] = server.available();</span><br><span class="line">        DebugPrint(<span class="string">&quot;New client: &quot;</span>); </span><br><span class="line">        DebugPrint(i);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//å½“è¾¾åˆ°æœ€å¤§è¿æ¥æ•° æ— æ³•é‡Šæ”¾æ— æ•ˆçš„clientï¼Œéœ€è¦æ‹’ç»è¿æ¥</span></span><br><span class="line">    <span class="keyword">if</span> (i == MAX_SRV_CLIENTS) &#123;</span><br><span class="line">      WiFiClient serverClient = server.available();</span><br><span class="line">      serverClient.stop();</span><br><span class="line">      DebugPrintln(<span class="string">&quot;Connection rejected &quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//æ£€æµ‹clientå‘è¿‡æ¥çš„æ•°æ®</span></span><br><span class="line">  <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; MAX_SRV_CLIENTS; i++) &#123;</span><br><span class="line">    <span class="keyword">if</span> (serverClients[i] &amp;&amp; serverClients[i].connected()) &#123;</span><br><span class="line">      <span class="keyword">if</span> (serverClients[i].available()) &#123;</span><br><span class="line">        <span class="comment">//get data from the telnet client and push it to the UART</span></span><br><span class="line">        <span class="keyword">while</span> (serverClients[i].available()) &#123;</span><br><span class="line">          <span class="comment">//å‘é€åˆ°ä¸²å£è°ƒè¯•å™¨</span></span><br><span class="line">          Serial.write(serverClients[i].read());</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="keyword">if</span> (Serial.available()) &#123;</span><br><span class="line">    <span class="comment">//æŠŠä¸²å£è°ƒè¯•å™¨å‘è¿‡æ¥çš„æ•°æ® å‘é€ç»™client</span></span><br><span class="line">    <span class="type">size_t</span> len = Serial.available();</span><br><span class="line">    <span class="type">uint8_t</span> sbuf[len];</span><br><span class="line">    Serial.readBytes(sbuf, len);</span><br><span class="line">    <span class="comment">//push UART data to all connected telnet clients</span></span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; MAX_SRV_CLIENTS; i++) &#123;</span><br><span class="line">      <span class="keyword">if</span> (serverClients[i] &amp;&amp; serverClients[i].connected()) &#123;</span><br><span class="line">        serverClients[i].write(sbuf, len);</span><br><span class="line">        delay(<span class="number">1</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="2"><li>8266ä½œä¸ºweb serverç«¯ï¼Œæ‰“å¼€PCæµè§ˆå™¨è¾“å…¥IPç½‘å€ï¼Œè¯·æ±‚web server</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * Demoï¼š</span><br><span class="line"> *    æ¼”ç¤ºweb ServeråŠŸèƒ½</span><br><span class="line"> *    æ‰“å¼€PCæµè§ˆå™¨ è¾“å…¥IPåœ°å€ã€‚è¯·æ±‚web server</span><br><span class="line"> */</span><br><span class="line">#include &lt;ESP8266WiFi.h&gt;</span><br><span class="line"> </span><br><span class="line">const char* ssid = &quot;TP-LINK_5344&quot;;//wifiè´¦å· è¿™é‡Œéœ€è¦ä¿®æ”¹</span><br><span class="line">const char* password = &quot;xxxx&quot;;//wifiå¯†ç  è¿™é‡Œéœ€è¦ä¿®æ”¹</span><br><span class="line"> </span><br><span class="line">//åˆ›å»º tcp server ç«¯å£å·æ˜¯80</span><br><span class="line">WiFiServer server(80);</span><br><span class="line"> </span><br><span class="line">void setup()&#123;</span><br><span class="line">  Serial.begin(115200);</span><br><span class="line">  Serial.println();</span><br><span class="line"> </span><br><span class="line">  Serial.printf(&quot;Connecting to %s &quot;, ssid);</span><br><span class="line">  WiFi.mode(WIFI_STA);</span><br><span class="line">  WiFi.begin(ssid, password);</span><br><span class="line">  while (WiFi.status() != WL_CONNECTED)&#123;</span><br><span class="line">    delay(500);</span><br><span class="line">    Serial.print(&quot;.&quot;);</span><br><span class="line">  &#125;</span><br><span class="line">  Serial.println(&quot; connected&quot;);</span><br><span class="line">  //å¯åŠ¨TCP è¿æ¥</span><br><span class="line">  server.begin();</span><br><span class="line">  //æ‰“å°TCP server IPåœ°å€</span><br><span class="line">  Serial.printf(&quot;Web server started, open %s in a web browser\n&quot;, WiFi.localIP().toString().c_str());</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">/**</span><br><span class="line"> * æ¨¡æ‹Ÿweb server è¿”å›http webå“åº”å†…å®¹</span><br><span class="line"> * è¿™é‡Œæ˜¯æ‰‹åŠ¨æ‹¼æ¥HTTPå“åº”å†…å®¹</span><br><span class="line"> * åé¢æ¥¼ä¸»ä¼šç»§ç»­è®²è§£å¦å¤–ä¸¤ä¸ªä¸“ç”¨äºhttpè¯·æ±‚çš„åº“</span><br><span class="line"> */</span><br><span class="line">String prepareHtmlPage()&#123;</span><br><span class="line">  String htmlPage =</span><br><span class="line">     String(&quot;HTTP/1.1 200 OK\r\n&quot;) +</span><br><span class="line">            &quot;Content-Type: text/html\r\n&quot; +</span><br><span class="line">            &quot;Connection: close\r\n&quot; +  // the connection will be closed after completion of the response</span><br><span class="line">            &quot;Refresh: 5\r\n&quot; +  // refresh the page automatically every 5 sec</span><br><span class="line">            &quot;\r\n&quot; +</span><br><span class="line">            &quot;&lt;!DOCTYPE HTML&gt;&quot; +</span><br><span class="line">            &quot;&lt;html&gt;&quot; +</span><br><span class="line">            &quot;Analog input:  &quot; + String(analogRead(A0)) +</span><br><span class="line">            &quot;&lt;/html&gt;&quot; +</span><br><span class="line">            &quot;\r\n&quot;;</span><br><span class="line">  return htmlPage;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">void loop()&#123;</span><br><span class="line">  WiFiClient client = server.available();</span><br><span class="line">  // wait for a client (web browser) to connect</span><br><span class="line">  if (client)&#123;</span><br><span class="line">    Serial.println(&quot;\n[Client connected]&quot;);</span><br><span class="line">    while (client.connected())&#123;</span><br><span class="line">      // ä¸æ–­è¯»å–è¯·æ±‚å†…å®¹</span><br><span class="line">      if (client.available())&#123;</span><br><span class="line">        String line = client.readStringUntil(&#x27;\r&#x27;);</span><br><span class="line">        Serial.print(line);</span><br><span class="line">        // wait for end of client&#x27;s request, that is marked with an empty line</span><br><span class="line">        if (line.length() == 1 &amp;&amp; line[0] == &#x27;\n&#x27;)&#123;</span><br><span class="line">          //è¿”å›å“åº”å†…å®¹</span><br><span class="line">          client.println(prepareHtmlPage());</span><br><span class="line">          break;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      //ç”±äºæˆ‘ä»¬è®¾ç½®äº† Connection: close  å½“æˆ‘ä»¬å“åº”æ•°æ®ä¹‹åå°±ä¼šè‡ªåŠ¨æ–­å¼€è¿æ¥</span><br><span class="line">    &#125;</span><br><span class="line">    delay(100); // give the web browser time to receive the data</span><br><span class="line"> </span><br><span class="line">    // close the connection:</span><br><span class="line">    client.stop();</span><br><span class="line">    Serial.println(&quot;[Client disonnected]&quot;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ol start="3"><li>8266ä½œä¸ºWiFiServerç«¯ï¼Œæ¼”ç¤ºç®€å•çš„web serveråŠŸèƒ½ï¼Œweb server ä¼šæ ¹æ®è¯·æ±‚æ¥åšä¸åŒçš„æ“ä½œ</li></ol><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* Demoï¼š</span></span><br><span class="line"><span class="comment">*    æ¼”ç¤ºç®€å•web ServeråŠŸèƒ½</span></span><br><span class="line"><span class="comment">*    web serverä¼šæ ¹æ®è¯·æ±‚æ¥åšä¸åŒçš„æ“ä½œ</span></span><br><span class="line"><span class="comment">*    http://server_ip/gpio/0 æ‰“å° /gpio0</span></span><br><span class="line"><span class="comment">*    http://server_ip/gpio/1 æ‰“å° /gpio1</span></span><br><span class="line"><span class="comment">*    server_ipå°±æ˜¯ESP8266çš„Ipåœ°å€</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="comment">//ä»¥ä¸‹ä¸‰ä¸ªå®šä¹‰ä¸ºè°ƒè¯•å®šä¹‰</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DebugBegin(baud_rate)    Serial.begin(baud_rate)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DebugPrintln(message)    Serial.println(message)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DebugPrint(message)    Serial.print(message)</span></span><br><span class="line"> </span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* ssid = <span class="string">&quot;TP-LINK_5344&quot;</span>;<span class="comment">//wifiè´¦å· è¿™é‡Œéœ€è¦ä¿®æ”¹</span></span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* password = <span class="string">&quot;xxxx&quot;</span>;<span class="comment">//wifiå¯†ç  è¿™é‡Œéœ€è¦ä¿®æ”¹</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">// åˆ›å»ºtcp server</span></span><br><span class="line">WiFiServer <span class="title function_">server</span><span class="params">(<span class="number">80</span>)</span>;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span> &#123;</span><br><span class="line">  DebugBegin(<span class="number">115200</span>);</span><br><span class="line">  delay(<span class="number">10</span>);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// Connect to WiFi network</span></span><br><span class="line">  DebugPrintln(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  DebugPrintln(String(<span class="string">&quot;Connecting to &quot;</span>) + ssid);</span><br><span class="line">  <span class="comment">//æˆ‘åªæƒ³åšä¸ªå®‰é™çš„ç¾ç”·å­ STA</span></span><br><span class="line">  WiFi.mode(WIFI_STA);</span><br><span class="line">  <span class="comment">//æˆ‘æƒ³è¿æ¥è·¯ç”±wifi</span></span><br><span class="line">  WiFi.begin(ssid, password);</span><br><span class="line"> </span><br><span class="line">  <span class="keyword">while</span> (WiFi.status() != WL_CONNECTED) &#123;</span><br><span class="line">    delay(<span class="number">500</span>);</span><br><span class="line">    DebugPrint(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  DebugPrintln(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  DebugPrintln(<span class="string">&quot;WiFi connected&quot;</span>);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// å¯åŠ¨server</span></span><br><span class="line">  server.begin();</span><br><span class="line">  DebugPrintln(<span class="string">&quot;Server started&quot;</span>);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// æ‰“å°IPåœ°å€</span></span><br><span class="line">  DebugPrintln(WiFi.localIP().toString());</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="comment">// ç­‰å¾…æœ‰æ•ˆçš„tcpè¿æ¥</span></span><br><span class="line">  WiFiClient client = server.available();</span><br><span class="line">  <span class="keyword">if</span> (!client) &#123;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  DebugPrintln(<span class="string">&quot;new client&quot;</span>);</span><br><span class="line">  <span class="comment">//ç­‰å¾…clientæ•°æ®è¿‡æ¥</span></span><br><span class="line">  <span class="keyword">while</span> (!client.available()) &#123;</span><br><span class="line">    delay(<span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// è¯»å–è¯·æ±‚çš„ç¬¬ä¸€è¡Œ ä¼šåŒ…æ‹¬ä¸€ä¸ªurlï¼Œè¿™é‡Œåªå¤„ç†url</span></span><br><span class="line">  String req = client.readStringUntil(<span class="string">&#x27;\r&#x27;</span>);</span><br><span class="line">  DebugPrintln(req);</span><br><span class="line">  <span class="comment">//æ¸…æ‰ç¼“å†²åŒºæ•°æ® æ®è¯´è¿™ä¸ªæ–¹æ³•æ²¡ä»€ä¹ˆç”¨ å¯ä»¥æ¢ç§å®ç°æ–¹å¼</span></span><br><span class="line">  client.flush();</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// å¼€å§‹åŒ¹é…</span></span><br><span class="line">  <span class="type">int</span> val;</span><br><span class="line">  <span class="keyword">if</span> (req.indexOf(<span class="string">&quot;/gpio/0&quot;</span>) != <span class="number">-1</span>) &#123;</span><br><span class="line">    DebugPrintln(<span class="string">&quot;/gpio0&quot;</span>);</span><br><span class="line">    val = <span class="number">0</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (req.indexOf(<span class="string">&quot;/gpio/1&quot;</span>) != <span class="number">-1</span>) &#123;</span><br><span class="line">    DebugPrintln(<span class="string">&quot;/gpio1&quot;</span>);</span><br><span class="line">    val = <span class="number">1</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    DebugPrintln(<span class="string">&quot;invalid request&quot;</span>);</span><br><span class="line">    <span class="comment">//å…³é—­è¿™ä¸ªclientè¯·æ±‚</span></span><br><span class="line">    client.stop();</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//æ¸…æ‰ç¼“å†²åŒºæ•°æ®</span></span><br><span class="line">  client.flush();</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// å‡†å¤‡å“åº”æ•°æ®</span></span><br><span class="line">  String s = <span class="string">&quot;HTTP/1.1 200 OK\r\nContent-Type: text/html\r\n\r\n&lt;!DOCTYPE HTML&gt;\r\n&lt;html&gt;\r\nGPIO is now &quot;</span>;</span><br><span class="line">  s += (val) ? <span class="string">&quot;high&quot;</span> : <span class="string">&quot;low&quot;</span>;</span><br><span class="line">  s += <span class="string">&quot;&lt;/html&gt;\n&quot;</span>;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// å‘é€å“åº”æ•°æ®ç»™client</span></span><br><span class="line">  client.print(s);</span><br><span class="line">  delay(<span class="number">1</span>);</span><br><span class="line">  DebugPrintln(<span class="string">&quot;Client disonnected&quot;</span>);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// The client will actually be disconnected</span></span><br><span class="line">  <span class="comment">// when the function returns and &#x27;client&#x27; object is detroyed</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="7ã€Smartconfigæ™ºèƒ½é…ç½‘ï¼š"><a href="#7ã€Smartconfigæ™ºèƒ½é…ç½‘ï¼š" class="headerlink" title="7ã€Smartconfigæ™ºèƒ½é…ç½‘ï¼š"></a>7ã€Smartconfigæ™ºèƒ½é…ç½‘ï¼š</h3><p>æ”¶é›†APPç«¯å‘é€åŒ…å«WIFIç”¨æˆ·åå’Œå¯†ç çš„UDPå¹¿æ’­åŒ…ï¼Œæ™ºèƒ½ç»ˆç«¯çš„WIFIèŠ¯ç‰‡æ¥æ”¶åˆ°UDPåŒ…ï¼Œè§£å¯†é…ç½®è¿æ¥ã€‚</p><p>æ‰‹æœºè½¯ä»¶esptouch:</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">smartConfig</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  WiFi.mode(WIFI_STA);</span><br><span class="line">  Serial.println(<span class="string">&quot;\r\nWait for Smartconfig&quot;</span>);</span><br><span class="line">  delay(<span class="number">2000</span>);</span><br><span class="line">  <span class="comment">// ç­‰å¾…é…ç½‘</span></span><br><span class="line">  WiFi.beginSmartConfig();</span><br><span class="line"> </span><br><span class="line"> <span class="keyword">while</span> (<span class="number">1</span>)</span><br><span class="line">  &#123;</span><br><span class="line">    Serial.print(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">    delay(<span class="number">500</span>);</span><br><span class="line">    <span class="keyword">if</span> (WiFi.smartConfigDone())</span><br><span class="line">    &#123;</span><br><span class="line">      Serial.println(<span class="string">&quot;SmartConfig Success&quot;</span>);</span><br><span class="line">      Serial.<span class="built_in">printf</span>(<span class="string">&quot;SSID:%s\r\n&quot;</span>, WiFi.SSID().c_str());</span><br><span class="line">      Serial.<span class="built_in">printf</span>(<span class="string">&quot;PSW:%s\r\n&quot;</span>, WiFi.psk().c_str());</span><br><span class="line">      WiFi.setAutoConnect(<span class="literal">true</span>);  <span class="comment">// è®¾ç½®è‡ªåŠ¨è¿æ¥</span></span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  Serial.println(<span class="string">&quot;WiFi connected&quot;</span>);  </span><br><span class="line"> </span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  Serial.begin(<span class="number">115200</span>);</span><br><span class="line">  smartConfig();</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  delay(<span class="number">1000</span>);</span><br><span class="line">   Serial.print(<span class="string">&quot;IP address: &quot;</span>);</span><br><span class="line">  Serial.println(WiFi.localIP());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="13ã€HttpClientâ€“ESP8266HTTPClientåº“"><a href="#13ã€HttpClientâ€“ESP8266HTTPClientåº“" class="headerlink" title="13ã€HttpClientâ€“ESP8266HTTPClientåº“"></a>13ã€HttpClientâ€“ESP8266HTTPClientåº“</h1><h2 id="1ã€HTTP"><a href="#1ã€HTTP" class="headerlink" title="1ã€HTTP"></a>1ã€HTTP</h2><h3 id="1ã€æ¦‚è¿°-2"><a href="#1ã€æ¦‚è¿°-2" class="headerlink" title="1ã€æ¦‚è¿°"></a>1ã€æ¦‚è¿°</h3><p><em><strong>HTTPåè®®ï¼ˆHyper Text Transfer Protocolï¼‰è¶…æ–‡æœ¬ä¼ è¾“åè®®</strong></em>ï¼Œç”¨äºä»WWWæœåŠ¡å™¨ä¼ è¾“æ–‡æœ¬åˆ°æœ¬åœ°æµè§ˆå™¨çš„ä¼ é€åè®®ã€‚åŸºäºTCP&#x2F;IPé€šä¿¡åè®®ï¼šæµè§ˆå™¨ä½œä¸ºHTTPå®¢æˆ·ç«¯é€šè¿‡URLå‘HTTPæœåŠ¡ç«¯å³WEBæœåŠ¡å™¨å‘é€æ‰€æœ‰è¯·æ±‚ã€‚WEBæœåŠ¡å™¨æ ¹æ®æ¥æ”¶åˆ°çš„è¯·æ±‚åï¼Œå‘å®¢æˆ·ç«¯å‘é€å“åº”ä¿¡æ¯ï¼›</p><p>HTTPåè®®ä½œä¸ºTCP&#x2F;IPæ¨¡å‹ä¸­<strong>åº”ç”¨å±‚</strong>çš„åè®®ï¼Œæ‰¿è½½ä¸TCPåè®®ä¸Šï¼Œæœ‰æ—¶ä¹Ÿæ‰¿è½½ä¸TLSæˆ–è€…SSLåè®®å±‚ä¹‹ä¸Šï¼Œè¿™æ—¶å°±æ˜¯<strong>HTTPS</strong>ï¼›</p><p>HTTPç”±<strong>è¯·æ±‚</strong>ä¸<strong>å“åº”</strong>æ„æˆï¼Œæ˜¯ä¸€ä¸ªæ ‡å‡†çš„å®¢æˆ·ç«¯æœåŠ¡å™¨æ¨¡å‹ï¼Œé»˜è®¤ç«¯å£å·80ï¼ŒHTTPSæ˜¯443ï¼›</p><p>æµè§ˆç½‘é¡µæ—¶HTTPä¸»è¦åº”ç”¨ï¼ˆä¸åªæ˜¯è¿™ä¸ªåŠŸèƒ½ï¼Œåªæ˜¯ä¸€ç§åè®®ï¼Œåªè¦é€šä¿¡åŒæ–¹éƒ½æ”¯æŒè¿™ä¸ªåè®®ï¼ŒHTTPå°±èƒ½ç”¨ï¼‰</p><p>ç‰¹ç‚¹ï¼šHTTP0.9ä¸1.0ä½¿ç”¨éæŒç»­è¿æ¥ï¼›1.1ä½¿ç”¨æŒç»­è¿æ¥ã€‚</p><p>æ— çŠ¶æ€ï¼Œæ— è®°å¿†èƒ½åŠ›</p><h3 id="2ã€å·¥ä½œæµç¨‹"><a href="#2ã€å·¥ä½œæµç¨‹" class="headerlink" title="2ã€å·¥ä½œæµç¨‹"></a>2ã€å·¥ä½œæµç¨‹</h3><p>ä¸€æ¬¡HTTPæ“ä½œç§°ä½ä¸€ä¸ªäº‹åŠ¡ï¼Œå¯åˆ†4æ­¥ï¼š</p><ol><li><p>clientä¸serverå»ºç«‹è¿æ¥ï¼›</p></li><li><p>è¿æ¥åï¼Œclientå‘é€ä¸€ä¸ªè¯·æ±‚ç»™serverï¼Œè¯·æ±‚æ–¹æ³•æ ¼å¼ï¼šç»Ÿä¸€èµ„æºæ ‡ç¤ºç¬¦ï¼ˆURLï¼‰ã€HTTPåè®®ç‰ˆæœ¬å·ã€è¯·æ±‚å¤´ã€è¯·æ±‚å†…å®¹ç­‰ï¼›</p></li><li><p>serveræ¥æ”¶åˆ°è¯·æ±‚åï¼Œç»™äºˆå“åº”ï¼Œæ ¼å¼ï¼šçŠ¶æ€è¡Œï¼ˆåŒ…æ‹¬åè®®ç‰ˆæœ¬ã€æˆåŠŸæˆ–è€…å¤±è´¥ä»£ç ã€æœåŠ¡å™¨ä¿¡æ¯ã€å®ä½“ä¿¡æ¯ç­‰ï¼‰</p></li><li><p>clientæ¥æ”¶åˆ°serverè¿”å›ä¿¡æ¯ï¼Œé€šè¿‡æµè§ˆå™¨æ˜¾ç¤ºåœ¨ç”¨æˆ·æ˜¾ç¤ºå±ä¸Šï¼Œç„¶åclientä¸serveræ–­å¼€è¿æ¥</p></li></ol><h3 id="3ã€HTTPè¯·æ±‚"><a href="#3ã€HTTPè¯·æ±‚" class="headerlink" title="3ã€HTTPè¯·æ±‚"></a>3ã€HTTPè¯·æ±‚</h3><p>Getè¯·æ±‚ï¼š</p><ul><li>è¯·æ±‚è¡Œï¼ˆrequest lineï¼‰ï¼šè¯´æ˜è¯·æ±‚ç±»å‹ï¼Œè¦è®¿é—®çš„èµ„æºåŠHTTPç‰ˆæœ¬</li><li>è¯·æ±‚å¤´éƒ¨ï¼ˆheaderï¼‰ï¼šè¯´æ˜æœåŠ¡å™¨è¦ä½¿ç”¨çš„é™„åŠ ä¿¡æ¯ï¼ˆç¬¬äºŒè¡Œèµ·ä½è¯·æ±‚å¤´éƒ¨ï¼ŒHOSTæŒ‡å‡ºç›®çš„åœ°ï¼›User-Agentæ˜¯clientä¸serverè„šæœ¬éƒ½èƒ½è®¿é—®ï¼Œæ˜¯æµè§ˆå™¨æ£€æµ‹é€»è¾‘çš„é‡è¦åŸºç¡€ï¼‰ï¼ˆè¯¥ä¿¡æ¯ç”±æµè§ˆå™¨å®šä¹‰ï¼Œå¹¶åœ¨æ¯ä¸ªè¯·æ±‚ä¸­è‡ªåŠ¨å‘é€ï¼‰</li><li>ç©ºè¡Œï¼ˆempty lineï¼‰ï¼šè¯·æ±‚å¤´éƒ¨åç©ºè¡Œæ˜¯å¿…é¡»çš„ï¼ˆå³ä½¿ç¬¬å››éƒ¨åˆ†è¯·æ±‚æ•°æ®ä¸ºç©ºï¼Œä¹Ÿå¿…é¡»æœ‰ç©ºè¡Œï¼‰</li><li>è¯·æ±‚æ•°æ®ï¼ˆrequest bodyï¼‰ï¼šä¸»ä½“ï¼Œå¯æ·»åŠ ä»»æ„å…¶ä»–æ•°æ®ï¼ˆä¸‹é¢ä¾‹å­ä¸­è¯·æ±‚æ•°æ®ä¸ºç©ºï¼‰</li></ul><p>è¯·æ±‚ä¾‹å­ï¼ˆGharlesæŠ“å–çš„requestï¼‰</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">GET /<span class="number">562f</span>25980001b1b106000338.jpg HTTP/<span class="number">1.1</span></span><br><span class="line">Host    img.mukewang.com</span><br><span class="line">User-Agent    Mozilla/<span class="number">5.0</span> (Windows NT <span class="number">10.0</span>; WOW64) AppleWebKit/<span class="number">537.36</span> (KHTML, like Gecko) Chrome/<span class="number">51.0</span><span class="number">.2704</span><span class="number">.106</span> Safari/<span class="number">537.36</span></span><br><span class="line">Accept    image/webp,image<span class="comment">/*,*/</span>*;q=<span class="number">0.8</span></span><br><span class="line">Referer    http:<span class="comment">//www.imooc.com/</span></span><br><span class="line">Accept-Encoding    gzip, deflate, sdch</span><br><span class="line">Accept-Language    zh-CN,zh;q=<span class="number">0.8</span></span><br></pre></td></tr></table></figure><p>POSTè¯·æ±‚ï¼š</p><p>è¯·æ±‚ä¾‹å­ï¼ˆGharlesæŠ“å–çš„requestï¼‰</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">POST / HTTP1<span class="number">.1</span></span><br><span class="line">Host:www.wrox.com</span><br><span class="line">User-Agent:Mozilla/<span class="number">4.0</span> (compatible; MSIE <span class="number">6.0</span>; Windows NT <span class="number">5.1</span>; SV1; .NET CLR <span class="number">2.0</span><span class="number">.50727</span>; .NET CLR <span class="number">3.0</span><span class="number">.04506</span><span class="number">.648</span>; .NET CLR <span class="number">3.5</span><span class="number">.21022</span>)</span><br><span class="line">Content-Type:application/x-www-form-urlencoded</span><br><span class="line">Content-Length:<span class="number">40</span></span><br><span class="line">Connection: Keep-Alive</span><br><span class="line"> </span><br><span class="line">name=Professional%<span class="number">20</span>Ajax&amp;publisher=Wiley</span><br></pre></td></tr></table></figure><h3 id="4ã€HTTP-Responseå“åº”ä¿¡æ¯"><a href="#4ã€HTTP-Responseå“åº”ä¿¡æ¯" class="headerlink" title="4ã€HTTP Responseå“åº”ä¿¡æ¯"></a>4ã€HTTP Responseå“åº”ä¿¡æ¯</h3><ul><li>çŠ¶æ€è¡Œ</li><li>æ¶ˆæ¯æŠ¥å¤´</li><li>ç©ºè¡Œ</li><li>å“åº”æ­£æ–‡</li></ul><p><a href="https://imgtu.com/i/huf9qH"><img src="https://z3.ax1x.com/2021/08/26/huf9qH.jpg" class="lazyload placeholder" data-srcset="https://z3.ax1x.com/2021/08/26/huf9qH.jpg" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="huf9qH.jpg"></a></p><p>HTTPçŠ¶æ€ç </p><h3 id="5ã€ESP8266HTTPClientåº“"><a href="#5ã€ESP8266HTTPClientåº“" class="headerlink" title="5ã€ESP8266HTTPClientåº“"></a>5ã€ESP8266HTTPClientåº“</h3><p><a href="https://imgtu.com/i/f3MpdO"><img src="https://z3.ax1x.com/2021/08/09/f3MpdO.png" class="lazyload placeholder" data-srcset="https://z3.ax1x.com/2021/08/09/f3MpdO.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="f3MpdO.png"></a></p><h3 id="6ã€ç¤ºä¾‹"><a href="#6ã€ç¤ºä¾‹" class="headerlink" title="6ã€ç¤ºä¾‹"></a>6ã€ç¤ºä¾‹</h3><ol><li>è·å–å¤©æ°”è¯·æ±‚ï¼ˆå¿ƒçŸ¥å¤©æ°”ï¼‰</li></ol><p>setupä¸­é…ç½®å¥½urlï¼Œä¸²å£å‚æ•°å’Œhttpclientå¹¶è®¾ç½®clientè¯·æ±‚å¤´ã€‚loopä¸­æ¯1ç§’è¯·æ±‚ä¸€æ¬¡getæœåŠ¡ï¼ŒæŠŠè·å–å›æ¥çš„å¤©æ°”ä¿¡æ¯é€šè¿‡jsonåº“è½¬æˆå…·ä½“å¯¹åº”çš„æ•°å€¼</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Demoï¼š</span></span><br><span class="line"><span class="comment"> *    æ¼”ç¤ºHttpè¯·æ±‚å¤©æ°”æ¥å£ä¿¡æ¯</span></span><br><span class="line"><span class="comment"> *    https://api.seniverse.com/v3/weather/now.json?key=Sv6J6HVHp8V2Cc34a&amp;location=beijing&amp;language=zh-Hans&amp;unit=c</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ArduinoJson.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266HTTPClient.h&gt;</span>  <span class="comment">//ä¸å±äºESP8266WiFiåº“çš„ä¸€éƒ¨åˆ†</span></span></span><br><span class="line"> </span><br><span class="line"><span class="comment">//ä»¥ä¸‹ä¸‰ä¸ªå®šä¹‰ä¸ºè°ƒè¯•å®šä¹‰</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DebugBegin(baud_rate)    Serial.begin(baud_rate)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DebugPrintln(message)    Serial.println(message)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DebugPrint(message)    Serial.print(message)</span></span><br><span class="line"> </span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* AP_SSID     = <span class="string">&quot;XU-ChinaNet&quot;</span>;         <span class="comment">// XXXXXX -- ä½¿ç”¨æ—¶è¯·ä¿®æ”¹ä¸ºå½“å‰ä½ çš„ wifi ssid</span></span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* AP_PSK = <span class="string">&quot;15358228063&quot;</span>;         <span class="comment">// XXXXXX -- ä½¿ç”¨æ—¶è¯·ä¿®æ”¹ä¸ºå½“å‰ä½ çš„ wifi å¯†ç </span></span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* HOST = <span class="string">&quot;http://api.seniverse.com&quot;</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* APIKEY = <span class="string">&quot;&quot;</span>;        <span class="comment">//API KEY</span></span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* CITY = <span class="string">&quot;yancheng&quot;</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* LANGUAGE = <span class="string">&quot;zh-Hans&quot;</span>;<span class="comment">//zh-Hans ç®€ä½“ä¸­æ–‡  ä¼šæ˜¾ç¤ºä¹±ç </span></span><br><span class="line">  </span><br><span class="line"><span class="type">const</span> <span class="type">unsigned</span> <span class="type">long</span> BAUD_RATE = <span class="number">115200</span>;                   <span class="comment">// serial connection speed</span></span><br><span class="line"><span class="type">const</span> <span class="type">unsigned</span> <span class="type">long</span> HTTP_TIMEOUT = <span class="number">5000</span>;               <span class="comment">// max respone time from server</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">// æˆ‘ä»¬è¦ä»æ­¤ç½‘é¡µä¸­æå–çš„æ•°æ®çš„ç±»å‹</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">WeatherData</span> &#123;</span></span><br><span class="line">  <span class="type">char</span> city[<span class="number">16</span>];<span class="comment">//åŸå¸‚åç§°</span></span><br><span class="line">  <span class="type">char</span> weather[<span class="number">32</span>];<span class="comment">//å¤©æ°”ä»‹ç»ï¼ˆå¤šäº‘...ï¼‰</span></span><br><span class="line">  <span class="type">char</span> temp[<span class="number">16</span>];<span class="comment">//æ¸©åº¦</span></span><br><span class="line">  <span class="type">char</span> udate[<span class="number">32</span>];<span class="comment">//æ›´æ–°æ—¶é—´</span></span><br><span class="line">&#125;;</span><br><span class="line">WiFiClient client;</span><br><span class="line">HTTPClient http;</span><br><span class="line">String GetUrl;</span><br><span class="line">String response;</span><br><span class="line">WeatherData weatherData;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="comment">// put your setup code here, to run once:</span></span><br><span class="line">  WiFi.mode(WIFI_STA);     <span class="comment">//è®¾ç½®esp8266 å·¥ä½œæ¨¡å¼</span></span><br><span class="line">  DebugBegin(BAUD_RATE);</span><br><span class="line">  DebugPrint(<span class="string">&quot;Connecting to &quot;</span>);<span class="comment">//å†™å‡ å¥æç¤ºï¼Œå“ˆå“ˆ</span></span><br><span class="line">  DebugPrintln(AP_SSID);</span><br><span class="line">  WiFi.begin(AP_SSID, AP_PSK);   <span class="comment">//è¿æ¥wifi</span></span><br><span class="line">  WiFi.setAutoConnect(<span class="literal">true</span>);</span><br><span class="line">  <span class="keyword">while</span> (WiFi.status() != WL_CONNECTED) &#123;</span><br><span class="line">    <span class="comment">//è¿™ä¸ªå‡½æ•°æ˜¯wifiè¿æ¥çŠ¶æ€ï¼Œè¿”å›wifié“¾æ¥çŠ¶æ€</span></span><br><span class="line">    delay(<span class="number">500</span>);</span><br><span class="line">    DebugPrint(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  DebugPrintln(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  DebugPrintln(<span class="string">&quot;WiFi connected&quot;</span>);</span><br><span class="line">  DebugPrint(<span class="string">&quot;IP address: &quot;</span>);</span><br><span class="line">  DebugPrintln(WiFi.localIP());</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//æ‹¼æ¥getè¯·æ±‚url  åšå“¥åé¢è€ƒè™‘çœ‹çœ‹æ˜¯å¦å¯ä»¥å°è£…ä¸€ä¸ªæ–¹æ³•æ¥ç”¨ç”¨ ä¸éœ€è¦è‡ªå·±ä¸€ä¸ªä¸ªæ‹¼è£…è¿™ä¸ªurl</span></span><br><span class="line">  GetUrl = String(HOST) + <span class="string">&quot;/v3/weather/now.json?key=&quot;</span>;</span><br><span class="line">  GetUrl += APIKEY;</span><br><span class="line">  GetUrl += <span class="string">&quot;&amp;location=&quot;</span>;</span><br><span class="line">  GetUrl += CITY;</span><br><span class="line">  GetUrl += <span class="string">&quot;&amp;language=&quot;</span>;</span><br><span class="line">  GetUrl += LANGUAGE;</span><br><span class="line">  <span class="comment">//è®¾ç½®è¶…æ—¶</span></span><br><span class="line">  http.setTimeout(HTTP_TIMEOUT);</span><br><span class="line">  <span class="comment">//è®¾ç½®è¯·æ±‚url</span></span><br><span class="line">  <span class="comment">//http.begin(GetUrl);</span></span><br><span class="line">  http.begin(client,GetUrl);</span><br><span class="line">  <span class="comment">//ä»¥ä¸‹ä¸ºè®¾ç½®ä¸€äº›å¤´  å…¶å®æ²¡ä»€ä¹ˆç”¨ æœ€é‡è¦æ˜¯åç«¯æœåŠ¡å™¨æ”¯æŒ</span></span><br><span class="line">  http.setUserAgent(<span class="string">&quot;esp8266&quot;</span>);<span class="comment">//ç”¨æˆ·ä»£ç†ç‰ˆæœ¬</span></span><br><span class="line">  http.setAuthorization(<span class="string">&quot;esp8266&quot;</span>,<span class="string">&quot;boge&quot;</span>);<span class="comment">//ç”¨æˆ·æ ¡éªŒä¿¡æ¯</span></span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="comment">//å¿ƒçŸ¥å¤©æ°”  å‘é€http  getè¯·æ±‚</span></span><br><span class="line">  <span class="type">int</span> httpCode = http.GET();</span><br><span class="line">  <span class="keyword">if</span> (httpCode &gt; <span class="number">0</span>) &#123;</span><br><span class="line">      Serial.<span class="built_in">printf</span>(<span class="string">&quot;[HTTP] GET... code: %d\n&quot;</span>, httpCode);</span><br><span class="line">      <span class="comment">//åˆ¤æ–­è¯·æ±‚æ˜¯å¦æˆåŠŸ</span></span><br><span class="line">      <span class="keyword">if</span> (httpCode == HTTP_CODE_OK) &#123;</span><br><span class="line">        <span class="comment">//è¯»å–å“åº”å†…å®¹</span></span><br><span class="line">        response = http.getString();</span><br><span class="line">        DebugPrintln(<span class="string">&quot;Get the data from Internet!&quot;</span>);</span><br><span class="line">        DebugPrintln(response);</span><br><span class="line">        <span class="comment">//è§£æå“åº”å†…å®¹</span></span><br><span class="line">        <span class="keyword">if</span> (parseUserData(response, &amp;weatherData)) &#123;</span><br><span class="line">          <span class="comment">//æ‰“å°å“åº”å†…å®¹</span></span><br><span class="line">          printUserData(&amp;weatherData);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      Serial.<span class="built_in">printf</span>(<span class="string">&quot;[HTTP] GET... failed, error: %s\n&quot;</span>, http.errorToString(httpCode).c_str());</span><br><span class="line">  &#125;</span><br><span class="line">  http.end();</span><br><span class="line">  delay(<span class="number">1000</span>);<span class="comment">//æ¯1sè°ƒç”¨ä¸€æ¬¡ </span></span><br><span class="line">&#125;</span><br><span class="line">  </span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @Desc è§£ææ•°æ® Jsonè§£æ</span></span><br><span class="line"><span class="comment"> * æ•°æ®æ ¼å¼å¦‚ä¸‹ï¼š</span></span><br><span class="line"><span class="comment"> * &#123;</span></span><br><span class="line"><span class="comment"> *    &quot;results&quot;: [</span></span><br><span class="line"><span class="comment"> *        &#123;</span></span><br><span class="line"><span class="comment"> *            &quot;location&quot;: &#123;</span></span><br><span class="line"><span class="comment"> *                &quot;id&quot;: &quot;WX4FBXXFKE4F&quot;,</span></span><br><span class="line"><span class="comment"> *                &quot;name&quot;: &quot;åŒ—äº¬&quot;,</span></span><br><span class="line"><span class="comment"> *                &quot;country&quot;: &quot;CN&quot;,</span></span><br><span class="line"><span class="comment"> *                &quot;path&quot;: &quot;åŒ—äº¬,åŒ—äº¬,ä¸­å›½&quot;,</span></span><br><span class="line"><span class="comment"> *                &quot;timezone&quot;: &quot;Asia/Shanghai&quot;,</span></span><br><span class="line"><span class="comment"> *                &quot;timezone_offset&quot;: &quot;+08:00&quot;</span></span><br><span class="line"><span class="comment"> *            &#125;,</span></span><br><span class="line"><span class="comment"> *            &quot;now&quot;: &#123;</span></span><br><span class="line"><span class="comment"> *                &quot;text&quot;: &quot;å¤šäº‘&quot;,</span></span><br><span class="line"><span class="comment"> *                &quot;code&quot;: &quot;4&quot;,</span></span><br><span class="line"><span class="comment"> *                &quot;temperature&quot;: &quot;23&quot;</span></span><br><span class="line"><span class="comment"> *            &#125;,</span></span><br><span class="line"><span class="comment"> *            &quot;last_update&quot;: &quot;2017-09-13T09:51:00+08:00&quot;</span></span><br><span class="line"><span class="comment"> *        &#125;</span></span><br><span class="line"><span class="comment"> *    ]</span></span><br><span class="line"><span class="comment"> *&#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">bool</span> <span class="title function_">parseUserData</span><span class="params">(String content, <span class="keyword">struct</span> WeatherData* weatherData)</span> &#123;</span><br><span class="line"><span class="comment">//    -- æ ¹æ®æˆ‘ä»¬éœ€è¦è§£æçš„æ•°æ®æ¥è®¡ç®—JSONç¼“å†²åŒºæœ€ä½³å¤§å°</span></span><br><span class="line"><span class="comment">//   å¦‚æœä½ ä½¿ç”¨StaticJsonBufferæ—¶æ‰éœ€è¦</span></span><br><span class="line"><span class="comment">//    const size_t BUFFER_SIZE = 1024;</span></span><br><span class="line"><span class="comment">//   åœ¨å †æ ˆä¸Šåˆ†é…ä¸€ä¸ªä¸´æ—¶å†…å­˜æ± </span></span><br><span class="line"><span class="comment">//    StaticJsonBuffer&lt;BUFFER_SIZE&gt; jsonBuffer;</span></span><br><span class="line"><span class="comment">//    -- å¦‚æœå †æ ˆçš„å†…å­˜æ± å¤ªå¤§ï¼Œä½¿ç”¨ DynamicJsonBuffer jsonBuffer ä»£æ›¿</span></span><br><span class="line">  DynamicJsonBuffer jsonBuffer;</span><br><span class="line">   </span><br><span class="line">  JsonObject&amp; root = jsonBuffer.parseObject(content);</span><br><span class="line">   </span><br><span class="line">  <span class="keyword">if</span> (!root.success()) &#123;</span><br><span class="line">    DebugPrintln(<span class="string">&quot;JSON parsing failed!&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line">    </span><br><span class="line">  <span class="comment">//å¤åˆ¶æˆ‘ä»¬æ„Ÿå…´è¶£çš„å­—ç¬¦ä¸²</span></span><br><span class="line">  <span class="built_in">strcpy</span>(weatherData-&gt;city, root[<span class="string">&quot;results&quot;</span>][<span class="number">0</span>][<span class="string">&quot;location&quot;</span>][<span class="string">&quot;name&quot;</span>]);</span><br><span class="line">  <span class="built_in">strcpy</span>(weatherData-&gt;weather, root[<span class="string">&quot;results&quot;</span>][<span class="number">0</span>][<span class="string">&quot;now&quot;</span>][<span class="string">&quot;text&quot;</span>]);</span><br><span class="line">  <span class="built_in">strcpy</span>(weatherData-&gt;temp, root[<span class="string">&quot;results&quot;</span>][<span class="number">0</span>][<span class="string">&quot;now&quot;</span>][<span class="string">&quot;temperature&quot;</span>]);</span><br><span class="line">  <span class="built_in">strcpy</span>(weatherData-&gt;udate, root[<span class="string">&quot;results&quot;</span>][<span class="number">0</span>][<span class="string">&quot;last_update&quot;</span>]);</span><br><span class="line">  <span class="comment">//  -- è¿™ä¸æ˜¯å¼ºåˆ¶å¤åˆ¶ï¼Œä½ å¯ä»¥ä½¿ç”¨æŒ‡é’ˆï¼Œå› ä¸ºä»–ä»¬æ˜¯æŒ‡å‘â€œå†…å®¹â€ç¼“å†²åŒºå†…ï¼Œæ‰€ä»¥ä½ éœ€è¦ç¡®ä¿</span></span><br><span class="line">  <span class="comment">//   å½“ä½ è¯»å–å­—ç¬¦ä¸²æ—¶å®ƒä»åœ¨å†…å­˜ä¸­</span></span><br><span class="line">  <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line">   </span><br><span class="line"><span class="comment">// æ‰“å°ä»JSONä¸­æå–çš„æ•°æ®</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">printUserData</span><span class="params">(<span class="type">const</span> <span class="keyword">struct</span> WeatherData* weatherData)</span> &#123;</span><br><span class="line">  DebugPrintln(<span class="string">&quot;Print parsed data :&quot;</span>);</span><br><span class="line">  DebugPrint(<span class="string">&quot;City : &quot;</span>);</span><br><span class="line">  DebugPrint(weatherData-&gt;city);</span><br><span class="line">  DebugPrint(<span class="string">&quot;, \t&quot;</span>);</span><br><span class="line">  DebugPrint(<span class="string">&quot;Weather : &quot;</span>);</span><br><span class="line">  DebugPrint(weatherData-&gt;weather);</span><br><span class="line">  DebugPrint(<span class="string">&quot;,\t&quot;</span>);</span><br><span class="line">  DebugPrint(<span class="string">&quot;Temp : &quot;</span>);</span><br><span class="line">  DebugPrint(weatherData-&gt;temp);</span><br><span class="line">  DebugPrint(<span class="string">&quot; C&quot;</span>);</span><br><span class="line">  DebugPrint(<span class="string">&quot;,\t&quot;</span>);</span><br><span class="line">  DebugPrint(<span class="string">&quot;Last Updata : &quot;</span>);</span><br><span class="line">  DebugPrint(weatherData-&gt;udate);</span><br><span class="line">  DebugPrintln(<span class="string">&quot;\r\n&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="2"><li><p>æ¼”è§†å“åº”å¤´è·å–ä¿¡æ¯</p><p>è®¾ç½®äº†è·å–å››ä¸ªè¯·æ±‚å¤´çš„ä¿¡æ¯ï¼Œç„¶åé€šè¿‡headeræ–¹æ³•è·å–å®ƒä»¬çš„æ•°å€¼ï¼ˆæ¥å£é™åˆ¶ï¼Œæ— æ³•å‘æŒ¥ä½œç”¨ï¼‰</p></li></ol><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Demoï¼š</span></span><br><span class="line"><span class="comment"> *    æ¼”ç¤ºHttpè¯·æ±‚å¤©æ°”æ¥å£ä¿¡æ¯,æ¼”ç¤ºå“åº”å¤´æ“ä½œ</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ArduinoJson.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266HTTPClient.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">//ä»¥ä¸‹ä¸‰ä¸ªå®šä¹‰ä¸ºè°ƒè¯•å®šä¹‰</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DebugBegin(baud_rate)    Serial.begin(baud_rate)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DebugPrintln(message)    Serial.println(message)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DebugPrint(message)    Serial.print(message)</span></span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* AP_SSID     = <span class="string">&quot;XU-ChinaNet&quot;</span>;         <span class="comment">// XXXXXX -- ä½¿ç”¨æ—¶è¯·ä¿®æ”¹ä¸ºå½“å‰ä½ çš„ wifi ssid</span></span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* AP_PSK = <span class="string">&quot;15358228063&quot;</span>;         <span class="comment">// XXXXXX -- ä½¿ç”¨æ—¶è¯·ä¿®æ”¹ä¸ºå½“å‰ä½ çš„ wifi å¯†ç </span></span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* HOST = <span class="string">&quot;http://api.seniverse.com&quot;</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* APIKEY = <span class="string">&quot;&quot;</span>;        <span class="comment">//API KEY</span></span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* CITY = <span class="string">&quot;yancheng&quot;</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* LANGUAGE = <span class="string">&quot;zh-Hans&quot;</span>;<span class="comment">//zh-Hans ç®€ä½“ä¸­æ–‡  ä¼šæ˜¾ç¤ºä¹±ç </span></span><br><span class="line"><span class="type">const</span> <span class="type">char</span> *keys[] = &#123;<span class="string">&quot;Content-Length&quot;</span>,<span class="string">&quot;Content-Type&quot;</span>,<span class="string">&quot;Connection&quot;</span>,<span class="string">&quot;Date&quot;</span>&#125;;<span class="comment">//éœ€è¦æ”¶é›†çš„å“åº”å¤´çš„ä¿¡æ¯</span></span><br><span class="line">  </span><br><span class="line"><span class="type">const</span> <span class="type">unsigned</span> <span class="type">long</span> BAUD_RATE = <span class="number">115200</span>;                   <span class="comment">// serial connection speed</span></span><br><span class="line"><span class="type">const</span> <span class="type">unsigned</span> <span class="type">long</span> HTTP_TIMEOUT = <span class="number">5000</span>;               <span class="comment">// max respone time from server;</span></span><br><span class="line"></span><br><span class="line">WiFiClient client;</span><br><span class="line">HTTPClient http;</span><br><span class="line">String GetUrl;</span><br><span class="line">String response;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="comment">// put your setup code here, to run once:</span></span><br><span class="line">  WiFi.mode(WIFI_STA);     <span class="comment">//è®¾ç½®esp8266 å·¥ä½œæ¨¡å¼</span></span><br><span class="line">  DebugBegin(BAUD_RATE);</span><br><span class="line">  DebugPrint(<span class="string">&quot;Connecting to &quot;</span>);<span class="comment">//å†™å‡ å¥æç¤ºï¼Œå“ˆå“ˆ</span></span><br><span class="line">  DebugPrintln(AP_SSID);</span><br><span class="line">  WiFi.begin(AP_SSID, AP_PSK);   <span class="comment">//è¿æ¥wifi</span></span><br><span class="line">  WiFi.setAutoConnect(<span class="literal">true</span>);</span><br><span class="line">  <span class="keyword">while</span> (WiFi.status() != WL_CONNECTED) &#123;</span><br><span class="line">    <span class="comment">//è¿™ä¸ªå‡½æ•°æ˜¯wifiè¿æ¥çŠ¶æ€ï¼Œè¿”å›wifié“¾æ¥çŠ¶æ€</span></span><br><span class="line">    delay(<span class="number">500</span>);</span><br><span class="line">    DebugPrint(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  DebugPrintln(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  DebugPrintln(<span class="string">&quot;WiFi connected&quot;</span>);</span><br><span class="line">  DebugPrint(<span class="string">&quot;IP address: &quot;</span>);</span><br><span class="line">  DebugPrintln(WiFi.localIP());</span><br><span class="line">  <span class="comment">//æ‹¼æ¥getè¯·æ±‚url  åšå“¥åé¢è€ƒè™‘çœ‹çœ‹æ˜¯å¦å¯ä»¥å°è£…ä¸€ä¸ªæ–¹æ³•æ¥ç”¨ç”¨ ä¸éœ€è¦è‡ªå·±ä¸€ä¸ªä¸ªæ‹¼è£…è¿™ä¸ªurl</span></span><br><span class="line">  GetUrl = String(HOST) + <span class="string">&quot;/v3/weather/now.json?key=&quot;</span>;</span><br><span class="line">  GetUrl += APIKEY;</span><br><span class="line">  GetUrl += <span class="string">&quot;&amp;location=&quot;</span>;</span><br><span class="line">  GetUrl += CITY;</span><br><span class="line">  GetUrl += <span class="string">&quot;&amp;language=&quot;</span>;</span><br><span class="line">  GetUrl += LANGUAGE;</span><br><span class="line">  <span class="comment">//è®¾ç½®è¶…æ—¶</span></span><br><span class="line">  http.setTimeout(HTTP_TIMEOUT);</span><br><span class="line">  <span class="comment">//è®¾ç½®è¯·æ±‚url</span></span><br><span class="line">  http.begin(client,GetUrl);</span><br><span class="line">  <span class="comment">//ä»¥ä¸‹ä¸ºè®¾ç½®ä¸€äº›å¤´  å…¶å®æ²¡ä»€ä¹ˆç”¨ æœ€é‡è¦æ˜¯åç«¯æœåŠ¡å™¨æ”¯æŒ</span></span><br><span class="line">  http.setUserAgent(<span class="string">&quot;esp8266&quot;</span>);<span class="comment">//ç”¨æˆ·ä»£ç†ç‰ˆæœ¬</span></span><br><span class="line">  http.setAuthorization(<span class="string">&quot;esp8266&quot;</span>,<span class="string">&quot;boge&quot;</span>);<span class="comment">//ç”¨æˆ·æ ¡éªŒä¿¡æ¯</span></span><br><span class="line">  http.addHeader(<span class="string">&quot;myname&quot;</span>,<span class="string">&quot;cainiaobo&quot;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">//è®¾ç½®è·å–å“åº”å¤´çš„ä¿¡æ¯</span></span><br><span class="line">  http.collectHeaders(keys,<span class="number">4</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="comment">//å¿ƒçŸ¥å¤©æ°”  å‘é€http  getè¯·æ±‚</span></span><br><span class="line">  <span class="type">int</span> httpCode = http.GET();</span><br><span class="line">  <span class="keyword">if</span> (httpCode &gt; <span class="number">0</span>) &#123;</span><br><span class="line">      Serial.<span class="built_in">printf</span>(<span class="string">&quot;[HTTP] GET... code: %d\n&quot;</span>, httpCode);</span><br><span class="line">      <span class="comment">//åˆ¤æ–­è¯·æ±‚æ˜¯å¦æˆåŠŸ</span></span><br><span class="line">      <span class="keyword">if</span> (httpCode == HTTP_CODE_OK) &#123;</span><br><span class="line">        <span class="comment">//è¯»å–å“åº”å†…å®¹</span></span><br><span class="line">        response = http.getString();</span><br><span class="line">        DebugPrintln(<span class="string">&quot;Get the data from Internet!&quot;</span>);</span><br><span class="line">        DebugPrintln(response);</span><br><span class="line">        DebugPrintln(String(<span class="string">&quot;Content-Length:&quot;</span>)+ http.header(<span class="string">&quot;Content-Length&quot;</span>));</span><br><span class="line">        DebugPrintln(String(<span class="string">&quot;Content-Type:&quot;</span>)+ http.header(<span class="string">&quot;Content-Type&quot;</span>));</span><br><span class="line">        DebugPrintln(String(<span class="string">&quot;Connection:&quot;</span>)+ http.header(<span class="string">&quot;Connection&quot;</span>));</span><br><span class="line">        DebugPrintln(String(<span class="string">&quot;Date:&quot;</span>)+ http.header(<span class="string">&quot;Date&quot;</span>));</span><br><span class="line">      &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      Serial.<span class="built_in">printf</span>(<span class="string">&quot;[HTTP] GET... failed, error: %s\n&quot;</span>, http.errorToString(httpCode).c_str());</span><br><span class="line">  &#125;</span><br><span class="line">  http.end();</span><br><span class="line">  delay(<span class="number">1000</span>);<span class="comment">//æ¯1sè°ƒç”¨ä¸€æ¬¡ </span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="14ã€UDPæœåŠ¡"><a href="#14ã€UDPæœåŠ¡" class="headerlink" title="14ã€UDPæœåŠ¡"></a>14ã€UDPæœåŠ¡</h1><h2 id="1ã€UDP"><a href="#1ã€UDP" class="headerlink" title="1ã€UDP"></a>1ã€UDP</h2><p>UDPï¼ˆUser Datagram Protocolï¼‰ä¸€ç§æ— è¿æ¥ã€ä¸å¯é çš„åè®®ï¼ˆå¯èƒ½ä¼šä¸¢åŒ…ï¼‰ï¼Œ</p><p>ç›¸å¯¹äºTCPè€Œè¨€ï¼š</p><ul><li><p>UDPé¢å‘æ— è¿æ¥çš„ï¼Œä¸éœ€å»ºç«‹è¿æ¥ï¼ˆTCPæ˜¯é¢å‘è¿æ¥çš„ï¼‰</p></li><li><p>UDPå°½åŠ›åšåˆ°å¯é ï¼Œä½†ä¸ç»å¯¹å¯é ï¼ˆTCPæ— å·®é”™ã€ä¸ä¸¢å¤±ã€ä¸é‡å¤ä¸”æŒ‰åºåˆ°è¾¾ï¼‰</p></li><li><p>UDPè¾ƒå¥½å®æ—¶æ€§ï¼Œæ•ˆç‡æ¯”TCPé«˜</p></li><li><p>UDPæ”¯æŒä¸€å¯¹ä¸€ï¼Œä¸€å¯¹å¤šï¼Œå¤šå¯¹ä¸€å’Œå¤šå¯¹å¤šçš„äº¤äº’é€šä¿¡ï¼ˆTCPç‚¹åˆ°ç‚¹ï¼‰</p></li><li><p>UDPå¯¹ç³»ç»Ÿèµ„æºè¦æ±‚è¾ƒå°‘ï¼ˆTCPå¤šï¼‰</p></li></ul><h2 id="2ã€åº“å’Œç¤ºä¾‹"><a href="#2ã€åº“å’Œç¤ºä¾‹" class="headerlink" title="2ã€åº“å’Œç¤ºä¾‹"></a>2ã€åº“å’Œç¤ºä¾‹</h2><p><a href="https://imgtu.com/i/f31s6s"><img src="https://z3.ax1x.com/2021/08/09/f31s6s.png" class="lazyload placeholder" data-srcset="https://z3.ax1x.com/2021/08/09/f31s6s.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="f31s6s.png"></a></p><ol><li>é€šè¿‡UDPæ”¶å‘æ•°æ®</li></ol><p>ESP8266ä½œä¸ºUDPæœåŠ¡ç«¯ï¼ŒæŠŠç”µè„‘UDPå®¢æˆ·ç«¯å‘è¿‡æ¥çš„æ•°æ®æ‰“å°åˆ°ä¸²å£è°ƒè¯•å™¨ï¼Œå¹¶å›å¤åº”ç­”æ¶ˆæ¯ï¼ˆä½¿ç”¨Packet Senderè½¯ä»¶å‘é€UDPæ•°æ®ï¼‰</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;WiFiUdp.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* ssid = <span class="string">&quot;XU-ChinaNet&quot;</span>;<span class="comment">//wifiè´¦å·</span></span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* password = <span class="string">&quot;15358228063&quot;</span>;<span class="comment">//wifiå¯†ç </span></span><br><span class="line"></span><br><span class="line">WiFiUDP Udp;</span><br><span class="line"><span class="type">unsigned</span> <span class="type">int</span> localUdpPort = <span class="number">4210</span>;  <span class="comment">// æœ¬åœ°ç›‘å¬ç«¯å£</span></span><br><span class="line"><span class="type">char</span> incomingPacket[<span class="number">255</span>];  <span class="comment">// å­˜å‚¨Udpå®¢æˆ·ç«¯å‘è¿‡æ¥çš„æ•°æ®</span></span><br><span class="line"><span class="type">char</span>  replyPacket[] = <span class="string">&quot;Hi there! Got the message :-)&quot;</span>;  <span class="comment">// åº”ç­”ä¿¡æ¯</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  Serial.begin(<span class="number">115200</span>);</span><br><span class="line">  Serial.println();</span><br><span class="line"></span><br><span class="line">  Serial.<span class="built_in">printf</span>(<span class="string">&quot;Connecting to %s &quot;</span>, ssid);</span><br><span class="line">  WiFi.begin(ssid, password);</span><br><span class="line">  <span class="keyword">while</span> (WiFi.status() != WL_CONNECTED)</span><br><span class="line">  &#123;</span><br><span class="line">    delay(<span class="number">500</span>);</span><br><span class="line">    Serial.print(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  Serial.println(<span class="string">&quot; connected&quot;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">//å¯åŠ¨Udpç›‘å¬æœåŠ¡</span></span><br><span class="line">  Udp.begin(localUdpPort);</span><br><span class="line">  <span class="comment">//æ‰“å°æœ¬åœ°ipåœ°å€ï¼Œudp clientç«¯ä¼šä½¿ç”¨åˆ°</span></span><br><span class="line">  Serial.<span class="built_in">printf</span>(<span class="string">&quot;Now listening at IP %s, UDP port %d\n&quot;</span>, WiFi.localIP().toString().c_str(), localUdpPort);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//è§£æUdpæ•°æ®åŒ…</span></span><br><span class="line">  <span class="type">int</span> packetSize = Udp.parsePacket();</span><br><span class="line">  <span class="keyword">if</span> (packetSize)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">// æ”¶åˆ°Udpæ•°æ®åŒ…</span></span><br><span class="line">    Serial.<span class="built_in">printf</span>(<span class="string">&quot;Received %d bytes from %s, port %d\n&quot;</span>, packetSize, Udp.remoteIP().toString().c_str(), Udp.remotePort());</span><br><span class="line">    <span class="comment">// è¯»å–Udpæ•°æ®åŒ…</span></span><br><span class="line">    <span class="type">int</span> len = Udp.read(incomingPacket, <span class="number">255</span>);</span><br><span class="line">    <span class="keyword">if</span> (len &gt; <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">      incomingPacket[len] = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//å‘Dä¸²å£è°ƒè¯•å™¨æ‰“å°ä¿¡æ¯</span></span><br><span class="line">    Serial.<span class="built_in">printf</span>(<span class="string">&quot;UP packet contents: %s\n&quot;</span>, incomingPacket);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å¾€udp è¿œç«¯å‘é€åº”ç­”ä¿¡æ¯</span></span><br><span class="line">    Udp.beginPacket(Udp.remoteIP(), Udp.remotePort());</span><br><span class="line">    Udp.write(replyPacket);</span><br><span class="line">    Udp.endPacket();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="2"><li>é€šè¿‡UDPæ§åˆ¶LED</li></ol><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;WiFiUdp.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">char</span> *ssid = <span class="string">&quot;XU-ChinaNet&quot;</span>;     <span class="comment">//wifiåç§°</span></span><br><span class="line"><span class="type">const</span> <span class="type">char</span> *password = <span class="string">&quot;15358228063&quot;</span>; <span class="comment">//wifiå¯†ç </span></span><br><span class="line"></span><br><span class="line">WiFiUDP Udp;</span><br><span class="line"><span class="type">unsigned</span> <span class="type">int</span> localUdpPort = <span class="number">4210</span>; <span class="comment">// æœ¬åœ°ç«¯å£å·</span></span><br><span class="line"><span class="type">char</span> incomingPacket[<span class="number">255</span>];         <span class="comment">// æ¥æ”¶ç¼“å†²åŒº</span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//ä»¥ä¸‹ä¸ºåŸºæœ¬åŠŸèƒ½åˆå§‹åŒ–ï¼Œåˆå§‹åŒ–ä¸²å£å’Œç½‘ç»œå’ŒLED</span></span><br><span class="line">  pinMode(LED_BUILTIN, OUTPUT);</span><br><span class="line">  Serial.begin(<span class="number">115200</span>);</span><br><span class="line">  Serial.println();</span><br><span class="line">  Serial.<span class="built_in">printf</span>(<span class="string">&quot;Connecting to %s &quot;</span>, ssid);</span><br><span class="line">  WiFi.mode(WIFI_STA);</span><br><span class="line">  WiFi.begin(ssid, password);</span><br><span class="line">  <span class="keyword">while</span> (WiFi.status() != WL_CONNECTED)</span><br><span class="line">  &#123;</span><br><span class="line">    delay(<span class="number">500</span>);</span><br><span class="line">    Serial.print(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  Serial.println(<span class="string">&quot; connected&quot;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">//ä»¥ä¸‹å¼€å¯UDPç›‘å¬å¹¶æ‰“å°è¾“å‡ºä¿¡æ¯</span></span><br><span class="line">  Udp.begin(localUdpPort);</span><br><span class="line">  Serial.<span class="built_in">printf</span>(<span class="string">&quot;Now listening at IP %s, UDP port %d\n&quot;</span>, WiFi.localIP().toString().c_str(), localUdpPort);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> packetSize = Udp.parsePacket(); <span class="comment">//è·å–å½“å‰é˜Ÿé¦–æ•°æ®åŒ…é•¿åº¦</span></span><br><span class="line">  <span class="keyword">if</span> (packetSize)  <span class="comment">// æœ‰æ•°æ®å¯ç”¨</span></span><br><span class="line">  &#123;</span><br><span class="line">    Serial.<span class="built_in">printf</span>(<span class="string">&quot;Received %d bytes from %s, port %d\n&quot;</span>, packetSize, Udp.remoteIP().toString().c_str(), Udp.remotePort());</span><br><span class="line">    <span class="type">int</span> len = Udp.read(incomingPacket, <span class="number">255</span>); <span class="comment">// è¯»å–æ•°æ®åˆ°incomingPacket</span></span><br><span class="line">    <span class="keyword">if</span> (len &gt; <span class="number">0</span>)                             <span class="comment">// å¦‚æœæ­£ç¡®è¯»å–</span></span><br><span class="line">    &#123;</span><br><span class="line">      incomingPacket[len] = <span class="number">0</span>; <span class="comment">//æœ«å°¾è¡¥0ç»“æŸå­—ç¬¦ä¸²</span></span><br><span class="line">      Serial.<span class="built_in">printf</span>(<span class="string">&quot;UDP packet contents: %s\n&quot;</span>, incomingPacket);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (<span class="built_in">strcmp</span>(incomingPacket, <span class="string">&quot;LED_OFF&quot;</span>) == <span class="number">0</span>) <span class="comment">// å‘½ä»¤LED_OFF</span></span><br><span class="line">      &#123;</span><br><span class="line">        digitalWrite(LED_BUILTIN, HIGH); <span class="comment">// ç†„ç­LED</span></span><br><span class="line">        sendCallBack(<span class="string">&quot;LED has been turn off&quot;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">strcmp</span>(incomingPacket, <span class="string">&quot;LED_ON&quot;</span>) == <span class="number">0</span>) <span class="comment">// å¦‚æœæ”¶åˆ°LED_ON</span></span><br><span class="line">      &#123;</span><br><span class="line">        digitalWrite(LED_BUILTIN, LOW); <span class="comment">// ç‚¹äº®LED</span></span><br><span class="line">        sendCallBack(<span class="string">&quot;LED has been turn on&quot;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span> <span class="comment">// å¦‚æœéæŒ‡å®šæ¶ˆæ¯</span></span><br><span class="line">      &#123;</span><br><span class="line">        sendCallBack(<span class="string">&quot;Command Error!&quot;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å‘é€å“åº”ä¿¡æ¯</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">sendCallBack</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *buffer)</span>&#123;</span><br><span class="line">   Udp.beginPacket(Udp.remoteIP(), Udp.remotePort());</span><br><span class="line">   Udp.write(buffer); <span class="comment">//å›å¤å†…å®¹</span></span><br><span class="line">   Udp.endPacket(); </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="15ã€WebServerâ€“ESP8266WebServeråº“"><a href="#15ã€WebServerâ€“ESP8266WebServeråº“" class="headerlink" title="15ã€WebServerâ€“ESP8266WebServeråº“"></a>15ã€WebServerâ€“ESP8266WebServeråº“</h1><p><a href="https://imgtu.com/i/f8kYYq"><img src="https://z3.ax1x.com/2021/08/09/f8kYYq.png" class="lazyload placeholder" data-srcset="https://z3.ax1x.com/2021/08/09/f8kYYq.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="f8kYYq.png"></a></p><p><strong>ç¤ºä¾‹ï¼š</strong></p><ol><li>æ¼”ç¤ºwebserveråŸºç¡€åŠŸèƒ½ï¼Œwifiæ¨¡å—è¿æ¥ä¸Šçƒ­ç‚¹åï¼Œåœ¨PCæµè§ˆå™¨ä¸Šè¾“å…¥serverip+urlè®¿é—®</li></ol><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Demoï¼š</span></span><br><span class="line"><span class="comment"> *    æ¼”ç¤ºwebserveråŸºç¡€åŠŸèƒ½</span></span><br><span class="line"><span class="comment"> *    (å½“wifiæ¨¡å—è¿æ¥ä¸Šapä¹‹åï¼Œåœ¨pcæµè§ˆå™¨ä¸­è¾“å…¥ip+uriæ¥è®¿é—®)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WebServer.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="comment">//ä»¥ä¸‹ä¸‰ä¸ªå®šä¹‰ä¸ºè°ƒè¯•å®šä¹‰</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DebugBegin(baud_rate)    Serial.begin(baud_rate)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DebugPrintln(message)    Serial.println(message)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DebugPrint(message)    Serial.print(message)</span></span><br><span class="line"> </span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* AP_SSID     = <span class="string">&quot;TP-LINK_5344&quot;</span>;         <span class="comment">// XXXXXX -- ä½¿ç”¨æ—¶è¯·ä¿®æ”¹ä¸ºå½“å‰ä½ çš„ wifi ssid</span></span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* AP_PSK = <span class="string">&quot;6206908you11011010&quot;</span>;         <span class="comment">// XXXXXX -- ä½¿ç”¨æ—¶è¯·ä¿®æ”¹ä¸ºå½“å‰ä½ çš„ wifi å¯†ç </span></span><br><span class="line"><span class="type">const</span> <span class="type">unsigned</span> <span class="type">long</span> BAUD_RATE = <span class="number">115200</span>;                   <span class="comment">// serial connection speed</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">//å£°æ˜ä¸€ä¸‹å‡½æ•°</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">initBasic</span><span class="params">(<span class="type">void</span>)</span>;</span><br><span class="line"><span class="type">void</span> <span class="title function_">initWifi</span><span class="params">(<span class="type">void</span>)</span>;</span><br><span class="line"><span class="type">void</span> <span class="title function_">initWebServer</span><span class="params">(<span class="type">void</span>)</span>;</span><br><span class="line"> </span><br><span class="line">ESP8266WebServer <span class="title function_">server</span><span class="params">(<span class="number">80</span>)</span>;<span class="comment">//åˆ›å»ºä¸€ä¸ªwebserver</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å¤„ç†æ ¹ç›®å½•uriè¯·æ±‚</span></span><br><span class="line"><span class="comment"> * uri:http://server_ip/</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">handleRoot</span><span class="params">()</span> &#123;</span><br><span class="line">  server.send(<span class="number">200</span>, <span class="string">&quot;text/plain&quot;</span>, <span class="string">&quot;hello from esp8266!&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å¤„ç†æ— æ•ˆuri</span></span><br><span class="line"><span class="comment"> * uri:http://server_ip/xxxx</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">handleNotFound</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="comment">//æ‰“å°æ— æ•ˆuriçš„ä¿¡æ¯ åŒ…æ‹¬è¯·æ±‚æ–¹å¼ è¯·æ±‚å‚æ•°</span></span><br><span class="line">  String message = <span class="string">&quot;File Not Found\n\n&quot;</span>;</span><br><span class="line">  message += <span class="string">&quot;URI: &quot;</span>;</span><br><span class="line">  message += server.uri();</span><br><span class="line">  message += <span class="string">&quot;\nMethod: &quot;</span>;</span><br><span class="line">  message += (server.method() == HTTP_GET) ? <span class="string">&quot;GET&quot;</span> : <span class="string">&quot;POST&quot;</span>;</span><br><span class="line">  message += <span class="string">&quot;\nArguments: &quot;</span>;</span><br><span class="line">  message += server.args();</span><br><span class="line">  message += <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="type">uint8_t</span> i = <span class="number">0</span>; i &lt; server.args(); i++) &#123;</span><br><span class="line">    message += <span class="string">&quot; &quot;</span> + server.argName(i) + <span class="string">&quot;: &quot;</span> + server.arg(i) + <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  server.send(<span class="number">404</span>, <span class="string">&quot;text/plain&quot;</span>, message);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">(<span class="type">void</span>)</span> &#123;</span><br><span class="line">  initBasic();</span><br><span class="line">  initWifi();</span><br><span class="line">  initWebServer();</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åˆå§‹åŒ–åŸºç¡€åŠŸèƒ½ï¼šæ³¢ç‰¹ç‡</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">initBasic</span><span class="params">()</span>&#123;</span><br><span class="line">  DebugBegin(BAUD_RATE);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åˆå§‹åŒ–wifiæ¨¡å—ï¼šå·¥ä½œæ¨¡å¼ è¿æ¥ç½‘ç»œ</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">initWifi</span><span class="params">()</span>&#123;</span><br><span class="line">  WiFi.mode(WIFI_STA);</span><br><span class="line">  WiFi.begin(AP_SSID, AP_PSK);</span><br><span class="line">  DebugPrintln(<span class="string">&quot;&quot;</span>);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// Wait for connection</span></span><br><span class="line">  <span class="keyword">while</span> (WiFi.status() != WL_CONNECTED) &#123;</span><br><span class="line">    delay(<span class="number">500</span>);</span><br><span class="line">    DebugPrint(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  DebugPrintln(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  DebugPrint(<span class="string">&quot;Connected to &quot;</span>);</span><br><span class="line">  DebugPrintln(AP_SSID);</span><br><span class="line">  DebugPrint(<span class="string">&quot;IP address: &quot;</span>);</span><br><span class="line">  DebugPrintln(WiFi.localIP());</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åˆå§‹åŒ–webserver</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">initWebServer</span><span class="params">()</span>&#123;</span><br><span class="line">  <span class="comment">//ä»¥ä¸‹é…ç½®uriå¯¹åº”çš„handler</span></span><br><span class="line">  server.on(<span class="string">&quot;/&quot;</span>, handleRoot);</span><br><span class="line"> </span><br><span class="line">  server.on(<span class="string">&quot;/inline&quot;</span>, []() &#123;</span><br><span class="line">    server.send(<span class="number">200</span>, <span class="string">&quot;text/plain&quot;</span>, <span class="string">&quot;this works as well&quot;</span>);</span><br><span class="line">  &#125;);</span><br><span class="line"> </span><br><span class="line">  server.onNotFound(handleNotFound);</span><br><span class="line">  <span class="comment">//å¯åŠ¨webserver</span></span><br><span class="line">  server.begin();</span><br><span class="line">  DebugPrintln(<span class="string">&quot;HTTP server started&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">(<span class="type">void</span>)</span> &#123;</span><br><span class="line">  server.handleClient();</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ol start="2"><li>æ¼”ç¤ºwebserverè¿”å›htmlåŠŸèƒ½</li></ol><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Demoï¼š</span></span><br><span class="line"><span class="comment"> *    æ¼”ç¤ºwebserver htmlåŠŸèƒ½</span></span><br><span class="line"><span class="comment"> *    (å½“wifiæ¨¡å—è¿æ¥ä¸Šapä¹‹åï¼Œåœ¨pcæµè§ˆå™¨ä¸­è¾“å…¥ip+uriæ¥è®¿é—®)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WebServer.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="comment">//ä»¥ä¸‹ä¸‰ä¸ªå®šä¹‰ä¸ºè°ƒè¯•å®šä¹‰</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DebugBegin(baud_rate)    Serial.begin(baud_rate)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DebugPrintln(message)    Serial.println(message)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DebugPrint(message)    Serial.print(message)</span></span><br><span class="line"> </span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* AP_SSID     = <span class="string">&quot;XU-ChinaNet&quot;</span>;         <span class="comment">// XXXXXX -- ä½¿ç”¨æ—¶è¯·ä¿®æ”¹ä¸ºå½“å‰ä½ çš„ wifi ssid</span></span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* AP_PSK = <span class="string">&quot;15358228063&quot;</span>;         <span class="comment">// XXXXXX -- ä½¿ç”¨æ—¶è¯·ä¿®æ”¹ä¸ºå½“å‰ä½ çš„ wifi å¯†ç </span></span><br><span class="line"><span class="type">const</span> <span class="type">unsigned</span> <span class="type">long</span> BAUD_RATE = <span class="number">115200</span>;                   <span class="comment">// serial connection speed</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">//å£°æ˜ä¸€ä¸‹å‡½æ•°</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">initBasic</span><span class="params">(<span class="type">void</span>)</span>;</span><br><span class="line"><span class="type">void</span> <span class="title function_">initWifi</span><span class="params">(<span class="type">void</span>)</span>;</span><br><span class="line"><span class="type">void</span> <span class="title function_">initWebServer</span><span class="params">(<span class="type">void</span>)</span>;</span><br><span class="line"> </span><br><span class="line">ESP8266WebServer <span class="title function_">server</span><span class="params">(<span class="number">80</span>)</span>;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å¤„ç†æ ¹ç›®å½•uriè¯·æ±‚</span></span><br><span class="line"><span class="comment"> * uri:http://server_ip/</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">handleRoot</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="type">char</span> temp[<span class="number">400</span>];</span><br><span class="line">  <span class="type">int</span> sec = millis() / <span class="number">1000</span>;</span><br><span class="line">  <span class="type">int</span> min = sec / <span class="number">60</span>;</span><br><span class="line">  <span class="type">int</span> hr = min / <span class="number">60</span>;</span><br><span class="line"> </span><br><span class="line">  <span class="built_in">snprintf</span>(temp, <span class="number">400</span>,</span><br><span class="line"> </span><br><span class="line">           <span class="string">&quot;&lt;html&gt;\</span></span><br><span class="line"><span class="string">  &lt;head&gt;\</span></span><br><span class="line"><span class="string">    &lt;meta http-equiv=&#x27;refresh&#x27; content=&#x27;5&#x27;/&gt;\</span></span><br><span class="line"><span class="string">    &lt;title&gt;ESP8266 Demo&lt;/title&gt;\</span></span><br><span class="line"><span class="string">    &lt;style&gt;\</span></span><br><span class="line"><span class="string">      body &#123; background-color: #cccccc; font-family: Arial, Helvetica, Sans-Serif; Color: #000088; &#125;\</span></span><br><span class="line"><span class="string">    &lt;/style&gt;\</span></span><br><span class="line"><span class="string">  &lt;/head&gt;\</span></span><br><span class="line"><span class="string">  &lt;body&gt;\</span></span><br><span class="line"><span class="string">    &lt;h1&gt;Hello from ESP8266!&lt;/h1&gt;\</span></span><br><span class="line"><span class="string">    &lt;p&gt;Uptime: %02d:%02d:%02d&lt;/p&gt;\</span></span><br><span class="line"><span class="string">    &lt;img src=\&quot;/test.svg\&quot; /&gt;\</span></span><br><span class="line"><span class="string">  &lt;/body&gt;\</span></span><br><span class="line"><span class="string">&lt;/html&gt;&quot;</span>,</span><br><span class="line"> </span><br><span class="line">           hr, min % <span class="number">60</span>, sec % <span class="number">60</span></span><br><span class="line">          );</span><br><span class="line">  server.send(<span class="number">200</span>, <span class="string">&quot;text/html&quot;</span>, temp);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å¤„ç†æ— æ•ˆuri</span></span><br><span class="line"><span class="comment"> * uri:http://server_ip/xxxx</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">handleNotFound</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="comment">//æ‰“å°æ— æ•ˆuriçš„ä¿¡æ¯ åŒ…æ‹¬è¯·æ±‚æ–¹å¼ è¯·æ±‚å‚æ•°</span></span><br><span class="line">  String message = <span class="string">&quot;File Not Found\n\n&quot;</span>;</span><br><span class="line">  message += <span class="string">&quot;URI: &quot;</span>;</span><br><span class="line">  message += server.uri();</span><br><span class="line">  message += <span class="string">&quot;\nMethod: &quot;</span>;</span><br><span class="line">  message += (server.method() == HTTP_GET) ? <span class="string">&quot;GET&quot;</span> : <span class="string">&quot;POST&quot;</span>;</span><br><span class="line">  message += <span class="string">&quot;\nArguments: &quot;</span>;</span><br><span class="line">  message += server.args();</span><br><span class="line">  message += <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="type">uint8_t</span> i = <span class="number">0</span>; i &lt; server.args(); i++) &#123;</span><br><span class="line">    message += <span class="string">&quot; &quot;</span> + server.argName(i) + <span class="string">&quot;: &quot;</span> + server.arg(i) + <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  server.send(<span class="number">404</span>, <span class="string">&quot;text/plain&quot;</span>, message);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">(<span class="type">void</span>)</span> &#123;</span><br><span class="line">  initBasic();</span><br><span class="line">  initWifi();</span><br><span class="line">  initWebServer();</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">(<span class="type">void</span>)</span> &#123;</span><br><span class="line">  server.handleClient();</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åˆå§‹åŒ–åŸºç¡€åŠŸèƒ½ï¼šæ³¢ç‰¹ç‡</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">initBasic</span><span class="params">()</span>&#123;</span><br><span class="line">  DebugBegin(BAUD_RATE);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åˆå§‹åŒ–wifiæ¨¡å—ï¼šå·¥ä½œæ¨¡å¼ è¿æ¥ç½‘ç»œ</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">initWifi</span><span class="params">()</span>&#123;</span><br><span class="line">  WiFi.mode(WIFI_STA);</span><br><span class="line">  WiFi.begin(AP_SSID, AP_PSK);</span><br><span class="line">  DebugPrintln(<span class="string">&quot;&quot;</span>);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// Wait for connection</span></span><br><span class="line">  <span class="keyword">while</span> (WiFi.status() != WL_CONNECTED) &#123;</span><br><span class="line">    delay(<span class="number">500</span>);</span><br><span class="line">    DebugPrint(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  DebugPrintln(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  DebugPrint(<span class="string">&quot;Connected to &quot;</span>);</span><br><span class="line">  DebugPrintln(AP_SSID);</span><br><span class="line">  DebugPrint(<span class="string">&quot;IP address: &quot;</span>);</span><br><span class="line">  DebugPrintln(WiFi.localIP());</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åˆå§‹åŒ–webserver</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">initWebServer</span><span class="params">()</span>&#123;</span><br><span class="line">  <span class="comment">//ä»¥ä¸‹é…ç½®uriå¯¹åº”çš„handler</span></span><br><span class="line">  server.on(<span class="string">&quot;/&quot;</span>, handleRoot);</span><br><span class="line"> </span><br><span class="line">  server.on(<span class="string">&quot;/inline&quot;</span>, []() &#123;</span><br><span class="line">    server.send(<span class="number">200</span>, <span class="string">&quot;text/plain&quot;</span>, <span class="string">&quot;this works as well&quot;</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">  server.on(<span class="string">&quot;/test.svg&quot;</span>, drawGraph);</span><br><span class="line">  server.onNotFound(handleNotFound);</span><br><span class="line">  <span class="comment">//å¯åŠ¨webserver</span></span><br><span class="line">  server.begin();</span><br><span class="line">  DebugPrintln(<span class="string">&quot;HTTP server started&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ç”»å›¾</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">drawGraph</span><span class="params">()</span> &#123;</span><br><span class="line">  String out = <span class="string">&quot;&quot;</span>;</span><br><span class="line">  <span class="type">char</span> temp[<span class="number">100</span>];</span><br><span class="line">  out += <span class="string">&quot;&lt;svg xmlns=\&quot;http://www.w3.org/2000/svg\&quot; version=\&quot;1.1\&quot; width=\&quot;400\&quot; height=\&quot;150\&quot;&gt;\n&quot;</span>;</span><br><span class="line">  out += <span class="string">&quot;&lt;rect width=\&quot;400\&quot; height=\&quot;150\&quot; fill=\&quot;rgb(250, 230, 210)\&quot; stroke-width=\&quot;1\&quot; stroke=\&quot;rgb(0, 0, 0)\&quot; /&gt;\n&quot;</span>;</span><br><span class="line">  out += <span class="string">&quot;&lt;g stroke=\&quot;black\&quot;&gt;\n&quot;</span>;</span><br><span class="line">  <span class="type">int</span> y = rand() % <span class="number">130</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="type">int</span> x = <span class="number">10</span>; x &lt; <span class="number">390</span>; x += <span class="number">10</span>) &#123;</span><br><span class="line">    <span class="type">int</span> y2 = rand() % <span class="number">130</span>;</span><br><span class="line">    <span class="built_in">sprintf</span>(temp, <span class="string">&quot;&lt;line x1=\&quot;%d\&quot; y1=\&quot;%d\&quot; x2=\&quot;%d\&quot; y2=\&quot;%d\&quot; stroke-width=\&quot;1\&quot; /&gt;\n&quot;</span>, x, <span class="number">140</span> - y, x + <span class="number">10</span>, <span class="number">140</span> - y2);</span><br><span class="line">    out += temp;</span><br><span class="line">    y = y2;</span><br><span class="line">  &#125;</span><br><span class="line">  out += <span class="string">&quot;&lt;/g&gt;\n&lt;/svg&gt;\n&quot;</span>;</span><br><span class="line"> </span><br><span class="line">  server.send(<span class="number">200</span>, <span class="string">&quot;image/svg+xml&quot;</span>, out);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ol start="3"><li>æ¼”ç¤ºwebserveræ ¡éªŒè´¦å·å¯†ç åŠŸèƒ½ï¼ŒAutherticateè¯·æ±‚å¤´</li></ol><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Demoï¼š</span></span><br><span class="line"><span class="comment"> *    æ¼”ç¤ºwebserver authæ ¡éªŒåŠŸèƒ½</span></span><br><span class="line"><span class="comment"> *    (å½“wifiæ¨¡å—è¿æ¥ä¸Šapä¹‹åï¼Œåœ¨pcæµè§ˆå™¨ä¸­è¾“å…¥ip+uriæ¥è®¿é—®ï¼Œä¸è¿‡éœ€è¦å¸¦æ ¡éªŒè¯·æ±‚å¤´)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WebServer.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="comment">//ä»¥ä¸‹ä¸‰ä¸ªå®šä¹‰ä¸ºè°ƒè¯•å®šä¹‰</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DebugBegin(baud_rate)    Serial.begin(baud_rate)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DebugPrintln(message)    Serial.println(message)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DebugPrint(message)    Serial.print(message)</span></span><br><span class="line"> </span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* AP_SSID     = <span class="string">&quot;XU-ChinaNet&quot;</span>;         <span class="comment">// XXXXXX -- ä½¿ç”¨æ—¶è¯·ä¿®æ”¹ä¸ºå½“å‰ä½ çš„ wifi ssid</span></span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* AP_PSK = <span class="string">&quot;15358228063&quot;</span>;         <span class="comment">// XXXXXX -- ä½¿ç”¨æ—¶è¯·ä¿®æ”¹ä¸ºå½“å‰ä½ çš„ wifi å¯†ç </span></span><br><span class="line"><span class="type">const</span> <span class="type">unsigned</span> <span class="type">long</span> BAUD_RATE = <span class="number">115200</span>;                   <span class="comment">// serial connection speed</span></span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* www_username = <span class="string">&quot;admin&quot;</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* www_password = <span class="string">&quot;esp8266&quot;</span>;</span><br><span class="line"> </span><br><span class="line"><span class="comment">//å£°æ˜ä¸€ä¸‹å‡½æ•°</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">initBasic</span><span class="params">(<span class="type">void</span>)</span>;</span><br><span class="line"><span class="type">void</span> <span class="title function_">initWifi</span><span class="params">(<span class="type">void</span>)</span>;</span><br><span class="line"><span class="type">void</span> <span class="title function_">initWebServer</span><span class="params">(<span class="type">void</span>)</span>;</span><br><span class="line"> </span><br><span class="line">ESP8266WebServer <span class="title function_">server</span><span class="params">(<span class="number">80</span>)</span>;<span class="comment">//åˆ›å»ºwebserver</span></span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span> &#123;</span><br><span class="line">  initBasic();</span><br><span class="line">  initWifi();</span><br><span class="line">  initWebServer();</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span> &#123;</span><br><span class="line">  server.handleClient();</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åˆå§‹åŒ–åŸºç¡€åŠŸèƒ½ï¼šæ³¢ç‰¹ç‡</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">initBasic</span><span class="params">()</span>&#123;</span><br><span class="line">  DebugBegin(BAUD_RATE);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åˆå§‹åŒ–wifiæ¨¡å—ï¼šå·¥ä½œæ¨¡å¼ è¿æ¥ç½‘ç»œ</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">initWifi</span><span class="params">()</span>&#123;</span><br><span class="line">  WiFi.mode(WIFI_STA);</span><br><span class="line">  WiFi.begin(AP_SSID, AP_PSK);</span><br><span class="line">  DebugPrintln(<span class="string">&quot;&quot;</span>);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// Wait for connection</span></span><br><span class="line">  <span class="keyword">while</span> (WiFi.status() != WL_CONNECTED) &#123;</span><br><span class="line">    delay(<span class="number">500</span>);</span><br><span class="line">    DebugPrint(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  DebugPrintln(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  DebugPrint(<span class="string">&quot;Connected to &quot;</span>);</span><br><span class="line">  DebugPrintln(AP_SSID);</span><br><span class="line">  DebugPrint(<span class="string">&quot;IP address: &quot;</span>);</span><br><span class="line">  DebugPrintln(WiFi.localIP());</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åˆå§‹åŒ–webserver</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">initWebServer</span><span class="params">()</span>&#123;</span><br><span class="line">  <span class="comment">//ä»¥ä¸‹é…ç½®uriå¯¹åº”çš„handler</span></span><br><span class="line">  server.on(<span class="string">&quot;/&quot;</span>, []() &#123;</span><br><span class="line">    <span class="comment">//æ ¡éªŒå¸å·å’Œå¯†ç </span></span><br><span class="line">    <span class="keyword">if</span> (!server.authenticate(www_username, www_password)) &#123;</span><br><span class="line">      <span class="keyword">return</span> server.requestAuthentication();</span><br><span class="line">    &#125;</span><br><span class="line">    server.send(<span class="number">200</span>, <span class="string">&quot;text/plain&quot;</span>, <span class="string">&quot;Login OK&quot;</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">  server.begin();</span><br><span class="line"> </span><br><span class="line">  DebugPrint(<span class="string">&quot;Open http://&quot;</span>);</span><br><span class="line">  DebugPrint(WiFi.localIP());</span><br><span class="line">  DebugPrintln(<span class="string">&quot;/ in your browser to see it working&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ol start="4"><li>æ¼”ç¤ºwebserverç™»å½•åŠŸèƒ½ï¼Œhtmlç™»å½•é¡µé¢</li></ol><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Demoï¼š</span></span><br><span class="line"><span class="comment"> *    æ¼”ç¤ºwebserver authæ ¡éªŒåŠŸèƒ½</span></span><br><span class="line"><span class="comment"> *    (å½“wifiæ¨¡å—è¿æ¥ä¸Šapä¹‹åï¼Œåœ¨pcæµè§ˆå™¨ä¸­è¾“å…¥ip+uriæ¥è®¿é—®ï¼Œä¸è¿‡éœ€è¦å¸¦æ ¡éªŒè¯·æ±‚å¤´)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WebServer.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="comment">//ä»¥ä¸‹ä¸‰ä¸ªå®šä¹‰ä¸ºè°ƒè¯•å®šä¹‰</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DebugBegin(baud_rate)    Serial.begin(baud_rate)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DebugPrintln(message)    Serial.println(message)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DebugPrint(message)    Serial.print(message)</span></span><br><span class="line"> </span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* AP_SSID     = <span class="string">&quot;TP-LINK_5344&quot;</span>;         <span class="comment">// XXXXXX -- ä½¿ç”¨æ—¶è¯·ä¿®æ”¹ä¸ºå½“å‰ä½ çš„ wifi ssid</span></span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* AP_PSK = <span class="string">&quot;6206908you11011010&quot;</span>;         <span class="comment">// XXXXXX -- ä½¿ç”¨æ—¶è¯·ä¿®æ”¹ä¸ºå½“å‰ä½ çš„ wifi å¯†ç </span></span><br><span class="line"><span class="type">const</span> <span class="type">unsigned</span> <span class="type">long</span> BAUD_RATE = <span class="number">115200</span>;                   <span class="comment">// serial connection speed</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">//å£°æ˜ä¸€ä¸‹å‡½æ•°</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">initBasic</span><span class="params">(<span class="type">void</span>)</span>;</span><br><span class="line"><span class="type">void</span> <span class="title function_">initWifi</span><span class="params">(<span class="type">void</span>)</span>;</span><br><span class="line"><span class="type">void</span> <span class="title function_">initWebServer</span><span class="params">(<span class="type">void</span>)</span>;</span><br><span class="line"> </span><br><span class="line">ESP8266WebServer <span class="title function_">server</span><span class="params">(<span class="number">80</span>)</span>;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ ¡éªŒæ˜¯å¦å­˜åœ¨cookieå¤´å¹¶ä¸”cookieå¤´çš„å€¼æ˜¯æ­£ç¡®çš„</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">bool</span> <span class="title function_">is_authentified</span><span class="params">()</span> &#123;</span><br><span class="line">  DebugPrintln(<span class="string">&quot;Enter is_authentified&quot;</span>);</span><br><span class="line">  <span class="comment">//æ˜¯å¦å­˜åœ¨cookieå¤´</span></span><br><span class="line">  <span class="keyword">if</span> (server.hasHeader(<span class="string">&quot;Cookie&quot;</span>)) &#123;</span><br><span class="line">    DebugPrint(<span class="string">&quot;Found cookie: &quot;</span>);</span><br><span class="line">    <span class="comment">//è·å–cookieå¤´çš„ä¿¡æ¯</span></span><br><span class="line">    String cookie = server.header(<span class="string">&quot;Cookie&quot;</span>);</span><br><span class="line">    DebugPrintln(cookie);</span><br><span class="line">    <span class="keyword">if</span> (cookie.indexOf(<span class="string">&quot;ESPSESSIONID=1&quot;</span>) != <span class="number">-1</span>) &#123;</span><br><span class="line">      DebugPrintln(<span class="string">&quot;Authentification Successful&quot;</span>);</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  DebugPrintln(<span class="string">&quot;Authentification Failed&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å¤„ç†ç™»é™†uri</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">handleLogin</span><span class="params">()</span> &#123;</span><br><span class="line">  String msg;</span><br><span class="line">  <span class="comment">//åˆ¤æ–­æ˜¯å¦å­˜åœ¨cookieå¤´</span></span><br><span class="line">  <span class="keyword">if</span> (server.hasHeader(<span class="string">&quot;Cookie&quot;</span>)) &#123;</span><br><span class="line">    DebugPrint(<span class="string">&quot;Found cookie: &quot;</span>);</span><br><span class="line">    String cookie = server.header(<span class="string">&quot;Cookie&quot;</span>);</span><br><span class="line">    DebugPrint(cookie);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//åˆ¤æ–­æ˜¯å¦å­˜åœ¨DISCONNECTå‚æ•°</span></span><br><span class="line">  <span class="keyword">if</span> (server.hasArg(<span class="string">&quot;DISCONNECT&quot;</span>)) &#123;</span><br><span class="line">    DebugPrintln(<span class="string">&quot;Disconnection&quot;</span>);</span><br><span class="line">    server.sendHeader(<span class="string">&quot;Location&quot;</span>, <span class="string">&quot;/login&quot;</span>);</span><br><span class="line">    server.sendHeader(<span class="string">&quot;Cache-Control&quot;</span>, <span class="string">&quot;no-cache&quot;</span>);</span><br><span class="line">    server.sendHeader(<span class="string">&quot;Set-Cookie&quot;</span>, <span class="string">&quot;ESPSESSIONID=0&quot;</span>);</span><br><span class="line">    server.send(<span class="number">301</span>);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//åˆ¤æ–­æ˜¯å¦å­˜åœ¨USERNAMEå’ŒPASSWORDå‚æ•°</span></span><br><span class="line">  <span class="keyword">if</span> (server.hasArg(<span class="string">&quot;USERNAME&quot;</span>) &amp;&amp; server.hasArg(<span class="string">&quot;PASSWORD&quot;</span>)) &#123;</span><br><span class="line">    <span class="keyword">if</span> (server.arg(<span class="string">&quot;USERNAME&quot;</span>) == <span class="string">&quot;admin&quot;</span> &amp;&amp;  server.arg(<span class="string">&quot;PASSWORD&quot;</span>) == <span class="string">&quot;admin&quot;</span>) &#123;</span><br><span class="line">      server.sendHeader(<span class="string">&quot;Location&quot;</span>, <span class="string">&quot;/&quot;</span>);</span><br><span class="line">      server.sendHeader(<span class="string">&quot;Cache-Control&quot;</span>, <span class="string">&quot;no-cache&quot;</span>);</span><br><span class="line">      server.sendHeader(<span class="string">&quot;Set-Cookie&quot;</span>, <span class="string">&quot;ESPSESSIONID=1&quot;</span>);</span><br><span class="line">      server.send(<span class="number">301</span>);</span><br><span class="line">      DebugPrintln(<span class="string">&quot;Log in Successful&quot;</span>);</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    msg = <span class="string">&quot;Wrong username/password! try again.&quot;</span>;</span><br><span class="line">    DebugPrintln(<span class="string">&quot;Log in Failed&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//è¿”å›html å¡«å†™è´¦å·å¯†ç é¡µé¢</span></span><br><span class="line">  String content = <span class="string">&quot;&lt;html&gt;&lt;body&gt;&lt;form action=&#x27;/login&#x27; method=&#x27;POST&#x27;&gt;To log in, please use : admin/admin&lt;br&gt;&quot;</span>;</span><br><span class="line">  content += <span class="string">&quot;User:&lt;input type=&#x27;text&#x27; name=&#x27;USERNAME&#x27; placeholder=&#x27;user name&#x27;&gt;&lt;br&gt;&quot;</span>;</span><br><span class="line">  content += <span class="string">&quot;Password:&lt;input type=&#x27;password&#x27; name=&#x27;PASSWORD&#x27; placeholder=&#x27;password&#x27;&gt;&lt;br&gt;&quot;</span>;</span><br><span class="line">  content += <span class="string">&quot;&lt;input type=&#x27;submit&#x27; name=&#x27;SUBMIT&#x27; value=&#x27;Submit&#x27;&gt;&lt;/form&gt;&quot;</span> + msg + <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">  content += <span class="string">&quot;You also can go &lt;a href=&#x27;/inline&#x27;&gt;here&lt;/a&gt;&lt;/body&gt;&lt;/html&gt;&quot;</span>;</span><br><span class="line">  server.send(<span class="number">200</span>, <span class="string">&quot;text/html&quot;</span>, content);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ ¹ç›®å½•å¤„ç†å™¨</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">//root page can be accessed only if authentification is ok</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">handleRoot</span><span class="params">()</span> &#123;</span><br><span class="line">  DebugPrintln(<span class="string">&quot;Enter handleRoot&quot;</span>);</span><br><span class="line">  String header;</span><br><span class="line">  <span class="keyword">if</span> (!is_authentified()) &#123;</span><br><span class="line">    <span class="comment">//æ ¡éªŒä¸é€šè¿‡</span></span><br><span class="line">    server.sendHeader(<span class="string">&quot;Location&quot;</span>, <span class="string">&quot;/login&quot;</span>);</span><br><span class="line">    server.sendHeader(<span class="string">&quot;Cache-Control&quot;</span>, <span class="string">&quot;no-cache&quot;</span>);</span><br><span class="line">    server.send(<span class="number">301</span>);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  String content = <span class="string">&quot;&lt;html&gt;&lt;body&gt;&lt;H2&gt;hello, you successfully connected to esp8266!&lt;/H2&gt;&lt;br&gt;&quot;</span>;</span><br><span class="line">  <span class="keyword">if</span> (server.hasHeader(<span class="string">&quot;User-Agent&quot;</span>)) &#123;</span><br><span class="line">    content += <span class="string">&quot;the user agent used is : &quot;</span> + server.header(<span class="string">&quot;User-Agent&quot;</span>) + <span class="string">&quot;&lt;br&gt;&lt;br&gt;&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  content += <span class="string">&quot;You can access this page until you &lt;a href=\&quot;/login?DISCONNECT=YES\&quot;&gt;disconnect&lt;/a&gt;&lt;/body&gt;&lt;/html&gt;&quot;</span>;</span><br><span class="line">  server.send(<span class="number">200</span>, <span class="string">&quot;text/html&quot;</span>, content);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ— æ•ˆuriå¤„ç†å™¨</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">handleNotFound</span><span class="params">()</span> &#123;</span><br><span class="line">  String message = <span class="string">&quot;File Not Found\n\n&quot;</span>;</span><br><span class="line">  message += <span class="string">&quot;URI: &quot;</span>;</span><br><span class="line">  message += server.uri();</span><br><span class="line">  message += <span class="string">&quot;\nMethod: &quot;</span>;</span><br><span class="line">  message += (server.method() == HTTP_GET) ? <span class="string">&quot;GET&quot;</span> : <span class="string">&quot;POST&quot;</span>;</span><br><span class="line">  message += <span class="string">&quot;\nArguments: &quot;</span>;</span><br><span class="line">  message += server.args();</span><br><span class="line">  message += <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="type">uint8_t</span> i = <span class="number">0</span>; i &lt; server.args(); i++) &#123;</span><br><span class="line">    message += <span class="string">&quot; &quot;</span> + server.argName(i) + <span class="string">&quot;: &quot;</span> + server.arg(i) + <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  server.send(<span class="number">404</span>, <span class="string">&quot;text/plain&quot;</span>, message);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">(<span class="type">void</span>)</span> &#123;</span><br><span class="line">  initBasic();</span><br><span class="line">  initWifi();</span><br><span class="line">  initWebServer();</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">(<span class="type">void</span>)</span> &#123;</span><br><span class="line">  server.handleClient();</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åˆå§‹åŒ–åŸºç¡€åŠŸèƒ½ï¼šæ³¢ç‰¹ç‡</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">initBasic</span><span class="params">()</span>&#123;</span><br><span class="line">  DebugBegin(BAUD_RATE);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åˆå§‹åŒ–wifiæ¨¡å—ï¼šå·¥ä½œæ¨¡å¼ è¿æ¥ç½‘ç»œ</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">initWifi</span><span class="params">()</span>&#123;</span><br><span class="line">  WiFi.mode(WIFI_STA);</span><br><span class="line">  WiFi.begin(AP_SSID, AP_PSK);</span><br><span class="line">  DebugPrintln(<span class="string">&quot;&quot;</span>);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// Wait for connection</span></span><br><span class="line">  <span class="keyword">while</span> (WiFi.status() != WL_CONNECTED) &#123;</span><br><span class="line">    delay(<span class="number">500</span>);</span><br><span class="line">    DebugPrint(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  DebugPrintln(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  DebugPrint(<span class="string">&quot;Connected to &quot;</span>);</span><br><span class="line">  DebugPrintln(AP_SSID);</span><br><span class="line">  DebugPrint(<span class="string">&quot;IP address: &quot;</span>);</span><br><span class="line">  DebugPrintln(WiFi.localIP());</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åˆå§‹åŒ–webserver</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">initWebServer</span><span class="params">()</span>&#123;</span><br><span class="line">  <span class="comment">//ä»¥ä¸‹é…ç½®uriå¯¹åº”çš„handler</span></span><br><span class="line">  </span><br><span class="line">  server.on(<span class="string">&quot;/&quot;</span>, handleRoot);</span><br><span class="line">  server.on(<span class="string">&quot;/login&quot;</span>, handleLogin);</span><br><span class="line">  server.on(<span class="string">&quot;/inline&quot;</span>, []() &#123;</span><br><span class="line">    server.send(<span class="number">200</span>, <span class="string">&quot;text/plain&quot;</span>, <span class="string">&quot;this works without need of authentification&quot;</span>);</span><br><span class="line">  &#125;);</span><br><span class="line"> </span><br><span class="line">  server.onNotFound(handleNotFound);</span><br><span class="line">  <span class="comment">//è®¾ç½®éœ€è¦æ”¶é›†çš„è¯·æ±‚å¤´</span></span><br><span class="line">  <span class="type">const</span> <span class="type">char</span> * headerkeys[] = &#123;<span class="string">&quot;User-Agent&quot;</span>, <span class="string">&quot;Cookie&quot;</span>&#125; ;</span><br><span class="line">  <span class="type">size_t</span> headerkeyssize = <span class="keyword">sizeof</span>(headerkeys) / <span class="keyword">sizeof</span>(<span class="type">char</span>*);</span><br><span class="line">  <span class="comment">//æ”¶é›†å¤´ä¿¡æ¯</span></span><br><span class="line">  server.collectHeaders(headerkeys, headerkeyssize);</span><br><span class="line">  server.begin();</span><br><span class="line">  DebugPrintln(<span class="string">&quot;HTTP server started&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="16ã€åŸŸåæœåŠ¡â€“ESP8266mDNSåº“"><a href="#16ã€åŸŸåæœåŠ¡â€“ESP8266mDNSåº“" class="headerlink" title="16ã€åŸŸåæœåŠ¡â€“ESP8266mDNSåº“"></a>16ã€åŸŸåæœåŠ¡â€“ESP8266mDNSåº“</h1><h2 id="1ã€DNS"><a href="#1ã€DNS" class="headerlink" title="1ã€DNS"></a>1ã€DNS</h2><p>â€‹DNSï¼ˆDomain Name Systemï¼‰åŸŸåç³»ç»Ÿï¼ˆå› ç‰¹ç½‘ä¸Šä½œä¸ºåŸŸåå’ŒIPåœ°å€ç›¸äº’æ˜ å°„çš„ä¸€ä¸ªåˆ†å¸ƒå¼æ•°æ®åº“ï¼‰ï¼ŒDNSåè®®è¿è¡Œåœ¨UDPåè®®ä¸Šï¼Œç«¯å£å·53ï¼ŒmDNSï¼ˆMulticast DNSï¼‰ç»„æ’­dnsï¼Œä¸»è¦å®ç°äº†åœ¨<em>æ²¡æœ‰ä¼ ç»ŸDNSæœåŠ¡å™¨</em>çš„æƒ…å†µä¸‹ä½¿ç”¨<em>å±€åŸŸç½‘å†…çš„ä¸»æœºå®ç°æœ¬åœ°å‘ç°å’ŒåŸŸåè®¿é—®</em>ï¼Œç«¯å£å·5353ï¼Œéµä»dnsåè®®ï¼ˆåŸºäºUDPåè®®ï¼Œå³è¿ç”¨äº†UDPå¹¿æ’­ï¼‰ã€‚</p><h2 id="2ã€åº“å’Œç¤ºä¾‹-1"><a href="#2ã€åº“å’Œç¤ºä¾‹-1" class="headerlink" title="2ã€åº“å’Œç¤ºä¾‹"></a>2ã€åº“å’Œç¤ºä¾‹</h2><p><a href="https://imgtu.com/i/f88DBR"><img src="https://z3.ax1x.com/2021/08/09/f88DBR.png" class="lazyload placeholder" data-srcset="https://z3.ax1x.com/2021/08/09/f88DBR.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="f88DBR.png"></a></p><ol><li>æ¼”ç¤ºESP8266 mDNS responderåŠŸèƒ½</li></ol><p>ç”µè„‘ç«¯è¾“å…¥<code>http://esp8266.local/</code>ä»¥åŸŸåæ–¹å¼è®¿é—®webserver</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Demoï¼š</span></span><br><span class="line"><span class="comment"> *    æ¼”ç¤ºESP8266 mDNS responderåŠŸèƒ½</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266mDNS.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WebServer.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="comment">//ä»¥ä¸‹ä¸‰ä¸ªå®šä¹‰ä¸ºè°ƒè¯•å®šä¹‰</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DebugBegin(baud_rate)    Serial.begin(baud_rate)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DebugPrintln(message)    Serial.println(message)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DebugPrint(message)    Serial.print(message)</span></span><br><span class="line"> </span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* AP_SSID     = <span class="string">&quot;TP-LINK_5344&quot;</span>; <span class="comment">// XXXXXX -- ä½¿ç”¨æ—¶è¯·ä¿®æ”¹ä¸ºå½“å‰ä½ çš„ wifi ssid</span></span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* AP_PSK = <span class="string">&quot;6206908you11011010&quot;</span>;  <span class="comment">// XXXXXX -- ä½¿ç”¨æ—¶è¯·ä¿®æ”¹ä¸ºå½“å‰ä½ çš„ wifi å¯†ç </span></span><br><span class="line"><span class="type">const</span> <span class="type">unsigned</span> <span class="type">long</span> BAUD_RATE = <span class="number">115200</span>;<span class="comment">// serial connection speed</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">//å£°æ˜ä¸€ä¸‹å‡½æ•°</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">initBasic</span><span class="params">(<span class="type">void</span>)</span>;</span><br><span class="line"><span class="type">void</span> <span class="title function_">initWifi</span><span class="params">(<span class="type">void</span>)</span>;</span><br><span class="line"><span class="type">void</span> <span class="title function_">initWebServer</span><span class="params">(<span class="type">void</span>)</span>;</span><br><span class="line"><span class="type">void</span> <span class="title function_">initmDNS</span><span class="params">(<span class="type">void</span>)</span>;</span><br><span class="line"> </span><br><span class="line">ESP8266WebServer <span class="title function_">server</span><span class="params">(<span class="number">80</span>)</span>;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å¤„ç†æ ¹ç›®å½•uriè¯·æ±‚</span></span><br><span class="line"><span class="comment"> * uri:http://server_ip/</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">handleRoot</span><span class="params">()</span> &#123;</span><br><span class="line">  DebugPrintln(<span class="string">&quot;handleRoot&quot;</span>);</span><br><span class="line">  server.send(<span class="number">200</span>, <span class="string">&quot;text/html&quot;</span>, <span class="string">&quot;Hello From ESP8266 mDNS demo&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å¤„ç†æ— æ•ˆuri</span></span><br><span class="line"><span class="comment"> * uri:http://server_ip/xxxx</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">handleNotFound</span><span class="params">()</span> &#123;</span><br><span class="line">  DebugPrintln(<span class="string">&quot;handleNotFound&quot;</span>);</span><br><span class="line">  <span class="comment">//æ‰“å°æ— æ•ˆuriçš„ä¿¡æ¯ åŒ…æ‹¬è¯·æ±‚æ–¹å¼ è¯·æ±‚å‚æ•°</span></span><br><span class="line">  String message = <span class="string">&quot;File Not Found\n\n&quot;</span>;</span><br><span class="line">  message += <span class="string">&quot;URI: &quot;</span>;</span><br><span class="line">  message += server.uri();</span><br><span class="line">  message += <span class="string">&quot;\nMethod: &quot;</span>;</span><br><span class="line">  message += (server.method() == HTTP_GET) ? <span class="string">&quot;GET&quot;</span> : <span class="string">&quot;POST&quot;</span>;</span><br><span class="line">  message += <span class="string">&quot;\nArguments: &quot;</span>;</span><br><span class="line">  message += server.args();</span><br><span class="line">  message += <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="type">uint8_t</span> i = <span class="number">0</span>; i &lt; server.args(); i++) &#123;</span><br><span class="line">    message += <span class="string">&quot; &quot;</span> + server.argName(i) + <span class="string">&quot;: &quot;</span> + server.arg(i) + <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  server.send(<span class="number">404</span>, <span class="string">&quot;text/plain&quot;</span>, message);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">(<span class="type">void</span>)</span> &#123;</span><br><span class="line">  initBasic();</span><br><span class="line">  initWifi();</span><br><span class="line">  initWebServer();</span><br><span class="line">  initmDNS();</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">(<span class="type">void</span>)</span> &#123;</span><br><span class="line">  MDNS.update();    <span class="comment">//å°‘è¿™è¡Œ</span></span><br><span class="line">  server.handleClient();</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åˆå§‹åŒ–åŸºç¡€åŠŸèƒ½ï¼šæ³¢ç‰¹ç‡</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">initBasic</span><span class="params">()</span>&#123;</span><br><span class="line">  DebugBegin(BAUD_RATE);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åˆå§‹åŒ–wifiæ¨¡å—ï¼šå·¥ä½œæ¨¡å¼ è¿æ¥ç½‘ç»œ</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">initWifi</span><span class="params">()</span>&#123;</span><br><span class="line">  WiFi.mode(WIFI_STA);</span><br><span class="line">  WiFi.begin(AP_SSID, AP_PSK);</span><br><span class="line">  DebugPrintln(<span class="string">&quot;&quot;</span>);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// Wait for connection</span></span><br><span class="line">  <span class="keyword">while</span> (WiFi.status() != WL_CONNECTED) &#123;</span><br><span class="line">    delay(<span class="number">500</span>);</span><br><span class="line">    DebugPrint(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  DebugPrintln(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  DebugPrint(<span class="string">&quot;Connected to &quot;</span>);</span><br><span class="line">  DebugPrintln(AP_SSID);</span><br><span class="line">  DebugPrint(<span class="string">&quot;IP address: &quot;</span>);</span><br><span class="line">  DebugPrintln(WiFi.localIP());</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åˆå§‹åŒ–webserver</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">initWebServer</span><span class="params">()</span>&#123;</span><br><span class="line">  <span class="comment">//ä»¥ä¸‹é…ç½®uriå¯¹åº”çš„handler</span></span><br><span class="line">  server.on(<span class="string">&quot;/&quot;</span>, handleRoot);</span><br><span class="line">  server.on(<span class="string">&quot;/inline&quot;</span>, []() &#123;</span><br><span class="line">    DebugPrintln(<span class="string">&quot;handleInline&quot;</span>);</span><br><span class="line">    server.send(<span class="number">200</span>, <span class="string">&quot;text/plain&quot;</span>, <span class="string">&quot;this works as well&quot;</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">  server.onNotFound(handleNotFound);</span><br><span class="line">  <span class="comment">//å¯åŠ¨webserver</span></span><br><span class="line">  server.begin();</span><br><span class="line">  DebugPrintln(<span class="string">&quot;HTTP server started&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åˆå§‹åŒ–mDNS</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">initmDNS</span><span class="params">()</span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (!MDNS.begin(<span class="string">&quot;esp8266&quot;</span>)) &#123;</span><br><span class="line">    DebugPrintln(<span class="string">&quot;Error setting up MDNS responder!&quot;</span>);</span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>) &#123;</span><br><span class="line">      delay(<span class="number">1000</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  DebugPrintln(<span class="string">&quot;mDNS responder started,please input http://esp8266.local/ in your browser after install Bonjour&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>2. </p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">  æ¼”ç¤ºESP8266 mDNS å‘ç°æœåŠ¡åŠŸèƒ½</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">  æ³¨æ„:</span></span><br><span class="line"><span class="comment">  - è¾“å…¥ä½ çš„ WiFi SSID å’Œ password.</span></span><br><span class="line"><span class="comment">  - çƒ§å†™åˆ°ä¸¤å— ESP8266  æ¿å­ </span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266mDNS.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* ssid     = <span class="string">&quot;...&quot;</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* password = <span class="string">&quot;...&quot;</span>;</span><br><span class="line"><span class="type">char</span> hostString[<span class="number">16</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span> &#123;</span><br><span class="line">  Serial.begin(<span class="number">115200</span>);</span><br><span class="line">  delay(<span class="number">100</span>);</span><br><span class="line">  Serial.println(<span class="string">&quot;\r\nsetup()&quot;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="built_in">sprintf</span>(hostString, <span class="string">&quot;ESP_%06X&quot;</span>, ESP.getChipId());</span><br><span class="line">  Serial.print(<span class="string">&quot;Hostname: &quot;</span>);</span><br><span class="line">  Serial.println(hostString);</span><br><span class="line">  WiFi.hostname(hostString);</span><br><span class="line"></span><br><span class="line">  WiFi.mode(WIFI_STA);</span><br><span class="line">  WiFi.begin(ssid, password);</span><br><span class="line">  <span class="keyword">while</span> (WiFi.status() != WL_CONNECTED) &#123;</span><br><span class="line">    delay(<span class="number">250</span>);</span><br><span class="line">    Serial.print(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  Serial.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  Serial.print(<span class="string">&quot;Connected to &quot;</span>);</span><br><span class="line">  Serial.println(ssid);</span><br><span class="line">  Serial.print(<span class="string">&quot;IP address: &quot;</span>);</span><br><span class="line">  Serial.println(WiFi.localIP());</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (!MDNS.begin(hostString)) &#123;</span><br><span class="line">    Serial.println(<span class="string">&quot;Error setting up MDNS responder!&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  Serial.println(<span class="string">&quot;mDNS responder started&quot;</span>);</span><br><span class="line">  <span class="comment">//å¾€mDNSé‡Œé¢æ³¨å†ŒæœåŠ¡</span></span><br><span class="line">  MDNS.addService(<span class="string">&quot;esp&quot;</span>, <span class="string">&quot;tcp&quot;</span>, <span class="number">8080</span>); </span><br><span class="line"></span><br><span class="line">  Serial.println(<span class="string">&quot;Sending mDNS query&quot;</span>);</span><br><span class="line">  <span class="comment">//æŸ¥æ‰¾æœåŠ¡</span></span><br><span class="line">  <span class="type">int</span> n = MDNS.queryService(<span class="string">&quot;esp&quot;</span>, <span class="string">&quot;tcp&quot;</span>); <span class="comment">// Send out query for esp tcp services</span></span><br><span class="line">  Serial.println(<span class="string">&quot;mDNS query done&quot;</span>);</span><br><span class="line">  <span class="keyword">if</span> (n == <span class="number">0</span>) &#123;</span><br><span class="line">    Serial.println(<span class="string">&quot;no services found&quot;</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    Serial.print(n);</span><br><span class="line">    Serial.println(<span class="string">&quot; service(s) found&quot;</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; ++i) &#123;</span><br><span class="line">      <span class="comment">// æ‰“å°æŸ¥æ‰¾åˆ°çš„æœåŠ¡å…·ä½“ä¿¡æ¯</span></span><br><span class="line">      Serial.print(i + <span class="number">1</span>);</span><br><span class="line">      Serial.print(<span class="string">&quot;: &quot;</span>);</span><br><span class="line">      Serial.print(MDNS.hostname(i));</span><br><span class="line">      Serial.print(<span class="string">&quot; (&quot;</span>);</span><br><span class="line">      Serial.print(MDNS.IP(i));</span><br><span class="line">      Serial.print(<span class="string">&quot;:&quot;</span>);</span><br><span class="line">      Serial.print(MDNS.port(i));</span><br><span class="line">      Serial.println(<span class="string">&quot;)&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  Serial.println();</span><br><span class="line">  Serial.println(<span class="string">&quot;loop() next&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="comment">// put your main code here, to run repeatedly:</span></span><br></pre></td></tr></table></figure><h1 id="17ã€SPIFFSâ€“ESP8266-SPIFFSæ–‡ä»¶ç³»ç»Ÿ"><a href="#17ã€SPIFFSâ€“ESP8266-SPIFFSæ–‡ä»¶ç³»ç»Ÿ" class="headerlink" title="17ã€SPIFFSâ€“ESP8266 SPIFFSæ–‡ä»¶ç³»ç»Ÿ"></a>17ã€SPIFFSâ€“ESP8266 SPIFFSæ–‡ä»¶ç³»ç»Ÿ</h1><h2 id="1ã€æ¦‚è¿°ï¼š"><a href="#1ã€æ¦‚è¿°ï¼š" class="headerlink" title="1ã€æ¦‚è¿°ï¼š"></a>1ã€æ¦‚è¿°ï¼š</h2><p>â€‹Arduinoç¯å¢ƒä¸‹çš„esp8266çš„flashå­˜å‚¨åˆ†é…ï¼š</p><ol><li>ä»£ç åŒºï¼šç¨‹åºå­˜å‚¨åŒºï¼ˆåŒ…å«å½“å‰ä»£ç åŒºcurrent Sketchã€æ›´æ–°ä»£ç åŒºOTA updateï¼‰</li><li>æ–‡ä»¶ç³»ç»Ÿï¼šSPIFFSé—ªå­˜æ–‡ä»¶ç³»ç»Ÿï¼ˆSPI Flash File Systemï¼‰å¯é€šè¿‡IDEé…ç½®ï¼Œä¸€èˆ¬NodeMcué…ç½®æˆ3M&#96;&#96;&#96;#include&lt;FS.h&gt;&#96;&#96;</li></ol><p><strong>ä¸æ”¯æŒç›®å½•</strong> <strong>æ–‡ä»¶å32å­—ç¬¦é™åˆ¶</strong>  <strong>å»ºè®®ä¿æŒçŸ­æ–‡ä»¶å</strong></p><ol><li>EEPROM</li><li>WIFI Configï¼šè®¾ç½®WiFiæ¨¡å—é…ç½®æ—¶å­˜å‚¨çš„æ•°æ®</li></ol><h2 id="2ã€åº“å’Œä½¿ç”¨"><a href="#2ã€åº“å’Œä½¿ç”¨" class="headerlink" title="2ã€åº“å’Œä½¿ç”¨"></a>2ã€åº“å’Œä½¿ç”¨</h2><p><a href="https://imgtu.com/i/fGpEUP"><img src="https://z3.ax1x.com/2021/08/09/fGpEUP.png" class="lazyload placeholder" data-srcset="https://z3.ax1x.com/2021/08/09/fGpEUP.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="fGpEUP.png"></a></p><ol><li>æ–‡ä»¶æ“ä½œ</li></ol><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åŠŸèƒ½æè¿°ï¼šspiffsæ–‡ä»¶æ“ä½œå¸¸è§æ–¹æ³•ä½¿ç”¨ï¼ŒåŒ…æ‹¬æ–‡ä»¶æŸ¥æ‰¾ã€åˆ›å»ºã€æ‰“å¼€ã€å…³é—­ã€åˆ é™¤</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;FS.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">//ä»¥ä¸‹ä¸‰ä¸ªå®šä¹‰ä¸ºè°ƒè¯•å®šä¹‰</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DebugBegin(baud_rate)    Serial.begin(baud_rate)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DebugPrintln(message)    Serial.println(message)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DebugPrint(message)    Serial.print(message)</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> myFileName  <span class="string">&quot;mydemo.txt&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span>&#123;</span><br><span class="line">  DebugBegin(<span class="number">9600</span>);</span><br><span class="line">  DebugPrintln(<span class="string">&quot;Check Start SPIFFS...&quot;</span>);</span><br><span class="line">  <span class="comment">//å¯åŠ¨SPIFFSï¼Œå¦‚æœä¸‹è½½é…ç½®æ²¡æœ‰é…ç½®SPIFFSï¼Œè¿”å›false</span></span><br><span class="line">  <span class="keyword">if</span>(!SPIFFS.begin())&#123;</span><br><span class="line">     DebugPrintln(<span class="string">&quot;Start SPIFFS Failed!please check Arduino Download Config.&quot;</span>);</span><br><span class="line">     <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  DebugPrintln(<span class="string">&quot;Start SPIFFS Done.&quot;</span>);</span><br><span class="line">  <span class="comment">//åˆ¤æ–­æ–‡ä»¶æ˜¯å¦å­˜åœ¨</span></span><br><span class="line">  <span class="keyword">if</span>(SPIFFS.exists(myFileName))&#123;</span><br><span class="line">    DebugPrintln(<span class="string">&quot;mydemo.txt exists.&quot;</span>);</span><br><span class="line">  &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    DebugPrintln(<span class="string">&quot;mydemo.txt not exists.&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  File myFile;</span><br><span class="line">  <span class="comment">//æ‰“å¼€æ–‡ä»¶ ä¸å­˜åœ¨å°±åˆ›å»ºä¸€ä¸ª å¯è¯»å¯å†™</span></span><br><span class="line">  myFile = SPIFFS.open(myFileName,<span class="string">&quot;w+&quot;</span>);</span><br><span class="line">  <span class="comment">//å…³é—­æ–‡ä»¶</span></span><br><span class="line">  myFile.close();</span><br><span class="line">  <span class="comment">//å†æ¬¡åˆ¤æ–­æ–‡ä»¶æ˜¯å¦å­˜åœ¨</span></span><br><span class="line">  <span class="keyword">if</span>(SPIFFS.exists(myFileName))&#123;</span><br><span class="line">    DebugPrintln(<span class="string">&quot;mydemo.txt exists.&quot;</span>);</span><br><span class="line">  &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    DebugPrintln(<span class="string">&quot;mydemo.txt not exists.&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//åˆ é™¤æ–‡ä»¶</span></span><br><span class="line">  DebugPrintln(<span class="string">&quot;mydemo.txt removing...&quot;</span>);</span><br><span class="line">  SPIFFS.remove(myFileName);</span><br><span class="line">  <span class="comment">//å†æ¬¡åˆ¤æ–­æ–‡ä»¶æ˜¯å¦å­˜åœ¨</span></span><br><span class="line">  <span class="keyword">if</span>(SPIFFS.exists(myFileName))&#123;</span><br><span class="line">    DebugPrintln(<span class="string">&quot;mydemo.txt exists.&quot;</span>);</span><br><span class="line">  &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    DebugPrintln(<span class="string">&quot;mydemo.txt not exists.&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="2"><li>æŸ¥çœ‹spiffsæ–‡ä»¶ç³»ç»Ÿåˆ—è¡¨</li></ol><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åŠŸèƒ½æè¿°ï¼šæŸ¥çœ‹spiffsæ–‡ä»¶ç³»ç»Ÿåˆ—è¡¨</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;FS.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">//ä»¥ä¸‹ä¸‰ä¸ªå®šä¹‰ä¸ºè°ƒè¯•å®šä¹‰</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DebugBegin(baud_rate)    Serial.begin(baud_rate)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DebugPrintln(message)    Serial.println(message)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DebugPrint(message)    Serial.print(message)</span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span>&#123;</span><br><span class="line">  DebugBegin(<span class="number">9600</span>);</span><br><span class="line">  DebugPrintln(<span class="string">&quot;Check Start SPIFFS...&quot;</span>);</span><br><span class="line">  <span class="comment">//å¯åŠ¨SPIFFSï¼Œå¦‚æœä¸‹è½½é…ç½®æ²¡æœ‰é…ç½®SPIFFSï¼Œè¿”å›false</span></span><br><span class="line">  <span class="keyword">if</span>(!SPIFFS.begin())&#123;</span><br><span class="line">     DebugPrintln(<span class="string">&quot;Start SPIFFS Failed!please check Arduino Download Config.&quot;</span>);</span><br><span class="line">   <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  DebugPrintln(<span class="string">&quot;Start SPIFFS Done.&quot;</span>);</span><br><span class="line">  </span><br><span class="line">  File myFile;</span><br><span class="line">  <span class="comment">//æ‰“å¼€æ–‡ä»¶ ä¸å­˜åœ¨å°±åˆ›å»ºä¸€ä¸ª å¯è¯»å¯å†™</span></span><br><span class="line">  myFile = SPIFFS.open(<span class="string">&quot;/myDemo.txt&quot;</span>,<span class="string">&quot;w+&quot;</span>);</span><br><span class="line">  <span class="comment">//å…³é—­æ–‡ä»¶</span></span><br><span class="line">  myFile.close();</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//æ‰“å¼€æ–‡ä»¶ ä¸å­˜åœ¨å°±åˆ›å»ºä¸€ä¸ª å¯è¯»å¯å†™</span></span><br><span class="line">  myFile = SPIFFS.open(<span class="string">&quot;/myDemo.jpg&quot;</span>,<span class="string">&quot;w+&quot;</span>);</span><br><span class="line">  <span class="comment">//å…³é—­æ–‡ä»¶</span></span><br><span class="line">  myFile.close();</span><br><span class="line">  </span><br><span class="line">    <span class="comment">//æ‰“å¼€æ–‡ä»¶ ä¸å­˜åœ¨å°±åˆ›å»ºä¸€ä¸ª å¯è¯»å¯å†™</span></span><br><span class="line">  myFile = SPIFFS.open(<span class="string">&quot;/myDemo.html&quot;</span>,<span class="string">&quot;w+&quot;</span>);</span><br><span class="line">  <span class="comment">//å…³é—­æ–‡ä»¶</span></span><br><span class="line">  myFile.close();</span><br><span class="line">  </span><br><span class="line">  Dir dir = SPIFFS.openDir(<span class="string">&quot;/&quot;</span>);</span><br><span class="line">  <span class="keyword">while</span>(dir.next())&#123;</span><br><span class="line">    String fileName = dir.fileName();</span><br><span class="line">  <span class="type">size_t</span> fileSize = dir.fileSize();</span><br><span class="line">  Serial.<span class="built_in">printf</span>(<span class="string">&quot;FS File:%s,size:%d\n&quot;</span>,fileName.c_str(),fileSize);</span><br><span class="line">  &#125;</span><br><span class="line">  DebugPrintln(<span class="string">&quot;Setup Done!&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="3"><li>å¾€æ–‡ä»¶myDemo.txtä¸­å†™å…¥ä¸€å¥è¯å¹¶è¯»å–å‡ºæ¥æ˜¾ç¤º</li></ol><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åŠŸèƒ½æè¿°ï¼šæ¼”ç¤ºæ–‡ä»¶è¯»å†™åŠŸèƒ½</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;FS.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">//ä»¥ä¸‹ä¸‰ä¸ªå®šä¹‰ä¸ºè°ƒè¯•å®šä¹‰</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DebugBegin(baud_rate)    Serial.begin(baud_rate)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DebugPrintln(message)    Serial.println(message)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DebugPrint(message)    Serial.print(message)</span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span>&#123;</span><br><span class="line">  DebugBegin(<span class="number">9600</span>);</span><br><span class="line">  DebugPrintln(<span class="string">&quot;Check Start SPIFFS...&quot;</span>);</span><br><span class="line">  <span class="comment">//å¯åŠ¨SPIFFSï¼Œå¦‚æœä¸‹è½½é…ç½®æ²¡æœ‰é…ç½®SPIFFSï¼Œè¿”å›false</span></span><br><span class="line">  <span class="keyword">if</span>(!SPIFFS.begin())&#123;</span><br><span class="line">     DebugPrintln(<span class="string">&quot;Start SPIFFS Failed!please check Arduino Download Config.&quot;</span>);</span><br><span class="line">   <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  DebugPrintln(<span class="string">&quot;Start SPIFFS Done.&quot;</span>);</span><br><span class="line">  </span><br><span class="line">  File myFile;</span><br><span class="line">  <span class="comment">//æ‰“å¼€æ–‡ä»¶ ä¸å­˜åœ¨å°±åˆ›å»ºä¸€ä¸ª å¯è¯»å¯å†™</span></span><br><span class="line">  myFile = SPIFFS.open(<span class="string">&quot;myDemo.txt&quot;</span>,<span class="string">&quot;w+&quot;</span>);</span><br><span class="line">  <span class="keyword">if</span>(myFile)&#123;</span><br><span class="line">    DebugPrintln(<span class="string">&quot;Writing something to myDemo.txt...&quot;</span>);</span><br><span class="line">  myFile.println(<span class="string">&quot;å•ç‰‡æœºèœé¸Ÿåšå“¥666&quot;</span>);</span><br><span class="line">  myFile.close();</span><br><span class="line">  DebugPrintln(<span class="string">&quot;Writing Done.&quot;</span>);</span><br><span class="line">  &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    DebugPrintln(<span class="string">&quot;Open File Failed.&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//æ‰“å¼€æ–‡ä»¶ å¯è¯»</span></span><br><span class="line">  myFile = SPIFFS.open(<span class="string">&quot;myDemo.txt&quot;</span>,<span class="string">&quot;r&quot;</span>);</span><br><span class="line">  <span class="keyword">if</span>(myFile)&#123;</span><br><span class="line">    DebugPrintln(<span class="string">&quot;Reading myDemo.txt...&quot;</span>);</span><br><span class="line">  <span class="keyword">while</span>(myFile.available())&#123;</span><br><span class="line">    <span class="comment">//è¯»å–æ–‡ä»¶è¾“å‡º</span></span><br><span class="line">    Serial.write(myFile.read());</span><br><span class="line">  &#125;</span><br><span class="line">  myFile.close();</span><br><span class="line">  &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    DebugPrintln(<span class="string">&quot;Open File Failed.&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  DebugPrintln(<span class="string">&quot;Setup Done!&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="4"><li>çƒ§å†™æ–‡ä»¶ï¼Œå°†è¦å­˜å…¥SOIFFSåŒºåŸŸçš„æ–‡ä»¶ï¼Œæå‰æ”¾åœ¨ä»£ç ç›®å½•çš„â€dataâ€ç›®å½•ä¸­ï¼Œä½¿ç”¨<a href="https://github.com/esp8266/arduino-esp8266fs-plugin/releases/download/0.5.0/ESP8266FS-0.5.0.zip">ESP8266FS</a>å·¥å…·çƒ§å†™ï¼ˆé›†æˆåœ¨ArduinoIDEä¸­ï¼Œä½†è¦å®‰è£…è¿™ä¸ªå·¥å…·ï¼‰ï¼ˆæç¤ºæ²¡æœ‰æ‰¾åˆ°è¿™ä¸ªå·¥å…·çš„è¯ï¼Œä¸€èˆ¬éƒ½æ˜¯ç‰ˆæœ¬é—®é¢˜ï¼Œæ¢ä¸ªç‰ˆæœ¬å°±å¥½äº†ï¼‰</li></ol><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åŠŸèƒ½æè¿°ï¼šæ¼”ç¤ºä¸Šä¼ æ–‡ä»¶å¹¶è¯»å–æ–‡ä»¶å†…å®¹</span></span><br><span class="line"><span class="comment"> * å‰æï¼šéœ€è¦å…ˆå¾€SPIFFSé‡Œé¢ä¸Šä¼ config.txtæ–‡ä»¶ </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;FS.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">//ä»¥ä¸‹ä¸‰ä¸ªå®šä¹‰ä¸ºè°ƒè¯•å®šä¹‰</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DebugBegin(baud_rate)    Serial.begin(baud_rate)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DebugPrintln(message)    Serial.println(message)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DebugPrint(message)    Serial.print(message)</span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span>&#123;</span><br><span class="line">  DebugBegin(<span class="number">9600</span>);</span><br><span class="line">  DebugPrintln(<span class="string">&quot;Check Start SPIFFS...&quot;</span>);</span><br><span class="line">  <span class="comment">//å¯åŠ¨SPIFFSï¼Œå¦‚æœä¸‹è½½é…ç½®æ²¡æœ‰é…ç½®SPIFFSï¼Œè¿”å›false</span></span><br><span class="line">  <span class="keyword">if</span>(!SPIFFS.begin())&#123;</span><br><span class="line">     DebugPrintln(<span class="string">&quot;Start SPIFFS Failed!please check Arduino Download Config.&quot;</span>);</span><br><span class="line">   <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  DebugPrintln(<span class="string">&quot;Start SPIFFS Done.&quot;</span>);</span><br><span class="line">  </span><br><span class="line">  File myFile;</span><br><span class="line">  <span class="comment">//æ‰“å¼€æ–‡ä»¶ ä¸å­˜åœ¨å°±åˆ›å»ºä¸€ä¸ª å¯è¯»å¯å†™</span></span><br><span class="line">  myFile = SPIFFS.open(<span class="string">&quot;/config.txt&quot;</span>,<span class="string">&quot;r&quot;</span>);</span><br><span class="line">  <span class="keyword">if</span>(myFile)&#123;</span><br><span class="line">    <span class="comment">//æ‰“å°æ–‡ä»¶å¤§å°</span></span><br><span class="line">    <span class="type">int</span> size = myFile.size();</span><br><span class="line">  Serial.<span class="built_in">printf</span>(<span class="string">&quot;Size=%d\r\n&quot;</span>, size);</span><br><span class="line">  <span class="comment">//è¯»å–æ–‡ä»¶å†…å®¹</span></span><br><span class="line">  DebugPrintln(myFile.readString());</span><br><span class="line">  myFile.close();</span><br><span class="line">  DebugPrintln(<span class="string">&quot;Reading Done.&quot;</span>);</span><br><span class="line">  &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    DebugPrintln(<span class="string">&quot;Open File Failed.&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="18ã€webé…ç½‘"><a href="#18ã€webé…ç½‘" class="headerlink" title="18ã€webé…ç½‘"></a>18ã€webé…ç½‘</h1><p>è‡ªå®šä¹‰APé…ç½‘</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åŠŸèƒ½ï¼šAPé…ç½‘ï¼ˆwebé…ç½‘ï¼‰</span></span><br><span class="line"><span class="comment"> * ä½œè€…ï¼šå•ç‰‡æœºèœé¸Ÿå“¥</span></span><br><span class="line"><span class="comment"> * æ—¶é—´ï¼š2020-02-15</span></span><br><span class="line"><span class="comment"> * æè¿°ï¼š</span></span><br><span class="line"><span class="comment"> *    1.è®¾ç½®å›ºå®šIP 192.168.4.1</span></span><br><span class="line"><span class="comment"> *    2.è®¾ç½®webserverç›‘å¬webè¯·æ±‚</span></span><br><span class="line"><span class="comment"> *    3.å¤„ç†webè¯·æ±‚ï¼Œè·å–ssidå’Œpwd</span></span><br><span class="line"><span class="comment"> *    4.è¿æ¥ç½‘ç»œ</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WebServer.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DEBUG</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> DEBUG</span></span><br><span class="line">  <span class="comment">//ä»¥ä¸‹ä¸‰ä¸ªå®šä¹‰ä¸ºè°ƒè¯•å®šä¹‰</span></span><br><span class="line">  <span class="meta">#<span class="keyword">define</span> DebugBegin(baud_rate)    Serial.begin(baud_rate)</span></span><br><span class="line">  <span class="meta">#<span class="keyword">define</span> DebugPrintln(message)    Serial.println(message)</span></span><br><span class="line">  <span class="meta">#<span class="keyword">define</span> DebugPrint(message)    Serial.print(message)</span></span><br><span class="line"><span class="meta">#<span class="keyword">else</span></span></span><br><span class="line">  <span class="comment">//ä»¥ä¸‹ä¸‰ä¸ªå®šä¹‰ä¸ºè°ƒè¯•å®šä¹‰</span></span><br><span class="line">  <span class="meta">#<span class="keyword">define</span> DebugBegin(baud_rate)</span></span><br><span class="line">  <span class="meta">#<span class="keyword">define</span> DebugPrintln(message)</span></span><br><span class="line">  <span class="meta">#<span class="keyword">define</span> DebugPrint(message)</span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span>  </span></span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* ap_ssid = <span class="string">&quot;esp_webconfig&quot;</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* ap_password = <span class="string">&quot;&quot;</span>;<span class="comment">//å¼€æ”¾å¼ç½‘ç»œ</span></span><br><span class="line"></span><br><span class="line"><span class="type">char</span> sta_ssid[<span class="number">32</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line"><span class="type">char</span> sta_password[<span class="number">64</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* webpage_html = <span class="string">&quot;\</span></span><br><span class="line"><span class="string">&lt;!DOCTYPE html&gt;\r\n\</span></span><br><span class="line"><span class="string">&lt;html lang=&#x27;en&#x27;&gt;\r\n\</span></span><br><span class="line"><span class="string">&lt;head&gt;\r\n\</span></span><br><span class="line"><span class="string">  &lt;meta charset=&#x27;UTF-8&#x27;&gt;\r\n\</span></span><br><span class="line"><span class="string">  &lt;title&gt;Document&lt;/title&gt;\r\n\</span></span><br><span class="line"><span class="string">&lt;/head&gt;\r\n\</span></span><br><span class="line"><span class="string">&lt;body&gt;\r\n\</span></span><br><span class="line"><span class="string">  &lt;form name=&#x27;input&#x27; action=&#x27;/&#x27; method=&#x27;POST&#x27;&gt;\r\n\</span></span><br><span class="line"><span class="string">        wifiåç§°: &lt;br&gt;\r\n\</span></span><br><span class="line"><span class="string">        &lt;input type=&#x27;text&#x27; name=&#x27;ssid&#x27;&gt;&lt;br&gt;\r\n\</span></span><br><span class="line"><span class="string">        wifiå¯†ç :&lt;br&gt;\r\n\</span></span><br><span class="line"><span class="string">        &lt;input type=&#x27;text&#x27; name=&#x27;password&#x27;&gt;&lt;br&gt;\r\n\</span></span><br><span class="line"><span class="string">        &lt;input type=&#x27;submit&#x27; value=&#x27;ä¿å­˜&#x27;&gt;\r\n\</span></span><br><span class="line"><span class="string">    &lt;/form&gt;\r\n\</span></span><br><span class="line"><span class="string">&lt;/body&gt;\r\n\</span></span><br><span class="line"><span class="string">&lt;/html&gt;\r\n\</span></span><br><span class="line"><span class="string">&quot;</span>;</span><br><span class="line"></span><br><span class="line">IPAddress <span class="title function_">local_IP</span><span class="params">(<span class="number">192</span>,<span class="number">168</span>,<span class="number">4</span>,<span class="number">1</span>)</span>;</span><br><span class="line">IPAddress <span class="title function_">gateway</span><span class="params">(<span class="number">192</span>,<span class="number">168</span>,<span class="number">4</span>,<span class="number">1</span>)</span>;</span><br><span class="line">IPAddress <span class="title function_">subnet</span><span class="params">(<span class="number">255</span>,<span class="number">255</span>,<span class="number">255</span>,<span class="number">0</span>)</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">initApConfig</span><span class="params">()</span>;</span><br><span class="line"><span class="type">void</span> <span class="title function_">initWebServer</span><span class="params">()</span>;</span><br><span class="line"><span class="type">void</span> <span class="title function_">connectToWifi</span><span class="params">()</span>;</span><br><span class="line"><span class="type">void</span> <span class="title function_">handleRootPost</span><span class="params">()</span>;</span><br><span class="line"><span class="type">void</span> <span class="title function_">handleRoot</span><span class="params">()</span>;</span><br><span class="line"><span class="type">void</span> <span class="title function_">handleNotFound</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">ESP8266WebServer <span class="title function_">server</span><span class="params">(<span class="number">80</span>)</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">(<span class="type">void</span>)</span> &#123;</span><br><span class="line">  DebugBegin(<span class="number">115200</span>);</span><br><span class="line">  DebugPrintln(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  DebugPrint(<span class="string">&quot;connect ap: &quot;</span>);</span><br><span class="line">  DebugPrintln(ap_ssid);</span><br><span class="line"></span><br><span class="line">  initApConfig();</span><br><span class="line"></span><br><span class="line">  DebugPrint(<span class="string">&quot;IP address: &quot;</span>);</span><br><span class="line">  DebugPrintln(WiFi.softAPIP());</span><br><span class="line"></span><br><span class="line">  initWebServer();</span><br><span class="line"></span><br><span class="line">  DebugPrintln(<span class="string">&quot;HTTP server started&quot;</span>);</span><br><span class="line"></span><br><span class="line">  Serial.<span class="built_in">printf</span>(<span class="string">&quot;Ready! Open http://%s in your browser\n&quot;</span>,</span><br><span class="line">  WiFi.softAPIP().toString().c_str());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">(<span class="type">void</span>)</span> &#123;</span><br><span class="line">  server.handleClient();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åˆå§‹åŒ–APé…ç½®</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">initApConfig</span><span class="params">()</span>&#123;</span><br><span class="line">  WiFi.mode(WIFI_AP);</span><br><span class="line">  WiFi.softAPConfig(local_IP, gateway, subnet);</span><br><span class="line">  WiFi.softAP(ap_ssid, ap_password);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åˆå§‹åŒ–webserveré…ç½®</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">initWebServer</span><span class="params">()</span>&#123;</span><br><span class="line">  server.on(<span class="string">&quot;/&quot;</span>, HTTP_GET, handleRoot);</span><br><span class="line">  server.on(<span class="string">&quot;/&quot;</span>, HTTP_POST, handleRootPost);</span><br><span class="line">  server.onNotFound(handleNotFound);</span><br><span class="line"></span><br><span class="line">  server.begin();   </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è¿æ¥åˆ°WiFi</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">connectToWifi</span><span class="params">()</span>&#123;</span><br><span class="line">  DebugPrintln(<span class="string">&quot;connectToWifi&quot;</span>);</span><br><span class="line">  WiFi.disconnect();</span><br><span class="line">  WiFi.mode(WIFI_STA);</span><br><span class="line">  WiFi.begin(sta_ssid, sta_password);</span><br><span class="line"></span><br><span class="line">  <span class="type">int</span> cnt = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">while</span> (WiFi.status() != WL_CONNECTED) &#123;</span><br><span class="line">          delay(<span class="number">500</span>);</span><br><span class="line">          cnt++;</span><br><span class="line">          Serial.print(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">          <span class="keyword">if</span>(cnt&gt;=<span class="number">40</span>)&#123;</span><br><span class="line">            cnt = <span class="number">0</span>;</span><br><span class="line">            <span class="comment">//é‡å¯ç³»ç»Ÿ</span></span><br><span class="line">            DebugPrintln(<span class="string">&quot;\r\nRestart now!&quot;</span>);</span><br><span class="line">            ESP.restart();</span><br><span class="line">          &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  DebugPrintln(<span class="string">&quot;connectToWifi Success!&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å¤„ç†web postè¯·æ±‚</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">handleRootPost</span><span class="params">()</span> &#123;</span><br><span class="line">  DebugPrintln(<span class="string">&quot;handleRootPost&quot;</span>);</span><br><span class="line">  <span class="keyword">if</span> (server.hasArg(<span class="string">&quot;ssid&quot;</span>)) &#123;</span><br><span class="line">    DebugPrint(<span class="string">&quot;got ssid:&quot;</span>);</span><br><span class="line">    <span class="built_in">strcpy</span>(sta_ssid, server.arg(<span class="string">&quot;ssid&quot;</span>).c_str());</span><br><span class="line">    DebugPrintln(sta_ssid);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    DebugPrintln(<span class="string">&quot;error, not found ssid&quot;</span>);</span><br><span class="line">    server.send(<span class="number">200</span>, <span class="string">&quot;text/html&quot;</span>, <span class="string">&quot;&lt;meta charset=&#x27;UTF-8&#x27;&gt;error, not found ssid&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (server.hasArg(<span class="string">&quot;password&quot;</span>)) &#123;</span><br><span class="line">    DebugPrint(<span class="string">&quot;got password:&quot;</span>);</span><br><span class="line">    <span class="built_in">strcpy</span>(sta_password, server.arg(<span class="string">&quot;password&quot;</span>).c_str());</span><br><span class="line">    DebugPrintln(sta_password);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    DebugPrintln(<span class="string">&quot;error, not found password&quot;</span>);</span><br><span class="line">    server.send(<span class="number">200</span>, <span class="string">&quot;text/html&quot;</span>, <span class="string">&quot;&lt;meta charset=&#x27;UTF-8&#x27;&gt;error, not found password&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  server.send(<span class="number">200</span>, <span class="string">&quot;text/html&quot;</span>, <span class="string">&quot;&lt;meta charset=&#x27;UTF-8&#x27;&gt;ä¿å­˜æˆåŠŸ&quot;</span>);</span><br><span class="line">  delay(<span class="number">2000</span>);</span><br><span class="line">  <span class="comment">//è¿æ¥wifi</span></span><br><span class="line">  connectToWifi();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å¤„ç†web getè¯·æ±‚</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">handleRoot</span><span class="params">()</span> &#123;</span><br><span class="line">  DebugPrintln(<span class="string">&quot;handleRoot&quot;</span>);</span><br><span class="line">  server.send(<span class="number">200</span>, <span class="string">&quot;text/html&quot;</span>, webpage_html);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">handleNotFound</span><span class="params">()</span> &#123;</span><br><span class="line">  String message = <span class="string">&quot;File Not Found\n\n&quot;</span>;</span><br><span class="line">  server.send(<span class="number">404</span>, <span class="string">&quot;text/plain&quot;</span>, message);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="19ã€NTPâ€“æ—¶é—´æœåŠ¡"><a href="#19ã€NTPâ€“æ—¶é—´æœåŠ¡" class="headerlink" title="19ã€NTPâ€“æ—¶é—´æœåŠ¡"></a>19ã€NTPâ€“æ—¶é—´æœåŠ¡</h1><p>â€‹NTPï¼ˆNetwork Time Protocolï¼‰ç½‘ç»œæ—¶é—´åè®®ï¼ŒåŸºäºUDPï¼Œç”¨äºç½‘ç»œæ—¶é—´åŒæ­¥çš„åè®®ï¼Œä½¿ç½‘ç»œä¸­çš„è®¡ç®—æœºæ—¶é’ŸåŒæ­¥åˆ°UTC,å†é…åˆå„ä¸ªæ—¶åŒºçš„åç§»è°ƒæ•´å°±èƒ½å®ç°ç²¾å‡†åŒæ­¥å¯¹æ—¶åŠŸèƒ½ã€‚</p><p>NTPæŠ¥æ–‡åè®®</p><p>å®ç°:</p><ol><li>æ‹¼æ¥åè®®</li><li>ä½¿ç”¨ç°æˆNTPç¬¬ä¸‰æ–¹åº“ï¼ˆNTPClientï¼‰</li></ol><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;NTPClient.h&gt;</span></span></span><br><span class="line"><span class="comment">// change next line to use with another board/shield</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"><span class="comment">//#include &lt;WiFi.h&gt; // for WiFi shield</span></span><br><span class="line"><span class="comment">//#include &lt;WiFi101.h&gt; // for WiFi 101 shield or MKR1000</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;WiFiUdp.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">char</span> *ssid     = <span class="string">&quot;XU-ChinaNet&quot;</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">char</span> *password = <span class="string">&quot;15358228063&quot;</span>;</span><br><span class="line"></span><br><span class="line">WiFiUDP ntpUDP;</span><br><span class="line"></span><br><span class="line"><span class="comment">// You can specify the time server pool and the offset (in seconds, can be</span></span><br><span class="line"><span class="comment">// changed later with setTimeOffset() ). Additionaly you can specify the</span></span><br><span class="line"><span class="comment">// update interval (in milliseconds, can be changed using setUpdateInterval() ).</span></span><br><span class="line">NTPClient <span class="title function_">timeClient</span><span class="params">(ntpUDP, <span class="string">&quot;ntp1.aliyun.com&quot;</span>, <span class="number">60</span>*<span class="number">60</span>*<span class="number">8</span>, <span class="number">30</span>*<span class="number">60</span>*<span class="number">1000</span>)</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span>&#123;</span><br><span class="line">  Serial.begin(<span class="number">115200</span>);</span><br><span class="line"></span><br><span class="line">  WiFi.begin(ssid, password);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">while</span> ( WiFi.status() != WL_CONNECTED ) &#123;</span><br><span class="line">    delay ( <span class="number">500</span> );</span><br><span class="line">    Serial.print ( <span class="string">&quot;.&quot;</span> );</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  timeClient.begin();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span> &#123;</span><br><span class="line">  timeClient.update();</span><br><span class="line"></span><br><span class="line">  Serial.println(timeClient.getFormattedTime());</span><br><span class="line">  <span class="type">int</span> hours = timeClient.getHours();</span><br><span class="line">  <span class="type">int</span> minu =  timeClient.getMinutes();</span><br><span class="line">  <span class="type">int</span> sece =  timeClient.getSeconds();</span><br><span class="line">  Serial.<span class="built_in">printf</span>(<span class="string">&quot;hour:%d minu:%d sece:%d\n&quot;</span>, hours,minu,sece);</span><br><span class="line">  delay(<span class="number">1000</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="20ã€DNSServerâ€“çœŸæ­£çš„åŸŸåæœåŠ¡"><a href="#20ã€DNSServerâ€“çœŸæ­£çš„åŸŸåæœåŠ¡" class="headerlink" title="20ã€DNSServerâ€“çœŸæ­£çš„åŸŸåæœåŠ¡"></a>20ã€DNSServerâ€“çœŸæ­£çš„åŸŸåæœåŠ¡</h1><p>â€‹å»ºç«‹DNSæœåŠ¡ï¼Œä½¿ç”¨æ—¶æ¨¡å—å¿…é¡»å¤„äºAPæ¨¡å¼ä¸‹ï¼›çœŸæ­£æ„ä¹‰ä¸Šçš„ç²¾ç®€ç‰ˆDNSæœåŠ¡å™¨ï¼›DNSServerè¿è¡ŒäºUDPæœåŠ¡ï¼›è¿™é‡ŒDNSæœåŠ¡å™¨å”¯ä¸€çš„ä½œç”¨æ˜¯æŠŠåŸŸåè½¬æˆå¯¹åº”æ˜ å°„åœ°å€ï¼ˆåªæ”¯æŒä¸€ä¸ªï¼‰</p><p><a href="https://imgtu.com/i/fGI9sS"><img src="https://z3.ax1x.com/2021/08/10/fGI9sS.png" class="lazyload placeholder" data-srcset="https://z3.ax1x.com/2021/08/10/fGI9sS.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="fGI9sS.png"></a></p><p>1. </p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åŠŸèƒ½æè¿°ï¼šåœ¨æ‰‹æœºæµè§ˆå™¨è®¿é—® &quot;www.danpianji.com&quot;ä¼šæ˜¾ç¤ºâ€œHello Worldâ€ </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;DNSServer.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WebServer.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">//è°ƒè¯•å®šä¹‰</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DebugBegin(baud_rate)    Serial.begin(baud_rate)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DebugPrintln(message)    Serial.println(message)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DebugPrint(message)    Serial.print(message)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DebugPrintF(...) Serial.printf( __VA_ARGS__ )</span></span><br><span class="line"></span><br><span class="line"><span class="type">const</span> byte DNS_PORT = <span class="number">53</span>;</span><br><span class="line">IPAddress <span class="title function_">apIP</span><span class="params">(<span class="number">192</span>, <span class="number">168</span>, <span class="number">1</span>, <span class="number">1</span>)</span>;</span><br><span class="line">DNSServer dnsServer;</span><br><span class="line">ESP8266WebServer <span class="title function_">webServer</span><span class="params">(<span class="number">80</span>)</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">  DebugBegin(<span class="number">115200</span>);</span><br><span class="line">  WiFi.mode(WIFI_AP);</span><br><span class="line">  WiFi.softAPConfig(apIP, apIP, IPAddress(<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0</span>));</span><br><span class="line">  WiFi.softAP(<span class="string">&quot;DNSServer example&quot;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// modify TTL associated  with the domain name (in seconds)</span></span><br><span class="line">  <span class="comment">// default is 60 seconds</span></span><br><span class="line">  dnsServer.setTTL(<span class="number">300</span>);</span><br><span class="line">  <span class="comment">// set which return code will be used for all other domains (e.g. sending</span></span><br><span class="line">  <span class="comment">// ServerFailure instead of NonExistentDomain will reduce number of queries</span></span><br><span class="line">  <span class="comment">// sent by clients)</span></span><br><span class="line">  <span class="comment">// default is DNSReplyCode::NonExistentDomain</span></span><br><span class="line">  dnsServer.setErrorReplyCode(DNSReplyCode::ServerFailure);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å¯åŠ¨DNS serverï¼Œæ˜ å°„ä¸»æœºåä¸º www.danpianji.com</span></span><br><span class="line">  <span class="type">bool</span> status = dnsServer.start(DNS_PORT, <span class="string">&quot;www.danpianji.com&quot;</span>, apIP);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span>(status)&#123;</span><br><span class="line">      DebugPrintln(<span class="string">&quot;start dnsserver success.&quot;</span>);</span><br><span class="line">  &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">     DebugPrintln(<span class="string">&quot;start dnsserver failed.&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// simple HTTP server to see that DNS server is working</span></span><br><span class="line">  webServer.onNotFound([]() &#123;</span><br><span class="line">    String message = <span class="string">&quot;Hello World!\n\n&quot;</span>;</span><br><span class="line">    message += <span class="string">&quot;URI: &quot;</span>;</span><br><span class="line">    message += webServer.uri();</span><br><span class="line"></span><br><span class="line">    webServer.send(<span class="number">200</span>, <span class="string">&quot;text/plain&quot;</span>, message);</span><br><span class="line">  &#125;);</span><br><span class="line">  webServer.begin();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span> &#123;</span><br><span class="line">  dnsServer.processNextRequest();</span><br><span class="line">  webServer.handleClient();</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ol start="2"><li>Portalè®¤è¯</li></ol><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åŠŸèƒ½æè¿°ï¼športalè®¤è¯</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;DNSServer.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WebServer.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">//è°ƒè¯•å®šä¹‰</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DebugBegin(baud_rate)    Serial.begin(baud_rate)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DebugPrintln(message)    Serial.println(message)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DebugPrint(message)    Serial.print(message)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DebugPrintF(...) Serial.printf( __VA_ARGS__ )</span></span><br><span class="line"></span><br><span class="line"><span class="type">const</span> byte DNS_PORT = <span class="number">53</span>;</span><br><span class="line">IPAddress <span class="title function_">apIP</span><span class="params">(<span class="number">192</span>, <span class="number">168</span>, <span class="number">1</span>, <span class="number">1</span>)</span>;</span><br><span class="line">DNSServer dnsServer;</span><br><span class="line">ESP8266WebServer <span class="title function_">webServer</span><span class="params">(<span class="number">80</span>)</span>;</span><br><span class="line"></span><br><span class="line">String responseHTML = <span class="string">&quot;&quot;</span></span><br><span class="line">                      <span class="string">&quot;&lt;!DOCTYPE html&gt;&lt;html&gt;&lt;head&gt;&lt;title&gt;CaptivePortal&lt;/title&gt;&lt;/head&gt;&lt;body&gt;&quot;</span></span><br><span class="line">                      <span class="string">&quot;&lt;h1&gt;Hello World!&lt;/h1&gt;&lt;p&gt;This is a captive portal example. All requests will &quot;</span></span><br><span class="line">                      <span class="string">&quot;be redirected here.&lt;/p&gt;&lt;/body&gt;&lt;/html&gt;&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span> &#123;</span><br><span class="line">  DebugBegin(<span class="number">115200</span>);</span><br><span class="line">  WiFi.mode(WIFI_AP);</span><br><span class="line">  WiFi.softAPConfig(apIP, apIP, IPAddress(<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0</span>));</span><br><span class="line">  WiFi.softAP(<span class="string">&quot;DNSServer CaptivePortal example&quot;</span>);</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line">  <span class="comment">// æ‰€æœ‰è¯·æ±‚éƒ½æ˜ å°„åˆ°ä¸€ä¸ªå…·ä½“åœ°å€</span></span><br><span class="line">  dnsServer.start(DNS_PORT, <span class="string">&quot;*&quot;</span>, apIP);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// replay to all requests with same HTML</span></span><br><span class="line">  webServer.onNotFound([]() &#123;</span><br><span class="line">    DebugPrintln(<span class="string">&quot;webServer handle.&quot;</span>);</span><br><span class="line">    webServer.send(<span class="number">200</span>, <span class="string">&quot;text/html&quot;</span>, responseHTML);</span><br><span class="line">  &#125;);</span><br><span class="line">  webServer.begin();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span> &#123;</span><br><span class="line">  dnsServer.processNextRequest();</span><br><span class="line">  webServer.handleClient();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="21ã€æ— çº¿æ›´æ–°â€“OTAå›ºä»¶æ›´æ–°"><a href="#21ã€æ— çº¿æ›´æ–°â€“OTAå›ºä»¶æ›´æ–°" class="headerlink" title="21ã€æ— çº¿æ›´æ–°â€“OTAå›ºä»¶æ›´æ–°"></a>21ã€æ— çº¿æ›´æ–°â€“OTAå›ºä»¶æ›´æ–°</h1><h2 id="1ã€ArduinoOTA"><a href="#1ã€ArduinoOTA" class="headerlink" title="1ã€ArduinoOTA"></a>1ã€ArduinoOTA</h2><ul><li>è¿æ¥WIFIï¼›</li><li>é…ç½®ArduinoOTAå¯¹è±¡çš„äº‹ä»¶å‡½æ•°ï¼›</li><li>å¯åŠ¨ArduinoOTAæœåŠ¡ArduinoOTA.begin();</li><li>åœ¨loop()å‡½æ•°å°†å¤„ç†æƒäº¤ç”±ArduinoOTA.handle()ã€‚</li></ul><p>ä¸ºäº†åŒºåˆ†æ­£å¸¸å·¥ä½œæ¨¡å¼ä»¥åŠæ›´æ–°æ¨¡å¼ï¼Œå¯ä»¥è®¾ç½®æ ‡å¿—ä½æ¥åŒºåˆ†ï¼ˆæ ‡å¿—ä½å¯é€šè¿‡å…¶ä»–æ‰‹æ®µä¿®æ”¹ï¼Œå¦‚æŒ‰é”®ã€è½¯ä»¶æ§åˆ¶ï¼‰</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (flag ==<span class="number">0</span> ) &#123;</span><br><span class="line">    <span class="comment">// æ­£å¸¸å·¥ä½œçŠ¶æ€çš„ä»£ç </span></span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    ArduinoOTA.handle();</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><a href="https://imgtu.com/i/fGXaO1"><img src="https://z3.ax1x.com/2021/08/10/fGXaO1.png" class="lazyload placeholder" data-srcset="https://z3.ax1x.com/2021/08/10/fGXaO1.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="fGXaO1.png"></a></p><p>python2.7ç¯å¢ƒ</p><p>æ—§ä»£ç ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åŠŸèƒ½æè¿°ï¼šOTAä¹‹Arduino IDEæ›´æ–° V1.0ç‰ˆæœ¬ä»£ç </span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266mDNS.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;WiFiUdp.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ArduinoOTA.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">//è°ƒè¯•å®šä¹‰</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DebugBegin(baud_rate)    Serial.begin(baud_rate)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DebugPrintln(message)    Serial.println(message)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DebugPrint(message)    Serial.print(message)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DebugPrintF(...) Serial.printf( __VA_ARGS__ )</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> CodeVersion <span class="string">&quot;CodeVersion V1.0&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* ssid = <span class="string">&quot;xxxx&quot;</span>;<span class="comment">//å¡«ä¸Šwifiè´¦å·</span></span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* password = <span class="string">&quot;xxxxx&quot;</span>;<span class="comment">//å¡«ä¸Šwifiå¯†ç </span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span> &#123;</span><br><span class="line">  DebugBegin(<span class="number">115200</span>);</span><br><span class="line">  DebugPrintln(<span class="string">&quot;Booting Sketch....&quot;</span>);</span><br><span class="line">  DebugPrintln(CodeVersion);</span><br><span class="line">  WiFi.mode(WIFI_STA);</span><br><span class="line">  WiFi.begin(ssid, password);</span><br><span class="line">  <span class="keyword">while</span> (WiFi.waitForConnectResult() != WL_CONNECTED) &#123;</span><br><span class="line">    DebugPrintln(<span class="string">&quot;Connection Failed! Rebooting...&quot;</span>);</span><br><span class="line">    delay(<span class="number">5000</span>);</span><br><span class="line">  <span class="comment">//é‡å¯ESP8266æ¨¡å—</span></span><br><span class="line">    ESP.restart();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Port defaults to 8266</span></span><br><span class="line">  <span class="comment">// ArduinoOTA.setPort(8266);</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// Hostname defaults to esp8266-[ChipID]</span></span><br><span class="line">  <span class="comment">// ArduinoOTA.setHostname(&quot;myesp8266&quot;);</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// No authentication by default</span></span><br><span class="line">  <span class="comment">// ArduinoOTA.setPassword(&quot;admin&quot;);</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// Password can be set with it&#x27;s md5 value as well</span></span><br><span class="line">  <span class="comment">// MD5(admin) = 21232f297a57a5a743894a0e4a801fc3</span></span><br><span class="line">  <span class="comment">// ArduinoOTA.setPasswordHash(&quot;21232f297a57a5a743894a0e4a801fc3&quot;);</span></span><br><span class="line"></span><br><span class="line">  ArduinoOTA.onStart([]() &#123;</span><br><span class="line">    String type;</span><br><span class="line">  <span class="comment">//åˆ¤æ–­ä¸€ä¸‹OTAå†…å®¹</span></span><br><span class="line">    <span class="keyword">if</span> (ArduinoOTA.getCommand() == U_FLASH) &#123;</span><br><span class="line">      type = <span class="string">&quot;sketch&quot;</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123; <span class="comment">// U_SPIFFS</span></span><br><span class="line">      type = <span class="string">&quot;filesystem&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// <span class="doctag">NOTE:</span> if updating SPIFFS this would be the place to unmount SPIFFS using SPIFFS.end()</span></span><br><span class="line">    DebugPrintln(<span class="string">&quot;Start updating &quot;</span> + type);</span><br><span class="line">  &#125;);</span><br><span class="line">  ArduinoOTA.onEnd([]() &#123;</span><br><span class="line">    DebugPrintln(<span class="string">&quot;\nEnd&quot;</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">  ArduinoOTA.onProgress([](<span class="type">unsigned</span> <span class="type">int</span> progress, <span class="type">unsigned</span> <span class="type">int</span> total) &#123;</span><br><span class="line">    DebugPrintF(<span class="string">&quot;Progress: %u%%\r&quot;</span>, (progress / (total / <span class="number">100</span>)));</span><br><span class="line">  &#125;);</span><br><span class="line">  ArduinoOTA.onError([](<span class="type">ota_error_t</span> error) &#123;</span><br><span class="line">    DebugPrintF(<span class="string">&quot;Error[%u]: &quot;</span>, error);</span><br><span class="line">    <span class="keyword">if</span> (error == OTA_AUTH_ERROR) &#123;</span><br><span class="line">      DebugPrintln(<span class="string">&quot;Auth Failed&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (error == OTA_BEGIN_ERROR) &#123;</span><br><span class="line">      DebugPrintln(<span class="string">&quot;Begin Failed&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (error == OTA_CONNECT_ERROR) &#123;</span><br><span class="line">      DebugPrintln(<span class="string">&quot;Connect Failed&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (error == OTA_RECEIVE_ERROR) &#123;</span><br><span class="line">      DebugPrintln(<span class="string">&quot;Receive Failed&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (error == OTA_END_ERROR) &#123;</span><br><span class="line">      DebugPrintln(<span class="string">&quot;End Failed&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">  ArduinoOTA.begin();</span><br><span class="line">  DebugPrintln(<span class="string">&quot;Ready&quot;</span>);</span><br><span class="line">  DebugPrint(<span class="string">&quot;IP address: &quot;</span>);</span><br><span class="line">  DebugPrintln(WiFi.localIP());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span> &#123;</span><br><span class="line">  ArduinoOTA.handle();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>çƒ§å†™æˆåŠŸåï¼Œé‡å¯IDEï¼ˆIDEä¸8266å»ºç«‹æ— çº¿è¿æ¥ï¼‰ç«¯å£é¡¹å‡ºç°ç½‘ç»œç«¯å£</p><p>æ–°ä»£ç ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åŠŸèƒ½æè¿°ï¼šOTAä¹‹Arduino IDEæ›´æ–° V1.1ç‰ˆæœ¬ä»£ç </span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266mDNS.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;WiFiUdp.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ArduinoOTA.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">//è°ƒè¯•å®šä¹‰</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DebugBegin(baud_rate)    Serial.begin(baud_rate)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DebugPrintln(message)    Serial.println(message)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DebugPrint(message)    Serial.print(message)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DebugPrintF(...) Serial.printf( __VA_ARGS__ )</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> CodeVersion <span class="string">&quot;CodeVersion V1.1&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* ssid = <span class="string">&quot;xxxx&quot;</span>;<span class="comment">//å¡«ä¸Šwifiè´¦å·</span></span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* password = <span class="string">&quot;xxxx&quot;</span>;<span class="comment">//å¡«ä¸Šwifiå¯†ç </span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span> &#123;</span><br><span class="line">  DebugBegin(<span class="number">115200</span>);</span><br><span class="line">  DebugPrintln(<span class="string">&quot;Booting Sketch....&quot;</span>);</span><br><span class="line">  DebugPrintln(CodeVersion);</span><br><span class="line">  WiFi.mode(WIFI_STA);</span><br><span class="line">  WiFi.begin(ssid, password);</span><br><span class="line">  <span class="keyword">while</span> (WiFi.waitForConnectResult() != WL_CONNECTED) &#123;</span><br><span class="line">    DebugPrintln(<span class="string">&quot;Connection Failed! Rebooting...&quot;</span>);</span><br><span class="line">    delay(<span class="number">5000</span>);</span><br><span class="line">  <span class="comment">//é‡å¯ESP8266æ¨¡å—</span></span><br><span class="line">    ESP.restart();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Port defaults to 8266</span></span><br><span class="line">  <span class="comment">// ArduinoOTA.setPort(8266);</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// Hostname defaults to esp8266-[ChipID]</span></span><br><span class="line">  <span class="comment">// ArduinoOTA.setHostname(&quot;myesp8266&quot;);</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// No authentication by default</span></span><br><span class="line">  <span class="comment">// ArduinoOTA.setPassword(&quot;admin&quot;);</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// Password can be set with it&#x27;s md5 value as well</span></span><br><span class="line">  <span class="comment">// MD5(admin) = 21232f297a57a5a743894a0e4a801fc3</span></span><br><span class="line">  <span class="comment">// ArduinoOTA.setPasswordHash(&quot;21232f297a57a5a743894a0e4a801fc3&quot;);</span></span><br><span class="line"></span><br><span class="line">  ArduinoOTA.onStart([]() &#123;</span><br><span class="line">    String type;</span><br><span class="line">  <span class="comment">//åˆ¤æ–­ä¸€ä¸‹OTAå†…å®¹</span></span><br><span class="line">    <span class="keyword">if</span> (ArduinoOTA.getCommand() == U_FLASH) &#123;</span><br><span class="line">      type = <span class="string">&quot;sketch&quot;</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123; <span class="comment">// U_SPIFFS</span></span><br><span class="line">      type = <span class="string">&quot;filesystem&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// <span class="doctag">NOTE:</span> if updating SPIFFS this would be the place to unmount SPIFFS using SPIFFS.end()</span></span><br><span class="line">    DebugPrintln(<span class="string">&quot;Start updating &quot;</span> + type);</span><br><span class="line">  &#125;);</span><br><span class="line">  ArduinoOTA.onEnd([]() &#123;</span><br><span class="line">    DebugPrintln(<span class="string">&quot;\nEnd&quot;</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">  ArduinoOTA.onProgress([](<span class="type">unsigned</span> <span class="type">int</span> progress, <span class="type">unsigned</span> <span class="type">int</span> total) &#123;</span><br><span class="line">    DebugPrintF(<span class="string">&quot;Progress: %u%%\r&quot;</span>, (progress / (total / <span class="number">100</span>)));</span><br><span class="line">  &#125;);</span><br><span class="line">  ArduinoOTA.onError([](<span class="type">ota_error_t</span> error) &#123;</span><br><span class="line">    DebugPrintF(<span class="string">&quot;Error[%u]: &quot;</span>, error);</span><br><span class="line">    <span class="keyword">if</span> (error == OTA_AUTH_ERROR) &#123;</span><br><span class="line">      DebugPrintln(<span class="string">&quot;Auth Failed&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (error == OTA_BEGIN_ERROR) &#123;</span><br><span class="line">      DebugPrintln(<span class="string">&quot;Begin Failed&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (error == OTA_CONNECT_ERROR) &#123;</span><br><span class="line">      DebugPrintln(<span class="string">&quot;Connect Failed&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (error == OTA_RECEIVE_ERROR) &#123;</span><br><span class="line">      DebugPrintln(<span class="string">&quot;Receive Failed&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (error == OTA_END_ERROR) &#123;</span><br><span class="line">      DebugPrintln(<span class="string">&quot;End Failed&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">  ArduinoOTA.begin();</span><br><span class="line">  DebugPrintln(<span class="string">&quot;Ready&quot;</span>);</span><br><span class="line">  DebugPrint(<span class="string">&quot;IP address: &quot;</span>);</span><br><span class="line">  DebugPrintln(WiFi.localIP());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span> &#123;</span><br><span class="line">  ArduinoOTA.handle();</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="2ã€WebUpdateOTA"><a href="#2ã€WebUpdateOTA" class="headerlink" title="2ã€WebUpdateOTA"></a>2ã€WebUpdateOTA</h2><p><a href="https://imgtu.com/i/fJ9d3T"><img src="https://z3.ax1x.com/2021/08/10/fJ9d3T.png" class="lazyload placeholder" data-srcset="https://z3.ax1x.com/2021/08/10/fJ9d3T.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="fJ9d3T.png"></a></p><ol><li>ç³»ç»Ÿè‡ªå¸¦OTAä¹‹WEBæ›´æ–°ï¼ˆé€šè¿‡å»ºç«‹ webserveræ¥ä¸Šä¼ æ–°å›ºä»¶ä»¥è¾¾åˆ°æ›´æ–°ç›®çš„ï¼‰</li></ol><p>V1.1ä»£ç ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * åŠŸèƒ½æè¿°ï¼šOTAä¹‹webæ›´æ–° V1.0ç‰ˆæœ¬ä»£ç </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;WiFiClient.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WebServer.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266mDNS.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266HTTPUpdateServer.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">//è°ƒè¯•å®šä¹‰</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DebugBegin(baud_rate)    Serial.begin(baud_rate)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DebugPrintln(message)    Serial.println(message)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DebugPrint(message)    Serial.print(message)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DebugPrintF(...) Serial.printf( __VA_ARGS__ )</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> CodeVersion <span class="string">&quot;CodeVersion V1.0&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* host = <span class="string">&quot;esp8266-webupdate&quot;</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* ssid = <span class="string">&quot;xxx&quot;</span>;<span class="comment">//å¡«ä¸Šwifiè´¦å·</span></span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* password = <span class="string">&quot;xxx&quot;</span>;<span class="comment">//å¡«ä¸Šwifiå¯†ç </span></span><br><span class="line"></span><br><span class="line">ESP8266WebServer <span class="title function_">httpServer</span><span class="params">(<span class="number">80</span>)</span>;</span><br><span class="line">ESP8266HTTPUpdateServer httpUpdater;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">(<span class="type">void</span>)</span> &#123;</span><br><span class="line">  DebugBegin(<span class="number">115200</span>);</span><br><span class="line">  DebugPrintln(<span class="string">&quot;Booting Sketch...&quot;</span>);</span><br><span class="line">  DebugPrintln(CodeVersion);</span><br><span class="line">  WiFi.mode(WIFI_AP_STA);</span><br><span class="line">  WiFi.begin(ssid, password);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">while</span> (WiFi.waitForConnectResult() != WL_CONNECTED) &#123;</span><br><span class="line">    WiFi.begin(ssid, password);</span><br><span class="line">    DebugPrintln(<span class="string">&quot;WiFi failed, retrying.&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//å¯åŠ¨mdnsæœåŠ¡</span></span><br><span class="line">  MDNS.begin(host);</span><br><span class="line">  <span class="comment">//é…ç½®webserverä¸ºæ›´æ–°server</span></span><br><span class="line">  httpUpdater.setup(&amp;httpServer);</span><br><span class="line">  httpServer.begin();</span><br><span class="line"></span><br><span class="line">  MDNS.addService(<span class="string">&quot;http&quot;</span>, <span class="string">&quot;tcp&quot;</span>, <span class="number">80</span>);</span><br><span class="line">  DebugPrintF(<span class="string">&quot;HTTPUpdateServer ready! Open http://%s.local/update in your browser\n&quot;</span>, host);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">(<span class="type">void</span>)</span> &#123;</span><br><span class="line">  httpServer.handleClient();</span><br><span class="line">  MDNS.update();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åŒä¸€WIFIä¸‹ï¼Œæ‰“å¼€è°ƒè¯•å™¨ä¸­æç¤ºçš„ç½‘ç«™</p><p>ç¼–è¯‘V1.1ä»£ç ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * åŠŸèƒ½æè¿°ï¼šOTAä¹‹webæ›´æ–° V1.1ç‰ˆæœ¬ä»£ç </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;WiFiClient.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WebServer.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266mDNS.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266HTTPUpdateServer.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">//è°ƒè¯•å®šä¹‰</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DebugBegin(baud_rate)    Serial.begin(baud_rate)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DebugPrintln(message)    Serial.println(message)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DebugPrint(message)    Serial.print(message)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DebugPrintF(...) Serial.printf( __VA_ARGS__ )</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> CodeVersion <span class="string">&quot;CodeVersion V1.1&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* host = <span class="string">&quot;esp8266-webupdate&quot;</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* ssid = <span class="string">&quot;xxx&quot;</span>;<span class="comment">//å¡«ä¸Šwifiè´¦å·</span></span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* password = <span class="string">&quot;xxx&quot;</span>;<span class="comment">//å¡«ä¸Šwifiå¯†ç </span></span><br><span class="line"></span><br><span class="line">ESP8266WebServer <span class="title function_">httpServer</span><span class="params">(<span class="number">80</span>)</span>;</span><br><span class="line">ESP8266HTTPUpdateServer httpUpdater;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">(<span class="type">void</span>)</span> &#123;</span><br><span class="line">  DebugBegin(<span class="number">115200</span>);</span><br><span class="line">  DebugPrintln(<span class="string">&quot;Booting Sketch...&quot;</span>);</span><br><span class="line">  DebugPrintln(CodeVersion);</span><br><span class="line">  WiFi.mode(WIFI_AP_STA);</span><br><span class="line">  WiFi.begin(ssid, password);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">while</span> (WiFi.waitForConnectResult() != WL_CONNECTED) &#123;</span><br><span class="line">    WiFi.begin(ssid, password);</span><br><span class="line">    DebugPrintln(<span class="string">&quot;WiFi failed, retrying.&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//å¯åŠ¨mdnsæœåŠ¡</span></span><br><span class="line">  MDNS.begin(host);</span><br><span class="line">  <span class="comment">//é…ç½®webserverä¸ºæ›´æ–°server</span></span><br><span class="line">  httpUpdater.setup(&amp;httpServer);</span><br><span class="line">  httpServer.begin();</span><br><span class="line"></span><br><span class="line">  MDNS.addService(<span class="string">&quot;http&quot;</span>, <span class="string">&quot;tcp&quot;</span>, <span class="number">80</span>);</span><br><span class="line">  DebugPrintF(<span class="string">&quot;HTTPUpdateServer ready! Open http://%s.local/update in your browser\n&quot;</span>, host);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">(<span class="type">void</span>)</span> &#123;</span><br><span class="line">  httpServer.handleClient();</span><br><span class="line">  MDNS.update();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é€‰æ‹©binæ–‡ä»¶ï¼Œé€šè¿‡WEBç½‘é¡µä¸Šä¼ </p><ol start="2"><li>è‡ªå®šä¹‰OTAä¹‹WEBæ›´æ–°ï¼ˆä¸ªæ€§åŒ–é¡µé¢ï¼‰</li></ol><h2 id="3-SerialUpdateOTAâ€”OTAä¹‹æœåŠ¡å™¨æ›´æ–°"><a href="#3-SerialUpdateOTAâ€”OTAä¹‹æœåŠ¡å™¨æ›´æ–°" class="headerlink" title="3.SerialUpdateOTAâ€”OTAä¹‹æœåŠ¡å™¨æ›´æ–°"></a>3.SerialUpdateOTAâ€”OTAä¹‹æœåŠ¡å™¨æ›´æ–°</h2><p><a href="https://imgtu.com/i/ftmccj"><img src="https://z3.ax1x.com/2021/08/10/ftmccj.png" class="lazyload placeholder" data-srcset="https://z3.ax1x.com/2021/08/10/ftmccj.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="ftmccj.png"></a></p><p>æ”¾åœ¨æœåŠ¡å™¨ä¸Šï¼Œæ— æ„ŸçŸ¥æ›´æ–°</p><h1 id="22ã€WebSocket-Clientâ€“å…¨åŒå·¥é€šä¿¡"><a href="#22ã€WebSocket-Clientâ€“å…¨åŒå·¥é€šä¿¡" class="headerlink" title="22ã€WebSocket Clientâ€“å…¨åŒå·¥é€šä¿¡"></a>22ã€WebSocket Clientâ€“å…¨åŒå·¥é€šä¿¡</h1><p>é—®é¢˜ï¼šHTTPï¼šä¸€ä¸ª<em><strong>è¯·æ±‚-å“åº”</strong></em>åº”ç”¨å±‚åè®®ï¼Œå®¢æˆ·ç«¯æ²¡æœ‰ä¸»åŠ¨å‘è¯·æ±‚ï¼ŒæœåŠ¡å™¨ä¸èƒ½ä¸»åŠ¨ç»™å®¢æˆ·ç«¯å‘æ•°æ®</p><p>æ–¹æ³•ï¼š</p><ol><li><em><strong>è½®è¯¢</strong></em>ï¼ˆæµªè´¹å¸¦å®½èµ„æºï¼‰</li><li>åº”ç”¨å±‚åè®®è§£å†³<em><strong>MQTT</strong></em>åè®®</li><li><em><strong>WebSocket</strong></em>åè®®ï¼šè®©å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨ä¹‹é—´å»ºç«‹æ— é™åˆ¶çš„å…¨åŒå·¥é€šä¿¡ï¼Œä»»ä½•ä¸€æ–¹éƒ½å¯ä¸»åŠ¨å‘æ¶ˆæ¯ç»™å¯¹æ–¹ï¼ˆHTML5å®šä¹‰çš„åè®®ï¼Œæ›´å¥½çš„èŠ‚çœæœåŠ¡å™¨èµ„æºå’Œå¸¦å®½ï¼Œå¹¶å®æ—¶è¿›è¡Œé€šè®¯ï¼‰</li></ol><p>ä¸¤é˜¶æ®µï¼š</p><ol><li><p>é€šè¿‡HTTPè¯·æ±‚ç¡®è®¤WebSocketæ¡æ‰‹åè®®é˜¶æ®µï¼›</p></li><li><p>é€šè¿‡WebSocketäº¤äº’æ•°æ®é˜¶æ®µã€‚</p></li></ol><h1 id="23ã€ä¾‹ç¨‹"><a href="#23ã€ä¾‹ç¨‹" class="headerlink" title="23ã€ä¾‹ç¨‹"></a>23ã€ä¾‹ç¨‹</h1><h2 id="1ã€å±€åŸŸç½‘åº”ç”¨â€“ç‚«é…·RGB"><a href="#1ã€å±€åŸŸç½‘åº”ç”¨â€“ç‚«é…·RGB" class="headerlink" title="1ã€å±€åŸŸç½‘åº”ç”¨â€“ç‚«é…·RGB"></a>1ã€å±€åŸŸç½‘åº”ç”¨â€“ç‚«é…·RGB</h2><p>ç›¸å…³æŠ€æœ¯ç‚¹ï¼š</p><ul><li>ArduinoJsonåº“</li><li>TCP ServeræœåŠ¡</li><li>STAæ¨¡å¼</li><li>ä¸€é”®é…ç½‘</li></ul><p>å†…å®¹ï¼š</p><p>æ‰‹æœºã€ESP8266å‡è¿æ¥åœ¨åŒä¸€ä¸ªè·¯ç”±å™¨wifiï¼Œ8266ä½œä¸ºæœåŠ¡ç«¯ï¼Œæ‰‹æœºä½œä¸ºå®¢æˆ·ç«¯ï¼Œæ‰‹æœºå†é€šè¿‡wifiç»™8266å‘é€æ•°æ®ï¼Œ8266æ¥æ”¶åˆ°æ•°æ®å†æŠŠæ•°æ®å‘ç»™Arduinoï¼ˆä¸²å£é€šä¿¡ï¼‰,Arduinoè§£ææ•°æ®è¾¾åˆ°æ§åˆ¶æ•ˆæœ</p><p>å®ç°ï¼š</p><p><a href="https://github.com/tingyouwu/WifiLamp">APPæºç åœ°å€</a></p><p>8266ç«¯ä»£ç ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* åŠŸèƒ½ï¼šwifi RGB 8266ç«¯</span></span><br><span class="line"><span class="comment">*       åŠ å…¥SmartConfigåŠŸèƒ½</span></span><br><span class="line"><span class="comment">**/</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MAX_SRV_CLIENTS 3   <span class="comment">//æœ€å¤§åŒæ—¶è”æ¥æ•°ï¼Œå³ä½ æƒ³è¦æ¥å…¥çš„è®¾å¤‡æ•°é‡ï¼Œ8266tcpserveråªèƒ½æ¥å…¥äº”ä¸ª</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LED 2</span></span><br><span class="line">  </span><br><span class="line">WiFiServer <span class="title function_">server</span><span class="params">(<span class="number">8266</span>)</span>;    <span class="comment">//ä½ è¦çš„ç«¯å£å·ï¼Œéšæ„ä¿®æ”¹ï¼ŒèŒƒå›´0-65535</span></span><br><span class="line">WiFiClient serverClients[MAX_SRV_CLIENTS];</span><br><span class="line"><span class="type">int</span> flag = HIGH;<span class="comment">//é»˜è®¤å½“å‰ç­ç¯</span></span><br><span class="line">  </span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span> &#123;</span><br><span class="line">  Serial.begin(<span class="number">115200</span>);</span><br><span class="line">  pinMode(LED,OUTPUT);</span><br><span class="line">  digitalWrite(LED, HIGH);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span>(!autoConfig())&#123;              <span class="comment">//è¿æ¥WIFIï¼Œå…ˆæ˜¯è‡ªåŠ¨è¿æ¥ï¼Œè¶…è¿‡20ç§’è‡ªåŠ¨è¿æ¥å¤±è´¥ï¼Œå¼€å§‹smartConfig()</span></span><br><span class="line">    smartConfig();</span><br><span class="line">    Serial.print(<span class="string">&quot;Connecting to WiFi&quot;</span>);</span><br><span class="line">    <span class="keyword">while</span> (WiFi.status() != WL_CONNECTED) &#123;</span><br><span class="line">       delay(<span class="number">500</span>);</span><br><span class="line">       Serial.print(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  delay(<span class="number">1000</span>);</span><br><span class="line">  digitalWrite(LED, LOW);</span><br><span class="line">  Serial.println(<span class="string">&quot;IP address: &quot;</span>);</span><br><span class="line">  Serial.println(WiFi.localIP());      <span class="comment">//WiFi.localIP()è¿”å›8266è·å¾—çš„ipåœ°å€</span></span><br><span class="line">  server.begin();</span><br><span class="line">  server.setNoDelay(<span class="literal">true</span>);  <span class="comment">//åŠ ä¸Šåæ‰æ­£å¸¸äº›</span></span><br><span class="line">  <span class="comment">//ä½¿èƒ½è½¯ä»¶çœ‹é—¨ç‹—çš„è§¦å‘é—´éš”</span></span><br><span class="line">  ESP.wdtEnable(<span class="number">5000</span>);</span><br><span class="line">&#125;</span><br><span class="line">  </span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="type">uint8_t</span> index;</span><br><span class="line">  <span class="keyword">if</span> (server.hasClient())&#123;</span><br><span class="line">        <span class="keyword">for</span> (index = <span class="number">0</span>; index &lt; MAX_SRV_CLIENTS; index++)&#123;</span><br><span class="line">            <span class="keyword">if</span> (!serverClients[index] || !serverClients[index].connected())&#123;</span><br><span class="line">                <span class="keyword">if</span> (serverClients[index]) serverClients[index].stop();<span class="comment">//æœªè”æ¥,å°±é‡Šæ”¾</span></span><br><span class="line">                serverClients[index] = server.available();<span class="comment">//åˆ†é…æ–°çš„</span></span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//8266tcpserveråªèƒ½æ¥å…¥äº”ä¸ª  è¶…å‡ºçš„éœ€è¦é‡Šæ”¾</span></span><br><span class="line">        WiFiClient serverClient = server.available();</span><br><span class="line">        <span class="keyword">if</span> (serverClient)&#123;</span><br><span class="line">          serverClient.stop();</span><br><span class="line">        &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">for</span> (index = <span class="number">0</span>; index &lt; MAX_SRV_CLIENTS; index++)&#123;</span><br><span class="line">        <span class="keyword">if</span> (serverClients[index] &amp;&amp; serverClients[index].connected())&#123;</span><br><span class="line">            <span class="comment">//å¤„ç†å®¢æˆ·ç«¯å‘è¿‡æ¥çš„æ•°æ®</span></span><br><span class="line">            <span class="keyword">if</span> (serverClients[index].available())&#123;</span><br><span class="line">                <span class="keyword">while</span> (serverClients[index].available()) </span><br><span class="line">                    <span class="comment">//æŠŠæ•°æ®å‘é€ç»™mega</span></span><br><span class="line">                    Serial.write(serverClients[index].read());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">if</span>(Serial.available()&gt;<span class="number">0</span>)&#123;</span><br><span class="line">      <span class="type">char</span> ch = Serial.read();</span><br><span class="line">      <span class="comment">//æ”¶åˆ°ardunioå‘è¿‡æ¥çš„è¿›å…¥smartconfigæ¨¡å¼çš„å‘½ä»¤</span></span><br><span class="line">      <span class="keyword">if</span>(ch == <span class="string">&#x27;1&#x27;</span>)&#123;</span><br><span class="line">        smartConfig();</span><br><span class="line">        delay(<span class="number">1000</span>);</span><br><span class="line">        digitalWrite(LED, LOW);</span><br><span class="line">        Serial.println(<span class="string">&quot;IP address: &quot;</span>);</span><br><span class="line">        Serial.println(WiFi.localIP());<span class="comment">//WiFi.localIP()è¿”å›8266è·å¾—çš„ipåœ°å€</span></span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">//å–‚ç‹—</span></span><br><span class="line">   ESP.wdtFeed();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* è‡ªåŠ¨è¿æ¥20s è¶…è¿‡ä¹‹åè‡ªåŠ¨è¿›å…¥SmartConfigæ¨¡å¼</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">bool</span> <span class="title function_">autoConfig</span><span class="params">()</span>&#123;</span><br><span class="line">  WiFi.mode(WIFI_AP_STA);     <span class="comment">//è®¾ç½®esp8266 å·¥ä½œæ¨¡å¼</span></span><br><span class="line">  WiFi.begin();</span><br><span class="line">  delay(<span class="number">2000</span>);                <span class="comment">//åˆšå¯åŠ¨æ¨¡å—çš„è¯ å»¶æ—¶ç¨³å®šä¸€ä¸‹</span></span><br><span class="line">  Serial.println(<span class="string">&quot;AutoConfiging ......&quot;</span>);</span><br><span class="line">  <span class="keyword">for</span>(<span class="type">int</span> index=<span class="number">0</span>;index&lt;<span class="number">20</span>;index++)&#123;</span><br><span class="line">    <span class="type">int</span> wstatus = WiFi.status();</span><br><span class="line">    <span class="keyword">if</span> (wstatus == WL_CONNECTED)&#123;</span><br><span class="line">      Serial.println(<span class="string">&quot;AutoConfig Success&quot;</span>);</span><br><span class="line">      Serial.print(<span class="string">&quot;SSID:&quot;</span>);</span><br><span class="line">      Serial.println(WiFi.SSID().c_str());</span><br><span class="line">      Serial.print(<span class="string">&quot;PSW:&quot;</span>);</span><br><span class="line">      Serial.println(WiFi.psk().c_str());</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">      Serial.print(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">      delay(<span class="number">1000</span>);</span><br><span class="line">      flag = !flag;</span><br><span class="line">      digitalWrite(LED, flag);</span><br><span class="line">    &#125; </span><br><span class="line">  &#125;</span><br><span class="line">  Serial.println(<span class="string">&quot;AutoConfig Faild!&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* å¼€å¯SmartConfigåŠŸèƒ½</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">smartConfig</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  WiFi.mode(WIFI_STA);</span><br><span class="line">  delay(<span class="number">2000</span>);</span><br><span class="line">  Serial.println(<span class="string">&quot;Wait for Smartconfig&quot;</span>);<span class="comment">// ç­‰å¾…é…ç½‘</span></span><br><span class="line">  WiFi.beginSmartConfig();</span><br><span class="line">  <span class="keyword">while</span> (<span class="number">1</span>)&#123;</span><br><span class="line">    Serial.print(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">    delay(<span class="number">500</span>);</span><br><span class="line">    flag = !flag;</span><br><span class="line">    digitalWrite(LED, flag);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (WiFi.smartConfigDone())&#123;</span><br><span class="line">      <span class="comment">//smartconfigé…ç½®å®Œæ¯•</span></span><br><span class="line">      Serial.println(<span class="string">&quot;SmartConfig Success&quot;</span>);</span><br><span class="line">      Serial.print(<span class="string">&quot;SSID:&quot;</span>);</span><br><span class="line">      Serial.println(WiFi.SSID().c_str());</span><br><span class="line">      Serial.print(<span class="string">&quot;PSW:&quot;</span>);</span><br><span class="line">      Serial.println(WiFi.psk().c_str());</span><br><span class="line">      WiFi.mode(WIFI_AP_STA);     <span class="comment">//è®¾ç½®esp8266 å·¥ä½œæ¨¡å¼</span></span><br><span class="line">      WiFi.setAutoConnect(<span class="literal">true</span>);  <span class="comment">// è®¾ç½®è‡ªåŠ¨è¿æ¥</span></span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Arduinoç«¯ä»£ç ï¼šï¼ˆæ¥æ”¶8266ä¿¡æ¯ï¼ŒJSONè§£æï¼‰</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* åŠŸèƒ½ï¼šwifi lamp arduinoç«¯</span></span><br><span class="line"><span class="comment">**/</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;SoftwareSerial.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ArduinoJson.h&gt;</span></span></span><br><span class="line">  </span><br><span class="line"><span class="type">const</span> <span class="type">unsigned</span> <span class="type">long</span> BAUD_RATE = <span class="number">115200</span>;                   <span class="comment">// serial connection speed</span></span><br><span class="line"><span class="type">const</span> <span class="type">size_t</span> MAX_CONTENT_SIZE = <span class="number">50</span>; </span><br><span class="line"><span class="type">const</span> <span class="type">size_t</span> t_bright=<span class="number">1</span>,t_color=<span class="number">2</span>,t_frequency=<span class="number">3</span>,t_switch=<span class="number">4</span>;</span><br><span class="line"> </span><br><span class="line"><span class="comment">//#define UNO      //uncomment this line when you use it with UNO board</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MEGA    <span class="comment">//uncomment this line when you use it with MEGA board</span></span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> UNO</span></span><br><span class="line"> SoftwareSerial <span class="title function_">mySerial</span><span class="params">(<span class="number">10</span>,<span class="number">11</span>)</span>;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">  </span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> UNO</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> WifiSerial  Serial</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MyDebugSerial mySerial</span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">   </span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> MEGA</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> WifiSerial Serial1</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MyDebugSerial Serial</span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span>  </span></span><br><span class="line"> </span><br><span class="line"><span class="comment">//è¯¥æ¡è¯­å¥ç”¨äºä½¿èƒ½DEBUGè¾“å‡ºä¿¡æ¯ï¼Œå±è”½æ‰å°±ä¸ä¼šè¾“å‡ºdebugè°ƒè¯•ä¿¡æ¯</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DEBUG</span></span><br><span class="line"><span class="comment">//è¯¥æ¡è¯­å¥ç”¨äºä½¿èƒ½æ˜¯å…±é˜´RGB  å±è”½æ‰å°±æ˜¯å…±é˜³RGB</span></span><br><span class="line"><span class="comment">//#define COMMON_GND</span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> DEBUG</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DBGLN(message)    MyDebugSerial.println(message)</span></span><br><span class="line"><span class="meta">#<span class="keyword">else</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DBGLN(message)</span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> UNO </span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PIN_RED 3 <span class="comment">//red å¼•è„š</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PIN_GREEN 5 <span class="comment">//green å¼•è„š</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PIN_BLUE 6 <span class="comment">//blue å¼•è„š</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PIN_ENABLE 9  <span class="comment">//ä½¿èƒ½å¼•è„š pwmæ§åˆ¶äº®åº¦</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PIN_KEY 7<span class="comment">// æŒ‰é”®</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">else</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PIN_RED 2</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PIN_GREEN 3</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PIN_BLUE 4</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PIN_ENABLE 5</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PIN_KEY 6  </span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span> </span></span><br><span class="line"> </span><br><span class="line"><span class="type">int</span> red = <span class="number">0</span>,green = <span class="number">0</span>,blue = <span class="number">0</span>;</span><br><span class="line"><span class="type">int</span> type = <span class="number">4</span>;<span class="comment">//å½“å‰æ¨¡å¼ 1äº®åº¦ 2é¢œè‰² 3å‘¼å¸ 4å¼€å…³</span></span><br><span class="line"><span class="type">int</span> frequency = <span class="number">1</span>;<span class="comment">//é¢‘ç‡</span></span><br><span class="line"><span class="type">int</span> switch_status = <span class="number">1</span>;<span class="comment">//å…³é—­ or å¼€å¯</span></span><br><span class="line"><span class="type">int</span> bright = <span class="number">1</span>;<span class="comment">//äº®åº¦</span></span><br><span class="line"> </span><br><span class="line"><span class="type">char</span> response[MAX_CONTENT_SIZE];</span><br><span class="line"><span class="type">int</span> fadeValue = <span class="number">0</span>;<span class="comment">//å½“å‰äº®åº¦</span></span><br><span class="line"><span class="type">bool</span> isAdd = <span class="literal">true</span>;<span class="comment">//æ˜¯å¦æ˜¯ä»æš—åˆ°äº®</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">// å®šä¹‰è®°å½•æŒ‰é”®å½“å‰çŠ¶æ€çš„å˜é‡</span></span><br><span class="line"><span class="type">int</span> state_btn;</span><br><span class="line"><span class="comment">// å®šä¹‰è®°å½•æŒ‰é”®æœ€è¿‘ä¸€æ¬¡çŠ¶æ€å˜åŒ–çš„å˜é‡ï¼Œå¹¶åˆå§‹åŒ–çŠ¶æ€ä¸ºLOWã€‚</span></span><br><span class="line"><span class="type">int</span> lastButtonState = LOW;</span><br><span class="line"><span class="comment">// å®šä¹‰è®°å½•æœ€è¿‘ä¸€æ¬¡æŠ–åŠ¨çš„æ—¶é—´å˜é‡ï¼Œå¹¶åˆå§‹åŒ–æ—¶é—´ä¸º0æ¯«ç§’ã€‚</span></span><br><span class="line"><span class="type">long</span> lastDebounceTime = <span class="number">0</span>;</span><br><span class="line"><span class="comment">// å®šä¹‰å»¶è¿ŸæŠ–åŠ¨çš„æ—¶é—´å˜é‡</span></span><br><span class="line"><span class="type">long</span> debouncdDelay = <span class="number">60</span>;</span><br><span class="line">  </span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* @Desc åˆå§‹åŒ–æ“ä½œ</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span> &#123;</span><br><span class="line">  pinMode(PIN_RED, OUTPUT);</span><br><span class="line">  pinMode(PIN_GREEN, OUTPUT);</span><br><span class="line">  pinMode(PIN_BLUE, OUTPUT);</span><br><span class="line">  pinMode(PIN_ENABLE, OUTPUT);</span><br><span class="line">  pinMode(PIN_KEY,INPUT);</span><br><span class="line">  </span><br><span class="line">  WifiSerial.begin(BAUD_RATE);</span><br><span class="line">  <span class="meta">#<span class="keyword">ifdef</span> DEBUG</span></span><br><span class="line">    <span class="meta">#<span class="keyword">ifdef</span> UNO</span></span><br><span class="line">      MyDebugSerial.begin(<span class="number">9600</span>);<span class="comment">//è½¯ä¸²å£9600ç¨³å®š</span></span><br><span class="line">    <span class="meta">#<span class="keyword">else</span></span></span><br><span class="line">      MyDebugSerial.begin(BAUD_RATE);</span><br><span class="line">    <span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">  <span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">  DBGLN(<span class="string">&quot;Arduino Init End&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">  </span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* @Desc  ä¸»å‡½æ•°</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span> &#123;</span><br><span class="line"> </span><br><span class="line">  <span class="keyword">if</span>(WifiSerial.available()&gt;<span class="number">0</span>)&#123;</span><br><span class="line">    clrEsp8266ResponseBuffer();</span><br><span class="line">    <span class="type">int</span> data_size = ReceiveMessage(response, <span class="keyword">sizeof</span>(response));</span><br><span class="line">    <span class="keyword">if</span>(data_size&gt;<span class="number">0</span>)&#123;</span><br><span class="line">      <span class="comment">//å¼€å§‹è§£ææ•°æ®</span></span><br><span class="line">      parseData(response);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="keyword">if</span>(type == t_frequency)&#123;</span><br><span class="line">    <span class="comment">//å‘¼å¸ç¯æ•ˆæœ</span></span><br><span class="line">    breatheRGB(frequency);</span><br><span class="line">  &#125;</span><br><span class="line">  checkButton();</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* è¯»å–ä¸²å£ç¼“å†²åŒºé‡Œé¢çš„æ•°æ®</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">ReceiveMessage</span><span class="params">(<span class="type">char</span>* content, <span class="type">size_t</span> maxSize)</span>&#123;</span><br><span class="line">  <span class="comment">//ä¸ç”¨ readBytes å› ä¸ºæ¯”è¾ƒè€—æ—¶</span></span><br><span class="line">  <span class="type">size_t</span> length = WifiSerial.readBytesUntil(<span class="string">&#x27;&#125;&#x27;</span>,content, maxSize);</span><br><span class="line">  content[length] = <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">  content[++length] = <span class="number">0</span>;</span><br><span class="line">  DBGLN(content);</span><br><span class="line">  <span class="keyword">return</span> length;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * @Desc è§£æjson</span></span><br><span class="line"><span class="comment">     * æœ‰ä¸‰ç§</span></span><br><span class="line"><span class="comment">     * 1.äº®åº¦æ§åˆ¶é¡µé¢(0 æš— 1æ­£å¸¸ 2äº®)</span></span><br><span class="line"><span class="comment">     * &#123;</span></span><br><span class="line"><span class="comment">     *     &quot;t&quot;: 1,</span></span><br><span class="line"><span class="comment">     *     &quot;bb&quot;: 2</span></span><br><span class="line"><span class="comment">     * &#125;</span></span><br><span class="line"><span class="comment">     * 2.é¢œè‰²æ§åˆ¶é¡µé¢</span></span><br><span class="line"><span class="comment">     * &#123;</span></span><br><span class="line"><span class="comment">     *     &quot;t&quot;: 2,</span></span><br><span class="line"><span class="comment">     *     &quot;cr&quot;: 154,</span></span><br><span class="line"><span class="comment">     *     &quot;cg&quot;: 147,</span></span><br><span class="line"><span class="comment">     *     &quot;cb&quot;: 255</span></span><br><span class="line"><span class="comment">     * &#125;</span></span><br><span class="line"><span class="comment">     * 3.å‘¼å¸ç¯æ§åˆ¶é¡µé¢(0 æ…¢å‘¼å¸ 1æ­£å¸¸ 2å¿«)</span></span><br><span class="line"><span class="comment">     * &#123;</span></span><br><span class="line"><span class="comment">     *    &quot;t&quot;: 3,</span></span><br><span class="line"><span class="comment">     *    &quot;gf&quot;: 1</span></span><br><span class="line"><span class="comment">     * &#125;</span></span><br><span class="line"><span class="comment">     * 4.å¼€å…³æ§åˆ¶(0å…³é—­ 1å¼€å¯)</span></span><br><span class="line"><span class="comment">     * &#123;</span></span><br><span class="line"><span class="comment">     *    &quot;t&quot;: 4,</span></span><br><span class="line"><span class="comment">     *    &quot;ss&quot;: 1</span></span><br><span class="line"><span class="comment">     * &#125; </span></span><br><span class="line"><span class="comment">     **/</span></span><br><span class="line"><span class="type">bool</span> <span class="title function_">parseData</span><span class="params">(<span class="type">char</span>* content)</span> &#123;</span><br><span class="line"><span class="comment">//    -- æ ¹æ®æˆ‘ä»¬éœ€è¦è§£æçš„æ•°æ®æ¥è®¡ç®—JSONç¼“å†²åŒºæœ€ä½³å¤§å°</span></span><br><span class="line"><span class="comment">//   å¦‚æœä½ ä½¿ç”¨StaticJsonBufferæ—¶æ‰éœ€è¦</span></span><br><span class="line"><span class="comment">//    const size_t BUFFER_SIZE = 1024;</span></span><br><span class="line"><span class="comment">//   åœ¨å †æ ˆä¸Šåˆ†é…ä¸€ä¸ªä¸´æ—¶å†…å­˜æ± </span></span><br><span class="line"><span class="comment">//    StaticJsonBuffer&lt;BUFFER_SIZE&gt; jsonBuffer;</span></span><br><span class="line"><span class="comment">//    -- å¦‚æœå †æ ˆçš„å†…å­˜æ± å¤ªå¤§ï¼Œä½¿ç”¨ DynamicJsonBuffer jsonBuffer ä»£æ›¿</span></span><br><span class="line">  DynamicJsonBuffer jsonBuffer;</span><br><span class="line">   </span><br><span class="line">  JsonObject&amp; root = jsonBuffer.parseObject(content);</span><br><span class="line">   </span><br><span class="line">  <span class="keyword">if</span> (!root.success()) &#123;</span><br><span class="line">    Serial.println(<span class="string">&quot;JSON parsing failed!&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line">    </span><br><span class="line">  type = root[<span class="string">&quot;t&quot;</span>];</span><br><span class="line">  <span class="keyword">switch</span>(type)&#123;</span><br><span class="line">    <span class="keyword">case</span> t_bright:</span><br><span class="line">         bright = root[<span class="string">&quot;bb&quot;</span>];</span><br><span class="line">         brightRGB(bright);</span><br><span class="line">         <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> t_color:</span><br><span class="line">         red = root[<span class="string">&quot;cr&quot;</span>];</span><br><span class="line">         green = root[<span class="string">&quot;cg&quot;</span>];</span><br><span class="line">         blue = root[<span class="string">&quot;cb&quot;</span>];</span><br><span class="line">         colorRGB(red,green,blue);</span><br><span class="line">         <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> t_frequency:</span><br><span class="line">         frequency = root[<span class="string">&quot;gf&quot;</span>];</span><br><span class="line">         <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> t_switch:</span><br><span class="line">         switch_status = root[<span class="string">&quot;ss&quot;</span>];</span><br><span class="line">         <span class="type">bool</span> enable = switch_status == <span class="number">1</span>;</span><br><span class="line">         switchRGB(enable);</span><br><span class="line">         <span class="keyword">break</span>;     </span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* æ§åˆ¶ç¯äº®åº¦</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">brightRGB</span><span class="params">(<span class="type">int</span> bright)</span>&#123;</span><br><span class="line">  <span class="type">int</span> level = bright%<span class="number">3</span>;</span><br><span class="line">  <span class="type">int</span> bright_level;</span><br><span class="line">  <span class="keyword">switch</span>(level)&#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">0</span>:<span class="comment">//æš—  50</span></span><br><span class="line">      bright_level = <span class="number">50</span>;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">1</span>:<span class="comment">//æ­£å¸¸ 100</span></span><br><span class="line">      bright_level = <span class="number">100</span>;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">2</span>:<span class="comment">//äº®  200</span></span><br><span class="line">      bright_level = <span class="number">200</span>;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">  &#125;</span><br><span class="line">    <span class="meta">#<span class="keyword">ifdef</span> COMMON_GND</span></span><br><span class="line">     <span class="comment">//å…±åœ°</span></span><br><span class="line">     analogWrite(PIN_ENABLE,bright_level);</span><br><span class="line">    <span class="meta">#<span class="keyword">else</span></span></span><br><span class="line">     analogWrite(PIN_ENABLE,<span class="number">255</span>-bright_level);</span><br><span class="line">    <span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* æ§åˆ¶RGBé¢œè‰²</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">colorRGB</span><span class="params">(<span class="type">int</span> red, <span class="type">int</span> green, <span class="type">int</span> blue)</span>&#123;</span><br><span class="line">  <span class="meta">#<span class="keyword">ifdef</span> COMMON_GND</span></span><br><span class="line">     analogWrite(PIN_RED,constrain(red,<span class="number">0</span>,<span class="number">255</span>));</span><br><span class="line">     analogWrite(PIN_GREEN,constrain(green,<span class="number">0</span>,<span class="number">255</span>));</span><br><span class="line">     analogWrite(PIN_BLUE,constrain(blue,<span class="number">0</span>,<span class="number">255</span>));</span><br><span class="line">  <span class="meta">#<span class="keyword">else</span></span></span><br><span class="line">     analogWrite(PIN_RED,constrain(<span class="number">255</span>-red,<span class="number">0</span>,<span class="number">255</span>));</span><br><span class="line">     analogWrite(PIN_GREEN,constrain(<span class="number">255</span>-green,<span class="number">0</span>,<span class="number">255</span>));</span><br><span class="line">     analogWrite(PIN_BLUE,constrain(<span class="number">255</span>-blue,<span class="number">0</span>,<span class="number">255</span>));</span><br><span class="line">  <span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* æ§åˆ¶äº®ç­</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">switchRGB</span><span class="params">(<span class="type">bool</span> enable)</span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(enable)&#123;</span><br><span class="line">    <span class="comment">//æ‰“å¼€</span></span><br><span class="line">    <span class="meta">#<span class="keyword">ifdef</span> COMMON_GND</span></span><br><span class="line">     <span class="comment">//å…±åœ°</span></span><br><span class="line">     analogWrite(PIN_ENABLE,<span class="number">255</span>);</span><br><span class="line">    <span class="meta">#<span class="keyword">else</span></span></span><br><span class="line">     analogWrite(PIN_ENABLE,<span class="number">0</span>);</span><br><span class="line">    <span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">  &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="comment">//å…³é—­</span></span><br><span class="line">    <span class="meta">#<span class="keyword">ifdef</span> COMMON_GND</span></span><br><span class="line">     <span class="comment">//å…±åœ°</span></span><br><span class="line">     analogWrite(PIN_ENABLE,<span class="number">0</span>);</span><br><span class="line">    <span class="meta">#<span class="keyword">else</span></span></span><br><span class="line">     analogWrite(PIN_ENABLE,<span class="number">255</span>);</span><br><span class="line">    <span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* å‘¼å¸ç¯</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">breatheRGB</span><span class="params">(<span class="type">int</span> frequency)</span>&#123;</span><br><span class="line">  <span class="type">int</span> level = frequency%<span class="number">3</span>;</span><br><span class="line">  <span class="type">int</span> f_level;</span><br><span class="line">  <span class="keyword">switch</span>(level)&#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">0</span>:<span class="comment">//æ…¢  50</span></span><br><span class="line">      f_level = <span class="number">3</span>;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">1</span>:<span class="comment">//æ­£å¸¸ 100</span></span><br><span class="line">      f_level = <span class="number">10</span>;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">2</span>:<span class="comment">//å¿«  200</span></span><br><span class="line">      f_level = <span class="number">20</span>;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span>(isAdd)&#123;</span><br><span class="line">    <span class="comment">//é€’å¢æ–¹å‘</span></span><br><span class="line">     fadeValue +=f_level;</span><br><span class="line">     <span class="keyword">if</span>(fadeValue&gt;=<span class="number">255</span>)&#123;</span><br><span class="line">       fadeValue = <span class="number">255</span>;</span><br><span class="line">       isAdd =<span class="literal">false</span>;</span><br><span class="line">     &#125;</span><br><span class="line">  &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="comment">//é€’å‡æ–¹å‘</span></span><br><span class="line">    fadeValue -=f_level;</span><br><span class="line">     <span class="keyword">if</span>(fadeValue&lt;=<span class="number">0</span>)&#123;</span><br><span class="line">       fadeValue = <span class="number">0</span>;</span><br><span class="line">       isAdd =<span class="literal">true</span>;</span><br><span class="line">     &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  analogWrite(PIN_ENABLE,fadeValue);</span><br><span class="line">  delay(<span class="number">20</span>);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* æ£€æŸ¥æŒ‰é”®åŠŸèƒ½</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">checkButton</span><span class="params">()</span>&#123;</span><br><span class="line">  <span class="type">int</span> buttonState = digitalRead(PIN_KEY);<span class="comment">//è¯»å–å½“å‰æŒ‰é”®çŠ¶æ€</span></span><br><span class="line">  <span class="keyword">if</span>(buttonState != lastButtonState)&#123;</span><br><span class="line">     <span class="comment">//å¦‚æœæŒ‰é”®å‘ç”Ÿäº†å˜åŒ–  åˆ™é‡æ–°è®¾ç½®æœ€è¿‘ä¸€æ¬¡æŠ–åŠ¨çš„æ—¶é—´</span></span><br><span class="line">     <span class="comment">//æ–¹æ³•millis()å¯ä»¥è·å–å½“å‰æ—¶é—´ï¼Œå•ä½ç»Ÿä¸€ä¸ºæ¯«ç§’ã€‚</span></span><br><span class="line">     lastDebounceTime = millis();  </span><br><span class="line">  &#125;</span><br><span class="line">   </span><br><span class="line">  <span class="comment">// åˆ¤æ–­æŒ‰é”®æŒ‰ä¸‹çŠ¶æ€æ—¶é—´é—´éš”æ˜¯å¦å¤§äºå»¶è¿ŸæŠ–åŠ¨çš„æ—¶é—´é•¿åº¦ã€‚</span></span><br><span class="line">  <span class="keyword">if</span>(millis()-lastDebounceTime&gt;debouncdDelay)&#123;</span><br><span class="line">    <span class="comment">// åˆ¤æ–­å½“å‰çš„æŒ‰é”®çŠ¶æ€æ˜¯å¦å’Œä¹‹å‰æœ‰æ‰€å˜åŒ–</span></span><br><span class="line">    <span class="keyword">if</span>(buttonState != state_btn)&#123;</span><br><span class="line">       <span class="comment">// å¦‚æœå‘ç”Ÿäº†å˜åŒ–ï¼Œ</span></span><br><span class="line">       <span class="comment">// åˆ™æ›´æ–°æŒ‰é”®çŠ¶æ€å˜é‡ã€‚</span></span><br><span class="line">       state_btn = buttonState;</span><br><span class="line">       <span class="keyword">if</span>(state_btn == HIGH)&#123;</span><br><span class="line">        <span class="comment">//å†æ¬¡ç¡®è®¤æ˜¯å¦çœŸçš„æŒ‰ä¸‹äº†æŒ‰é”®</span></span><br><span class="line">         DBGLN(<span class="string">&quot;smartconfig&quot;</span>);</span><br><span class="line">         WifiSerial.write(<span class="string">&#x27;1&#x27;</span>);</span><br><span class="line">       &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// æ›´æ–°æŒ‰é”®æœ€è¿‘ä¸€æ¬¡çŠ¶æ€å˜åŒ–çš„å˜é‡</span></span><br><span class="line">  lastButtonState = buttonState;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">clrEsp8266ResponseBuffer</span><span class="params">(<span class="type">void</span>)</span>&#123;</span><br><span class="line">    <span class="built_in">memset</span>(response, <span class="number">0</span>, MAX_CONTENT_SIZE);      <span class="comment">//æ¸…ç©º</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="2ã€OLEDæ˜¾ç¤ºå¤©æ°”å±"><a href="#2ã€OLEDæ˜¾ç¤ºå¤©æ°”å±" class="headerlink" title="2ã€OLEDæ˜¾ç¤ºå¤©æ°”å±"></a>2ã€OLEDæ˜¾ç¤ºå¤©æ°”å±</h2><p>ç›¸å…³æŠ€æœ¯ç‚¹ï¼š</p><ul><li>ArduinoJson V5åº“</li><li>TCP Client</li><li>STAæ¨¡å¼</li><li>ä¸€é”®é…ç½‘</li><li>U8G2 OLEDåº“</li></ul><p>å†…å®¹ï¼š</p><p>å‘å¿ƒçŸ¥å¤©æ°”è¯·æ±‚å½“åœ°åŸå¸‚å¤©æ°”æƒ…å†µï¼Œå¹¶åœ¨OLEDä¸Šæ˜¾ç¤ºå¤©æ°”å›¾æ ‡ã€æ¸©åº¦å€¼ä»¥åŠåŸå¸‚åç§°</p><p>å¿ƒçŸ¥å¤©æ°”å‚è€ƒ<a href="https://docs.seniverse.com/api/weather/now.html">wiki</a></p><p>å¤©æ°”ç¼–ç <a href="https://docs.seniverse.com/api/start/code.html">wiki</a></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* åŠŸèƒ½ï¼šOLEDæ˜¾ç¤ºå¤©æ°”å±</span></span><br><span class="line"><span class="comment">**/</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Arduino.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ArduinoJson.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;U8g2lib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> U8X8_HAVE_HW_SPI</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;SPI.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> U8X8_HAVE_HW_I2C</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Wire.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LED D4</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DEBUG <span class="comment">//æ˜¯å¦å¼€å¯debugåŠŸèƒ½</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> DEBUG</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DebugPrintln(message)    Serial.println(message)</span></span><br><span class="line"><span class="meta">#<span class="keyword">else</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DebugPrintln(message)</span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> DEBUG</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DebugPrint(message)    Serial.print(message)</span></span><br><span class="line"><span class="meta">#<span class="keyword">else</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DebugPrint(message)</span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> WEATHER_CODE_DAY_SUN <span class="string">&quot;0&quot;</span> <span class="comment">//æ™´ï¼ˆå›½å†…åŸå¸‚ç™½å¤©æ™´ï¼‰</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> WEATHER_CODE_NIGHT_SUN <span class="string">&quot;1&quot;</span> <span class="comment">//æ™´ï¼ˆå›½å†…åŸå¸‚å¤œæ™šæ™´ï¼‰</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> WEATHER_CODE_DAY_SUN1 <span class="string">&quot;2&quot;</span> <span class="comment">//æ™´ï¼ˆå›½å¤–åŸå¸‚ç™½å¤©æ™´ï¼‰</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> WEATHER_CODE_NIGHT_SUN2 <span class="string">&quot;3&quot;</span> <span class="comment">//æ™´ï¼ˆå›½å¤–åŸå¸‚å¤œæ™šæ™´ï¼‰</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> WEATHER_CODE_CLOUDY <span class="string">&quot;4&quot;</span> <span class="comment">//å¤šäº‘</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> WEATHER_CODE_DAY_PARTLY_CLOUDY <span class="string">&quot;5&quot;</span> <span class="comment">//ç™½å¤©æ™´é—´å¤šäº‘</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> WEATHER_CODE_NIGHT_PARTLY_CLOUDY <span class="string">&quot;6&quot;</span> <span class="comment">//å¤œæ™šæ™´é—´å¤šäº‘</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> WEATHER_CODE_DAY_MOSTLY_CLOUDY <span class="string">&quot;7&quot;</span> <span class="comment">//ç™½å¤©å¤§éƒ¨å¤šäº‘</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> WEATHER_CODE_NIGHT_MOSTLY_CLOUDY <span class="string">&quot;8&quot;</span> <span class="comment">//å¤œæ™šå¤§éƒ¨å¤šäº‘</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> WEATHER_CODE_OVERCAST <span class="string">&quot;9&quot;</span> <span class="comment">//é˜´</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> WEATHER_CODE_SHOWER <span class="string">&quot;10&quot;</span> <span class="comment">//é˜µé›¨</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> WEATHER_CODE_THUNDERSHOWER <span class="string">&quot;11&quot;</span> <span class="comment">//é›·é˜µé›¨</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> WEATHER_CODE_THUNDERSHOWER_WITH_HAIL <span class="string">&quot;12&quot;</span> <span class="comment">//é›·é˜µé›¨ä¼´æœ‰å†°é›¹</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> WEATHER_CODE_LIGHT_RAIN <span class="string">&quot;13&quot;</span> <span class="comment">//å°é›¨</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> WEATHER_CODE_MODERATE_RAIN <span class="string">&quot;14&quot;</span> <span class="comment">//ä¸­é›¨</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> WEATHER_CODE_HEAVY_RAIN <span class="string">&quot;15&quot;</span> <span class="comment">//å¤§é›¨</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> WEATHER_CODE_STORM <span class="string">&quot;16&quot;</span> <span class="comment">//æš´é›¨</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> WEATHER_CODE_HEAVY_STORM <span class="string">&quot;17&quot;</span> <span class="comment">//å¤§æš´é›¨</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> WEATHER_CODE_SEVERE_STORM <span class="string">&quot;18&quot;</span> <span class="comment">//ç‰¹å¤§æš´é›¨</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> WEATHER_CODE_ICE_RAIN <span class="string">&quot;19&quot;</span> <span class="comment">//å†»é›¨</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> WEATHER_CODE_SLEET <span class="string">&quot;20&quot;</span> <span class="comment">//é›¨å¤¹é›ª</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> WEATHER_CODE_SNOW_FLURRY <span class="string">&quot;21&quot;</span> <span class="comment">//é˜µé›ª</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> WEATHER_CODE_LIGHT_SNOW <span class="string">&quot;22&quot;</span> <span class="comment">//å°é›ª</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> WEATHER_CODE_MODERATE_SNOW <span class="string">&quot;23&quot;</span> <span class="comment">//ä¸­é›ª</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> WEATHER_CODE_HEAVY_SNOW <span class="string">&quot;24&quot;</span> <span class="comment">//å¤§é›ª</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> WEATHER_CODE_SNOW_STORM <span class="string">&quot;25&quot;</span> <span class="comment">//æš´é›ª</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SUN_DAY 0</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SUN_NIGHT 1</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SUN_CLOUD 2</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> CLOUD 3</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> RAIN 4</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> THUNDER 5</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//å£°æ˜æ–¹æ³•</span></span><br><span class="line"><span class="type">bool</span> <span class="title function_">autoConfig</span><span class="params">()</span>;</span><br><span class="line"><span class="type">void</span> <span class="title function_">smartConfig</span><span class="params">()</span>;</span><br><span class="line"><span class="type">bool</span> <span class="title function_">sendRequest</span><span class="params">(<span class="type">const</span> <span class="type">char</span>* host, <span class="type">const</span> <span class="type">char</span>* cityid, <span class="type">const</span> <span class="type">char</span>* apiKey)</span>;</span><br><span class="line"><span class="type">bool</span> <span class="title function_">skipResponseHeaders</span><span class="params">()</span>;</span><br><span class="line"><span class="type">void</span> <span class="title function_">readReponseContent</span><span class="params">(<span class="type">char</span>* content, <span class="type">size_t</span> maxSize)</span>;</span><br><span class="line"><span class="type">void</span> <span class="title function_">stopConnect</span><span class="params">()</span>;</span><br><span class="line"><span class="type">void</span> <span class="title function_">clrEsp8266ResponseBuffer</span><span class="params">(<span class="type">void</span>)</span>;</span><br><span class="line"><span class="type">bool</span> <span class="title function_">parseUserData</span><span class="params">(<span class="type">char</span>* content, <span class="keyword">struct</span> UserData* userData)</span>;</span><br><span class="line"><span class="type">void</span> <span class="title function_">drawWeatherSymbol</span><span class="params">(<span class="type">u8g2_uint_t</span> x, <span class="type">u8g2_uint_t</span> y, <span class="type">uint8_t</span> symbol)</span>;</span><br><span class="line"><span class="type">void</span> <span class="title function_">drawWeather</span><span class="params">(<span class="type">uint8_t</span> symbol, <span class="type">int</span> degree)</span>;</span><br><span class="line">  </span><br><span class="line"><span class="type">const</span> <span class="type">unsigned</span> <span class="type">long</span> BAUD_RATE = <span class="number">115200</span>;<span class="comment">// serial connection speed</span></span><br><span class="line"><span class="type">const</span> <span class="type">unsigned</span> <span class="type">long</span> HTTP_TIMEOUT = <span class="number">5000</span>;               <span class="comment">// max respone time from server</span></span><br><span class="line"><span class="type">const</span> <span class="type">size_t</span> MAX_CONTENT_SIZE = <span class="number">500</span>;                   <span class="comment">// max size of the HTTP response</span></span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* host = <span class="string">&quot;api.seniverse.com&quot;</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* APIKEY = <span class="string">&quot;wcmquevztdy1jpca&quot;</span>;        <span class="comment">//API KEY</span></span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* city = <span class="string">&quot;guangzhou&quot;</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* language = <span class="string">&quot;zh-Hans&quot;</span>;<span class="comment">//zh-Hans ç®€ä½“ä¸­æ–‡  ä¼šæ˜¾ç¤ºä¹±ç </span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> flag = HIGH;<span class="comment">//é»˜è®¤å½“å‰ç­ç¯</span></span><br><span class="line">U8G2_SSD1306_128X64_NONAME_F_HW_I2C <span class="title function_">u8g2</span><span class="params">(U8G2_R0, <span class="comment">/* reset=*/</span> U8X8_PIN_NONE)</span>;</span><br><span class="line"></span><br><span class="line">WiFiClient client;</span><br><span class="line"><span class="type">char</span> response[MAX_CONTENT_SIZE];</span><br><span class="line"><span class="type">char</span> endOfHeaders[] = <span class="string">&quot;\r\n\r\n&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">long</span> lastTime = <span class="number">0</span>;</span><br><span class="line"><span class="comment">// è¯·æ±‚æœåŠ¡é—´éš”</span></span><br><span class="line"><span class="type">long</span> Delay = <span class="number">20000</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æˆ‘ä»¬è¦ä»æ­¤ç½‘é¡µä¸­æå–çš„æ•°æ®çš„ç±»å‹</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">UserData</span> &#123;</span></span><br><span class="line">  <span class="type">char</span> city[<span class="number">16</span>];<span class="comment">//åŸå¸‚åç§°</span></span><br><span class="line">  <span class="type">char</span> weather_code[<span class="number">4</span>];<span class="comment">//å¤©æ°”ç°è±¡codeï¼ˆå¤šäº‘...ï¼‰</span></span><br><span class="line">  <span class="type">char</span> temp[<span class="number">5</span>];<span class="comment">//æ¸©åº¦</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* @Desc åˆå§‹åŒ–æ“ä½œ</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span> &#123;</span><br><span class="line">  Serial.begin(BAUD_RATE);</span><br><span class="line">  pinMode(LED,OUTPUT);</span><br><span class="line">  digitalWrite(LED, HIGH);</span><br><span class="line"></span><br><span class="line">  WiFi.disconnect();</span><br><span class="line">  <span class="keyword">if</span>(!autoConfig())&#123;</span><br><span class="line">    smartConfig();</span><br><span class="line">    DebugPrint(<span class="string">&quot;Connecting to WiFi&quot;</span>);<span class="comment">//å†™å‡ å¥æç¤ºï¼Œå“ˆå“ˆ</span></span><br><span class="line">    <span class="keyword">while</span> (WiFi.status() != WL_CONNECTED) &#123;</span><br><span class="line">    <span class="comment">//è¿™ä¸ªå‡½æ•°æ˜¯wifiè¿æ¥çŠ¶æ€ï¼Œè¿”å›wifié“¾æ¥çŠ¶æ€</span></span><br><span class="line">       delay(<span class="number">500</span>);</span><br><span class="line">       DebugPrint(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  delay(<span class="number">1000</span>);</span><br><span class="line">  digitalWrite(LED, LOW);</span><br><span class="line">  DebugPrintln(<span class="string">&quot;IP address: &quot;</span>);</span><br><span class="line">  DebugPrintln(WiFi.localIP());<span class="comment">//WiFi.localIP()è¿”å›8266è·å¾—çš„ipåœ°å€</span></span><br><span class="line">  lastTime = millis();</span><br><span class="line">  u8g2.begin();  </span><br><span class="line">  u8g2.enableUTF8Print();</span><br><span class="line">  <span class="comment">//ä½¿èƒ½è½¯ä»¶çœ‹é—¨ç‹—çš„è§¦å‘é—´éš”</span></span><br><span class="line">  ESP.wdtEnable(<span class="number">5000</span>);</span><br><span class="line">&#125;</span><br><span class="line">  </span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* @Desc  ä¸»å‡½æ•°</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="keyword">while</span> (!client.connected())&#123;</span><br><span class="line">     <span class="keyword">if</span> (!client.connect(host, <span class="number">80</span>))&#123;</span><br><span class="line">         flag = !flag;</span><br><span class="line">         digitalWrite(LED, flag);</span><br><span class="line">         delay(<span class="number">500</span>);</span><br><span class="line">         <span class="comment">//å–‚ç‹—</span></span><br><span class="line">         ESP.wdtFeed();</span><br><span class="line">     &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span>(millis()-lastTime&gt;=Delay)&#123;</span><br><span class="line">   <span class="comment">//æ¯é—´éš”20så·¦å³è°ƒç”¨ä¸€æ¬¡</span></span><br><span class="line">     lastTime = millis();</span><br><span class="line">     <span class="keyword">if</span> (sendRequest(host, city, APIKEY) &amp;&amp; skipResponseHeaders()) &#123;</span><br><span class="line">       clrEsp8266ResponseBuffer();</span><br><span class="line">       readReponseContent(response, <span class="keyword">sizeof</span>(response));</span><br><span class="line">       UserData userData;</span><br><span class="line">       <span class="keyword">if</span> (parseUserData(response, &amp;userData)) &#123;</span><br><span class="line">          showWeather(&amp;userData);</span><br><span class="line">       &#125;</span><br><span class="line">     &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">   <span class="comment">//å–‚ç‹—</span></span><br><span class="line">   ESP.wdtFeed();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* è‡ªåŠ¨è¿æ¥20s è¶…è¿‡ä¹‹åè‡ªåŠ¨è¿›å…¥SmartConfigæ¨¡å¼</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">bool</span> <span class="title function_">autoConfig</span><span class="params">()</span>&#123;</span><br><span class="line">  WiFi.mode(WIFI_AP_STA);     <span class="comment">//è®¾ç½®esp8266 å·¥ä½œæ¨¡å¼</span></span><br><span class="line">  WiFi.begin();</span><br><span class="line">  delay(<span class="number">2000</span>);<span class="comment">//åˆšå¯åŠ¨æ¨¡å—çš„è¯ å»¶æ—¶ç¨³å®šä¸€ä¸‹</span></span><br><span class="line">  DebugPrintln(<span class="string">&quot;AutoConfiging ......&quot;</span>);</span><br><span class="line">  <span class="keyword">for</span>(<span class="type">int</span> index=<span class="number">0</span>;index&lt;<span class="number">10</span>;index++)&#123;</span><br><span class="line">    <span class="type">int</span> wstatus = WiFi.status();</span><br><span class="line">    <span class="keyword">if</span> (wstatus == WL_CONNECTED)&#123;</span><br><span class="line">      DebugPrintln(<span class="string">&quot;AutoConfig Success&quot;</span>);</span><br><span class="line">      DebugPrint(<span class="string">&quot;SSID:&quot;</span>);</span><br><span class="line">      DebugPrintln(WiFi.SSID().c_str());</span><br><span class="line">      DebugPrint(<span class="string">&quot;PSW:&quot;</span>);</span><br><span class="line">      DebugPrintln(WiFi.psk().c_str());</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">      DebugPrint(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">      delay(<span class="number">500</span>);</span><br><span class="line">      flag = !flag;</span><br><span class="line">      digitalWrite(LED, flag);</span><br><span class="line">    &#125; </span><br><span class="line">  &#125;</span><br><span class="line">  DebugPrintln(<span class="string">&quot;AutoConfig Faild!&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* å¼€å¯SmartConfigåŠŸèƒ½</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">smartConfig</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  WiFi.mode(WIFI_STA);</span><br><span class="line">  delay(<span class="number">1000</span>);</span><br><span class="line">  DebugPrintln(<span class="string">&quot;Wait for Smartconfig&quot;</span>);</span><br><span class="line">  <span class="comment">// ç­‰å¾…é…ç½‘</span></span><br><span class="line">  WiFi.beginSmartConfig();</span><br><span class="line">  <span class="keyword">while</span> (<span class="number">1</span>)&#123;</span><br><span class="line">    DebugPrint(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">    delay(<span class="number">200</span>);</span><br><span class="line">    flag = !flag;</span><br><span class="line">    digitalWrite(LED, flag);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (WiFi.smartConfigDone())&#123;</span><br><span class="line">      <span class="comment">//smartconfigé…ç½®å®Œæ¯•</span></span><br><span class="line">      DebugPrintln(<span class="string">&quot;SmartConfig Success&quot;</span>);</span><br><span class="line">      DebugPrint(<span class="string">&quot;SSID:&quot;</span>);</span><br><span class="line">      DebugPrintln(WiFi.SSID().c_str());</span><br><span class="line">      DebugPrint(<span class="string">&quot;PSW:&quot;</span>);</span><br><span class="line">      DebugPrintln(WiFi.psk().c_str());</span><br><span class="line">      WiFi.mode(WIFI_AP_STA);     <span class="comment">//è®¾ç½®esp8266 å·¥ä½œæ¨¡å¼</span></span><br><span class="line">      WiFi.setAutoConnect(<span class="literal">true</span>);  <span class="comment">// è®¾ç½®è‡ªåŠ¨è¿æ¥</span></span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* @å‘é€è¯·æ±‚æŒ‡ä»¤</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">bool</span> <span class="title function_">sendRequest</span><span class="params">(<span class="type">const</span> <span class="type">char</span>* host, <span class="type">const</span> <span class="type">char</span>* cityid, <span class="type">const</span> <span class="type">char</span>* apiKey)</span> &#123;</span><br><span class="line">  <span class="comment">// We now create a URI for the request</span></span><br><span class="line">  <span class="comment">//å¿ƒçŸ¥å¤©æ°”</span></span><br><span class="line">  String GetUrl = <span class="string">&quot;/v3/weather/now.json?key=&quot;</span>;</span><br><span class="line">  GetUrl += apiKey;</span><br><span class="line">  GetUrl += <span class="string">&quot;&amp;location=&quot;</span>;</span><br><span class="line">  GetUrl += city;</span><br><span class="line">  GetUrl += <span class="string">&quot;&amp;language=&quot;</span>;</span><br><span class="line">  GetUrl += language;</span><br><span class="line">  <span class="comment">// This will send the request to the server</span></span><br><span class="line">  client.print(String(<span class="string">&quot;GET &quot;</span>) + GetUrl + <span class="string">&quot; HTTP/1.1\r\n&quot;</span> +</span><br><span class="line">               <span class="string">&quot;Host: &quot;</span> + host + <span class="string">&quot;\r\n&quot;</span> +</span><br><span class="line">               <span class="string">&quot;Connection: close\r\n\r\n&quot;</span>);</span><br><span class="line">  DebugPrintln(<span class="string">&quot;create a request:&quot;</span>);</span><br><span class="line">  DebugPrintln(String(<span class="string">&quot;GET &quot;</span>) + GetUrl + <span class="string">&quot; HTTP/1.1\r\n&quot;</span> +</span><br><span class="line">               <span class="string">&quot;Host: &quot;</span> + host + <span class="string">&quot;\r\n&quot;</span> +</span><br><span class="line">               <span class="string">&quot;Connection: close\r\n&quot;</span>);</span><br><span class="line">  delay(<span class="number">1000</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* @Desc è·³è¿‡ HTTP å¤´ï¼Œä½¿æˆ‘ä»¬åœ¨å“åº”æ­£æ–‡çš„å¼€å¤´</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">bool</span> <span class="title function_">skipResponseHeaders</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="comment">// HTTP headers end with an empty line</span></span><br><span class="line">  <span class="type">bool</span> ok = client.find(endOfHeaders);</span><br><span class="line">  <span class="keyword">if</span> (!ok) &#123;</span><br><span class="line">    DebugPrintln(<span class="string">&quot;No response or invalid response!&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> ok;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* @Desc ä»HTTPæœåŠ¡å™¨å“åº”ä¸­è¯»å–æ­£æ–‡</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">readReponseContent</span><span class="params">(<span class="type">char</span>* content, <span class="type">size_t</span> maxSize)</span> &#123;</span><br><span class="line">  <span class="type">size_t</span> length = client.readBytes(content, maxSize);</span><br><span class="line">  delay(<span class="number">100</span>);</span><br><span class="line">  DebugPrintln(<span class="string">&quot;Get the data from Internet!&quot;</span>);</span><br><span class="line">  content[length] = <span class="number">0</span>;</span><br><span class="line">  DebugPrintln(content);</span><br><span class="line">  DebugPrintln(<span class="string">&quot;Read data Over!&quot;</span>);</span><br><span class="line">  client.flush();<span class="comment">//è¿™å¥ä»£ç éœ€è¦åŠ ä¸Š  ä¸ç„¶ä¼šå‘ç°æ¯éš”ä¸€æ¬¡client.findä¼šå¤±è´¥</span></span><br><span class="line">&#125;</span><br><span class="line">  </span><br><span class="line"><span class="comment">// å…³é—­ä¸HTTPæœåŠ¡å™¨è¿æ¥</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">stopConnect</span><span class="params">()</span> &#123;</span><br><span class="line">  client.stop();</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">clrEsp8266ResponseBuffer</span><span class="params">(<span class="type">void</span>)</span>&#123;</span><br><span class="line">    <span class="built_in">memset</span>(response, <span class="number">0</span>, MAX_CONTENT_SIZE);      <span class="comment">//æ¸…ç©º</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">bool</span> <span class="title function_">parseUserData</span><span class="params">(<span class="type">char</span>* content, <span class="keyword">struct</span> UserData* userData)</span> &#123;</span><br><span class="line"><span class="comment">//    -- æ ¹æ®æˆ‘ä»¬éœ€è¦è§£æçš„æ•°æ®æ¥è®¡ç®—JSONç¼“å†²åŒºæœ€ä½³å¤§å°</span></span><br><span class="line"><span class="comment">//   å¦‚æœä½ ä½¿ç”¨StaticJsonBufferæ—¶æ‰éœ€è¦</span></span><br><span class="line"><span class="comment">//    const size_t BUFFER_SIZE = 1024;</span></span><br><span class="line"><span class="comment">//   åœ¨å †æ ˆä¸Šåˆ†é…ä¸€ä¸ªä¸´æ—¶å†…å­˜æ± </span></span><br><span class="line"><span class="comment">//    StaticJsonBuffer&lt;BUFFER_SIZE&gt; jsonBuffer;</span></span><br><span class="line"><span class="comment">//    -- å¦‚æœå †æ ˆçš„å†…å­˜æ± å¤ªå¤§ï¼Œä½¿ç”¨ DynamicJsonBuffer jsonBuffer ä»£æ›¿</span></span><br><span class="line">  DynamicJsonBuffer jsonBuffer;</span><br><span class="line">  </span><br><span class="line">  JsonObject&amp; root = jsonBuffer.parseObject(content);</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">if</span> (!root.success()) &#123;</span><br><span class="line">    Serial.println(<span class="string">&quot;JSON parsing failed!&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line">   </span><br><span class="line">  <span class="comment">//å¤åˆ¶æˆ‘ä»¬æ„Ÿå…´è¶£çš„å­—ç¬¦ä¸²</span></span><br><span class="line">  <span class="built_in">strcpy</span>(userData-&gt;city, root[<span class="string">&quot;results&quot;</span>][<span class="number">0</span>][<span class="string">&quot;location&quot;</span>][<span class="string">&quot;name&quot;</span>]);</span><br><span class="line">  <span class="built_in">strcpy</span>(userData-&gt;weather_code, root[<span class="string">&quot;results&quot;</span>][<span class="number">0</span>][<span class="string">&quot;now&quot;</span>][<span class="string">&quot;code&quot;</span>]);</span><br><span class="line">  <span class="built_in">strcpy</span>(userData-&gt;temp, root[<span class="string">&quot;results&quot;</span>][<span class="number">0</span>][<span class="string">&quot;now&quot;</span>][<span class="string">&quot;temperature&quot;</span>]);</span><br><span class="line">  <span class="comment">//  -- è¿™ä¸æ˜¯å¼ºåˆ¶å¤åˆ¶ï¼Œä½ å¯ä»¥ä½¿ç”¨æŒ‡é’ˆï¼Œå› ä¸ºä»–ä»¬æ˜¯æŒ‡å‘â€œå†…å®¹â€ç¼“å†²åŒºå†…ï¼Œæ‰€ä»¥ä½ éœ€è¦ç¡®ä¿</span></span><br><span class="line">  <span class="comment">//   å½“ä½ è¯»å–å­—ç¬¦ä¸²æ—¶å®ƒä»åœ¨å†…å­˜ä¸­</span></span><br><span class="line">  <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ ¹æ®å¤©æ°”æ¥å£è¿”å›çš„æ•°æ®åˆ¤æ–­æ˜¾ç¤º</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">showWeather</span><span class="params">(<span class="keyword">struct</span> UserData* userData)</span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(<span class="built_in">strcmp</span>(userData-&gt;weather_code,WEATHER_CODE_DAY_SUN) == <span class="number">0</span> </span><br><span class="line">  || <span class="built_in">strcmp</span>(userData-&gt;weather_code,WEATHER_CODE_DAY_SUN1) == <span class="number">0</span>)&#123;</span><br><span class="line">    drawWeather(SUN_DAY,userData-&gt;temp,userData-&gt;city);</span><br><span class="line">  &#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="built_in">strcmp</span>(userData-&gt;weather_code,WEATHER_CODE_NIGHT_SUN) == <span class="number">0</span> </span><br><span class="line">  || <span class="built_in">strcmp</span>(userData-&gt;weather_code,WEATHER_CODE_NIGHT_SUN2) == <span class="number">0</span> )&#123;</span><br><span class="line">    drawWeather(SUN_NIGHT,userData-&gt;temp,userData-&gt;city);</span><br><span class="line">  &#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="built_in">strcmp</span>(userData-&gt;weather_code,WEATHER_CODE_DAY_PARTLY_CLOUDY) == <span class="number">0</span> </span><br><span class="line">  || <span class="built_in">strcmp</span>(userData-&gt;weather_code,WEATHER_CODE_NIGHT_PARTLY_CLOUDY) == <span class="number">0</span> )&#123;</span><br><span class="line">    drawWeather(SUN_CLOUD,userData-&gt;temp,userData-&gt;city);</span><br><span class="line">  &#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="built_in">strcmp</span>(userData-&gt;weather_code,WEATHER_CODE_CLOUDY) == <span class="number">0</span> </span><br><span class="line">  || <span class="built_in">strcmp</span>(userData-&gt;weather_code,WEATHER_CODE_DAY_MOSTLY_CLOUDY) == <span class="number">0</span> </span><br><span class="line">  || <span class="built_in">strcmp</span>(userData-&gt;weather_code,WEATHER_CODE_NIGHT_MOSTLY_CLOUDY) == <span class="number">0</span> </span><br><span class="line">  || <span class="built_in">strcmp</span>(userData-&gt;weather_code,WEATHER_CODE_OVERCAST) == <span class="number">0</span>)&#123;</span><br><span class="line">    drawWeather(CLOUD,userData-&gt;temp,userData-&gt;city); </span><br><span class="line">  &#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="built_in">strcmp</span>(userData-&gt;weather_code,WEATHER_CODE_SHOWER) == <span class="number">0</span> </span><br><span class="line">  || <span class="built_in">strcmp</span>(userData-&gt;weather_code,WEATHER_CODE_LIGHT_RAIN) == <span class="number">0</span> </span><br><span class="line">  || <span class="built_in">strcmp</span>(userData-&gt;weather_code,WEATHER_CODE_MODERATE_RAIN) == <span class="number">0</span> </span><br><span class="line">  || <span class="built_in">strcmp</span>(userData-&gt;weather_code,WEATHER_CODE_HEAVY_RAIN) == <span class="number">0</span> </span><br><span class="line">  || <span class="built_in">strcmp</span>(userData-&gt;weather_code,WEATHER_CODE_STORM) == <span class="number">0</span></span><br><span class="line">  || <span class="built_in">strcmp</span>(userData-&gt;weather_code,WEATHER_CODE_HEAVY_STORM) == <span class="number">0</span> </span><br><span class="line">  || <span class="built_in">strcmp</span>(userData-&gt;weather_code,WEATHER_CODE_SEVERE_STORM) == <span class="number">0</span>)&#123;</span><br><span class="line">    drawWeather(RAIN,userData-&gt;temp,userData-&gt;city);</span><br><span class="line">  &#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="built_in">strcmp</span>(userData-&gt;weather_code,WEATHER_CODE_THUNDERSHOWER) == <span class="number">0</span> </span><br><span class="line">  || <span class="built_in">strcmp</span>(userData-&gt;weather_code,WEATHER_CODE_THUNDERSHOWER_WITH_HAIL) == <span class="number">0</span>)&#123;</span><br><span class="line">    drawWeather(THUNDER,userData-&gt;temp,userData-&gt;city);</span><br><span class="line">  &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    drawWeather(CLOUD,userData-&gt;temp,userData-&gt;city); </span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">drawWeather</span><span class="params">(<span class="type">uint8_t</span> symbol, <span class="type">char</span>* degree,<span class="type">char</span>* city)</span></span><br><span class="line">&#123;</span><br><span class="line">  DebugPrintln(city);</span><br><span class="line">  u8g2.clearBuffer();         <span class="comment">// clear the internal memory</span></span><br><span class="line">  <span class="comment">//ç»˜åˆ¶å¤©æ°”ç¬¦å·</span></span><br><span class="line">  drawWeatherSymbol(<span class="number">0</span>, <span class="number">48</span>, symbol);</span><br><span class="line">  <span class="comment">//ç»˜åˆ¶æ¸©åº¦</span></span><br><span class="line">  u8g2.setFont(u8g2_font_logisoso32_tf);</span><br><span class="line">  u8g2.setCursor(<span class="number">48</span>+<span class="number">3</span>, <span class="number">42</span>);</span><br><span class="line">  u8g2.print(degree);</span><br><span class="line">  u8g2.print(<span class="string">&quot;Â°C&quot;</span>);   <span class="comment">// requires enableUTF8Print()</span></span><br><span class="line">  u8g2.setFont(u8g2_font_unifont_t_chinese3);</span><br><span class="line"></span><br><span class="line">  <span class="type">u8g2_uint_t</span> strWidth = u8g2.getUTF8Width(city);</span><br><span class="line">  <span class="type">u8g2_uint_t</span> displayWidth = u8g2.getDisplayWidth();</span><br><span class="line">  </span><br><span class="line">  u8g2.setCursor(displayWidth - strWidth - <span class="number">5</span>, <span class="number">60</span>);</span><br><span class="line">  u8g2.print(city);</span><br><span class="line">  u8g2.sendBuffer();        <span class="comment">// transfer internal memory to the display</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ç»˜åˆ¶å¤©æ°”ç¬¦å·</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">drawWeatherSymbol</span><span class="params">(<span class="type">u8g2_uint_t</span> x, <span class="type">u8g2_uint_t</span> y, <span class="type">uint8_t</span> symbol)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// fonts used:</span></span><br><span class="line">  <span class="comment">// u8g2_font_open_iconic_embedded_6x_t</span></span><br><span class="line">  <span class="comment">// u8g2_font_open_iconic_weather_6x_t</span></span><br><span class="line">  <span class="comment">// encoding values, see: https://github.com/olikraus/u8g2/wiki/fntgrpiconic</span></span><br><span class="line">  <span class="keyword">switch</span>(symbol)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">case</span> SUN_DAY:<span class="comment">//å¤ªé˜³</span></span><br><span class="line">      u8g2.setFont(<span class="type">u8g2_font_open_iconic_weather_6x_t</span>);</span><br><span class="line">      u8g2.drawGlyph(x, y, <span class="number">69</span>); </span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> SUN_NIGHT:<span class="comment">//å¤ªé˜³</span></span><br><span class="line">      u8g2.setFont(<span class="type">u8g2_font_open_iconic_weather_6x_t</span>);</span><br><span class="line">      u8g2.drawGlyph(x, y, <span class="number">66</span>); </span><br><span class="line">      <span class="keyword">break</span>;  </span><br><span class="line">    <span class="keyword">case</span> SUN_CLOUD:<span class="comment">//æ™´é—´å¤šäº‘</span></span><br><span class="line">      u8g2.setFont(<span class="type">u8g2_font_open_iconic_weather_6x_t</span>);</span><br><span class="line">      u8g2.drawGlyph(x, y, <span class="number">65</span>); </span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> CLOUD:<span class="comment">//å¤šäº‘</span></span><br><span class="line">      u8g2.setFont(<span class="type">u8g2_font_open_iconic_weather_6x_t</span>);</span><br><span class="line">      u8g2.drawGlyph(x, y, <span class="number">64</span>); </span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> RAIN:<span class="comment">//ä¸‹é›¨</span></span><br><span class="line">      u8g2.setFont(<span class="type">u8g2_font_open_iconic_weather_6x_t</span>);</span><br><span class="line">      u8g2.drawGlyph(x, y, <span class="number">67</span>); </span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> THUNDER:<span class="comment">//æ‰“é›·</span></span><br><span class="line">      u8g2.setFont(<span class="type">u8g2_font_open_iconic_embedded_6x_t</span>);</span><br><span class="line">      u8g2.drawGlyph(x, y, <span class="number">67</span>);</span><br><span class="line">      <span class="keyword">break</span>;      </span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="3ã€WIFIå°è½¦"><a href="#3ã€WIFIå°è½¦" class="headerlink" title="3ã€WIFIå°è½¦"></a>3ã€WIFIå°è½¦</h2><p>ç›¸å…³æŠ€æœ¯ç‚¹ï¼š</p><p>WebSocket Client å…¨åŒå·¥é€šä¿¡</p><p>WebSocket Server å…¨åŒå·¥é€šä¿¡</p><p>å†…å®¹ï¼š</p><ul><li>NodeMcuä½œä¸ºAPã€‚æ‰‹æœºæ§åˆ¶ç«¯ä½œä¸ºSTAï¼Œè¿æ¥AP</li><li>NodeMcuä½œä¸ºWebSocketServerç«¯ï¼Œæ‰‹æœºä½œä¸ºWebSocketClientç«¯</li><li>ä¸¤è€…å»ºç«‹WSé€šä¿¡ï¼Œæ‰‹æœºå¾€NodeMcuå‘é€æ§åˆ¶å‘½ä»¤</li><li>NodeMcuæ§åˆ¶ç”µæœº</li></ul><p>å®ç°ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> *åŠŸèƒ½ï¼šwifiå°è½¦ ESP8266</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;WebSocketsServer.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESP8266WebServer.h&gt;</span> </span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ArduinoJson.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> AP_SSID <span class="string">&quot;WiFiCar&quot;</span> <span class="comment">//è¿™é‡Œæ”¹æˆä½ çš„APåå­—</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> AP_PSW  <span class="string">&quot;12345678&quot;</span> <span class="comment">//è¿™é‡Œæ”¹æˆä½ çš„APå¯†ç  8ä½ä»¥ä¸Š</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> IN1 D1 <span class="comment">// 7 6 å³è½®</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> IN2 D2 </span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> IN3 D3 <span class="comment">// 5 4 å·¦è½®</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> IN4 D4</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LEFT <span class="string">&quot;3&quot;</span> <span class="comment">//å·¦è½¬ç¼–ç </span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> RIGHT <span class="string">&quot;4&quot;</span><span class="comment">//å³è½¬ç¼–ç </span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> GO <span class="string">&quot;1&quot;</span><span class="comment">//å‰è¿›ç¼–ç </span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> BACK <span class="string">&quot;2&quot;</span><span class="comment">//åé€€ç¼–ç </span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> STOP <span class="string">&quot;0&quot;</span><span class="comment">//åœæ­¢ç¼–ç </span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> USE_SERIAL Serial</span></span><br><span class="line"></span><br><span class="line">IPAddress <span class="title function_">local_IP</span><span class="params">(<span class="number">192</span>,<span class="number">168</span>,<span class="number">4</span>,<span class="number">25</span>)</span>;</span><br><span class="line">IPAddress <span class="title function_">gateway</span><span class="params">(<span class="number">192</span>,<span class="number">168</span>,<span class="number">4</span>,<span class="number">1</span>)</span>;</span><br><span class="line">IPAddress <span class="title function_">subnet</span><span class="params">(<span class="number">255</span>,<span class="number">255</span>,<span class="number">255</span>,<span class="number">0</span>)</span>;</span><br><span class="line"></span><br><span class="line">WebSocketsServer webSocket = WebSocketsServer(<span class="number">81</span>);</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">initSys</span><span class="params">()</span>;</span><br><span class="line"><span class="type">void</span> <span class="title function_">initAP</span><span class="params">()</span>;</span><br><span class="line"><span class="type">void</span> <span class="title function_">initWS</span><span class="params">()</span>;</span><br><span class="line"><span class="type">void</span> <span class="title function_">initCar</span><span class="params">()</span>;</span><br><span class="line"><span class="type">void</span> <span class="title function_">stopCar</span><span class="params">()</span>;</span><br><span class="line"><span class="type">void</span> <span class="title function_">turnLeft</span><span class="params">()</span>;</span><br><span class="line"><span class="type">void</span> <span class="title function_">turnRight</span><span class="params">()</span>;</span><br><span class="line"><span class="type">void</span> <span class="title function_">go</span><span class="params">()</span>;</span><br><span class="line"><span class="type">void</span> <span class="title function_">back</span><span class="params">()</span>;</span><br><span class="line"><span class="type">void</span> <span class="title function_">webSocketEvent</span><span class="params">(<span class="type">uint8_t</span> num, WStype_t type, <span class="type">uint8_t</span> * payload, <span class="type">size_t</span> length)</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="comment">// put your setup code here, to run once:</span></span><br><span class="line">  initSys();</span><br><span class="line">  initAP();</span><br><span class="line">  initWS();</span><br><span class="line">  initCar();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="comment">// put your main code here, to run repeatedly:</span></span><br><span class="line">  webSocket.loop();</span><br><span class="line">  <span class="comment">//å–‚ç‹—</span></span><br><span class="line">  ESP.wdtFeed();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">initSys</span><span class="params">()</span>&#123;</span><br><span class="line">  USE_SERIAL.begin(<span class="number">115200</span>);</span><br><span class="line">  USE_SERIAL.println();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">initAP</span><span class="params">()</span>&#123;</span><br><span class="line">  <span class="comment">//é…ç½®APä¿¡æ¯</span></span><br><span class="line">  WiFi.mode(WIFI_AP);</span><br><span class="line">  WiFi.softAPConfig(local_IP, gateway, subnet);</span><br><span class="line">  boolean result = WiFi.softAP(AP_SSID, AP_PSW);</span><br><span class="line">  <span class="keyword">if</span>(!result)&#123;</span><br><span class="line">     ESP.restart();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">initWS</span><span class="params">()</span>&#123;</span><br><span class="line">   <span class="comment">// start webSocket server</span></span><br><span class="line">   webSocket.begin();</span><br><span class="line">   webSocket.onEvent(webSocketEvent);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">initCar</span><span class="params">()</span>&#123;</span><br><span class="line">  pinMode(IN1,OUTPUT);</span><br><span class="line">  pinMode(IN2,OUTPUT);</span><br><span class="line">  pinMode(IN3,OUTPUT);</span><br><span class="line">  pinMode(IN4,OUTPUT);  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">stopCar</span><span class="params">()</span>&#123;</span><br><span class="line">  <span class="comment">//é»˜è®¤å…¨æ˜¯ä½ç”µå¹³ åœæ­¢çŠ¶æ€</span></span><br><span class="line">  digitalWrite(IN1,LOW);      </span><br><span class="line">  digitalWrite(IN2,LOW);</span><br><span class="line">  digitalWrite(IN3,LOW);   </span><br><span class="line">  digitalWrite(IN4,LOW);  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* å·¦è½¬</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">turnLeft</span><span class="params">()</span>&#123;</span><br><span class="line">  digitalWrite(IN1,HIGH);      </span><br><span class="line">  digitalWrite(IN2,LOW);         <span class="comment">//å³è½®å‰è¿›</span></span><br><span class="line">  digitalWrite(IN3,LOW);      </span><br><span class="line">  digitalWrite(IN4,LOW);         <span class="comment">//å·¦è½®ä¸åŠ¨</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* å³è½¬</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">turnRight</span><span class="params">()</span>&#123;</span><br><span class="line">  digitalWrite(IN1,LOW);      </span><br><span class="line">  digitalWrite(IN2,LOW);         <span class="comment">//å³è½®ä¸åŠ¨</span></span><br><span class="line">  digitalWrite(IN3,HIGH);      </span><br><span class="line">  digitalWrite(IN4,LOW);         <span class="comment">//å·¦è½®å‰è¿›</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* å‰è¿›</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">go</span><span class="params">()</span>&#123;</span><br><span class="line">  digitalWrite(IN1,HIGH);      </span><br><span class="line">  digitalWrite(IN2,LOW);         <span class="comment">//å³è½®å‰è¿›</span></span><br><span class="line">  digitalWrite(IN3,HIGH);      </span><br><span class="line">  digitalWrite(IN4,LOW);         <span class="comment">//å·¦è½®å‰è¿›</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* å€’è½¦</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">back</span><span class="params">()</span>&#123;</span><br><span class="line">  digitalWrite(IN1,LOW);      </span><br><span class="line">  digitalWrite(IN2,HIGH);        <span class="comment">//å³è½®åé€€</span></span><br><span class="line">  digitalWrite(IN3,LOW);      </span><br><span class="line">  digitalWrite(IN4,HIGH);        <span class="comment">//å·¦è½®åé€€</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">webSocketEvent</span><span class="params">(<span class="type">uint8_t</span> num, WStype_t type, <span class="type">uint8_t</span> * payload, <span class="type">size_t</span> length)</span> &#123;</span><br><span class="line">    <span class="keyword">switch</span>(type) &#123;</span><br><span class="line">        <span class="keyword">case</span> WStype_DISCONNECTED:</span><br><span class="line">            USE_SERIAL.<span class="built_in">printf</span>(<span class="string">&quot;[%u] Disconnected!\n&quot;</span>, num);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> WStype_CONNECTED: &#123;</span><br><span class="line">            IPAddress ip = webSocket.remoteIP(num);</span><br><span class="line">            USE_SERIAL.<span class="built_in">printf</span>(<span class="string">&quot;[%u] Connected from %d.%d.%d.%d url: %s\n&quot;</span>, num, ip[<span class="number">0</span>], ip[<span class="number">1</span>], ip[<span class="number">2</span>], ip[<span class="number">3</span>], payload);</span><br><span class="line">            <span class="comment">// send message to client</span></span><br><span class="line">            webSocket.sendTXT(num, <span class="string">&quot;Connected&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> WStype_TEXT:</span><br><span class="line">            USE_SERIAL.<span class="built_in">printf</span>(<span class="string">&quot;[%u] get Text: %s\n&quot;</span>, num, payload);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// ç¼ºå°‘æ§åˆ¶é€»è¾‘</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> åµŒå…¥å¼å¼€å‘ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¢¨æ°´å±</title>
      <link href="/2021/07/23/mo-shui-ping/"/>
      <url>/2021/07/23/mo-shui-ping/</url>
      
        <content type="html"><![CDATA[<h1 id="1ã€èƒŒæ™¯"><a href="#1ã€èƒŒæ™¯" class="headerlink" title="1ã€èƒŒæ™¯"></a>1ã€èƒŒæ™¯</h1><p>å’¸é±¼æ·˜çš„ï¼Œ15ä¸€å¥—ï¼Œä¸‰è‰²çš„18ä¸€å¥—ï¼Œå…¼å®¹å¾®é›ªé©±åŠ¨ï¼Œæ‹†æœºå±å¹•ï¼Œè´¨é‡çš„ç¡®æ²¡æœ‰å¾®é›ªçš„å±å¹•å¥½ï¼Œä½†è¿˜å¤Ÿç”¨ï¼Œè¦åŠæ—¶æ¸…å±ï¼Œé˜²æ­¢æœ‰æ®‹å½±ã€‚<a href="https://www.waveshare.net/">å¾®é›ªç”µå­å®˜ç½‘</a></p><p><img src="https://z3.ax1x.com/2021/07/25/WRCeKA.md.jpg" class="lazyload placeholder" data-srcset="https://z3.ax1x.com/2021/07/25/WRCeKA.md.jpg" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="WRCeKA.md.jpg"></p><h1 id="2ã€2-13å¯¸é»‘ç™½å±å¹•å¸¸ç”¨å‡½æ•°ï¼š"><a href="#2ã€2-13å¯¸é»‘ç™½å±å¹•å¸¸ç”¨å‡½æ•°ï¼š" class="headerlink" title="2ã€2.13å¯¸é»‘ç™½å±å¹•å¸¸ç”¨å‡½æ•°ï¼š"></a>2ã€2.13å¯¸é»‘ç™½å±å¹•å¸¸ç”¨å‡½æ•°ï¼š</h1><p><a href="https://imgtu.com/i/WDvGIx"><img src="https://z3.ax1x.com/2021/07/23/WDvGIx.md.jpg" class="lazyload placeholder" data-srcset="https://z3.ax1x.com/2021/07/23/WDvGIx.md.jpg" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="WDvGIx.md.jpg"></a></p><p>epd1in54.inoï¼šä½¿ç”¨Arduino IDEæ‰“å¼€å³å¯ï¼›<br>epd1in54.cpp(.h):æ˜¯å¢¨æ°´å±çš„é©±åŠ¨ç¨‹åºï¼›<br>epdif.cpp(.h):æ˜¯ç¡¬ä»¶æ¥å£å®šä¹‰ï¼Œé‡Œé¢å°è£…äº†è¯»å†™ç®¡è„šç”µå¹³ï¼ŒSPIä¼ è¾“æ•°æ®ï¼Œä»¥åŠç®¡è„šåˆå§‹åŒ–ï¼›<br>font8.cppã€font12.cppã€font16.cppã€font20.cppã€font24.cppã€fonts.hï¼šä¸ºä¸åŒå¤§å°å­—ç¬¦çš„æ¨¡ï¼›<br>imagedata.cpp(.h)ï¼šæ˜¯å›¾ç‰‡æ•°æ®ï¼Œè¿™ä¸ªå¯ä»¥é€šè¿‡Img2Lcd(åœ¨å¼€å‘èµ„æ–™ä¸­å¯ä¸‹è½½)æŠŠ2ä½æ·±åº¦çš„BMPå›¾ç‰‡è½¬æ¢æˆæ•°ç»„ã€‚<br>ç¨‹åºåˆ†ä¸ºåº•å±‚ç¡¬ä»¶æ¥å£ã€ä¸­é—´å±‚å¢¨æ°´å±é©±åŠ¨ã€ä¸Šå±‚åº”ç”¨ï¼›</p><h2 id="1ã€åº•å±‚ç¡¬ä»¶æ¥å£ï¼š"><a href="#1ã€åº•å±‚ç¡¬ä»¶æ¥å£ï¼š" class="headerlink" title="1ã€åº•å±‚ç¡¬ä»¶æ¥å£ï¼š"></a>1ã€åº•å±‚ç¡¬ä»¶æ¥å£ï¼š</h2><p>åœ¨epdif.cpp(.h)ä¸¤ä¸ªæ–‡ä»¶ä¸­å®šä¹‰äº†ç¡¬ä»¶æ¥å£ï¼Œå¹¶å°è£…å¥½è¯»å†™ç®¡è„šç”µå¹³ã€å»¶æ—¶ã€SPIä¼ è¾“ç­‰å‡½æ•°ã€‚</p><p>1ã€å†™ç®¡è„šç”µå¹³</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">DigitalWrite</span><span class="params">(<span class="type">int</span> pin,<span class="type">int</span> value)</span></span><br></pre></td></tr></table></figure><p>2ã€è¯»ç®¡è„šç”µå¹³</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">DigitalRead</span><span class="params">(<span class="type">int</span> pin)</span></span><br></pre></td></tr></table></figure><p>3ã€å»¶æ—¶</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DelayMs(<span class="type">unsigned</span> <span class="type">int</span> delaytime)</span><br></pre></td></tr></table></figure><p>4ã€SPIæ•°æ®è¾“å‡º</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SpiTransfer(<span class="type">unsigned</span> <span class="type">char</span> data)</span><br></pre></td></tr></table></figure><p>5ã€ç¡¬ä»¶åˆå§‹åŒ–</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">IfInit</span><span class="params">(<span class="type">void</span>)</span></span><br></pre></td></tr></table></figure><h2 id="2ã€ä¸­é—´å±‚å¢¨æ°´å±é©±åŠ¨ï¼š"><a href="#2ã€ä¸­é—´å±‚å¢¨æ°´å±é©±åŠ¨ï¼š" class="headerlink" title="2ã€ä¸­é—´å±‚å¢¨æ°´å±é©±åŠ¨ï¼š"></a>2ã€ä¸­é—´å±‚å¢¨æ°´å±é©±åŠ¨ï¼š</h2><p>1ã€å®ä¾‹åŒ–å¢¨æ°´å±</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Epd epd;</span><br></pre></td></tr></table></figure><p>2ã€å¢¨æ°´å±åˆå§‹åŒ–ï¼Œå†å±å¹•å¼€å§‹å·¥ä½œæ—¶å’Œé€€å‡ºç¡çœ æ¨¡å¼ä¹‹åè°ƒç”¨<br>1.54inch e-Paperã€1.54inch e-Paper V2ã€2.13inch e-Paperã€2.13inch e-Paper V2ã€2.13inch e-Paper (D)ã€2.9inch e-Paperã€2.9inch e-Paper (D)</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">epd.Init(lut_full_update); <span class="comment">//å…¨åˆ·åˆå§‹åŒ–</span></span><br><span class="line">epd.Init(lut_partial_update); <span class="comment">//å±€åˆ·åˆå§‹åŒ–</span></span><br></pre></td></tr></table></figure><p>å…¶ä»–å‹å·</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">epd.Init();</span><br></pre></td></tr></table></figure><p>3ã€æ¸…å±ï¼ŒæŠŠå¢¨æ°´å±åˆ·æˆç™½è‰²</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">epd.clear();</span><br></pre></td></tr></table></figure><p>å¯èƒ½æŸäº›ç¨‹åºé‡Œé¢ä¼šè¢«æ‹†åˆ†æˆä¸¤å¥ï¼Œä½†æ˜¯ä»–ä»¬æœ€ç»ˆçš„æ•ˆæœéƒ½æ˜¯ä¸€æ ·çš„ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">epd.ClearFrameMemory(<span class="number">0xFF</span>); </span><br><span class="line">epd.DisplayFrame();<span class="comment">//æ‰“å¼€æ˜¾ç¤º</span></span><br></pre></td></tr></table></figure><p>4ã€ä¼ è¾“ä¸€å¸§çš„å›¾ç‰‡æ•°æ®å¹¶æ˜¾ç¤º</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">Display</span><span class="params">(<span class="type">const</span> <span class="type">unsigned</span> <span class="type">char</span>* frame_buffer)</span>;</span><br><span class="line"><span class="type">void</span> <span class="title function_">DisplayFrame</span><span class="params">(<span class="type">const</span> <span class="type">unsigned</span> <span class="type">char</span>* frame_buffer_black, <span class="type">const</span> <span class="type">unsigned</span> <span class="type">char</span>* frame_buffer_red)</span>; <span class="comment">//ä¸‰è‰²å±å¹•</span></span><br></pre></td></tr></table></figure><p>5ã€ç¡çœ </p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">epd.Sleep();</span><br></pre></td></tr></table></figure><p>è¿›å…¥ç¡çœ æ¨¡å¼ï¼Œå¢¨æ°´å±è®²è¿›å…¥è¶…ä½è€—ç”µï¼Œå¦‚æœé•¿æ—¶é—´ä¸ç”¨éœ€è¦åˆ·ç™½ä¿å­˜ï¼Œå¦åˆ™é•¿æ—¶é—´ä¼šæœ‰æ®‹å½±ã€‚</p><h2 id="3ã€ä¸Šå±‚åº”ç”¨ï¼š"><a href="#3ã€ä¸Šå±‚åº”ç”¨ï¼š" class="headerlink" title="3ã€ä¸Šå±‚åº”ç”¨ï¼š"></a>3ã€ä¸Šå±‚åº”ç”¨ï¼š</h2><p>ä¸Šå±‚åº”ç”¨ä¹Ÿå°±æ˜¯æˆ‘ä»¬çš„éœ€è¦ç”¨å¢¨æ°´å±å®ç°çš„åŠŸèƒ½ï¼Œä¸€èˆ¬å°±æ˜¯ç”»å›¾ã€å­—ç¬¦ç­‰åŠŸèƒ½ï¼Œä¹Ÿå°±æ˜¯epdpaint.cppé‡Œé¢å®šä¹‰çš„åŠŸèƒ½<br>é¦–å…ˆéœ€è¦è®²è§£ä¸€ä¸‹ç¼“å­˜çš„åæ ‡ç³»ï¼Œä¸ºäº†ä¼ è¾“æ–¹ä¾¿é€šå¸¸å§åä¸Šå®šä½åŸç‚¹ï¼Œå¾€å³Xè½´å¢åŠ ï¼Œå¾€ä¸‹Yè½´å¢åŠ ã€‚åªéœ€è¦çœ‹publicä¸‹å‡½æ•°å³å¯ã€‚<br>1ã€åˆå§‹åŒ–å›¾ç‰‡ç¼“å­˜</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Paint(<span class="type">unsigned</span> <span class="type">char</span>* image, <span class="type">int</span> width, <span class="type">int</span> height);</span><br></pre></td></tr></table></figure><p>ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯å›¾ç‰‡ç¼“å­˜ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯å®šä¹‰å›¾ç‰‡é•¿åº¦ï¼Œç¬¬ä¸‰ä¸ªå‚æ•°å®šä¹‰å›¾ç‰‡é«˜åº¦ï¼Œä½ å¯èƒ½ä¼šåœ¨ç¨‹åºä¸­çœ‹åˆ°å¦‚ä¸‹</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Paint <span class="title function_">paint</span><span class="params">(image, <span class="number">0</span>, <span class="number">0</span>)</span>;    <span class="comment">// width should be the multiple of 8</span></span><br></pre></td></tr></table></figure><p>ç¬¬äºŒã€ä¸‰ä¸ªå‚æ•°è¿™é‡Œè®¾ç½®æˆ0ï¼Œæ˜¯å› ä¸ºä¸‹é¢è¿˜å¯ä»¥è®¾ç½®ã€‚<br>2ã€è®¾ç½®é«˜å®½ã€è·å–é«˜å®½ã€è®¾ç½®ç¿»è½¬è§’åº¦ã€è·å–ç¿»è½¬è§’åº¦</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span>  <span class="title function_">GetWidth</span><span class="params">(<span class="type">void</span>)</span>; <span class="comment">//å¾—åˆ°å®½åº¦</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">SetWidth</span><span class="params">(<span class="type">int</span> width)</span>;<span class="comment">//è®¾ç½®å®½åº¦</span></span><br><span class="line"><span class="type">int</span>  <span class="title function_">GetHeight</span><span class="params">(<span class="type">void</span>)</span>;<span class="comment">//å¾—åˆ°é«˜åº¦</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">SetHeight</span><span class="params">(<span class="type">int</span> height)</span>;<span class="comment">//è®¾ç½®é«˜åº¦</span></span><br><span class="line"><span class="type">int</span>  <span class="title function_">GetRotate</span><span class="params">(<span class="type">void</span>)</span>;<span class="comment">//å¾—åˆ°ç¿»è½¬è§’åº¦</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">SetRotate</span><span class="params">(<span class="type">int</span> rotate)</span>;<span class="comment">//è®¾ç½®ç¿»è½¬è§’åº¦</span></span><br><span class="line">Â·Â·Â·</span><br><span class="line"><span class="number">3</span>ã€è·å–å›¾åƒç¼“å­˜</span><br><span class="line">```c</span><br><span class="line"><span class="type">unsigned</span> <span class="type">char</span>* <span class="title function_">GetImage</span><span class="params">(<span class="type">void</span>)</span>;</span><br></pre></td></tr></table></figure><p>4ã€ç”»ç‚¹</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">DrawPixel</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y, <span class="type">int</span> colored)</span>;</span><br></pre></td></tr></table></figure><p>åœ¨åæ ‡(x,y)<br>5ã€å†™å­—ç¬¦</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">DrawCharAt</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y, <span class="type">char</span> ascii_char, sFONT* font, <span class="type">int</span> colored)</span>;</span><br></pre></td></tr></table></figure><p>åœ¨ï¼ˆx,yï¼‰è¿™ä¸€ç‚¹ä¸ºå·¦é¡¶ç‚¹å†™å­—ç¬¦ascii_charï¼Œå­—ä½“å¤§å°ä¸ºfontï¼Œé¢œè‰²ä¸ºcolored<br>6ã€å†™å­—ç¬¦ä¸²</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">DrawStringAt</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y, <span class="type">const</span> <span class="type">char</span>* text, sFONT* font, <span class="type">int</span> colored)</span>;</span><br></pre></td></tr></table></figure><p>åœ¨ï¼ˆx,yï¼‰è¿™ä¸€ç‚¹ä¸ºå·¦é¡¶ç‚¹å†™å­—ç¬¦ä¸²textï¼Œå­—ä½“å¤§å°ä¸ºfontï¼Œé¢œè‰²ä¸ºcolored<br>7ã€ç”»çº¿</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">DrawLine</span><span class="params">(<span class="type">int</span> x0, <span class="type">int</span> y0, <span class="type">int</span> x1, <span class="type">int</span> y1, <span class="type">int</span> colored)</span>;</span><br></pre></td></tr></table></figure><p>ä»¥ï¼ˆx0,y0ï¼‰ä¸ºèµ·ç‚¹ï¼Œï¼ˆx1,y1ï¼‰ä¸ºç»ˆç‚¹ç”»ä¸€æ¡çº¿ï¼Œæ–œç‡ä»»æ„ï¼›<br>8ã€ç”»æ¨ªçº¿</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">DrawHorizontalLine</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y, <span class="type">int</span> width, <span class="type">int</span> colored)</span>;</span><br></pre></td></tr></table></figure><p>ä»¥ï¼ˆx0,y0ï¼‰ä¸ºèµ·ç‚¹ï¼Œï¼ˆx1,y1ï¼‰ä¸ºç»ˆç‚¹ç”»ä¸€æ¡æ¨ªçº¿ï¼Œé€Ÿåº¦æ¯”DrawLine()å¿«<br>9ã€ç”»ç«–çº¿</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">DrawVerticalLine</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y, <span class="type">int</span> height, <span class="type">int</span> colored)</span>;</span><br></pre></td></tr></table></figure><p>ä»¥ï¼ˆx0,y0ï¼‰ä¸ºèµ·ç‚¹ï¼Œï¼ˆx1,y1ï¼‰ä¸ºç»ˆç‚¹ç”»ä¸€æ¡ç«–çº¿ï¼Œé€Ÿåº¦æ¯”DrawLine()å¿«<br>10ã€çŸ©å½¢ï¼Œç”»ç©ºå¿ƒæ¡†</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">DrawRectangle</span><span class="params">(<span class="type">int</span> x0, <span class="type">int</span> y0, <span class="type">int</span> x1, <span class="type">int</span> y1, <span class="type">int</span> colored)</span>;</span><br></pre></td></tr></table></figure><p>ä»¥ï¼ˆx0,y0ï¼‰ä¸ºèµ·ç‚¹ï¼Œï¼ˆx1,y1ï¼‰ä¸ºç»ˆç‚¹ç”»ä¸€ä¸ªæ¡†ï¼Œè¾¹çš„é¢œè‰²ä¸ºcolored<br>11ã€å¡«å……çŸ©å½¢ï¼Œç”»å®å¿ƒæ¡†</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">DrawFilledRectangle</span><span class="params">(<span class="type">int</span> x0, <span class="type">int</span> y0, <span class="type">int</span> x1, <span class="type">int</span> y1, <span class="type">int</span> colored)</span>;</span><br></pre></td></tr></table></figure><p>ä»¥ï¼ˆx0,y0ï¼‰ä¸ºèµ·ç‚¹ï¼Œï¼ˆx1,y1ï¼‰ä¸ºç»ˆç‚¹ç”»ä¸€ä¸ªæ¡†ï¼Œå¹¶ä¸”å†…éƒ¨å¡«å……ï¼Œé¢œè‰²ä¸ºcolored<br>12ã€ç”»ç©ºå¿ƒåœ†</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">DrawCircle</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y, <span class="type">int</span> radius, <span class="type">int</span> colored)</span>;</span><br></pre></td></tr></table></figure><p>ä»¥ï¼ˆx,yï¼‰ä¸ºåœ†å¿ƒï¼Œradiusä¸ºåŠæ–¤ç”»ä¸€ä¸ªç©ºå¿ƒåœ†ï¼Œé¢œè‰²ä¸ºcolored<br>13ã€å®å¿ƒåœ†</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">DrawFilledCircle</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y, <span class="type">int</span> radius, <span class="type">int</span> colored)</span>;</span><br></pre></td></tr></table></figure><p>ä»¥ï¼ˆx,yï¼‰ä¸ºåœ†å¿ƒï¼Œradiusä¸ºåŠæ–¤ç”»ä¸€ä¸ªå®å¿ƒå¿ƒåœ†ï¼Œé¢œè‰²ä¸ºcolored</p><h1 id="3ã€PSåˆ¶ä½œæ•£ç‚¹å›¾"><a href="#3ã€PSåˆ¶ä½œæ•£ç‚¹å›¾" class="headerlink" title="3ã€PSåˆ¶ä½œæ•£ç‚¹å›¾"></a>3ã€PSåˆ¶ä½œæ•£ç‚¹å›¾</h1><p>å–æ¨¡ï¼Œ2.13å¯¸ä¸‰è‰²å¢¨æ°´å±ï¼ˆä¸å…¼å®¹å¾®é›ªçš„ç¨‹åºï¼Œä½†å¯å‚è€ƒï¼‰<a href="https://www.waveshare.net/wiki/2.13inch_e-Paper_HAT_(B)">å¾®é›ªï¼š2.13inch e-Paper HAT (B)</a></p><p>å›¾ç‰‡ç´ æåˆ¶ä½œï¼šé¦–å…ˆç”¨PSåˆ¶ä½œä¸‰è‰²æ•£ç‚¹å›¾ï¼Œç„¶åç”¨PSå°†ä¸‰è‰²ï¼ˆé»‘ç™½çº¢ï¼‰åˆ†ä¸¤ç±»ï¼Œä¸€å¼ é»‘ç™½ï¼Œä¸€å¼ çº¢ç™½ï¼ˆä½¿ç”¨PSå¸ç®¡å·¥å…·é¢œè‰²æ›¿æ¢ï¼Œå…ˆå°†ä¸‰è‰²å›¾ä¸­çº¢è‰²æ›¿æ¢ä¸ºç™½è‰²ï¼Œåˆ¶æˆé»‘ç™½å›¾ç‰‡ï¼›å†å°†ä¸‰è‰²å›¾ä¸­é»‘è‰²æ›¿æ¢ä¸ºç™½è‰²ï¼‰å®é™…ä¸Šä¸‰è‰²å¢¨æ°´å±æ˜¯é€šè¿‡ä¸¤å¼ å›¾ç‰‡å åŠ è€Œæˆçš„ã€‚<br>[<img src="https://z3.ax1x.com/2021/07/25/WRpUQs.md.jpg" class="lazyload placeholder" data-srcset="https://z3.ax1x.com/2021/07/25/WRpUQs.md.jpg" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="WRpUQs.md.jpg"></p>]]></content>
      
      
      
        <tags>
            
            <tag> åµŒå…¥å¼å¼€å‘ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>APM28å››æ—‹ç¿¼è£…æœº</title>
      <link href="/2021/07/07/apm28-si-xuan-yi-zhuang-ji/"/>
      <url>/2021/07/07/apm28-si-xuan-yi-zhuang-ji/</url>
      
        <content type="html"><![CDATA[<h1 id="1ã€åŸºæœ¬è£…æœºå’Œè°ƒè¯•"><a href="#1ã€åŸºæœ¬è£…æœºå’Œè°ƒè¯•" class="headerlink" title="1ã€åŸºæœ¬è£…æœºå’Œè°ƒè¯•"></a>1ã€åŸºæœ¬è£…æœºå’Œè°ƒè¯•</h1><pre><code>1. å®‰è£…APMçš„åœ°é¢ç«™ï¼›1. é£æ§è¿æ¥ç”µè„‘ï¼ŒGPSä¸æ¥æ”¶æœºè¿æ¥é£æ§ï¼›1. åœ°é¢ç«™ç‚¹å‡»è¿æ¥ï¼Œç¬¬ä¸€æ­¥æ ¡å‡†åŠ é€Ÿåº¦è®¡ï¼ŒæŒ‰ç…§è¦æ±‚ä¸€æ­¥ä¸€æ­¥æ‘†æ”¾é£æ§ä½ç½®ï¼›1. ç½—ç›˜æ ¡å‡†ï¼šç‚¹å‡»åœ°é¢ç«™ç½—ç›˜æ ¡å‡†ï¼Œç§»åŠ¨GPSä½ç½®ï¼Œä½¿ä¹‹å…¨éƒ¨æ ¡å‡†å®Œæ¯•ï¼›1. é¥æ§å™¨æ ¡å‡†ï¼›1. é£è¡Œæ¨¡å¼è®¾ç½®ï¼Œä¸€èˆ¬å°±è¦è‡ªç¨³ï¼Œå®šç‚¹ï¼Œå®šé«˜..1. APMè§£é”æ£€æŸ¥ï¼Œå·¦æ‘‡æ†å³ä¸‹è§’3ç§’è§£é”ï¼Œå·¦ä¸‹è§’3ç§’ä¸Šé”ï¼›1. è£…æœºï¼šå››è½´ç”µè°ƒä¿¡å·çº¿ï¼Œå³ä¸Šè§’æœºæ¶ä¸º1é€šé“ï¼Œå¯¹è§’ä¸º2é€šé“ï¼Œå·¦ä¸Šè§’ä¸º3é€šé“ï¼Œå¯¹è§’ä¸º4é€šé“ï¼›1. APMå¤±æ§ä¿æŠ¤è®¾ç½®ã€‚</code></pre><p><a href="https://imgtu.com/i/RbbUlq"><img src="https://z3.ax1x.com/2021/07/07/RbbUlq.md.jpg" class="lazyload placeholder" data-srcset="https://z3.ax1x.com/2021/07/07/RbbUlq.md.jpg" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="RbbUlq.md.jpg"></a></p>]]></content>
      
      
      
        <tags>
            
            <tag> èˆªæ¨¡ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>é€šä¿¡è¯¾è®¾--åŸºäºSTM32ä¸OneNetçš„æ¸©å®¤å¤§æ£š</title>
      <link href="/2021/06/03/tong-xin-ke-she-ji-yu-stm32-yu-onenet-de-wen-shi-da-peng/"/>
      <url>/2021/06/03/tong-xin-ke-she-ji-yu-stm32-yu-onenet-de-wen-shi-da-peng/</url>
      
        <content type="html"><![CDATA[<p>â€‹é€šä¿¡è¯¾è®¾ç»ˆäºåšå®Œäº†ï¼ˆæ™ºèƒ½æ¸©å®¤å¤§æ£šï¼‰</p><p><a href="https://imgtu.com/i/288AA0"><img src="https://z3.ax1x.com/2021/06/03/288AA0.md.png" class="lazyload placeholder" data-srcset="https://z3.ax1x.com/2021/06/03/288AA0.md.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="288AA0.md.png"></a></p><p>â€‹ç®€è¦è®°è¿°ä¸€ä¸‹ï¼š</p><p>â€‹ç”¨åŸå­çš„ç²¾è‹±ç‰ˆç›¸å…³ä¾‹ç¨‹ç»„åˆå½¢æˆæœ¬åœ°ç«¯ç•Œé¢ï¼Œä¸»è¦åŒ…æ‹¬LCDå­—ç¬¦æ˜¾ç¤ºï¼Œä¸­æ–‡å­—åº“æ˜¾ç¤ºï¼ŒDHT11ä¼ æ„Ÿå™¨çš„åº“ï¼ˆå…¶ä¸­DHT11çš„ä¿¡å·é‡ç‚¹çœ‹äº†ä¸€ä¸‹ï¼Œå…¶ä¸­æœ‰ä¸€ä¸ªä¼ æ„Ÿå™¨æ£€æµ‹çš„ä¿¡å·ï¼Œåˆ¤æ–­è¿æ¥æ˜¯å¦æ­£ç¡®ï¼‰ï¼Œè¿˜æœ‰å°±æ˜¯YL69åœŸå£¤æ¹¿åº¦ä¼ æ„Ÿå™¨å’Œå…‰æ•ç”µé˜»ä¼ æ„Ÿå™¨ï¼Œè¿™ä¸¤ä¸ªä½¿ç”¨çš„æ˜¯ADCé‡‡é›†ï¼ŒSTM32ZET6å†…éƒ¨é›†æˆäº†3ä¸ªADCï¼šæ³¨æ„ä¸€ä¸‹ç›¸å…³ADCçš„ä½¿èƒ½å’Œé€šé“çš„å¯ç”¨ï¼Œé¿å…å†²çªï¼Œé€‰æ‹©åˆé€‚çš„ADCé€šé“ï¼ˆè¿™ä¸ªåœ°æ–¹å¡äº†ä¸€æ®µæ—¶é—´ï¼‰ã€‚</p><p><a href="https://imgtu.com/i/28JU0A"><img src="https://z3.ax1x.com/2021/06/03/28JU0A.md.png" class="lazyload placeholder" data-srcset="https://z3.ax1x.com/2021/06/03/28JU0A.md.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="28JU0A.md.png"></a></p><p>è¿˜æœ‰æ³¨æ„ä¸€ä¸‹å¼•å…¥ç¡¬ä»¶åº“æ—¶ï¼Œè®°å¾—è¦åœ¨MDKâ€œå°é­”æœ¯æ£’â€çš„C++é‡Œæ·»åŠ ç›¸å…³æ–‡ä»¶çš„è·¯å¾„ï¼Œè¦ä¸ä¼šæŠ¥é”™ã€‚ä¼ æ„Ÿå™¨é‡‡é›†æ­£å¸¸åï¼Œæˆ‘çš„å¼ºè¿«ç—‡åˆçŠ¯äº†ï¼ŒèŠ±äº†ä¸€éƒ¨åˆ†æ—¶é—´åœ¨è®¾è®¡ç•Œé¢ä¸Šï¼Œæ¥ä¸‹æ¥å°±æ˜¯æ·»åŠ äº†é˜ˆå€¼è®¾ç½®ä¸ç›¸å…³æ§åˆ¶å™¨çš„å¼€å¯ä¸å…³é—­ï¼Œå……åˆ†çš„åˆ©ç”¨äº†ç²¾è‹±ç‰ˆä¸Šçš„ä¸ªå®ä½“æŒ‰é”®ï¼ˆå¤ä½æŒ‰é”®ä¸èƒ½ç”¨ï¼‰ï¼Œä¹Ÿä¸ç”¨å¤–æ¥æŒ‰é”®äº†ã€‚</p><p>â€‹æ¥ä¸‹æ¥å°±æ˜¯ç½‘ç»œéƒ¨åˆ†ï¼Œé‡‡ç”¨æ­£ç‚¹åŸå­çš„esp8266æ¨¡å—ï¼ˆä¸€å¼€å§‹ç”¨çš„æ—¶01s,æ„Ÿè§‰ä¸å¤ªå¥½è°ƒï¼Œå…¶å®ä¹Ÿæ˜¯èƒ½ç”¨çš„ï¼‰ï¼Œå‚è€ƒäº†ä¸­å›½ç§»åŠ¨onenetå‡ºçš„ä¸€éƒ¨åˆ†MQTTéƒ¨åˆ†ç¨‹åºï¼ŒæŒºå¥½ç”¨çš„ï¼Œç²¾è‹±ç‰ˆçš„ä¸²å£1ç”¨æ¥è°ƒè¯•ï¼Œä¸²å£2ç”¨æ¥å’Œ8266è¿›è¡Œä¸²å£é€šä¿¡ï¼Œå‘é€ATæŒ‡ä»¤ã€‚æœåŠ¡å™¨ç”¨çš„emqx(æ­å·è¥æ˜ äº‘ç§‘æŠ€)å…è´¹çš„åœ¨çº¿MQTT 5æœåŠ¡å™¨ï¼Œç½‘ç»œè°ƒè¯•ä½¿ç”¨çš„æ—¶ç”µè„‘ç«¯ï¼šMQTT.fx,åæ¥å› ä¸ºæ²¡æœ‰æ—¶é—´åšå°ç¨‹åºäº†ï¼Œæ”¹ç”¨äº†APP Storeçš„ä¸€ä¸ªå«MQTToolçš„æ‰‹æœºç«¯ç½‘ç»œè°ƒè¯•å™¨ï¼Œä¹Ÿç®—æ˜¯æ‰‹æœºå°ç¨‹åºäº†å§ã€‚ã€‚ã€‚ï¼ˆå°ç¨‹åºæ¥ä¸‹æ¥è¦ç»§ç»­åšçš„è¯å‡†å¤‡ä½¿ç”¨mpvue.comçš„å¿«é€Ÿæ¡†æ¶ï¼Œä½¿ç”¨VScodeè¿›è¡Œå¼€å‘ï¼Œå¾®ä¿¡å¼€å‘è€…å·¥å…·ä½œä¸ºè°ƒè¯•ç«¯ï¼Œä¸‹è½½å¿«é€Ÿæ¡†æ¶æ˜¯æ—¶é‡åˆ°ç‚¹é—®é¢˜è¿˜æ²¡æœ‰åŠæ—¶è§£å†³ï¼‰ã€‚</p><p>â€‹è¿æ¥æœåŠ¡å™¨åï¼Œå°±è¦è®¢é˜…å’Œä¸Šä¼ æ•°æ®ï¼Œä¸Šä¼ æ•°æ®å¾ˆå¥½è§£å†³ï¼Œè®¢é˜…ï¼Œæ•°æ®ä¸‹è¡Œä½¿ç”¨äº†JSONçš„æ ¼å¼æ•°æ®è¿›è¡Œä¼ è¾“è§£æçš„ï¼Œé€Ÿåº¦å¾ˆå¿«ï¼Œè™½ç„¶ä»£ç å˜å¤šäº†ã€‚ä¸»è¦æ—¶51å‡æœŸæœŸé—´æäº†å‡ å¤©ï¼ŒåŸºæœ¬ä¸Šå°±æ˜¯è¿™æ ·äº†ï¼Œç„¶åä¸ºäº†è§£å†³åˆšå¼€æœºå°±è¿æœåŠ¡å™¨å¯¼è‡´æœ¬åœ°ç«¯æ•°æ®å¡ä½çš„é—®é¢˜ï¼Œä½¿ç”¨äº†æœ€åä¸€ä¸ªæŒ‰é”®â€”â€“æ¿å­ä¸Šçš„è§¦æ‘¸æŒ‰é”®ï¼Œä½œä¸ºè¿æ¥æœåŠ¡å™¨çš„å¼€å…³ï¼Œä½¿å¾—åˆšå¼€æœºè¿›å…¥æœ¬åœ°æ¨¡å¼ï¼Œè¦æƒ³è¿æ¥æœåŠ¡å™¨å†æŒ‰ä¸€ä¸‹è§¦æ‘¸å¼€å…³ï¼ŒåŒæ—¶ï¼Œæˆ‘æŠŠä¸²å£è°ƒè¯•çš„è¾“å‡ºä¿¡æ¯æ”¾åœ¨äº†LCDä¸‹é¢çš„å‰©ä½™ç©ºé—´å¤„ï¼Œä¾¿äºè„±æœºè¿è¡Œæ—¶å‡ºç°é—®é¢˜çš„åŠæ—¶åˆ†æã€‚å¤§æ¦‚å°±åšæˆäº†è¿™æ ·ã€‚</p><p>â€‹æ¥ä¸‹æ¥ä¸»è¦å°±æ˜¯å¸®åŒå­¦åšäº†ï¼Œä¸»è¦ä½¿ç”¨çš„ç‚¹ç¯ç§‘æŠ€å¼€å‘æ–‡æ¡£ï¼Œç›´æ¥ç”¨ï¼Œå¤åˆ¶åˆ°ä»–ä»¬çš„é¡¹ç›®ä¸Šï¼Œå¾ˆå¥½ç”¨ï¼Œè¿˜èƒ½è¿æ¥å°çˆ±åŒå­¦è¯­éŸ³è®­ç»ƒï¼Œå°±æ˜¯æœ‰ä¸ªåŒå­¦çš„51å•ç‰‡æœºä¸²å£é€šä¿¡é‚£å—æ²¡åšå¥½ï¼Œç°å­¦å¾—å¾—51ä¸²å£é€šä¿¡ï¼Œå¯æ˜¯å®ƒåŸæœ‰çš„ä¸²å£è¢«å½“ä½œæ™®é€šIOå£ç”¨äº†ï¼Œé‡æ–°å®šä¹‰è¿˜ä¼šå’Œä¹‹å‰å®ƒä½¿ç”¨çš„å¯„å­˜å™¨åˆå€¼å†²çªï¼Œæ€»ä¹‹ä¸å¤ªå¥½æ”¹ï¼Œæœ€ååªåšäº†8266ä¸æœåŠ¡å™¨ç«¯çš„æ•°æ®ä¸Šä¼ ï¼Œæ— æ³•ä»51ä¸²å£å®æ—¶è·å–é‡‡é›†çš„æ•°æ®ã€‚ã€‚ã€‚æˆ‘é‚£è¯¾è®¾æ”¾äº†ä¸€ä¸ªå¤šæœˆï¼Œå†æ‹¿å‡ºæ¥åï¼Œæ•°æ®ä¸‹å‘ä¸äº†äº†ï¼ŒæŸ¥äº†å¾ˆå¤šåŸå› ï¼Œä¸€ç›´ä»¥ä¸ºæ˜¯æˆ‘ç¨‹åºå†™çš„è¿‡äºè‡ƒè‚¿ï¼ŒåŠ ä¸ŠæœåŠ¡å™¨çš„å»¶æ—¶ï¼Œå¯¼è‡´ç¨‹åºè¿›ä¸å»ï¼Œä¸€ç›´åœ¨è°ƒå»¶æ—¶æ—¶é—´ï¼Œä¸€ç›´ä¸å¥½ç”¨ï¼Œå¡äº†æˆ‘ä¸¤å¤©ï¼Œæœ€åæ‰å‘ç°ï¼Œæ˜¯æˆ‘åŠ å…¥è§¦æ‘¸è¿æ¥æœåŠ¡å™¨åå½¢æˆäº†å…ˆè®¢é˜…ï¼Œåè¿æ¥çš„é”™è¯¯é¡ºåºï¼Œæ€»ä¹‹ä¸€ä¸ªå¾ˆä½çº§çš„é—®é¢˜ã€‚ã€‚ã€‚å¡äº†æˆ‘ä¸¤å¤©ã€‚</p><p>â€‹åœ¨å½“å¤©å¿«è¦ç­”è¾©æ—¶ï¼Œå—å­¦å§ç›¸å…³å®éªŒè¯¾çš„å¯å‘ï¼Œæˆ‘æƒ³ï¼Œæå‡ºæˆ‘çš„å¤è‘£æ ‘è“æ´¾ï¼Œè‡ªå·±æ­ä¸€ä¸ªMQTTçš„æœåŠ¡å™¨ï¼Œä¸ç”¨å…¬å…±æˆ–è€…ä¹°çš„æœåŠ¡å™¨ï¼Œå…´è®¸è¿˜èƒ½å¤šåŠ ç‚¹åˆ†ï¼Œè°ƒäº†2ä¸ªå¤šå°æ—¶ï¼Œè°ƒå‡ºæ¥äº†ï¼Œæ‹¿å»å®éªŒå®¤æ—¶è™½ç„¶è¿æ¥ä¸Šäº†ï¼Œä½†æ˜¯æ˜¾ç¤ºç«¯å£è¢«å ç”¨ï¼Œåº”è¯¥æ˜¯æˆ‘ä¹‹å‰å¼€äº†ä¸€ä¸ªç«¯å£å¿˜å…³äº†ï¼Œå¼€äº†å…¶ä»–çš„ç«¯å£ï¼Œåæ¥è¿˜æ˜¯å¯ä»¥ç”¨çš„ï¼Œä½†ç­”è¾©æ—¶è¿˜æ˜¯ç”¨çš„å…¬å…±æœåŠ¡å™¨ã€‚ã€‚ã€‚</p><p>â€‹å°±è¿™ä¹ˆå¤šï¼Œåªæœ‰åŠ¨æ‰‹å»åšäº†ï¼Œæ‰ä¼šå‘ç°ï¼ŒåŸæ¥é—®é¢˜é‚£ä¹ˆå¤šï¼Œä¸è¿‡ä¼šè¢«è§£å†³çš„ï¼Œä¹Ÿç®—æ˜¯ä¸€æ¬¡ç»éªŒå§ã€‚å…¶ä»–çš„ç»†èŠ‚æš‚æ—¶æƒ³ä¸èµ·æ¥äº†ã€‚</p>]]></content>
      
      
      
        <tags>
            
            <tag> é¡¹ç›® </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>STC51</title>
      <link href="/2021/04/05/stc51/"/>
      <url>/2021/04/05/stc51/</url>
      
        <content type="html"><![CDATA[<h1 id="1ã€ç¡¬ä»¶-BST-M51"><a href="#1ã€ç¡¬ä»¶-BST-M51" class="headerlink" title="1ã€ç¡¬ä»¶(BST-M51)"></a>1ã€ç¡¬ä»¶(BST-M51)</h1><h2 id="1ã€51æœ€å°ç³»ç»Ÿ"><a href="#1ã€51æœ€å°ç³»ç»Ÿ" class="headerlink" title="1ã€51æœ€å°ç³»ç»Ÿ"></a>1ã€51æœ€å°ç³»ç»Ÿ</h2><p>â€‹<a href="https://imgtu.com/i/cQwm6A"><img src="https://z3.ax1x.com/2021/04/05/cQwm6A.png" class="lazyload placeholder" data-srcset="https://z3.ax1x.com/2021/04/05/cQwm6A.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="cQwm6A.png"></a></p><h2 id="2ã€æµæ°´ç¯"><a href="#2ã€æµæ°´ç¯" class="headerlink" title="2ã€æµæ°´ç¯"></a>2ã€æµæ°´ç¯</h2><p><a href="https://imgtu.com/i/cQwM0P"><img src="https://z3.ax1x.com/2021/04/05/cQwM0P.png" class="lazyload placeholder" data-srcset="https://z3.ax1x.com/2021/04/05/cQwM0P.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="cQwM0P.png"></a></p><h2 id="3ã€CH340çƒ§å½•æ¨¡å—"><a href="#3ã€CH340çƒ§å½•æ¨¡å—" class="headerlink" title="3ã€CH340çƒ§å½•æ¨¡å—"></a>3ã€CH340çƒ§å½•æ¨¡å—</h2><p><a href="https://imgtu.com/i/cQw1k8"><img src="https://z3.ax1x.com/2021/04/05/cQw1k8.png" class="lazyload placeholder" data-srcset="https://z3.ax1x.com/2021/04/05/cQw1k8.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="cQw1k8.png"></a></p><h2 id="4ã€USBä¾›ç”µ"><a href="#4ã€USBä¾›ç”µ" class="headerlink" title="4ã€USBä¾›ç”µ"></a>4ã€USBä¾›ç”µ</h2><p><a href="https://imgtu.com/i/cQwYlj"><img src="https://z3.ax1x.com/2021/04/05/cQwYlj.png" class="lazyload placeholder" data-srcset="https://z3.ax1x.com/2021/04/05/cQwYlj.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="cQwYlj.png"></a></p><h2 id="5ã€æ•°ç ç®¡ã€WIFIã€çº¢å¤–å‘é€æ¨¡å—"><a href="#5ã€æ•°ç ç®¡ã€WIFIã€çº¢å¤–å‘é€æ¨¡å—" class="headerlink" title="5ã€æ•°ç ç®¡ã€WIFIã€çº¢å¤–å‘é€æ¨¡å—"></a>5ã€æ•°ç ç®¡ã€WIFIã€çº¢å¤–å‘é€æ¨¡å—</h2><p><a href="https://imgtu.com/i/cQwHcd"><img src="https://z3.ax1x.com/2021/04/05/cQwHcd.md.png" class="lazyload placeholder" data-srcset="https://z3.ax1x.com/2021/04/05/cQwHcd.md.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="cQwHcd.md.png"></a></p><h2 id="6ã€çº¢å¤–æ¥æ”¶ã€èœ‚é¸£å™¨ã€4ä½æŒ‰é”®"><a href="#6ã€çº¢å¤–æ¥æ”¶ã€èœ‚é¸£å™¨ã€4ä½æŒ‰é”®" class="headerlink" title="6ã€çº¢å¤–æ¥æ”¶ã€èœ‚é¸£å™¨ã€4ä½æŒ‰é”®"></a>6ã€çº¢å¤–æ¥æ”¶ã€èœ‚é¸£å™¨ã€4ä½æŒ‰é”®</h2><p><a href="https://imgtu.com/i/cQwz4S"><img src="https://z3.ax1x.com/2021/04/05/cQwz4S.png" class="lazyload placeholder" data-srcset="https://z3.ax1x.com/2021/04/05/cQwz4S.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="cQwz4S.png"></a></p><h2 id="7ã€æ¸©åº¦ä¼ æ„Ÿå™¨"><a href="#7ã€æ¸©åº¦ä¼ æ„Ÿå™¨" class="headerlink" title="7ã€æ¸©åº¦ä¼ æ„Ÿå™¨"></a>7ã€æ¸©åº¦ä¼ æ„Ÿå™¨</h2><p><a href="https://imgtu.com/i/cQ0kBq"><img src="https://z3.ax1x.com/2021/04/05/cQ0kBq.png" class="lazyload placeholder" data-srcset="https://z3.ax1x.com/2021/04/05/cQ0kBq.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="cQ0kBq.png"></a></p><h2 id="8ã€å¤ä½ç”µè·¯"><a href="#8ã€å¤ä½ç”µè·¯" class="headerlink" title="8ã€å¤ä½ç”µè·¯"></a>8ã€å¤ä½ç”µè·¯</h2><p><a href="https://imgtu.com/i/cQ0nCF"><img src="https://z3.ax1x.com/2021/04/05/cQ0nCF.png" class="lazyload placeholder" data-srcset="https://z3.ax1x.com/2021/04/05/cQ0nCF.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="cQ0nCF.png"></a></p><h2 id="9ã€ä¾›ç”µ"><a href="#9ã€ä¾›ç”µ" class="headerlink" title="9ã€ä¾›ç”µ"></a>9ã€ä¾›ç”µ</h2><p><a href="https://imgtu.com/i/cQ01D1"><img src="https://z3.ax1x.com/2021/04/05/cQ01D1.png" class="lazyload placeholder" data-srcset="https://z3.ax1x.com/2021/04/05/cQ01D1.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="cQ01D1.png"></a></p><h1 id="2ã€ç¤ºä¾‹ä»£ç "><a href="#2ã€ç¤ºä¾‹ä»£ç " class="headerlink" title="2ã€ç¤ºä¾‹ä»£ç "></a>2ã€ç¤ºä¾‹ä»£ç </h1><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/***************************</span></span><br><span class="line"><span class="comment">1ã€51å•ç‰‡æœºç‚¹ç¯(IOå£æ§åˆ¶ï¼‰</span></span><br><span class="line"><span class="comment">****************************/</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;reg52.h&quot;</span><span class="comment">//&lt;reg52.h&gt;åœ¨å½“å‰å·¥ç¨‹æ–‡ä»¶å¤¹ä¸‹æœç´¢ï¼›â€œreg52.h&quot;å…ˆåœ¨å½“å‰å·¥ç¨‹æ–‡ä»¶å¤¹ä¸‹æœç´¢ï¼Œæ²¡æœ‰åˆ™åˆ°è½¯ä»¶å®‰è£…ç›®å½•æ‰¾</span></span></span><br><span class="line">sbit led1 = P1^<span class="number">0</span>;<span class="comment">//P1å£æœ€ä½ä½ï¼›sfr P0 = 0X80;(å¯„å­˜å™¨é‡å‘½åï¼‰ï¼›sbit CY = PSW^7 ï¼ˆPSWæœ€é«˜ä½é‡å‘½åï¼‰   </span></span><br><span class="line"><span class="type">void</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">led1 = <span class="number">0</span>;<span class="comment">//3~20mA</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/***************************</span></span><br><span class="line"><span class="comment">2ã€51å•ç‰‡æœºç‚¹ç¯(æ€»çº¿æ“ä½œæ³•ï¼‰</span></span><br><span class="line"><span class="comment">****************************/</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;reg52.h&quot;</span></span></span><br><span class="line"><span class="type">void</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">P1 = <span class="number">0</span>;<span class="comment">//0xaa = 10101010 = 170</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/***************************</span></span><br><span class="line"><span class="comment">3ã€å»¶æ—¶è¯­å¥ç²¾ç¡®è®¡ç®—</span></span><br><span class="line"><span class="comment">****************************/</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;reg52.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> uint unsigned int<span class="comment">//#define å®å®šä¹‰ï¼ˆ#define æ–°åç§° åŸå†…å®¹ï¼‰åªèƒ½å®šä¹‰ä¸€æ¬¡</span></span></span><br><span class="line">sbit led1 = P1^<span class="number">0</span>;</span><br><span class="line">uint i,j;</span><br><span class="line"><span class="type">void</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">while</span>(<span class="number">1</span>)</span><br><span class="line">&#123;</span><br><span class="line">led1 = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span>(i=<span class="number">1000</span>;i&gt;<span class="number">0</span>;i--)</span><br><span class="line"><span class="keyword">for</span>(j=<span class="number">110</span>;j&gt;<span class="number">0</span>;j--);</span><br><span class="line">led1 = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">for</span>(i=<span class="number">1000</span>;i&gt;<span class="number">0</span>;i--)</span><br><span class="line"><span class="keyword">for</span>(j=<span class="number">110</span>;j&gt;<span class="number">0</span>;j--);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/****************************</span></span><br><span class="line"><span class="comment">4ã€å¸¦å‚æ•°å‡½æ•°å†™æ³•åŠè°ƒç”¨</span></span><br><span class="line"><span class="comment">*****************************/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">delayms</span><span class="params">(<span class="type">unsigned</span> <span class="type">int</span> xms)</span></span><br><span class="line">&#123;</span><br><span class="line">uint i,j;</span><br><span class="line"><span class="keyword">for</span>(i=xms;i&gt;<span class="number">0</span>;i--)</span><br><span class="line"><span class="keyword">for</span>(j=<span class="number">110</span>;j&gt;<span class="number">0</span>;j--);<span class="comment">//i=xmså³å»¶æ—¶xmsæ¯«ç§’</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*****************************</span></span><br><span class="line"><span class="comment">5ã€åˆ©ç”¨C51åº“å‡½æ•°å®ç°æµæ°´ç¯ï¼ˆleil\C51\HIP\C51Libï¼‰</span></span><br><span class="line"><span class="comment">*******************************/</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;intrins.h&gt;</span></span></span><br><span class="line">_cro_(aa,<span class="number">1</span>);<span class="comment">//å°†aaå¾ªç¯å·¦ç§»1ä½ </span></span><br></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*******************************</span></span><br><span class="line"><span class="comment">6ã€æ•°ç ç®¡é™æ€æ˜¾ç¤ºï¼ŒBST51ç¬¬ä¸€ä¸ªæ•°ç ç®¡æ˜¾ç¤ºå­—ç¬¦â€œbâ€ï¼ˆå…±é˜´æ•°ç ç®¡ï¼‰</span></span><br><span class="line"><span class="comment">********************************/</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;reg52.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> duan P0</span></span><br><span class="line">sbit wei1 = P2^<span class="number">4</span>;<span class="comment">//å®šä¹‰ç¬¬ä¸€ä½æ•°ç ç®¡</span></span><br><span class="line">sbit wei2 = P2^<span class="number">5</span>;<span class="comment">//å®šä¹‰ç¬¬äºŒä½æ•°ç ç®¡</span></span><br><span class="line">sbit wei3 = P2^<span class="number">6</span>;<span class="comment">//å®šä¹‰ç¬¬ä¸‰ä½æ•°ç ç®¡</span></span><br><span class="line">sbit wei4 = P2^<span class="number">7</span>;<span class="comment">//å®šä¹‰ç¬¬å››ä½æ•°ç ç®¡</span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">wei1 = <span class="number">1</span>;</span><br><span class="line">wei2 = <span class="number">0</span>;</span><br><span class="line">wei3 = <span class="number">0</span>;</span><br><span class="line">wei4 = <span class="number">0</span>;</span><br><span class="line">duan = <span class="number">0x7c</span>;</span><br><span class="line">    <span class="comment">//0111 1100 &quot;b&quot;0x3f , 0x06 , 0x5b , 0x4f , 0x66 , 0x6d ,0x7d , 0x07 , 0x7f , 0x6f , 0x77 , 0x7c ,</span></span><br><span class="line"><span class="comment">//0x39 , 0x5e , 0x79 , 0x71 , 0x00ï¼ˆ0ï¼Œ1ï¼Œ2ï¼Œ3ï¼Œ4ï¼Œ5ï¼Œ6ï¼Œ7ï¼Œ8ï¼Œ9ï¼ŒA,B,C,D,E,F,ä¸æ˜¾ç¤ºï¼‰</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span>(<span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/***********è¡¥å……************************</span></span><br><span class="line"><span class="comment">unsigned char code table[]=&#123;</span></span><br><span class="line"><span class="comment">0x3f , 0x06 , 0x5b , 0x4f ,</span></span><br><span class="line"><span class="comment">0x66 , 0x6d ,0x7d , 0x07 , </span></span><br><span class="line"><span class="comment">0x7f , 0x6f , 0x77 , 0x7c ,</span></span><br><span class="line"><span class="comment">0x39 , 0x5e , 0x79 , 0x71 , 0x00&#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">//table[0] = 0x3f</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**************************************</span></span><br><span class="line"><span class="comment">7ã€74HC573é”å­˜å™¨ æ®µé€‰ã€ä½é€‰ï¼ˆæ•°ç ç®¡é™æ€æ˜¾ç¤ºï¼‰ï¼ˆå…±é˜´æ•°ç ç®¡ï¼‰ç¬¬ä¸€ä¸ªæ•°ç ç®¡æ˜¾ç¤ºå­—ç¬¦â€œ8â€</span></span><br><span class="line"><span class="comment">74H573é”å­˜å™¨ï¼š20å¼•è„šï¼Œ-OEè„šï¼šä¸‰æ€å…è®¸æ§åˆ¶ç«¯ï¼ˆä½ç”µå¹³æœ‰æ•ˆï¼‰ï¼ˆå³è¾“å‡ºä½¿èƒ½ç«¯ï¼‰</span></span><br><span class="line"><span class="comment">  INPUTS   OUTPUT 1D~8Dï¼šæ•°æ®è¾“å…¥ç«¯ï¼›1Q~8Q;æ•°æ®è¾“å‡ºç«¯</span></span><br><span class="line"><span class="comment">-OELED Q     LEï¼šé”å­˜å…è®¸ç«¯ï¼ˆé”å­˜æ§åˆ¶ç«¯ï¼‰</span></span><br><span class="line"><span class="comment"> L HH H</span></span><br><span class="line"><span class="comment"> L HL L</span></span><br><span class="line"><span class="comment"> L L  X    Q0ï¼ˆä¸Šä¸€æ¬¡çš„æ•°æ®çŠ¶æ€ï¼‰</span></span><br><span class="line"><span class="comment"> H   X  X    Zï¼ˆé«˜é˜»æ€ï¼‰</span></span><br><span class="line"><span class="comment"> (çœŸå€¼è¡¨)</span></span><br><span class="line"><span class="comment">***************************************/</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;reg52.h&quot;</span></span></span><br><span class="line">sbit duan = P2^<span class="number">6</span>;<span class="comment">//ç”³æ˜U1é”å­˜å™¨çš„é”å­˜ç«¯</span></span><br><span class="line">sbit wela = P2^<span class="number">7</span>;<span class="comment">//ç”³æ˜U2é”å­˜å™¨çš„é”å­˜ç«¯</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">wela = <span class="number">1</span>;<span class="comment">//æ‰“å¼€U2é”å­˜å™¨</span></span><br><span class="line">P0 = <span class="number">0xFE</span>;<span class="comment">//é€å…¥ä½é€‰ä¿¡å·11111110</span></span><br><span class="line">wela = <span class="number">0</span>;<span class="comment">//å…³é—­U2é”å­˜ç«¯ï¼ˆQ0ï¼‰</span></span><br><span class="line"></span><br><span class="line">duan = <span class="number">1</span>;<span class="comment">//æ‰“å¼€U1é”å­˜å™¨</span></span><br><span class="line">P0 = <span class="number">0x7F</span>;<span class="comment">//é€å…¥æ®µé€‰ä¿¡å·01111111</span></span><br><span class="line">duan = <span class="number">0</span>;<span class="comment">//å…³é—­U1é”å­˜å™¨ï¼ˆQ0ï¼‰</span></span><br><span class="line"><span class="keyword">while</span>(<span class="number">1</span>);<span class="comment">//ç¨‹åºåœåœ¨è¿™é‡Œ</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*************è¡¥å……***************************</span></span><br><span class="line"><span class="comment">6ä¸ªæ•°ç ç®¡åŒæ—¶ç‚¹äº®ï¼Œä¾æ¬¡æ˜¾ç¤º0~Fï¼Œæ—¶é—´é—´éš”ä¸º0.5sï¼Œå¾ªç¯ä¸‹å»</span></span><br><span class="line"><span class="comment">void main()</span></span><br><span class="line"><span class="comment">&#123;</span></span><br><span class="line"><span class="comment">wela = 1;//æ‰“å¼€U2é”å­˜å™¨</span></span><br><span class="line"><span class="comment">P0 = 0xc0;//é€å…¥ä½é€‰ä¿¡å·11000000</span></span><br><span class="line"><span class="comment">wela = 0;//å…³é—­U2é”å­˜ç«¯ï¼ˆQ0ï¼‰</span></span><br><span class="line"><span class="comment">while(1)</span></span><br><span class="line"><span class="comment">&#123;</span></span><br><span class="line"><span class="comment">for(num=0;num&lt;16;num++)</span></span><br><span class="line"><span class="comment">&#123;</span></span><br><span class="line"><span class="comment">duan = 1;//æ‰“å¼€U1é”å­˜å™¨</span></span><br><span class="line"><span class="comment">P0 = table[num];//é€å…¥æ®µé€‰ä¿¡å·</span></span><br><span class="line"><span class="comment">duan = 0;//å…³é—­U1é”å­˜ç«¯</span></span><br><span class="line"><span class="comment">delayms(500);//å»¶æ—¶0.5ç§’</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">&#125;*/</span></span><br></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/********************************************</span></span><br><span class="line"><span class="comment">8ã€æ•°ç ç®¡åŠ¨æ€æ˜¾ç¤ºï¼ˆé€æ¸ç¼©çŸ­å»¶æ—¶æ—¶é•¿ï¼Œåˆ™åŒæ—¶æ˜¾ç¤ºï¼‰ï¼ˆå®é™…ä¸Šæ˜¯è½®æµæ˜¾ç¤ºçš„ï¼‰</span></span><br><span class="line"><span class="comment">*********************************************/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">while</span>(<span class="number">1</span>)</span><br><span class="line">&#123;</span><br><span class="line">duan = <span class="number">1</span>;</span><br><span class="line">P0 = table[<span class="number">1</span>];<span class="comment">//é€æ®µé€‰ä¿¡å·</span></span><br><span class="line">duan = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">P0 = <span class="number">0xff</span>;<span class="comment">//11111111é€ä½é€‰æ•°æ®å‰å…³é—­æ‰€æœ‰æ˜¾ç¤ºï¼Œé˜²æ­¢æ‰“å¼€ä½é€‰é”å­˜æ—¶(æ¶ˆå½±ï¼‰</span></span><br><span class="line"><span class="comment">//åŸæ¥æ®µé€‰æ•°æ®é€šè¿‡ä½é€‰é”å­˜å™¨é€ æˆæ··ä¹±</span></span><br><span class="line">wela = <span class="number">1</span>;<span class="comment">//11111110é€ä½é€‰æ•°æ®</span></span><br><span class="line">P0 = <span class="number">0xfe</span>;</span><br><span class="line">wela = <span class="number">0</span>;</span><br><span class="line">delayms(<span class="number">500</span>);</span><br><span class="line"></span><br><span class="line">duan = <span class="number">1</span>;</span><br><span class="line">P0 = table[<span class="number">2</span>];</span><br><span class="line">duan = <span class="number">0</span>;</span><br><span class="line">P0 = <span class="number">0xff</span>;</span><br><span class="line">wela = <span class="number">1</span>;</span><br><span class="line">P0 = <span class="number">0xfd</span>;<span class="comment">//11111101é€ä½é€‰æ•°æ®</span></span><br><span class="line">wela = <span class="number">0</span>;</span><br><span class="line">delayms(<span class="number">500</span>);</span><br><span class="line"></span><br><span class="line">duan = <span class="number">1</span>;</span><br><span class="line">P0 = table[<span class="number">3</span>];</span><br><span class="line">duan = <span class="number">0</span>;</span><br><span class="line">P0 = <span class="number">0xff</span>;</span><br><span class="line">wela = <span class="number">1</span>;</span><br><span class="line">P0 = <span class="number">0xfb</span>;<span class="comment">//11111011é€ä½é€‰æ•°æ®</span></span><br><span class="line">wela = <span class="number">0</span>;</span><br><span class="line">delayms(<span class="number">500</span>);</span><br><span class="line"></span><br><span class="line">duan = <span class="number">1</span>;</span><br><span class="line">P0 = table[<span class="number">4</span>];</span><br><span class="line">duan = <span class="number">0</span>;</span><br><span class="line">P0 = <span class="number">0xff</span>;</span><br><span class="line">wela = <span class="number">1</span>;</span><br><span class="line">P0 = <span class="number">0xff</span>;<span class="comment">//11110111é€ä½é€‰æ•°æ®</span></span><br><span class="line">wela = <span class="number">0</span>;</span><br><span class="line">delayms(<span class="number">500</span>);</span><br><span class="line"></span><br><span class="line">duan = <span class="number">1</span>;</span><br><span class="line">P0 = table[<span class="number">5</span>];</span><br><span class="line">duan = <span class="number">0</span>;</span><br><span class="line">P0 = <span class="number">0xff</span>;</span><br><span class="line">wela = <span class="number">1</span>;</span><br><span class="line">P0 = <span class="number">0xef</span>;<span class="comment">//11101111é€ä½é€‰æ•°æ®</span></span><br><span class="line">wela = <span class="number">0</span>;</span><br><span class="line">delayms(<span class="number">500</span>);</span><br><span class="line"></span><br><span class="line">duan = <span class="number">1</span>;</span><br><span class="line">P0 = table[<span class="number">6</span>];</span><br><span class="line">duan = <span class="number">0</span>;</span><br><span class="line">P0 = <span class="number">0xff</span>;</span><br><span class="line">wela = <span class="number">1</span>;</span><br><span class="line">P0 = <span class="number">0xdf</span>;<span class="comment">//11011111é€ä½é€‰æ•°æ®</span></span><br><span class="line">wela = <span class="number">0</span>;</span><br><span class="line">delayms(<span class="number">500</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**************************************************</span></span><br><span class="line"><span class="comment">*å®éªŒåï¼šæ•°ç ç®¡åŠ¨æ€æ˜¾ç¤ºï¼ˆé€æ¸ç¼©çŸ­å»¶æ—¶æ—¶é•¿ï¼Œåˆ™åŒæ—¶æ˜¾ç¤ºï¼‰ï¼ˆå®é™…ä¸Šæ˜¯è½®æµæ˜¾ç¤ºçš„ï¼‰</span></span><br><span class="line"><span class="comment">***************************************************/</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;reg52.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> duan P0</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> uchar unsigned char </span></span><br><span class="line">sbit wei1 = P2^<span class="number">4</span>;<span class="comment">//å®šä¹‰ç¬¬ä¸€ä½æ•°ç ç®¡</span></span><br><span class="line">sbit wei2 = P2^<span class="number">5</span>;<span class="comment">//å®šä¹‰ç¬¬äºŒä½æ•°ç ç®¡</span></span><br><span class="line">sbit wei3 = P2^<span class="number">6</span>;<span class="comment">//å®šä¹‰ç¬¬ä¸‰ä½æ•°ç ç®¡</span></span><br><span class="line">sbit wei4 = P2^<span class="number">7</span>;<span class="comment">//å®šä¹‰ç¬¬å››ä½æ•°ç ç®¡</span></span><br><span class="line"></span><br><span class="line">uchar code sz[]=&#123;<span class="number">0x3f</span> , <span class="number">0x06</span> , <span class="number">0x5b</span> ,<span class="number">0x4f</span> , <span class="number">0x66</span> , <span class="number">0x6d</span> ,<span class="number">0x7d</span> ,</span><br><span class="line"><span class="number">0x07</span> , <span class="number">0x7f</span> , <span class="number">0x6f</span> ,<span class="number">0x77</span> , <span class="number">0x7c</span> , <span class="number">0x39</span> , <span class="number">0x5e</span> , <span class="number">0x79</span> , <span class="number">0x71</span> , <span class="number">0x00</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">delay</span><span class="params">(<span class="type">unsigned</span> <span class="type">int</span> xms)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="type">unsigned</span> <span class="type">int</span> i,j;</span><br><span class="line"><span class="keyword">for</span>(i=xms;i&gt;<span class="number">0</span>;i--)      <span class="comment">//i=xmså³å»¶æ—¶çº¦xmsæ¯«ç§’</span></span><br><span class="line"><span class="keyword">for</span>(j=<span class="number">112</span>;j&gt;<span class="number">0</span>;j--);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">   <span class="keyword">while</span>(<span class="number">1</span>)</span><br><span class="line">   &#123;</span><br><span class="line">   duan = sz[<span class="number">4</span>];</span><br><span class="line">wei1 = <span class="number">0</span>;</span><br><span class="line">wei2 = <span class="number">0</span>;</span><br><span class="line">wei3 = <span class="number">0</span>;</span><br><span class="line">wei4 = <span class="number">1</span>;</span><br><span class="line">delay(<span class="number">1000</span>);</span><br><span class="line">duan = sz[<span class="number">3</span>];</span><br><span class="line">wei1 = <span class="number">0</span>;</span><br><span class="line">wei2 = <span class="number">0</span>;</span><br><span class="line">wei3 = <span class="number">1</span>;</span><br><span class="line">wei4 = <span class="number">0</span>;</span><br><span class="line">delay(<span class="number">1000</span>);</span><br><span class="line">duan = sz[<span class="number">2</span>];</span><br><span class="line">wei1 = <span class="number">0</span>;</span><br><span class="line">wei2 = <span class="number">1</span>;</span><br><span class="line">wei3 = <span class="number">0</span>;</span><br><span class="line">wei4 = <span class="number">0</span>;</span><br><span class="line">delay(<span class="number">1000</span>);</span><br><span class="line">duan = sz[<span class="number">1</span>];</span><br><span class="line">wei1 = <span class="number">1</span>;</span><br><span class="line">wei2 = <span class="number">0</span>;</span><br><span class="line">wei3 = <span class="number">0</span>;</span><br><span class="line">wei4 = <span class="number">0</span>;</span><br><span class="line">delay(<span class="number">1000</span>);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="3ã€ä¸­æ–­"><a href="#3ã€ä¸­æ–­" class="headerlink" title="3ã€ä¸­æ–­"></a>3ã€ä¸­æ–­</h1><p><a href="https://imgtu.com/i/cGZAG6"><img src="https://z3.ax1x.com/2021/04/07/cGZAG6.png" class="lazyload placeholder" data-srcset="https://z3.ax1x.com/2021/04/07/cGZAG6.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="cGZAG6.png"></a></p><h2 id="1ã€ä¸­æ–­æº-ä¸­æ–­åµŒå¥—ï¼Œä¸­æ–­ä¼˜å…ˆçº§"><a href="#1ã€ä¸­æ–­æº-ä¸­æ–­åµŒå¥—ï¼Œä¸­æ–­ä¼˜å…ˆçº§" class="headerlink" title="1ã€ä¸­æ–­æº(ä¸­æ–­åµŒå¥—ï¼Œä¸­æ–­ä¼˜å…ˆçº§)"></a>1ã€ä¸­æ–­æº(ä¸­æ–­åµŒå¥—ï¼Œä¸­æ–­ä¼˜å…ˆçº§)</h2><p>â€‹51æœ‰5ä¸ªï¼Œ52æœ‰6ä¸ªï¼ˆå¤šä¸€ä¸ªT2å®šæ—¶å™¨&#x2F;è®¡æ•°å™¨2ï¼‰ï¼›</p><p>â€‹é»˜è®¤ä¼˜å…ˆçº§ï¼ˆç”±é«˜åˆ°ä½ï¼‰ï¼š</p><ol><li><strong>INT0</strong>â€”â€”å¤–éƒ¨ä¸­æ–­0ï¼ŒP3.2å£ï¼Œä½ç”µå¹³æˆ–ä¸‹é™æ²¿å¼•èµ·ï¼ˆåºå·ï¼š0ï¼›å…¥å£åœ°å€ï¼š0003Hï¼‰ï¼›</li><li><strong>INT1</strong>â€”â€”å¤–éƒ¨ä¸­æ–­1ï¼ŒP3.3å£ï¼Œä½ç”µå¹³æˆ–ä¸‹é™æ²¿å¼•èµ·ï¼ˆåºå·ï¼š1ï¼›å…¥å£åœ°å€ï¼š000BHï¼‰ï¼›</li><li><strong>T0</strong>â€”â€”å®šæ—¶å™¨&#x2F;è®¡æ•°å™¨0ä¸­æ–­ï¼Œç”±T0è®¡æ•°å™¨è®¡æ»¡å›é›¶å¼•èµ·ï¼ˆåºå·ï¼š2ï¼›å…¥å£åœ°å€ï¼š0013Hï¼‰ï¼›</li><li><strong>T1</strong>â€”â€”å®šæ—¶å™¨&#x2F;è®¡æ•°å™¨1ä¸­æ–­ï¼Œç”±T1è®¡æ•°å™¨è®¡æ»¡å›é›¶å¼•èµ·ï¼ˆåºå·ï¼š3ï¼›å…¥å£åœ°å€ï¼š001BHï¼‰ï¼›</li><li><strong>T2</strong>â€”â€”å®šæ—¶å™¨&#x2F;è®¡æ•°å™¨2ä¸­æ–­ï¼Œç”±T2è®¡æ•°å™¨è®¡æ»¡å›é›¶å¼•èµ·ï¼ˆåºå·ï¼š4ï¼›å…¥å£åœ°å€ï¼š0023Hï¼‰ï¼›</li><li><strong>TI&#x2F;IR</strong>â€”â€”ä¸²è¡Œå£ä¸­æ–­ï¼Œä¸²è¡Œç«¯å£å®Œæˆä¸€å¸§å­—ç¬¦å‘é€&#x2F;æ¥æ”¶åå¼•èµ·ï¼ˆåºå·ï¼š5ï¼›å…¥å£åœ°å€ï¼š002BHï¼‰ï¼›</li></ol><h2 id="2ã€ä¸­æ–­å…è®¸å¯„å­˜å™¨IEï¼š"><a href="#2ã€ä¸­æ–­å…è®¸å¯„å­˜å™¨IEï¼š" class="headerlink" title="2ã€ä¸­æ–­å…è®¸å¯„å­˜å™¨IEï¼š"></a>2ã€ä¸­æ–­å…è®¸å¯„å­˜å™¨IEï¼š</h2><p>â€‹è®¾å®šå„ä¸ªä¸­æ–­æºçš„æ‰“å¼€å’Œå…³é—­ï¼Œæ˜¯ç‰¹æ®ŠåŠŸèƒ½å¯„å­˜å™¨ï¼Œå­—èŠ‚åœ°å€ï¼šA8Hï¼Œä½åœ°å€ï¼šA8H~AFHï¼Œå¯è¿›è¡Œä½å¯»å€ï¼ˆå³å¯å¯¹å¯„å­˜å™¨çš„æ¯ä¸€ä½è¿›è¡Œå•ç‹¬æ“ä½œï¼Œå¤ä½æ—¶ï¼ŒIEå…¨è¢«æ¸…é›¶ã€‚</p><p><a href="https://imgtu.com/i/cGnTS0"><img src="https://z3.ax1x.com/2021/04/07/cGnTS0.md.png" class="lazyload placeholder" data-srcset="https://z3.ax1x.com/2021/04/07/cGnTS0.md.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="cGnTS0.md.png"></a></p><p><strong>EA</strong>ï¼šå…¨å±€ä¸­æ–­å…è®¸ä½ï¼›</p><p>**â€“**ï¼šæ— æ•ˆä½ï¼›</p><p><strong>ET2</strong>ï¼šå®šæ—¶å™¨&#x2F;è®¡æ•°å™¨2ä¸­æ–­å…è®¸ä½ï¼ˆä¸º1æ—¶æ‰“å¼€ï¼Œä¸º0æ—¶å…³é—­ï¼‰ï¼›</p><p><strong>ES</strong>:ä¸²è¡Œå£ä¸­æ–­å…è®¸ä½ï¼›</p><p><strong>ET1</strong>ï¼šå®šæ—¶å™¨&#x2F;è®¡æ•°å™¨1ä¸­æ–­å…è®¸ä½ï¼›</p><p><strong>EX1</strong>ï¼šå¤–éƒ¨ä¸­æ–­1ä¸­æ–­å…è®¸ä½ï¼›</p><p><strong>ET0</strong>ï¼šå®šæ—¶å™¨&#x2F;è®¡æ•°å™¨0ä¸­æ–­å…è®¸ä½ï¼›</p><p><strong>EX0</strong>ï¼šå¤–éƒ¨ä¸­æ–­0ä¸­æ–­å…è®¸ä½ã€‚</p><h2 id="3ã€ä¸­æ–­ä¼˜å…ˆçº§å¯„å­˜å™¨IPï¼š"><a href="#3ã€ä¸­æ–­ä¼˜å…ˆçº§å¯„å­˜å™¨IPï¼š" class="headerlink" title="3ã€ä¸­æ–­ä¼˜å…ˆçº§å¯„å­˜å™¨IPï¼š"></a>3ã€ä¸­æ–­ä¼˜å…ˆçº§å¯„å­˜å™¨IPï¼š</h2><p>ç‰¹æ®ŠåŠŸèƒ½å¯„å­˜å™¨ï¼ŒB8H~BFHã€‚å¯ä½å¯»å€ï¼Œå¤ä½æ—¶ï¼Œå…¨æ¸…é›¶</p><p><a href="https://imgtu.com/i/cGug91"><img src="https://z3.ax1x.com/2021/04/07/cGug91.md.png" class="lazyload placeholder" data-srcset="https://z3.ax1x.com/2021/04/07/cGug91.md.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="cGug91.md.png"></a></p><p>**â€“**ï¼šæ— æ•ˆä½ï¼›</p><p><strong>PS</strong>ï¼šä¸²è¡Œå£ä¸­æ–­ä¼˜å…ˆçº§æ§åˆ¶ä½ï¼ˆä¸º1å®šä¹‰ä¸ºé«˜ä¼˜å…ˆçº§ä¸­æ–­ï¼‰ï¼›</p><p><strong>PT1</strong>ï¼šå®šæ—¶å™¨&#x2F;è®¡æ•°å™¨1ä¸­æ–­ä¼˜å…ˆçº§æ§åˆ¶ä½ï¼›</p><p><strong>PX1</strong>ï¼šå¤–éƒ¨ä¸­æ–­1ä¸­æ–­ä¼˜å…ˆçº§æ§åˆ¶ä½ï¼›</p><p><strong>PT0</strong>ï¼šå®šæ—¶å™¨&#x2F;è®¡æ•°å™¨0ä¸­æ–­ä¼˜å…ˆçº§æ§åˆ¶ä½ï¼›</p><p><strong>PX0</strong>ï¼šå¤–éƒ¨ä¸­æ–­0ä¸­æ–­ä¼˜å…ˆçº§æ§åˆ¶ä½ï¼›</p><p>æŒ‰ä¼˜å…ˆçº§å¯å½¢æˆä¸­æ–­åµŒå¥—ã€‚</p><h2 id="4ã€å•ç‰‡æœºçš„å®šæ—¶å™¨ä¸­æ–­"><a href="#4ã€å•ç‰‡æœºçš„å®šæ—¶å™¨ä¸­æ–­" class="headerlink" title="4ã€å•ç‰‡æœºçš„å®šæ—¶å™¨ä¸­æ–­"></a>4ã€å•ç‰‡æœºçš„å®šæ—¶å™¨ä¸­æ–­</h2><p>â€‹å®šæ—¶å™¨&#x2F;è®¡æ•°å™¨å®è´¨æ˜¯åŠ 1è®¡æ•°å™¨ï¼ˆ16ä½ï¼‰ï¼Œç”±é«˜8ä½å’Œä½8ä½ä¸¤ä¸ªå¯„å­˜å™¨ç»„æˆï¼šTMOD(å®šæ—¶å™¨&#x2F;è®¡æ•°å™¨å·¥ä½œæ–¹å¼å¯„å­˜å™¨)</p><p>TCONï¼ˆæ§åˆ¶å¯„å­˜å™¨ï¼Œæ§åˆ¶T0ã€T1çš„å¯åŠ¨åœæ­¢åŠè®¾ç½®æº¢å‡ºæ ‡å¿—ï¼‰</p><p><a href="https://imgtu.com/i/cGMmsf"><img src="https://z3.ax1x.com/2021/04/07/cGMmsf.md.png" class="lazyload placeholder" data-srcset="https://z3.ax1x.com/2021/04/07/cGMmsf.md.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="cGMmsf.md.png"></a></p><p>åŠ 1è®¡æ•°å™¨è¾“å…¥è®¡æ•°è„‰å†²ä¸¤ä¸ªæ¥æºï¼›ç”±ç³»ç»Ÿçš„æ—¶é’ŸæŒ¯è¡å™¨è¾“å‡ºè„‰å†²ç»12åˆ†é¢‘åé€æ¥ï¼›T0æˆ–T1å¼•è„šè¾“å…¥çš„å¤–éƒ¨è„‰å†²æºï¼Œæ¯æ¥ä¸€ä¸ªè„‰å†²è®¡æ•°å™¨åŠ 1ï¼ŒåŠ åˆ°å…¨1æ—¶ï¼Œåœ¨è¾“å…¥ä¸€ä¸ªè„‰å†²ï¼Œè®¡æ•°å™¨å›é›¶ï¼Œä¸”è®¡æ•°å™¨çš„æº¢å‡ºä½¿TCONå¯„å­˜å™¨ä¸­TF0æˆ–TF1ç½®1ï¼Œå‘CPUå‘é€ä¸­æ–­è¯·æ±‚ï¼ˆå®šæ—¶å™¨&#x2F;è®¡æ•°å™¨ä¸­æ–­å…è®¸æ—¶ï¼‰</p><h2 id="5ã€å®šæ—¶å™¨-è®¡æ•°å™¨å·¥ä½œæ–¹å¼å¯„å­˜å™¨TMOD"><a href="#5ã€å®šæ—¶å™¨-è®¡æ•°å™¨å·¥ä½œæ–¹å¼å¯„å­˜å™¨TMOD" class="headerlink" title="5ã€å®šæ—¶å™¨&#x2F;è®¡æ•°å™¨å·¥ä½œæ–¹å¼å¯„å­˜å™¨TMOD"></a>5ã€å®šæ—¶å™¨&#x2F;è®¡æ•°å™¨å·¥ä½œæ–¹å¼å¯„å­˜å™¨TMOD</h2><p>â€‹å­—èŠ‚åœ°å€ï¼š89Hï¼Œä¸èƒ½ä½å¯»å€ï¼Œç”¨æ¥ç¡®å®šå®šæ—¶å™¨çš„å·¥ä½œæ–¹å¼åŠåŠŸèƒ½é€‰æ‹©ï¼Œå¤ä½æ—¶å…¨æ¸…é›¶</p><p><a href="https://imgtu.com/i/cUZZHU"><img src="https://z3.ax1x.com/2021/04/09/cUZZHU.md.png" class="lazyload placeholder" data-srcset="https://z3.ax1x.com/2021/04/09/cUZZHU.md.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="cUZZHU.md.png"></a></p><p>TMODé«˜å››ä½è®¾ç½®å®šæ—¶å™¨1ï¼Œä½å››ä½ç”¨äºè®¾ç½®å®šæ—¶å™¨0ï¼›</p><p><strong>GATE</strong>:é—¨æ§åˆ¶ä½</p><p>GATE&#x3D;0,å®šæ—¶å™¨&#x2F;è®¡æ•°å™¨å¯åŠ¨ä¸åœæ­¢ä»…å—TCONå¯„å­˜å™¨ä¸­çš„TRXï¼ˆX&#x3D;0,1)æ¥æ§åˆ¶ï¼›</p><p>GATE&#x3D;1ï¼Œå®šæ—¶å™¨&#x2F;è®¡æ•°å™¨å¯åŠ¨ä¸åœæ­¢ç”±TCONå¯„å­˜å™¨ä¸­TRXå’Œå¤–éƒ¨ä¸­æ–­å¼•è„šï¼ˆINT0æˆ–INT1ï¼‰ä¸Šçš„ç”µå¹³çŠ¶æ€æ¥å…±åŒæ§åˆ¶ã€‚</p><p><strong>C&#x2F;T</strong>:å®šæ—¶å™¨æ¨¡å¼ï¼ˆ&#x3D;0ï¼‰å’Œè®¡æ•°å™¨æ¨¡å¼ï¼ˆ&#x3D;1ï¼‰é€‰æ‹©ä½ï¼›</p><p><strong>M1M0</strong>:å·¥ä½œæ–¹å¼é€‰æ‹©ä½</p><p>ï¼ˆæ¯ä¸ªå®šæ—¶å™¨&#x2F;è®¡æ•°å™¨éƒ½æœ‰4ç§å·¥ä½œæ–¹å¼ï¼‰</p><p><a href="https://imgtu.com/i/cUeNLV"><img src="https://z3.ax1x.com/2021/04/09/cUeNLV.md.png" class="lazyload placeholder" data-srcset="https://z3.ax1x.com/2021/04/09/cUeNLV.md.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="cUeNLV.md.png"></a></p><h2 id="6ã€å®šæ—¶å™¨-è®¡æ•°å™¨æ§åˆ¶å¯„å­˜å™¨TCON"><a href="#6ã€å®šæ—¶å™¨-è®¡æ•°å™¨æ§åˆ¶å¯„å­˜å™¨TCON" class="headerlink" title="6ã€å®šæ—¶å™¨&#x2F;è®¡æ•°å™¨æ§åˆ¶å¯„å­˜å™¨TCON"></a>6ã€å®šæ—¶å™¨&#x2F;è®¡æ•°å™¨æ§åˆ¶å¯„å­˜å™¨TCON</h2><p>â€‹å­—èŠ‚åœ°å€ï¼š88H~8FHï¼Œå¯ä½å¯»å€ï¼ŒTCONå¯„å­˜å™¨ç”¨æ¥æ§åˆ¶å®šæ—¶å™¨çš„å¯ã€åœï¼Œæ ‡å¿—å®šæ—¶å™¨æº¢å‡ºå’Œä¸­æ–­æƒ…å†µã€‚å¤ä½æ—¶å…¨æ¸…é›¶ã€‚</p><p><a href="https://imgtu.com/i/cUmK61"><img src="https://z3.ax1x.com/2021/04/09/cUmK61.md.png" class="lazyload placeholder" data-srcset="https://z3.ax1x.com/2021/04/09/cUmK61.md.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="cUmK61.md.png"></a></p><p>TF1ã€TR1ã€TF0å’ŒTR0ä½ç”¨äºå®šæ—¶å™¨&#x2F;è®¡æ•°å™¨ï¼›IE1ã€IT1ã€IE0å’ŒIT0ä½ç”¨äºå¤–éƒ¨ä¸­æ–­ã€‚</p><p><strong>TF1</strong>:å®šæ—¶å™¨1æº¢å‡ºæ ‡å¿—ï¼ˆå½“å®šæ—¶å™¨1æº¢å‡ºæ—¶ï¼Œç”±ç¡¬ä»¶ä½¿TF1ç½®1ï¼Œå¹¶ä¸”ç”³è¯·ä¸­æ–­ã€‚è¿›å…¥ä¸­æ–­æœåŠ¡ç¨‹åºåï¼Œç”±ç¡¬ä»¶è‡ªåŠ¨æ¸…0ã€‚ï¼‰ï¼ˆå¦‚æœä½¿ç”¨å®šæ—¶å™¨çš„ä¸­æ–­ï¼Œåˆ™è¯¥ä½å®Œå…¨ä¸ç”¨äººä¸ºå»æ“ä½œï¼Œä½†æ˜¯å¦‚æœç”¨è½¯ä»¶æŸ¥è¯¢æ–¹å¼ï¼Œå½“æŸ¥è¯¢åˆ°è¯¥ä½ç½®1åï¼Œå°±éœ€è¦ç”¨è½¯ä»¶æ¸…0ã€‚ï¼‰</p><p><strong>TR1</strong>:å®šæ—¶å™¨1è¿è¡Œæ§åˆ¶ä½ã€‚ï¼ˆç”±è½¯ä»¶æ¸…0å…³é—­å®šæ—¶å™¨1.å½“GATE&#x3D;1ï¼Œä¸”INT1ä¸ºé«˜ç”µå¹³æ—¶ï¼ŒTR1ç½®1å¯åŠ¨å®šæ—¶å™¨1ï¼›å½“GATE&#x3D;0 æ—¶ï¼ŒTR1ç½®1å¯åŠ¨å®šæ—¶å™¨1ã€‚</p><p><strong>TF0</strong>:å®šæ—¶å™¨0æº¢å‡ºæ ‡å¿—ï¼ŒåŠŸèƒ½åŠæ“ä½œæ–¹æ³•åŒTF1ã€‚</p><p><strong>TR0</strong>ï¼šå®šæ—¶å™¨0è¿è¡Œæ§åˆ¶ä½ï¼ŒåŒTR1ã€‚</p><p><strong>IE1</strong>ï¼šå¤–éƒ¨ä¸­æ–­1è¯·æ±‚æ ‡å¿—ã€‚</p><p>ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚</p><p>**è®¡ç®—å®šæ—¶å™¨çš„åˆå€¼é—®é¢˜ **</p><p>é»˜è®¤<strong>TH0</strong>å’Œ<strong>TL0</strong>ä¸º0ï¼Œå½“ç”¨å®šæ—¶å™¨çš„æ–¹å¼1æ—¶ï¼Œæœºå™¨å‘¨æœŸä¸º<strong>Tcy</strong>ï¼ˆä¸€ä¸ªæœºå™¨å‘¨æœŸä¸º12ä¸ªæ—¶é’Ÿå‘¨æœŸï¼‰ï¼Œå®šæ—¶å™¨äº§ç”Ÿä¸€æ¬¡ä¸­æ–­çš„æ—¶é—´ä¸ºtï¼Œåˆ™éœ€è®¡æ•°çš„ä¸ªæ•°<strong>N&#x3D;t&#x2F;Tcy</strong>ï¼Œè£…å…¥THXå’ŒTLXä¸­çš„æ•°åˆ†åˆ«ä¸º;</p><p>â€‹THX &#x3D; ï¼ˆ65536-Nï¼‰&#x2F;256TLX &#x3D; ï¼ˆ65536-Nï¼‰%256</p><h2 id="7ã€ç¤ºä¾‹"><a href="#7ã€ç¤ºä¾‹" class="headerlink" title="7ã€ç¤ºä¾‹"></a>7ã€ç¤ºä¾‹</h2><p>è¡¥å……ï¼šä¸­æ–­æœåŠ¡ç¨‹åºçš„å†™æ³•ï¼ˆC51ï¼‰</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">å½¢å¼ï¼š</span><br><span class="line">void å‡½æ•°å () interrupt ä¸­æ–­å· using å·¥ä½œç»„</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">ä¸­æ–­æœåŠ¡ç¨‹åºå†…å®¹</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">è¯´æ˜ï¼šä¸­æ–­å·ï¼šä¸­æ–­æºçš„åºå·</span><br><span class="line"> using å·¥ä½œç»„ï¼šæŒ‡è¿™ä¸ªä¸­æ–­å‡½æ•°ä½¿ç”¨å•ç‰‡æœºå†…å­˜ä¸­4ç»„å·¥ä½œå¯„å­˜å™¨ä¸­çš„å“ªä¸€ç»„ï¼Œä¸€èˆ¬ä¸å†™ï¼Œä¼šè‡ªåŠ¨åˆ†é…ã€‚</span><br></pre></td></tr></table></figure><p>â€‹</p><p>å†™å•ç‰‡æœºçš„å®šæ—¶å™¨ç¨‹åºæ—¶ï¼Œå†å¼€å§‹å¤„éœ€å¯¹å®šæ—¶å™¨åŠä¸­æ–­å¯„å­˜å™¨åšåˆå§‹åŒ–é…ç½®ï¼š</p><p>1ã€å¯¹TMODèµ‹å€¼ï¼Œç¡®å®šT0å’ŒT1çš„å·¥ä½œæ–¹å¼ï¼›</p><p>2ã€è®¡ç®—åˆå€¼ï¼Œå¹¶å°†åˆå€¼å†™å…¥TH0ã€TL0æˆ–TH1ã€TL1;</p><p>3ã€ä¸­æ–­æ–¹å¼æ—¶ï¼Œåˆ™å¯¹IEèµ‹å€¼ï¼Œå¼€æ”¾ä¸­æ–­ï¼›</p><p>4ã€ä½¿TR0æˆ–TR1ç½®ä½ï¼Œå¯åŠ¨å®šæ—¶å™¨&#x2F;è®¡æ•°å™¨å®šæ—¶æˆ–è®¡æ•°ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/************************************************************</span></span><br><span class="line"><span class="comment">9ã€åˆ©ç”¨å®šæ—¶å™¨0å·¥ä½œæ–¹å¼1ï¼ŒLED 1Sé—ªçƒ</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;reg52.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> uchar unsigned char</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> uint unsigned int </span></span><br><span class="line">sbit led1 = P1^<span class="number">0</span>;</span><br><span class="line">uchar num;</span><br><span class="line"><span class="type">void</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">//å®šæ—¶å™¨åˆå§‹åŒ–</span></span><br><span class="line">TMOD = <span class="number">0x01</span>;<span class="comment">//è®¾ç½®å®šæ—¶å™¨0ä¸ºå·¥ä½œæ–¹å¼1ï¼ˆM1M0ä¸º01ï¼‰</span></span><br><span class="line">TH0 = (<span class="number">65536</span><span class="number">-45872</span>)/<span class="number">256</span>;<span class="comment">//è£…åˆå€¼11.0592Mæ™¶æŒ¯å®šæ—¶50msæ•°ä¸º45872</span></span><br><span class="line">TL0 = (<span class="number">65536</span><span class="number">-45872</span>)%<span class="number">256</span>;</span><br><span class="line">EA = <span class="number">1</span>;<span class="comment">//å¼€æ€»ä¸­æ–­</span></span><br><span class="line">ET0 = <span class="number">1</span>;<span class="comment">//å¼€å®šæ—¶å™¨0ä¸­æ–­</span></span><br><span class="line">TR0 = <span class="number">1</span>;<span class="comment">//å¯åŠ¨å®šæ—¶å™¨0</span></span><br><span class="line"><span class="keyword">while</span>(<span class="number">1</span>);<span class="comment">//ç¨‹åºåœæ­¢åœ¨è¿™é‡Œç­‰å¾…ä¸­æ–­å‘ç”Ÿ</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="type">void</span> <span class="title function_">T0_time</span><span class="params">()</span>interrupt 1<span class="comment">//ä¸­æ–­æœåŠ¡ç¨‹åº</span></span><br><span class="line">&#123;</span><br><span class="line">TH0 = (<span class="number">65536</span><span class="number">-45872</span>)/<span class="number">256</span>;<span class="comment">//é‡è£…åˆå€¼</span></span><br><span class="line">TL0 = (<span class="number">65536</span><span class="number">-45872</span>)%<span class="number">256</span>;</span><br><span class="line">num++;<span class="comment">//numæ¯åŠ 1æ¬¡åˆ¤æ–­ä¸€æ¬¡æ˜¯å¦åˆ°20æ¬¡</span></span><br><span class="line"><span class="keyword">if</span>(num==<span class="number">20</span>)<span class="comment">//å¦‚æœåˆ°äº†20æ¬¡ï¼Œè¯´æ˜1ç§’æ—¶é—´åˆ°</span></span><br><span class="line">&#123;</span><br><span class="line">num = <span class="number">0</span>;<span class="comment">//ç„¶åæŠŠnumæ¸…0é‡æ–°å†è®¡20æ¬¡</span></span><br><span class="line">led1 = ~led1;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>èƒ½åœ¨ä¸»ç¨‹åºä¸­å®Œæˆçš„åŠŸèƒ½å°±ä¸åœ¨ä¸­æ–­å‡½æ•°ä¸­å†™ï¼Œä¸­æ–­å‡½æ•°ä¸­è¦é«˜æ•ˆç®€æ´ï¼š</p><p>ä¼˜åŒ–åï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/************************************************************</span></span><br><span class="line"><span class="comment">9ã€åˆ©ç”¨å®šæ—¶å™¨0å·¥ä½œæ–¹å¼1ï¼ŒLED 1Sé—ªçƒ</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;reg52.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> uchar unsigned char</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> uint unsigned int </span></span><br><span class="line">sbit led1 = P1^<span class="number">0</span>;</span><br><span class="line">uchar num;</span><br><span class="line"><span class="type">void</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">//å®šæ—¶å™¨åˆå§‹åŒ–</span></span><br><span class="line">TMOD = <span class="number">0x01</span>;<span class="comment">//è®¾ç½®å®šæ—¶å™¨0ä¸ºå·¥ä½œæ–¹å¼1ï¼ˆM1M0ä¸º01ï¼‰</span></span><br><span class="line">TH0 = (<span class="number">65536</span><span class="number">-45872</span>)/<span class="number">256</span>;<span class="comment">//è£…åˆå€¼11.0592Mæ™¶æŒ¯å®šæ—¶50msæ•°ä¸º45872</span></span><br><span class="line">TL0 = (<span class="number">65536</span><span class="number">-45872</span>)%<span class="number">256</span>;</span><br><span class="line">EA = <span class="number">1</span>;<span class="comment">//å¼€æ€»ä¸­æ–­</span></span><br><span class="line">ET0 = <span class="number">1</span>;<span class="comment">//å¼€å®šæ—¶å™¨0ä¸­æ–­</span></span><br><span class="line">TR0 = <span class="number">1</span>;<span class="comment">//å¯åŠ¨å®šæ—¶å™¨0</span></span><br><span class="line"><span class="keyword">while</span>(<span class="number">1</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span>(num==<span class="number">20</span>)<span class="comment">//å¦‚æœåˆ°äº†20æ¬¡ï¼Œè¯´æ˜1ç§’æ—¶é—´åˆ°</span></span><br><span class="line">&#123;</span><br><span class="line">num = <span class="number">0</span>;<span class="comment">//ç„¶åæŠŠnumæ¸…0é‡æ–°å†è®¡20æ¬¡</span></span><br><span class="line">led1 = ~led1;</span><br><span class="line">&#125;</span><br><span class="line">&#125;<span class="comment">//ç¨‹åºåœæ­¢åœ¨è¿™é‡Œç­‰å¾…ä¸­æ–­å‘ç”Ÿ</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="type">void</span> <span class="title function_">T0_time</span><span class="params">()</span>interrupt 1<span class="comment">//ä¸­æ–­æœåŠ¡ç¨‹åº</span></span><br><span class="line">&#123;</span><br><span class="line">TH0 = (<span class="number">65536</span><span class="number">-45872</span>)/<span class="number">256</span>;<span class="comment">//é‡è£…åˆå€¼</span></span><br><span class="line">TL0 = (<span class="number">65536</span><span class="number">-45872</span>)%<span class="number">256</span>;</span><br><span class="line">num++;<span class="comment">//numæ¯åŠ 1æ¬¡åˆ¤æ–­ä¸€æ¬¡æ˜¯å¦åˆ°20æ¬¡</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*********************************************************</span></span><br><span class="line"><span class="comment">10ã€ä¸­æ–­ï¼ˆTX-1Cï¼‰å®šæ—¶å™¨0çš„æ–¹å¼1å®ç°ç¬¬ä¸€ä¸ªå‘å…‰ç®¡ä»¥200msé—´éš”é—ªçƒ</span></span><br><span class="line"><span class="comment">ç”¨å®šæ—¶å™¨1çš„æ–¹å¼1å®ç°æ•°ç ç®¡å‰ä¸¤ä½59så¾ªç¯è®¡æ—¶</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;reg52.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> uchar unsigned char</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> uint unsigned int </span></span><br><span class="line">sbit dula = P2^<span class="number">6</span>;</span><br><span class="line">sbit wela = P2^<span class="number">7</span>;</span><br><span class="line">sbit led1 = P1^<span class="number">0</span>;</span><br><span class="line">uchar code table[]=&#123;</span><br><span class="line"><span class="number">0x3f</span> , <span class="number">0x06</span> , <span class="number">0x5b</span> , <span class="number">0x4f</span> ,</span><br><span class="line"><span class="number">0x66</span> , <span class="number">0x6d</span> ,<span class="number">0x7d</span> , <span class="number">0x07</span> , </span><br><span class="line"><span class="number">0x7f</span> , <span class="number">0x6f</span> , <span class="number">0x77</span> , <span class="number">0x7c</span> ,</span><br><span class="line"><span class="number">0x39</span> , <span class="number">0x5e</span> , <span class="number">0x79</span> , <span class="number">0x71</span> &#125;;</span><br><span class="line"><span class="type">void</span> <span class="title function_">delayms</span><span class="params">(uint)</span>;</span><br><span class="line"><span class="type">void</span> <span class="title function_">display</span><span class="params">(uchar,uchar)</span>;</span><br><span class="line">uchar num,num1,num2,shi,ge;</span><br><span class="line"><span class="type">void</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">TMOD = <span class="number">0x11</span>;<span class="comment">//è®¾ç½®å®šæ—¶å™¨0å’Œ1ä¸ºå·¥ä½œæ–¹å¼1ï¼ˆ0001 0001ï¼‰</span></span><br><span class="line">TH0 = (<span class="number">65535</span><span class="number">-45872</span>)/<span class="number">256</span>;<span class="comment">//è£…åˆå€¼</span></span><br><span class="line">TL0 = (<span class="number">65536</span><span class="number">-45872</span>)%<span class="number">256</span>;</span><br><span class="line">TH1 = (<span class="number">65536</span><span class="number">-45872</span>)/<span class="number">256</span>;<span class="comment">//è£…åˆå€¼</span></span><br><span class="line">TL1 = (<span class="number">65536</span><span class="number">-45872</span>)%<span class="number">256</span>;</span><br><span class="line">EA = <span class="number">1</span>;<span class="comment">//å¼€æ€»ä¸­æ–­</span></span><br><span class="line">ET0 = <span class="number">1</span>;<span class="comment">//å¼€å®šæ—¶å™¨0ä¸­æ–­</span></span><br><span class="line">ET1 = <span class="number">1</span>;<span class="comment">//å¼€å®šæ—¶å™¨1ä¸­æ–­</span></span><br><span class="line">TR0 =<span class="number">1</span>;<span class="comment">//å¯åŠ¨å®šæ—¶å™¨0</span></span><br><span class="line">TR1 = <span class="number">1</span>;<span class="comment">//å¯åŠ¨å®šæ—¶å™¨1</span></span><br><span class="line"><span class="keyword">while</span>(<span class="number">1</span>)</span><br><span class="line">&#123;</span><br><span class="line">display(shi,ge);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">void</span> <span class="title function_">display</span><span class="params">(uchar shi,uchar ge)</span><span class="comment">//æ˜¾ç¤ºå­å‡½æ•°</span></span><br><span class="line">&#123;</span><br><span class="line">dula = <span class="number">1</span>;</span><br><span class="line">P0 = table[shi];<span class="comment">//é€æ®µé€‰æ•°æ®</span></span><br><span class="line">dula = <span class="number">0</span>;</span><br><span class="line">P0 = <span class="number">0xff</span>;<span class="comment">//é€ä½é€‰æ•°æ®å‰å…³é—­æ‰€æœ‰æ˜¾ç¤ºï¼Œé˜²æ­¢æ‰“å¼€ä½é€‰é”å­˜æ—¶åŸæ¥çš„æ®µé€‰æ•°æ®é€šè¿‡ä½é€‰é”å­˜å™¨é€ æˆæ··ä¹±</span></span><br><span class="line">wela = <span class="number">1</span>;</span><br><span class="line">P0 = <span class="number">0xfe</span>;<span class="comment">//é€ä½é€‰æ•°æ®</span></span><br><span class="line">wela = <span class="number">0</span>;</span><br><span class="line">delayms(<span class="number">5</span>);</span><br><span class="line"></span><br><span class="line">dula = <span class="number">1</span>;</span><br><span class="line">P0 = table[ge];</span><br><span class="line">dula = <span class="number">0</span>;</span><br><span class="line">P0 =<span class="number">0xff</span>;</span><br><span class="line">wela = <span class="number">1</span>;</span><br><span class="line">P0 = <span class="number">0xfd</span>;</span><br><span class="line">wela = <span class="number">0</span>;</span><br><span class="line">delayms(<span class="number">5</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">delayms</span><span class="params">(uint xms)</span></span><br><span class="line">&#123;</span><br><span class="line">uint i,j;</span><br><span class="line"><span class="keyword">for</span>(i=xms;i&gt;<span class="number">0</span>;i--)</span><br><span class="line"><span class="keyword">for</span>(j=<span class="number">110</span>;j&gt;<span class="number">0</span>;j--);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">void</span> <span class="title function_">T0_time</span><span class="params">()</span> interrupt 1</span><br><span class="line">&#123;</span><br><span class="line">TH0=(<span class="number">65536</span><span class="number">-45872</span>)/<span class="number">256</span>;<span class="comment">//é‡è£…åˆå€¼</span></span><br><span class="line">TL0=(<span class="number">65536</span><span class="number">-45872</span>)%<span class="number">256</span>;</span><br><span class="line">num1++;</span><br><span class="line"><span class="keyword">if</span>(num1==<span class="number">4</span>)<span class="comment">//4æ¬¡ä¸­æ–­=200ms</span></span><br><span class="line">&#123;</span><br><span class="line">num1 = <span class="number">0</span>;<span class="comment">//æ¸…0</span></span><br><span class="line">led1 = ~led1;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">T1_time</span><span class="params">()</span> interrupt 3</span><br><span class="line">&#123;</span><br><span class="line">TH1=(<span class="number">65536</span><span class="number">-45872</span>)/<span class="number">256</span>;<span class="comment">//é‡è£…åˆå€¼</span></span><br><span class="line">TL1=(<span class="number">65536</span><span class="number">-45872</span>)%<span class="number">256</span>;</span><br><span class="line">num2++;</span><br><span class="line"><span class="keyword">if</span>(num2==<span class="number">20</span>)<span class="comment">//20æ¬¡ä¸­æ–­=1ç§’</span></span><br><span class="line">&#123;</span><br><span class="line">num2=<span class="number">0</span>;<span class="comment">//æ¸…0</span></span><br><span class="line">num++;</span><br><span class="line"><span class="keyword">if</span>(num==<span class="number">60</span>)<span class="comment">//è¯¥æ•°ç”¨æ¥é€æ•°ç ç®¡æ˜¾ç¤ºï¼Œåˆ°60åå½’0</span></span><br><span class="line">num=<span class="number">0</span>;</span><br><span class="line">shi=num/<span class="number">10</span>;<span class="comment">//æŠŠä¸€ä¸ª2ä½æ•°åˆ†ç¦»ååˆ†åˆ«é€æ•°ç ç®¡æ˜¾ç¤º</span></span><br><span class="line">ge=num%<span class="number">10</span>;<span class="comment">//åä½å’Œä¸ªä½</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*********************************************************</span></span><br><span class="line"><span class="comment">10ã€ä¸­æ–­ï¼ˆBST-M51ï¼‰å®šæ—¶å™¨0çš„æ–¹å¼1å®ç°ç¬¬ä¸€ä¸ªå‘å…‰ç®¡ä»¥200msé—´éš”é—ªçƒ</span></span><br><span class="line"><span class="comment">ç”¨å®šæ—¶å™¨1çš„æ–¹å¼1å®ç°æ•°ç ç®¡å‰ä¸¤ä½59så¾ªç¯è®¡æ—¶</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;reg52.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> uchar unsigned char</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> uint unsigned int </span></span><br><span class="line">sbit wei1 = P2^<span class="number">4</span>;<span class="comment">//å®šä¹‰ç¬¬ä¸€ä½æ•°ç ç®¡</span></span><br><span class="line">sbit wei2 = P2^<span class="number">5</span>;<span class="comment">//å®šä¹‰ç¬¬äºŒä½æ•°ç ç®¡</span></span><br><span class="line">sbit wei3 = P2^<span class="number">6</span>;<span class="comment">//å®šä¹‰ç¬¬ä¸‰ä½æ•°ç ç®¡</span></span><br><span class="line">sbit wei4 = P2^<span class="number">7</span>;<span class="comment">//å®šä¹‰ç¬¬å››ä½æ•°ç ç®¡</span></span><br><span class="line">sbit led1 = P1^<span class="number">0</span>;</span><br><span class="line">uchar code table[]=&#123;</span><br><span class="line"><span class="number">0x3f</span> , <span class="number">0x06</span> , <span class="number">0x5b</span> , <span class="number">0x4f</span> ,</span><br><span class="line"><span class="number">0x66</span> , <span class="number">0x6d</span> ,<span class="number">0x7d</span> , <span class="number">0x07</span> , </span><br><span class="line"><span class="number">0x7f</span> , <span class="number">0x6f</span> , <span class="number">0x77</span> , <span class="number">0x7c</span> ,</span><br><span class="line"><span class="number">0x39</span> , <span class="number">0x5e</span> , <span class="number">0x79</span> , <span class="number">0x71</span> &#125;;</span><br><span class="line"><span class="type">void</span> <span class="title function_">delayms</span><span class="params">(uint)</span>;</span><br><span class="line"><span class="type">void</span> <span class="title function_">display</span><span class="params">(uchar,uchar)</span>;</span><br><span class="line">uchar num,num1,num2,shi,ge;</span><br><span class="line"><span class="type">void</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">TMOD = <span class="number">0x11</span>;<span class="comment">//è®¾ç½®å®šæ—¶å™¨0å’Œ1ä¸ºå·¥ä½œæ–¹å¼1ï¼ˆ0001 0001ï¼‰</span></span><br><span class="line">TH0 = (<span class="number">65535</span><span class="number">-45872</span>)/<span class="number">256</span>;<span class="comment">//è£…åˆå€¼</span></span><br><span class="line">TL0 = (<span class="number">65536</span><span class="number">-45872</span>)%<span class="number">256</span>;</span><br><span class="line">TH1 = (<span class="number">65536</span><span class="number">-45872</span>)/<span class="number">256</span>;<span class="comment">//è£…åˆå€¼</span></span><br><span class="line">TL1 = (<span class="number">65536</span><span class="number">-45872</span>)%<span class="number">256</span>;</span><br><span class="line">EA = <span class="number">1</span>;<span class="comment">//å¼€æ€»ä¸­æ–­</span></span><br><span class="line">ET0 = <span class="number">1</span>;<span class="comment">//å¼€å®šæ—¶å™¨0ä¸­æ–­</span></span><br><span class="line">ET1 = <span class="number">1</span>;<span class="comment">//å¼€å®šæ—¶å™¨1ä¸­æ–­</span></span><br><span class="line">TR0 =<span class="number">1</span>;<span class="comment">//å¯åŠ¨å®šæ—¶å™¨0</span></span><br><span class="line">TR1 = <span class="number">1</span>;<span class="comment">//å¯åŠ¨å®šæ—¶å™¨1</span></span><br><span class="line"><span class="keyword">while</span>(<span class="number">1</span>)</span><br><span class="line">&#123;</span><br><span class="line">display(shi,ge);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">void</span> <span class="title function_">display</span><span class="params">(uchar shi,uchar ge)</span><span class="comment">//æ˜¾ç¤ºå­å‡½æ•°</span></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">P0 = table[shi];<span class="comment">//é€æ®µé€‰æ•°æ®</span></span><br><span class="line">wei1 = <span class="number">1</span>;</span><br><span class="line">wei2 = <span class="number">0</span>;</span><br><span class="line">wei3 = <span class="number">0</span>;</span><br><span class="line">wei4 = <span class="number">0</span>;</span><br><span class="line">delayms(<span class="number">5</span>);</span><br><span class="line"></span><br><span class="line">P0 = table[ge];</span><br><span class="line">wei1 = <span class="number">0</span>;</span><br><span class="line">wei2 = <span class="number">1</span>;</span><br><span class="line">wei3 = <span class="number">0</span>;</span><br><span class="line">wei4 = <span class="number">0</span>;                                                                                                                                                                                                                  </span><br><span class="line">delayms(<span class="number">5</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">delayms</span><span class="params">(uint xms)</span></span><br><span class="line">&#123;</span><br><span class="line">uint i,j;</span><br><span class="line"><span class="keyword">for</span>(i=xms;i&gt;<span class="number">0</span>;i--)</span><br><span class="line"><span class="keyword">for</span>(j=<span class="number">110</span>;j&gt;<span class="number">0</span>;j--);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">void</span> <span class="title function_">T0_time</span><span class="params">()</span> interrupt 1</span><br><span class="line">&#123;</span><br><span class="line">TH0=(<span class="number">65536</span><span class="number">-45872</span>)/<span class="number">256</span>;<span class="comment">//é‡è£…åˆå€¼</span></span><br><span class="line">TL0=(<span class="number">65536</span><span class="number">-45872</span>)%<span class="number">256</span>;</span><br><span class="line">num1++;</span><br><span class="line"><span class="keyword">if</span>(num1==<span class="number">4</span>)<span class="comment">//4æ¬¡ä¸­æ–­=200ms</span></span><br><span class="line">&#123;</span><br><span class="line">num1 = <span class="number">0</span>;<span class="comment">//æ¸…0</span></span><br><span class="line">led1 = ~led1;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">T1_time</span><span class="params">()</span> interrupt 3</span><br><span class="line">&#123;</span><br><span class="line">TH1=(<span class="number">65536</span><span class="number">-45872</span>)/<span class="number">256</span>;<span class="comment">//é‡è£…åˆå€¼</span></span><br><span class="line">TL1=(<span class="number">65536</span><span class="number">-45872</span>)%<span class="number">256</span>;</span><br><span class="line">num2++;</span><br><span class="line"><span class="keyword">if</span>(num2==<span class="number">20</span>)<span class="comment">//20æ¬¡ä¸­æ–­=1ç§’</span></span><br><span class="line">&#123;</span><br><span class="line">num2=<span class="number">0</span>;<span class="comment">//æ¸…0</span></span><br><span class="line">num++;</span><br><span class="line"><span class="keyword">if</span>(num==<span class="number">60</span>)<span class="comment">//è¯¥æ•°ç”¨æ¥é€æ•°ç ç®¡æ˜¾ç¤ºï¼Œåˆ°60åå½’0</span></span><br><span class="line">num=<span class="number">0</span>;</span><br><span class="line">shi=num/<span class="number">10</span>;<span class="comment">//æŠŠä¸€ä¸ª2ä½æ•°åˆ†ç¦»ååˆ†åˆ«é€æ•°ç ç®¡æ˜¾ç¤º</span></span><br><span class="line">ge=num%<span class="number">10</span>;<span class="comment">//åä½å’Œä¸ªä½</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="4ã€æŒ‰é”®æ£€æµ‹åŸç†åŠåº”ç”¨å®ç°"><a href="#4ã€æŒ‰é”®æ£€æµ‹åŸç†åŠåº”ç”¨å®ç°" class="headerlink" title="4ã€æŒ‰é”®æ£€æµ‹åŸç†åŠåº”ç”¨å®ç°"></a>4ã€æŒ‰é”®æ£€æµ‹åŸç†åŠåº”ç”¨å®ç°</h1><p>â€‹é”®ç›˜åˆ†ä¸ºç¼–ç é”®ç›˜å’Œéç¼–ç é”®ç›˜ï¼ˆæ˜¯å¦æœ‰ç¼–ç å™¨ï¼‰ï¼›éç¼–ç é”®ç›˜åˆ†ä¸ºç‹¬ç«‹é”®ç›˜å’Œè¡Œåˆ—å¼ï¼ˆçŸ©é˜µå¼ï¼‰é”®ç›˜ã€‚</p><h2 id="1ã€ç‹¬ç«‹é”®ç›˜æ£€æµ‹"><a href="#1ã€ç‹¬ç«‹é”®ç›˜æ£€æµ‹" class="headerlink" title="1ã€ç‹¬ç«‹é”®ç›˜æ£€æµ‹"></a>1ã€ç‹¬ç«‹é”®ç›˜æ£€æµ‹</h2><p>â€‹æŠ–åŠ¨ç°è±¡ï¼ˆ5~10msï¼‰ï¼Œä¸€èˆ¬åœ¨æ£€æµ‹æŒ‰ä¸‹æ—¶åŠ å…¥å»æŠ–å»¶æ—¶ï¼Œæ£€æµ‹æ¾æ‰‹æ—¶ä¸éœ€ã€‚</p><p><a href="https://imgtu.com/i/cXXarj"><img src="https://z3.ax1x.com/2021/04/23/cXXarj.jpg" class="lazyload placeholder" data-srcset="https://z3.ax1x.com/2021/04/23/cXXarj.jpg" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="cXXarj.jpg"></a></p><p>ç›®æ ‡ï¼š1ã€æ•°ç ç®¡å‰ä¸¤ä½æ˜¾ç¤ºä¸€ä¸ªåè¿›åˆ¶æ•°ï¼Œå˜åŒ–èŒƒå›´00~59ï¼Œå¼€å§‹æ—¶æ˜¾ç¤º00ï¼Œ</p><p>â€‹2ã€æ¯æŒ‰ä¸‹S2é”®ä¸€æ¬¡ï¼Œæ•°å€¼åŠ 1ï¼›æ¯æŒ‰ä¸‹S3é”®ä¸€æ¬¡ï¼Œæ•°å€¼å‡1ï¼›æ¯æŒ‰ä¸‹S4é”®ä¸€æ¬¡ï¼Œæ•°å€¼å½’é›¶ï¼›</p><p>â€‹3ã€æ¯æŒ‰ä¸‹S5é”®ä¸€æ¬¡ï¼Œåˆ©ç”¨å®šæ—¶å™¨åŠŸèƒ½ä½¿æ•°å€¼å¼€å§‹è‡ªåŠ¨æ¯ç§’åŠ 1ï¼Œå†æ¬¡æŒ‰ä¸‹S5é”®ï¼Œæ•°å€¼æš‚åœã€‚</p><p>ä»£ç åˆ†æï¼š(çœç•¥ç‰ˆ)</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;reg52.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> uchar.....</span></span><br><span class="line">sbit....</span><br><span class="line">uchar code table[]=&#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">display</span><span class="params">(uchar numdis)</span>&#123;</span><br><span class="line">shi=numdis/<span class="number">10</span>;</span><br><span class="line">ge=numdis%<span class="number">10</span>;</span><br><span class="line">&#125;<span class="comment">//æ˜¾ç¤ºå­å‡½æ•°</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">delayms</span><span class="params">(uint xms)</span>&#123;&#125;  <span class="comment">//å»¶æ—¶å­å‡½æ•°</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">init</span><span class="params">()</span>&#123;                      <span class="comment">//åˆå§‹åŒ–å‡½æ•°</span></span><br><span class="line"><span class="comment">//å®šæ—¶å™¨åˆå§‹åŒ–</span></span><br><span class="line">TMOD = <span class="number">0x01</span>;<span class="comment">//è®¾ç½®å®šæ—¶å™¨0ä¸ºå·¥ä½œæ–¹å¼1ï¼ˆM1M0ä¸º01ï¼‰</span></span><br><span class="line">TH0 = (<span class="number">65536</span><span class="number">-45872</span>)/<span class="number">256</span>; <span class="comment">//è£…åˆå€¼11.0592Mæ™¶æŒ¯å®šæ—¶50msæ•°ä¸º45872</span></span><br><span class="line">TL0 = (<span class="number">65536</span><span class="number">-45872</span>)%<span class="number">256</span>;</span><br><span class="line">EA = <span class="number">1</span>;        <span class="comment">//å¼€æ€»ä¸­æ–­</span></span><br><span class="line">ET0 = <span class="number">1</span>;    <span class="comment">//å¼€å®šæ—¶å™¨0ä¸­æ–­ï¼ˆé€šè¿‡ TR0 = 1;å¼€å¯ï¼‰</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="type">void</span> <span class="title function_">keyscan</span><span class="params">()</span>&#123;<span class="comment">//æŒ‰é”®æ‰«æå­å‡½æ•°</span></span><br><span class="line"><span class="keyword">if</span>(key1==<span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line">delayms(<span class="number">10</span>);<span class="comment">//æ¶ˆæŠ–</span></span><br><span class="line"><span class="keyword">if</span>(key1==<span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line">num++;</span><br><span class="line"><span class="keyword">if</span>(num==<span class="number">60</span>)</span><br><span class="line">num=<span class="number">0</span>;</span><br><span class="line"><span class="keyword">while</span>(!key1);<span class="comment">//ç­‰å¾…æŒ‰é”®é‡Šæ”¾</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(key2==<span class="number">0</span>)&#123;&#125;</span><br><span class="line"><span class="keyword">if</span>(key3==<span class="number">0</span>)&#123;&#125;</span><br><span class="line"><span class="keyword">if</span>(key4==<span class="number">0</span>)&#123;<span class="keyword">while</span>(!key4); TR0=~TR0;&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">void</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">init();</span><br><span class="line"><span class="keyword">while</span>(<span class="number">1</span>)</span><br><span class="line">&#123;</span><br><span class="line">keyscan();</span><br><span class="line">display(num);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">void</span> <span class="title function_">T0_time</span><span class="params">()</span>interrupt 1</span><br><span class="line">&#123;</span><br><span class="line">TH0 = (<span class="number">65536</span><span class="number">-45872</span>)/<span class="number">256</span>;<span class="comment">//é‡è£…åˆå€¼</span></span><br><span class="line">TL0 = (<span class="number">65536</span><span class="number">-45872</span>)%<span class="number">256</span>;</span><br><span class="line">numt0++;</span><br><span class="line"><span class="keyword">if</span>(numt0==<span class="number">20</span>)<span class="comment">//1ç§’æ—¶é—´åˆ°</span></span><br><span class="line">&#123;</span><br><span class="line">numt0=<span class="number">0</span>;    <span class="comment">//æ—¶é—´æ¸…é›¶é‡è®¡</span></span><br><span class="line">num++;<span class="comment">//æ¯ç§’åŠ 1</span></span><br><span class="line"><span class="keyword">if</span>(num==<span class="number">60</span>)</span><br><span class="line">num=<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="2ã€çŸ©é˜µé”®ç›˜æ£€æµ‹"><a href="#2ã€çŸ©é˜µé”®ç›˜æ£€æµ‹" class="headerlink" title="2ã€çŸ©é˜µé”®ç›˜æ£€æµ‹"></a>2ã€çŸ©é˜µé”®ç›˜æ£€æµ‹</h2><p><a href="https://imgtu.com/i/cjpVPI"><img src="https://z3.ax1x.com/2021/04/23/cjpVPI.md.jpg" class="lazyload placeholder" data-srcset="https://z3.ax1x.com/2021/04/23/cjpVPI.md.jpg" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="cjpVPI.md.jpg" style="zoom:150%;" /></a></p><p>ç›®æ ‡ï¼šTX-1Cï¼šä¸Šç”µï¼Œæ•°ç ç®¡ä¸æ˜¾ç¤ºï¼Œé¡ºåºæŒ‰ä¸‹çŸ©é˜µé”®ç›˜åï¼Œæ•°ç ç®¡ä¸Šä¾æ¬¡æ˜¾ç¤º0~Fï¼Œ6ä¸ªæ•°ç ç®¡åŒæ—¶é™æ€æ˜¾ç¤ºå³å¯</p><p>ä»£ç åˆ†æï¼šï¼ˆçœç•¥ç‰ˆï¼‰</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    P0=<span class="number">0</span>;<span class="comment">//å…³é—­æ‰€æœ‰æ•°ç ç®¡æ®µé€‰</span></span><br><span class="line">    dula=<span class="number">1</span>;</span><br><span class="line">    dula=<span class="number">0</span>;</span><br><span class="line">    P0=<span class="number">0xc0</span>;<span class="comment">//ä½é€‰ä¸­æ‰€æœ‰æ•°ç ç®¡ï¼ˆä»¥åç›´æ¥é€æ®µé€‰ä¿¡å·ï¼‰</span></span><br><span class="line">    wela=<span class="number">1</span>;</span><br><span class="line">    wela=<span class="number">0</span>;</span><br><span class="line">  <span class="keyword">while</span>(<span class="number">1</span>)</span><br><span class="line">  &#123;</span><br><span class="line">      matrixkeyscan();<span class="comment">//ä¸åœè°ƒç”¨é”®ç›˜æ‰«æç¨‹åº</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">display</span><span class="params">(uchar num)</span></span><br><span class="line">&#123;</span><br><span class="line">    P0=table[num];<span class="comment">//æ˜¾ç¤ºå‡½æ•°åªé€æ®µé€‰æ•°æ®</span></span><br><span class="line">    dula=<span class="number">1</span>;</span><br><span class="line">    dula=<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">void</span> <span class="title function_">matrixkeyscan</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    uchar temp,key;</span><br><span class="line">    P3=<span class="number">0xfe</span>;<span class="comment">//1111 1110 ç¬¬ä¸€è¡Œçº¿ç½®ä½ç”µå¹³ï¼Œå…¶ä½™ä¸ºé«˜ç”µå¹³</span></span><br><span class="line">    temp=P3;<span class="comment">//P3çŠ¶æ€èµ‹ç»™ä¸´æ—¶å˜é‡ï¼Œç”¨äºè®¡ç®—</span></span><br><span class="line">    temp=temp&amp;<span class="number">0xf0</span>;<span class="comment">//1111 0000 è‹¥tempé«˜å››ä½æœ‰0ï¼Œåˆ™ç»“æœä¸ä¸º0xf0;è‹¥æ— ï¼Œåˆ™ä¸€ç›´ä¸º0xf0</span></span><br><span class="line">    <span class="keyword">if</span>(temp!=<span class="number">0xf0</span>)<span class="comment">//è¯´æ˜æœ‰é”®æŒ‰ä¸‹</span></span><br><span class="line">    &#123;</span><br><span class="line">        delayms(<span class="number">10</span>);<span class="comment">//æ¶ˆæŠ–</span></span><br><span class="line">        temp=P3;<span class="comment">//é‡è¯»</span></span><br><span class="line">        temp=temp&amp;<span class="number">0xf0</span>;<span class="comment">//é‡&amp;</span></span><br><span class="line">         <span class="keyword">if</span>(temp!=<span class="number">0xf0</span>)<span class="comment">//è¯´æ˜ç¡®å®æœ‰é”®æŒ‰ä¸‹</span></span><br><span class="line">         &#123;</span><br><span class="line">             temp=P3;<span class="comment">//å†è¯»ä¸€ä¸‹P3çŠ¶æ€ï¼ˆè¡Œåˆ—äº¤å‰ï¼‰</span></span><br><span class="line">             <span class="keyword">switch</span>(temp)</span><br><span class="line">             &#123;</span><br><span class="line">                 <span class="keyword">case</span> <span class="number">0xee</span>:<span class="comment">//1110 1110</span></span><br><span class="line">                     key=<span class="number">0</span>;</span><br><span class="line">                     <span class="keyword">break</span>;</span><br><span class="line">                 <span class="keyword">case</span> <span class="number">0xde</span>:<span class="comment">//1101 1110</span></span><br><span class="line">                     key=<span class="number">1</span>;</span><br><span class="line">                     <span class="keyword">break</span>;</span><br><span class="line">                 <span class="keyword">case</span> <span class="number">0xbe</span>:<span class="comment">//1011 1110</span></span><br><span class="line">                     key=<span class="number">2</span>;</span><br><span class="line">                     <span class="keyword">break</span>;</span><br><span class="line">                 <span class="keyword">case</span> <span class="number">0x7e</span>:<span class="comment">//0111 1110</span></span><br><span class="line">                     key=<span class="number">3</span>;</span><br><span class="line">                     <span class="keyword">break</span>;                </span><br><span class="line">             &#125;</span><br><span class="line">             <span class="keyword">while</span>(temp!=<span class="number">0xf0</span>)<span class="comment">//ç­‰å¾…æŒ‰é”®é‡Šæ”¾</span></span><br><span class="line">             &#123;</span><br><span class="line">                 temp=P3;<span class="comment">//ä¸æ–­è¯»å–</span></span><br><span class="line">                 temp=temp&amp;<span class="number">0xf0</span>;<span class="comment">//ä¸æ–­ç›¸&amp;ï¼Œåªè¦ç»“æœä¸ä¸º0xf0ï¼Œå°±è¯´æ˜æŒ‰é”®æ²¡æœ‰è¢«é‡Šæ”¾</span></span><br><span class="line">             &#125;</span><br><span class="line">             display(key);<span class="comment">//æ˜¾ç¤º</span></span><br><span class="line">         &#125;</span><br><span class="line">            </span><br><span class="line">    &#125;</span><br><span class="line">     P3=<span class="number">0xfd</span>;<span class="comment">//1111 1101ç¬¬äºŒè¡Œç½®ä½ç”µå¹³ï¼Œå…¶ä½™ä¸ºé«˜ç”µå¹³</span></span><br><span class="line">    ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚</span><br><span class="line">     P3=<span class="number">0xfb</span>;</span><br><span class="line">    .......................</span><br><span class="line">     P3=<span class="number">0xf7</span>;</span><br><span class="line">    .......................</span><br><span class="line">        </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="5ã€æ¨¡-æ•°è½¬æ¢"><a href="#5ã€æ¨¡-æ•°è½¬æ¢" class="headerlink" title="5ã€æ¨¡&#x2F;æ•°è½¬æ¢"></a>5ã€æ¨¡&#x2F;æ•°è½¬æ¢</h1><h2 id="1ã€è½¬æ¢åŸç†åŠå‚æ•°æŒ‡æ ‡"><a href="#1ã€è½¬æ¢åŸç†åŠå‚æ•°æŒ‡æ ‡" class="headerlink" title="1ã€è½¬æ¢åŸç†åŠå‚æ•°æŒ‡æ ‡"></a>1ã€è½¬æ¢åŸç†åŠå‚æ•°æŒ‡æ ‡</h2><p>â€‹é‡‡æ ·ä¿æŒã€é‡åŒ–ã€ç¼–ç ã€‚</p><p>â€‹<strong>é‡‡æ ·å®šç†</strong>ï¼š$f_s&gt;&#x3D;2f_{ i max }$ï¼Œé€šå¸¸å–3-5å€ï¼ˆé‡åŒ–éœ€è¦æ—¶é—´)ï¼Œ$f_s$ä¸ºé‡‡æ ·é¢‘ç‡ï¼Œ$f_{i max}$ä¸ºè¾“å…¥ä¿¡å·çš„æœ€é«˜é¢‘ç‡åˆ†é‡çš„é¢‘ç‡ã€‚åœ¨æ»¡è¶³é‡‡æ ·å®šç†çš„æ¡ä»¶ä¸‹å¯ä»¥ä½¿ç”¨ä¸€ä¸ªä½é€šæ»¤æ³¢å™¨å°†ä¿¡å·è¿˜åŸå‡ºæ¥ï¼Œè¯¥ä½é€šæ»¤æ³¢å™¨ç”µå‹ä¼ è¾“ç³»æ•°åœ¨ä½äº$f_{imax}$çš„èŒƒå›´å†…ä¿æŒä¸å˜ï¼Œåœ¨$f_s$-$f_{imax}$ä»¥å‰è¿…é€Ÿä¸‹é™ä¸º0</p><p>â€‹é‡åŒ–å’Œç¼–ç ï¼š</p><p>â€‹é‡åŒ–ï¼šåŒ–æˆä¸€ä¸ªæœ€å°æ•°é‡å•ä½ï¼ˆé‡åŒ–å•ä½$\bigtriangleup$ï¼‰çš„æ•´æ•°å€ã€‚ï¼ˆä¼šäº§ç”Ÿé‡åŒ–è¯¯å·®ï¼Œæœ€å¤§ä¸º$\bigtriangleup$ï¼Œè§£å†³ï¼šå–ä¸­ç‚¹ï¼Œç¼©å°ä¸º$\bigtriangleup$&#x2F;2ï¼‰</p><p>â€‹ç¼–ç ï¼šæŠŠé‡åŒ–çš„æ•°å€¼ç”¨äºŒè¿›åˆ¶ä»£ç è¡¨ç¤ºï¼Œå³è¾“å‡ºä¿¡å·ã€‚</p><p>â€‹<strong>è¡¥å……</strong>ï¼šé‡‡æ ·ä¿æŒç”µè·¯ï¼ˆNæ²Ÿé“MOSç®¡å¯åšé‡‡æ ·å¼€å…³ç”¨ï¼Œé«˜ç”µå¹³Tå¯¼é€šï¼‰</p><h2 id="2ã€ç›´æ¥A-Dè½¬æ¢å™¨"><a href="#2ã€ç›´æ¥A-Dè½¬æ¢å™¨" class="headerlink" title="2ã€ç›´æ¥A&#x2F;Dè½¬æ¢å™¨"></a>2ã€ç›´æ¥A&#x2F;Dè½¬æ¢å™¨</h2><h3 id="1ã€å¹¶è¡Œæ¯”è¾ƒå‹"><a href="#1ã€å¹¶è¡Œæ¯”è¾ƒå‹" class="headerlink" title="1ã€å¹¶è¡Œæ¯”è¾ƒå‹"></a>1ã€å¹¶è¡Œæ¯”è¾ƒå‹</h3><p>â€‹ï¼ˆç”µå‹æ¯”è¾ƒå™¨+å¯„å­˜å™¨+ä»£ç è½¬æ¢å™¨ï¼‰</p><p>â€‹å•ç‰‡é›†æˆå¹¶è¡Œæ¯”è¾ƒå‹A&#x2F;Dè½¬æ¢å™¨å¦‚ï¼šAD9012(8ä½)ã€AD9002ï¼ˆ8ä½ï¼‰ã€AD9020ï¼ˆ10ä½ï¼‰ç­‰</p><p>â€‹ç‰¹ç‚¹ï¼šâ‘ å¹¶è¡Œï¼Œè½¬æ¢æ—¶é—´åªå—æ¯”è¾ƒå™¨ã€è§¦å‘å™¨å’Œç¼–ç ç”µè·¯å»¶è¿Ÿæ—¶é—´é™åˆ¶ï¼Œè½¬æ¢é€Ÿåº¦å¿«ï¼›â‘¡éšç€åˆ†è¾¨ç‡æé«˜ï¼Œå…ƒä»¶æ•°ç›®æŒ‰å‡ ä½•çº§æ•°å¢åŠ ï¼›â‘¢è¿™ç§å«å¯„å­˜å™¨çš„å¹¶è¡ŒA&#x2F;Dè½¬æ¢ç”µè·¯ï¼Œå¯ä»¥ä¸ç”¨é™„åŠ é‡‡æ ·-ä¿æŒç”µè·¯ï¼ˆæ¯”è¾ƒå™¨å’Œå¯„å­˜å™¨å…¼æœ‰é‡‡æ ·-ä¿æŒåŠŸèƒ½ï¼‰ã€‚</p><p>â€‹ç¼ºç‚¹ï¼šéœ€è¦å¾ˆå¤šçš„ç”µå‹æ¯”è¾ƒå™¨å’Œè§¦å‘å™¨ã€‚</p><h3 id="2ã€åé¦ˆæ¯”è¾ƒå‹"><a href="#2ã€åé¦ˆæ¯”è¾ƒå‹" class="headerlink" title="2ã€åé¦ˆæ¯”è¾ƒå‹"></a>2ã€åé¦ˆæ¯”è¾ƒå‹</h3><p>â€‹åŸç†ï¼šå–ä¸€ä¸ªæ•°å­—é‡åŠ åˆ°D&#x2F;Aè½¬æ¢å™¨ä¸Šï¼Œå¾—åˆ°ä¸€ä¸ªå¯¹åº”çš„è¾“å‡ºæ¨¡æ‹Ÿç”µå‹ï¼Œå°†è¿™ä¸ªæ¨¡æ‹Ÿç”µå‹ä¸è¾“å…¥çš„æ¨¡æ‹Ÿç”µå‹ä¿¡å·æ¯”è¾ƒï¼Œå¦‚æœä¸¤è€…ä¸ç›¸ç­‰ï¼Œåˆ™è°ƒæ•´æ‰€å–çš„æ•°å­—é‡ï¼Œç›´è‡³ä¸¤ä¸ªæ¨¡æ‹Ÿç”µå‹ç›¸ç­‰ä¸ºæ­¢ï¼Œæœ€åæ‰€å–çš„æ•°å­—é‡å°±æ˜¯è½¬æ¢ç»“æœã€‚</p><h3 id="3ã€è®¡æ•°å‹"><a href="#3ã€è®¡æ•°å‹" class="headerlink" title="3ã€è®¡æ•°å‹"></a>3ã€è®¡æ•°å‹</h3><p>â€‹ï¼ˆ æ¯”è¾ƒå™¨C+D&#x2F;Aè½¬æ¢å™¨+è®¡æ•°å™¨+è„‰å†²æº+æ§åˆ¶é—¨G+è¾“å‡ºå¯„å­˜å™¨ç­‰ï¼‰</p><p>â€‹ä½¿ç”¨å¯„å­˜å™¨åŸå› ï¼šè½¬æ¢è¿‡ç¨‹è®¡æ•°å™¨ä¸­æ•°å­—ä¸åœå˜åŒ–ï¼Œä¸å®œå°†è®¡æ•°å™¨çŠ¶æ€ç›´æ¥ä½œä¸ºè¾“å‡ºä¿¡å·ã€‚</p><p>â€‹ç¼ºç‚¹ï¼šè½¬æ¢é€Ÿåº¦ä½ã€‚</p><h3 id="4ã€é€æ¬¡æ¯”è¾ƒå‹"><a href="#4ã€é€æ¬¡æ¯”è¾ƒå‹" class="headerlink" title="4ã€é€æ¬¡æ¯”è¾ƒå‹"></a>4ã€é€æ¬¡æ¯”è¾ƒå‹</h3><p>â€‹ï¼ˆæé«˜è½¬æ¢é€Ÿåº¦ï¼Œåœ¨è®¡æ•°å‹åŸºç¡€ä¸Šï¼Œé‡‡ç”¨ç±»ä¼¼å¤©å¹³ç§°é‡çš„æ€è·¯ï¼šå°†è¾“å…¥æ¨¡æ‹Ÿä¿¡å·ä¸ä¸åŒçš„å‚è€ƒç”µå‹åšå¤šæ¬¡æ¯”è¾ƒï¼Œä½¿è½¬æ¢æ‰€å¾—çš„æ•°å­—é‡åœ¨æ ‘æ•°å€¼ä¸Šé€æ¬¡é€¼è¿‘è¾“å…¥æ¨¡æ‹Ÿé‡çš„å¯¹åº”å€¼ï¼‰</p><p>â€‹ä¸€æ¬¡è½¬æ¢æ—¶é—´ä¸å…¶ä½æ•°å’Œæ—¶é’Ÿè„‰å†²é¢‘ç‡ç›¸å…³ã€‚ä½æ•°è¶Šå°‘ï¼Œæ—¶é’Ÿé¢‘ç‡è¶Šé«˜ï¼Œè½¬æ¢æ—¶é—´è¶ŠçŸ­ã€‚</p><p>â€‹ä¼˜ç‚¹ï¼šè½¬æ¢é€Ÿåº¦å¿«ï¼Œç²¾åº¦é«˜ç­‰ã€‚</p><p>â€‹é›†æˆé€æ¬¡æ¯”è¾ƒå‹A&#x2F;Dè½¬æ¢å™¨å¦‚ï¼š8ä½ï¼šADC0804ã€ADC0808ã€ADC0809ç³»åˆ—ï¼›10ä½ï¼šAD575ï¼›12ä½ï¼šAD574Aç­‰</p><h2 id="3ã€é—´æ¥A-Dè½¬æ¢å™¨ï¼ˆä¸»è¦ä¸¤ç§ï¼‰"><a href="#3ã€é—´æ¥A-Dè½¬æ¢å™¨ï¼ˆä¸»è¦ä¸¤ç§ï¼‰" class="headerlink" title="3ã€é—´æ¥A&#x2F;Dè½¬æ¢å™¨ï¼ˆä¸»è¦ä¸¤ç§ï¼‰"></a>3ã€é—´æ¥A&#x2F;Dè½¬æ¢å™¨ï¼ˆä¸»è¦ä¸¤ç§ï¼‰</h2><h3 id="1ã€æ—¶é—´-ç”µå‹å˜æ¢å‹ï¼ˆV-Tå˜æ¢å‹ï¼‰"><a href="#1ã€æ—¶é—´-ç”µå‹å˜æ¢å‹ï¼ˆV-Tå˜æ¢å‹ï¼‰" class="headerlink" title="1ã€æ—¶é—´-ç”µå‹å˜æ¢å‹ï¼ˆV-Tå˜æ¢å‹ï¼‰"></a>1ã€æ—¶é—´-ç”µå‹å˜æ¢å‹ï¼ˆV-Tå˜æ¢å‹ï¼‰</h3><p>â€‹é¦–å…ˆæŠŠè¾“å…¥çš„æ¨¡æ‹Ÿç”µå‹ä¿¡å·è½¬æ¢æˆä¸ä¹‹æˆæ­£æ¯”çš„<em><strong>æ—¶é—´å®½åº¦</strong></em>ä¿¡å·ï¼Œç„¶ååœ¨è¿™ä¸ªæ—¶é—´å®½åº¦é‡Œå¯¹å›ºå®šé¢‘ç‡çš„æ—¶é’Ÿè„‰å†²è®¡æ•°ï¼Œè®¡æ•°ç»“æœå°±æ˜¯æ­£æ¯”äºè¾“å…¥æ¨¡æ‹Ÿç”µå‹çš„æ•°å­—ä¿¡å·ã€‚</p><h3 id="2ã€ç”µå‹-é¢‘ç‡å˜æ¢å‹ï¼ˆV-Få˜æ¢å‹ï¼‰"><a href="#2ã€ç”µå‹-é¢‘ç‡å˜æ¢å‹ï¼ˆV-Få˜æ¢å‹ï¼‰" class="headerlink" title="2ã€ç”µå‹-é¢‘ç‡å˜æ¢å‹ï¼ˆV-Få˜æ¢å‹ï¼‰"></a>2ã€ç”µå‹-é¢‘ç‡å˜æ¢å‹ï¼ˆV-Få˜æ¢å‹ï¼‰</h3><p>â€‹é¦–å…ˆæŠŠè¾“å…¥çš„æ¨¡æ‹Ÿç”µå‹ä¿¡å·è½¬æ¢æˆä¸ä¹‹æˆæ­£æ¯”çš„<em><strong>é¢‘ç‡</strong></em>ä¿¡å·ï¼Œç„¶ååœ¨ä¸€ä¸ªå›ºå®šçš„æ—¶é—´é—´éš”é‡Œå¯¹å¾—åˆ°çš„é¢‘ç‡ä¿¡å·è®¡æ•°ï¼Œæ‰€å¾—åˆ°çš„ç»“æœå°±æ˜¯æ­£æ¯”äºè¾“å…¥æ¨¡æ‹Ÿç”µå‹çš„æ•°å­—é‡ã€‚</p><h2 id="4ã€A-Dè½¬æ¢å™¨çš„å‚æ•°æŒ‡æ ‡"><a href="#4ã€A-Dè½¬æ¢å™¨çš„å‚æ•°æŒ‡æ ‡" class="headerlink" title="4ã€A&#x2F;Dè½¬æ¢å™¨çš„å‚æ•°æŒ‡æ ‡"></a>4ã€A&#x2F;Dè½¬æ¢å™¨çš„å‚æ•°æŒ‡æ ‡</h2><ol><li>åˆ†è¾¨ç‡ï¼šå¯¹è¾“å…¥ä¿¡å·çš„åˆ†è¾¨èƒ½åŠ›ï¼Œä»¥è¾“å‡ºäºŒè¿›åˆ¶çš„ä½æ•°è¡¨ç¤ºã€‚eg:è¾“å‡º8ä½äºŒè¿›åˆ¶æ•°ï¼Œè¾“å…¥ä¿¡å·æœ€å¤§å€¼5V,åˆ†è¾¨æœ€å°ç”µå‹ï¼š$5VÃ—1&#x2F;2^8â‰ˆ19.53mv$ï¼›</li><li>è½¬æ¢è¯¯å·®ï¼šç†è®ºä¸å®é™…è¾“å‡ºæ•°å­—é‡ä¹‹é—´çš„å·®åˆ«ï¼Œä¸€èˆ¬ç”¨æœ€ä½æœ‰æ•ˆä½è¡¨ç¤ºï¼›</li><li>è½¬æ¢ç²¾åº¦ï¼šA&#x2F;Dè½¬æ¢å™¨çš„æœ€å¤§é‡åŒ–è¯¯å·®å’Œæ¨¡æ‹Ÿéƒ¨åˆ†ç²¾åº¦çš„å…±åŒä½“ç°ï¼›</li><li>æœ€å¤§é‡åŒ–è¯¯å·®ï¼šåº”ä¸ºåˆ†è¾¨ç‡æ•°å€¼çš„ä¸€åŠï¼ˆå®é™…è¿˜è¦ä½äº›ï¼‰ï¼›</li><li>æ¨¡æ‹Ÿå¤„ç†ï¼ˆå¦‚ç§¯åˆ†å™¨ã€æ¯”è¾ƒå™¨ç­‰ï¼‰éƒ¨åˆ†çš„è¯¯å·®ï¼šä¸€èˆ¬ä¸æ•°å­—è½¬æ¢è¯¯å·®åº”å°½é‡å¤„äºåŒä¸€æ•°é‡ç­‰çº§ã€‚eg:10ä½A&#x2F;Dè½¬æ¢å™¨ç”¨å…¶ä¸­9ä½è®¡æ•°ï¼›</li><li>æ€»è¯¯å·®ï¼šç´¯åŠ å’Œï¼›</li><li>æœ€å¤§ç›¸å¯¹é‡åŒ–è¯¯å·®ï¼š2^9Ã—0.5â‰ˆ0.1ï¼…ï¼Œæ¨¡æ‹Ÿéƒ¨åˆ†ä¹Ÿä¸º0.1ï¼…ï¼Œæ€»ç²¾åº¦0.2ï¼…ï¼›</li><li>è½¬æ¢æ—¶é—´ï¼šè½¬æ¢æ§åˆ¶ä¿¡å·æ¥ï¼Œåˆ°è¾“å‡ºç«¯å¾—åˆ°ç¨³å®šçš„æ•°å­—ä¿¡å·æ‰€ç»è¿‡çš„æ—¶é—´ã€‚å¹¶è¡Œæ¯”è¾ƒA&#x2F;Dè½¬æ¢å™¨ï¼ˆ8ä½å•ç‰‡é›†æˆ50nsï¼‰&lt; é€æ¬¡æ¯”è¾ƒå‹A&#x2F;Dè½¬æ¢å‹ï¼ˆ10-50us,ä¹Ÿæœ‰å‡ ç™¾çº³ç§’çš„ï¼‰&lt; é—´æ¥A&#x2F;Dè½¬æ¢å™¨ï¼ˆåŒç§¯åˆ†A&#x2F;Dè½¬æ¢å™¨æ—¶é—´å‡ åæ¯«ç§’~å‡ ç™¾æ¯«ç§’ï¼‰</li></ol><h2 id="5ã€å°ç»“ï¼š"><a href="#5ã€å°ç»“ï¼š" class="headerlink" title="5ã€å°ç»“ï¼š"></a>5ã€å°ç»“ï¼š</h2><p>â€‹â‘ é«˜é€Ÿï¼šå¹¶è¡Œï¼›</p><p>â€‹â‘¡é«˜ç²¾åº¦ï¼šåŒç§¯åˆ†A&#x2F;Dè½¬æ¢å™¨ï¼›</p><p>â€‹â‘¢é€æ¬¡æ¯”è¾ƒå‹A&#x2F;Dè½¬æ¢å™¨å…¼æœ‰ï¼Œæ™®éä½¿ç”¨ï¼›</p><p>â€‹â‘£ä¸»è¦æŠ€æœ¯å‚æ•°ï¼šè½¬æ¢ç²¾åº¦ã€è½¬æ¢é€Ÿåº¦ï¼ˆå†³å®šç³»ç»Ÿï¼‰</p><h2 id="6ã€ADC0804å·¥ä½œåŸç†åŠå…¶å®ç°æ–¹æ³•"><a href="#6ã€ADC0804å·¥ä½œåŸç†åŠå…¶å®ç°æ–¹æ³•" class="headerlink" title="6ã€ADC0804å·¥ä½œåŸç†åŠå…¶å®ç°æ–¹æ³•"></a>6ã€ADC0804å·¥ä½œåŸç†åŠå…¶å®ç°æ–¹æ³•</h2><p><a href="https://imgtu.com/i/RiZqCF"><img src="https://z3.ax1x.com/2021/06/20/RiZqCF.md.jpg" class="lazyload placeholder" data-srcset="https://z3.ax1x.com/2021/06/20/RiZqCF.md.jpg" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="RiZqCF.md.jpg" style="zoom:150%;" /></a></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*********************************************************</span></span><br><span class="line"><span class="comment">11ã€TX-ICä¸ŠADC0804çš„æ•°æ¨¡è½¬æ¢ä½¿ç”¨(é€æ¬¡æ¯”è¾ƒå‹)</span></span><br><span class="line"><span class="comment">*********************************************************/</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;reg52.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;intrins.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> uchar unsigned char</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> uint unsigned int </span></span><br><span class="line">sbit dula = P2^<span class="number">6</span>;<span class="comment">//U1é”å­˜ç«¯</span></span><br><span class="line">sbit wela = P2^<span class="number">7</span>;<span class="comment">//U2é”å­˜ç«¯</span></span><br><span class="line">sbit adwr = P3^<span class="number">6</span>;<span class="comment">//A/Dçš„WRç«¯å£</span></span><br><span class="line">sbit adrd = P3^<span class="number">7</span>;<span class="comment">//A/Dçš„RDç«¯å£</span></span><br><span class="line"></span><br><span class="line">uchar code table[]=&#123;</span><br><span class="line"><span class="number">0x3f</span> , <span class="number">0x06</span> , <span class="number">0x5b</span> , <span class="number">0x4f</span> ,</span><br><span class="line"><span class="number">0x66</span> , <span class="number">0x6d</span> ,<span class="number">0x7d</span> , <span class="number">0x07</span> , </span><br><span class="line"><span class="number">0x7f</span> , <span class="number">0x6f</span> , <span class="number">0x77</span> , <span class="number">0x7c</span> ,</span><br><span class="line"><span class="number">0x39</span> , <span class="number">0x5e</span> , <span class="number">0x79</span> , <span class="number">0x71</span> &#125;;</span><br><span class="line"><span class="type">void</span> <span class="title function_">delayms</span><span class="params">(uint xms)</span></span><br><span class="line">&#123;</span><br><span class="line">uint i,j;</span><br><span class="line"><span class="keyword">for</span>(i=xms;i&gt;<span class="number">0</span>;i--)</span><br><span class="line"><span class="keyword">for</span>(j=<span class="number">110</span>;j&gt;<span class="number">0</span>;j--);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">void</span> <span class="title function_">display</span><span class="params">(uchar bai,uchar shi,uchar ge)</span></span><br><span class="line">&#123;</span><br><span class="line">dula = <span class="number">1</span>;</span><br><span class="line">P0 = table[bai];</span><br><span class="line">dula = <span class="number">0</span>;</span><br><span class="line">P0 = <span class="number">0xff</span>;<span class="comment">//é€ä½é€‰æ•°æ®å‰å…³é—­æ‰€æœ‰æ˜¾ç¤ºï¼Œé˜²æ­¢æ‰“å¼€ä½é€‰é”å­˜æ—¶ï¼ŒåŸæ¥çš„æ®µé€‰æ•°æ®é€šè¿‡ä½é€‰é”å­˜å™¨é€ æˆæ··ä¹±</span></span><br><span class="line">wela = <span class="number">1</span>;</span><br><span class="line">P0 = <span class="number">0x7e</span>;<span class="comment">//é€ä½é€‰æ•°æ®   0111 1110 (å§‹ç»ˆä¿æŒæœ€é«˜ä½ä¸º0ï¼Œæ˜¯ä¸‹æ–¹CSç«¯ä¸€ç›´è¢«é€‰ä¸­)</span></span><br><span class="line">wela = <span class="number">0</span>;</span><br><span class="line">delayms(<span class="number">5</span>);</span><br><span class="line"></span><br><span class="line">dula = <span class="number">1</span>;</span><br><span class="line">P0 = table[shi];</span><br><span class="line">dula = <span class="number">0</span>;</span><br><span class="line">P0 = <span class="number">0xff</span>;</span><br><span class="line">wela = <span class="number">1</span>;</span><br><span class="line">P0 = <span class="number">0x7d</span>;<span class="comment">//0111 1101</span></span><br><span class="line">wela = <span class="number">0</span>;</span><br><span class="line">delayms(<span class="number">5</span>);</span><br><span class="line"></span><br><span class="line">dula = <span class="number">1</span>;</span><br><span class="line">P0 = table[ge];</span><br><span class="line">dula = <span class="number">0</span>;</span><br><span class="line">P0 = <span class="number">0xff</span>;</span><br><span class="line">wela = <span class="number">1</span>;</span><br><span class="line">P0 = <span class="number">0x7b</span>;<span class="comment">//0111 1011</span></span><br><span class="line">wela = <span class="number">0</span>;</span><br><span class="line">delayms(<span class="number">5</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">void</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">uchar a,A1,A2,A3,adval;</span><br><span class="line">wela = <span class="number">1</span>;</span><br><span class="line">P0 = <span class="number">0x7f</span>;<span class="comment">//CSADä¸º0ï¼Œé€‰é€šADCSåä¸å†ç®¡ADCS</span></span><br><span class="line">wela = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">while</span>(<span class="number">1</span>)</span><br><span class="line">&#123;</span><br><span class="line">adwr = <span class="number">1</span>;</span><br><span class="line">_nop_();<span class="comment">//å»¶è¿Ÿä¸€ä¸ªæœºå™¨å‘¨æœŸ</span></span><br><span class="line">adwr = <span class="number">0</span>;<span class="comment">//ADå¯åŠ¨</span></span><br><span class="line">_nop_();</span><br><span class="line">adwr = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">for</span>(a=<span class="number">10</span>;a&gt;<span class="number">0</span>;a--)<span class="comment">//æ­¤å¤„A/Då·¥ä½œé¢‘ç‡è¾ƒä½ï¼Œæ‰€ä»¥å¯åŠ¨åè¦å¤šç•™æ—¶é—´ç”¨æ¥è½¬æ¢ï¼ˆå°†æ˜¾ç¤ºéƒ¨åˆ†æ”¾åœ¨è¿™é‡Œï¼‰</span></span><br><span class="line">&#123;</span><br><span class="line">display(A1,A2,A3);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">P1 = <span class="number">0xff</span>;<span class="comment">//è¯»å–P1å£ä¹‹å‰å…¨èµ‹1</span></span><br><span class="line">adrd = <span class="number">1</span>;<span class="comment">//é€‰é€šADCS</span></span><br><span class="line">_nop_();</span><br><span class="line">adrd = <span class="number">0</span>;<span class="comment">//A/Dè¯»ä½¿èƒ½</span></span><br><span class="line">_nop_();</span><br><span class="line">adval = P1;<span class="comment">//å°†A/Dæ•°æ®èµ‹ç»™P1å£</span></span><br><span class="line">adrd = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">A1 = adval/<span class="number">100</span>;</span><br><span class="line">A2 = adval%<span class="number">100</span>/<span class="number">10</span>;</span><br><span class="line">A3 = adval%<span class="number">10</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="6ã€æ•°-æ¨¡è½¬æ¢"><a href="#6ã€æ•°-æ¨¡è½¬æ¢" class="headerlink" title="6ã€æ•°&#x2F;æ¨¡è½¬æ¢"></a>6ã€æ•°&#x2F;æ¨¡è½¬æ¢</h1>]]></content>
      
      
      
        <tags>
            
            <tag> åµŒå…¥å¼å¼€å‘ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>é­”æ–¹é—²ç©</title>
      <link href="/2021/04/04/mo-fang-xian-wan/"/>
      <url>/2021/04/04/mo-fang-xian-wan/</url>
      
        <content type="html"><![CDATA[<h1 id="1ã€èµ·å› "><a href="#1ã€èµ·å› " class="headerlink" title="1ã€èµ·å› "></a>1ã€èµ·å› </h1><p>â€‹å°å­¦æ—¶æˆ‘çˆ¸å°±ç»™æˆ‘ä¹°äº†ä¸€ä¸ªé­”æ–¹ï¼Œè¯´æ˜ä¹¦çœ‹ç€å¤ªå¤æ‚ï¼Œå°±è¢«æˆ‘éšæ‰‹æ‰”äº†ï¼Œè‡ªå·±çé¼“æ£ï¼Œé­”æ–¹è‡ªä»æ‰“ä¹±è¿‡å°±å†ä¹Ÿæ²¡æœ‰æ‹¼å¥½è¿‡ï¼ˆé™¤äº†æˆ‘æ‹¿èºä¸åˆ€æŠŠä¸­å¿ƒè½´å…¨æ‹†ä¸‹æ¥é‡æ–°æ‹¼å¥½ï¼‰ï¼Œæœ€å¤šä¹Ÿå°±æ‹¼å¥½ä¸€ä¸ªé¢è¿‡ï¼Œæˆ‘å§ä¹Ÿå¯¹â€¦ï¼Œç„¶åå°±æ‰”ä¸€è¾¹å»äº†ï¼Œçœ‹åˆ«äººç©çš„æŒºæºœçš„ï¼Œç„¶åçœ‹å…¬å¼ä¸€å¤§å †ï¼Œå°±æ²¡è€å¿ƒå»çœ‹äº†ï¼Œé«˜ä¸­å®¤å‹æœ‰ä¸€æ®µæ—¶é—´ä¹°äº†å„ç§å½¢çŠ¶çš„é­”æ–¹ï¼Œæˆ‘å°±å­¦ä¼šäº†æ‹¼é‡‘å­—å¡”é‚£ç§ç®€å•çš„å¼‚å½¢é­”æ–¹ï¼Œå…¶ä»–ä¹Ÿå°±æ²¡è€å¿ƒçœ‹ä¸‹å»äº†ï¼Œæœ€åŸºç¡€çš„ä¸‰é˜¶çš„ä¸€ç›´æ²¡å»çœ‹ï¼Œå°±ä¸€ç›´æ²¡å­¦ä¼šï¼Œå°±æ˜¯å¾ˆèœâ€¦ç„¶åï¼Œå°±æ˜¯è¿‘æœŸæ‹¼å¤šå¤šç»™æˆ‘æ¨äº†é­”æ–¹ï¼Œæˆ‘å°±åˆäº§ç”Ÿäº†å…´è¶£ï¼Œä¹°äº†ä¸¤ä¸ªï¼ˆä¸€ä¸ªä¸‰é˜¶ä¸€ä¸ªäº”é˜¶ï¼‰ï¼ˆé¢ã€‚ã€‚ã€‚5é˜¶çš„å†é¸½ä¸€é˜µå­å§ï¼‰ï¼Œç„¶åçœ‹äº†ä¸€æ™šä¸Šçš„è§†é¢‘æ•™ç¨‹ï¼Œè¿˜æ˜¯æ²¡æœ‰å­¦ä¼šï¼ˆå¤ªèœäº†â€¦â€¦ï¼‰ï¼Œç¬¬äºŒå¤©ä¸€æ—©ï¼Œè‡ªå·±å›é¡¾äº†ä¸€ä¸‹ï¼Œç»ˆäºèƒ½æ‹¼å¥½å…­ä¸ªé¢äº†ã€‚</p><p><a href="https://imgtu.com/i/cKtV74"><img src="https://z3.ax1x.com/2021/04/04/cKtV74.md.jpg" class="lazyload placeholder" data-srcset="https://z3.ax1x.com/2021/04/04/cKtV74.md.jpg" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="cKtV74.md.jpg" style="zoom:150%;" /></a></p><h1 id="2ã€ä¸‰é˜¶æ•™ç¨‹ï¼ˆå±‚å…ˆæ³•"><a href="#2ã€ä¸‰é˜¶æ•™ç¨‹ï¼ˆå±‚å…ˆæ³•" class="headerlink" title="2ã€ä¸‰é˜¶æ•™ç¨‹ï¼ˆå±‚å…ˆæ³•)"></a>2ã€ä¸‰é˜¶æ•™ç¨‹ï¼ˆå±‚å…ˆæ³•)</h1><h2 id="1ã€ç¬¬ä¸€æ­¥ï¼ˆåº•é¢ç™½è‰²åå­—ï¼‰"><a href="#1ã€ç¬¬ä¸€æ­¥ï¼ˆåº•é¢ç™½è‰²åå­—ï¼‰" class="headerlink" title="1ã€ç¬¬ä¸€æ­¥ï¼ˆåº•é¢ç™½è‰²åå­—ï¼‰"></a>1ã€ç¬¬ä¸€æ­¥ï¼ˆåº•é¢ç™½è‰²åå­—ï¼‰</h2><p>â€‹å…ˆæ‹¼å¥½ä¸€ä¸ªé»„ç™½å°èŠ±ï¼ˆä¸­é—´é»„è‰²ä¸€å—ï¼Œå››å‘¨å››ä¸ªç™½è‰²å—ï¼‰ï¼Œç„¶åå¯¹é½åº•å±‚æ£±å—ï¼Œå‰é¢ä¸€å±‚æ—‹è½¬180Â°ã€‚ã€‚ã€‚ï¼Œæœ€åæ‹¼æˆåº•é¢ä¸€ä¸ªç™½è‰²åå­—ã€‚</p><h2 id="2ã€ç¬¬äºŒæ­¥ï¼ˆåº•é¢ç™½è‰²ï¼Œåº•å±‚Tå½¢"><a href="#2ã€ç¬¬äºŒæ­¥ï¼ˆåº•é¢ç™½è‰²ï¼Œåº•å±‚Tå½¢" class="headerlink" title="2ã€ç¬¬äºŒæ­¥ï¼ˆåº•é¢ç™½è‰²ï¼Œåº•å±‚Tå½¢)"></a>2ã€ç¬¬äºŒæ­¥ï¼ˆåº•é¢ç™½è‰²ï¼Œåº•å±‚Tå½¢)</h2><p>â€‹å…ˆæ‰¾é™¤åº•é¢ç™½è‰²åå­—çš„å…¶ä½™ç™½è‰²å—ï¼Œé¡¶è§’ä¸‰é¢å¯¹é½ï¼Œç„¶åå¦‚æœç™½è‰²å—åœ¨å³ä¸Šè§’ï¼Œåˆ™ä½¿ç”¨ä¸€æ¬¡å³å…¬å¼ï¼ˆå³ä¸Šå·¦ä¸‹ï¼‰ï¼Œå¦‚æœåœ¨å·¦ä¸Šè§’ï¼Œåˆ™ä½¿ç”¨ä¸€æ¬¡å·¦å…¬å¼ï¼ˆå·¦ä¸Šå³ä¸‹ï¼‰ï¼Œå¦‚æœåœ¨é¡¶ä¸Šæ—¶ï¼Œåˆ™ä½¿ç”¨ä¸¤æ¬¡å³å…¬å¼ï¼Œé¡¶ä¸Šçš„ç™½è‰²å—å°±ä¼šè·‘åˆ°å³ä¸Šè§’ï¼Œè¿™æ—¶å°±å˜æˆäº†ç¬¬ä¸€ç§æƒ…å†µï¼Œå†ä½¿ç”¨ä¸€æ¬¡å³å…¬å¼å°±å¥½äº†ï¼ˆç›¸å½“äºé¡¶ä¸Šçš„ç™½è‰²å—ä½¿ç”¨ä¸‰æ¬¡å³å…¬å¼å°±å¯ä»¥äº†ï¼‰ã€‚</p><h2 id="3ã€ç¬¬ä¸‰æ­¥ï¼ˆä¸­å±‚ï¼‰"><a href="#3ã€ç¬¬ä¸‰æ­¥ï¼ˆä¸­å±‚ï¼‰" class="headerlink" title="3ã€ç¬¬ä¸‰æ­¥ï¼ˆä¸­å±‚ï¼‰"></a>3ã€ç¬¬ä¸‰æ­¥ï¼ˆä¸­å±‚ï¼‰</h2><p>â€‹è¦æ‹¼å¥½ä¸­å±‚çš„è¯å°±åªè¦è°ƒæ•´å¥½å››ä¸ªæ£±å—å°±å¥½äº†ï¼Œä¸Šå±‚æ£±å—å¯¹é½ï¼Œçœ‹å“ªäº›æ˜¯æˆ‘ä»¬éœ€è¦çš„ï¼Œé»„è‰²å—æ˜¯ä¸éœ€è¦çš„ï¼Œå¦‚æœé¡¶å±‚å››ä¸ªæ£±å—å…¨æ˜¯é»„è‰²å—å³æ²¡æœ‰æˆ‘ä»¬æ‰€éœ€è¦çš„æ£±å—ï¼Œåˆ™ä½¿ç”¨ä¸€æ¬¡å³å…¬å¼å°±æœ‰äº†ã€‚ç„¶åæ‰¾åˆ°æˆ‘ä»¬éœ€è¦çš„æ£±å—ï¼Œå®ƒè¦å»å·¦è¾¹è¿˜æ˜¯å³è¾¹ï¼Œå»å³å°±ç”¨ä¸€æ¬¡å³å…¬å¼ï¼Œè¿™æ—¶ç™½è‰²å—ä¼šä¸Šæ¥ä¸€å—ï¼Œåˆ™ä½¿ç”¨ç¬¬äºŒæ­¥çš„æ–¹æ³•ï¼›å®ƒè¦å»å·¦çš„è¯ï¼Œåˆ™ç±»æ¨ï¼Œç”¨å·¦å…¬å¼ä¸€ä¸‹ã€‚ã€‚ã€‚</p><h2 id="4ã€ç¬¬å››æ­¥-é¡¶å±‚åå­—ï¼Œé»„è‰²"><a href="#4ã€ç¬¬å››æ­¥-é¡¶å±‚åå­—ï¼Œé»„è‰²" class="headerlink" title="4ã€ç¬¬å››æ­¥(é¡¶å±‚åå­—ï¼Œé»„è‰²)"></a>4ã€ç¬¬å››æ­¥(é¡¶å±‚åå­—ï¼Œé»„è‰²)</h2><pre><code> 1. é»„è‰²å—ä¹ç‚¹é’Ÿå½¢çŠ¶ï¼šå‰é¢ä¸€å±‚é¡ºæ—¶é’ˆ90Â°ï¼Œå³å…¬å¼ä¸€æ¬¡ï¼Œå‰é¢ä¸€å±‚é€†æ—¶é’ˆ90Â°å°±å¥½äº†ï¼› 2. é»„è‰²å—ä¸‰ç‚¹ä¸€çº¿ï¼šæ¨ªç€å¯¹å‘è‡ªå·±ï¼Œå‰é¢ä¸€å±‚é¡ºæ—¶é’ˆ90Â°ï¼Œå³å…¬å¼ä¸€æ¬¡å‰é¢ä¸€å±‚é¡ºæ—¶é’ˆ90Â°å›æ¥ï¼Œå°±å˜æˆäº†æƒ…å†µ1ï¼› 3. é¡¶å±‚åªæœ‰ä¸€ä¸ªé»„è‰²ç‚¹ï¼šåˆ™å‰é¢ä¸€å±‚é¡ºæ—¶é’ˆ90Â°ï¼Œå³å…¬å¼ä¸€æ¬¡ï¼Œå‰é¢ä¸€å±‚é€†æ—¶é’ˆ90Â°å°±å˜æˆäº†æƒ…å†µ2ã€‚</code></pre><h2 id="5ã€ç¬¬äº”æ­¥ï¼ˆé¡¶è§’ä½ç½®ï¼‰"><a href="#5ã€ç¬¬äº”æ­¥ï¼ˆé¡¶è§’ä½ç½®ï¼‰" class="headerlink" title="5ã€ç¬¬äº”æ­¥ï¼ˆé¡¶è§’ä½ç½®ï¼‰"></a>5ã€ç¬¬äº”æ­¥ï¼ˆé¡¶è§’ä½ç½®ï¼‰</h2><p>â€‹é¡¶è§’ä¸€å®šæ˜¯æœ‰ä¸¤å—å¯¹é½äº†ï¼Œè¿™æ—¶åªæœ‰ä¸¤ç§æƒ…å†µï¼š</p><pre><code>    1. ç›¸é‚»ä¸¤è¾¹ä¸å¯¹é½ï¼šåˆ™ä¸å¯¹é½çš„æ”¾åœ¨å³ä¾§ï¼Œå³å…¬å¼ä¸‰æ¬¡ï¼Œé­”æ–¹æ•´ä½“é¡ºæ—¶é’ˆ90Â°ï¼Œå†æ¥ä¸‰æ¬¡å·¦å…¬å¼ï¼›    1. å¯¹è§’ä¸å¯¹é½ï¼šå³å…¬å¼ä¸‰æ¬¡ï¼Œæ•´ä½“é¡ºæ—¶é’ˆ90Â°ï¼Œå†æ¥ä¸‰æ¬¡å·¦å…¬å¼ã€‚</code></pre><h2 id="6ã€ç¬¬å…­æ­¥ï¼ˆé¡¶è§’æ–¹å‘ï¼‰"><a href="#6ã€ç¬¬å…­æ­¥ï¼ˆé¡¶è§’æ–¹å‘ï¼‰" class="headerlink" title="6ã€ç¬¬å…­æ­¥ï¼ˆé¡¶è§’æ–¹å‘ï¼‰"></a>6ã€ç¬¬å…­æ­¥ï¼ˆé¡¶è§’æ–¹å‘ï¼‰</h2><p>â€‹é­”æ–¹æ•´ä½“å€’è¿‡æ¥ï¼Œç™½è‰²ä¸€é¢å‘ä¸Šï¼Œé€‰ä¸€è‰²é¢å‘è‡ªå·±ï¼ˆé€‰å®Œåä¸èƒ½å˜ï¼‰ï¼Œåˆ™å³ä¸‹è§’ä¸€å—ä¸ºå¤„ç†ä½ï¼Œå¤„ç†æ—¶ï¼ˆå³å…¬å¼ä¸¤æ¬¡ï¼Œåˆ™å¤„ç†ä½çš„é¡¶è§’æ–¹å‘é€†æ—¶é’ˆè½¬ä¸€æ¬¡ï¼‰ï¼Œå¤„ç†å®Œååº•å±‚è½¬åŠ¨ï¼Œåˆ‡æ¢è¦å¤„ç†çš„é¡¶è§’ï¼Œç›´è‡³å››è§’å…¨éƒ¨å¤„ç†å®Œæ¯•ã€‚å¤„ç†å®Œåå†æ•´ä½“å€’è¿‡æ¥ï¼Œå¯ä»¥å‘ç°åŸæ¥çš„é­”æ–¹å¹¶æ²¡æœ‰è¢«æ‰“ä¹±ã€‚</p><h2 id="7ã€ç¬¬ä¸ƒæ­¥ï¼ˆé¡¶æ£±ä½ç½®ï¼‰"><a href="#7ã€ç¬¬ä¸ƒæ­¥ï¼ˆé¡¶æ£±ä½ç½®ï¼‰" class="headerlink" title="7ã€ç¬¬ä¸ƒæ­¥ï¼ˆé¡¶æ£±ä½ç½®ï¼‰"></a>7ã€ç¬¬ä¸ƒæ­¥ï¼ˆé¡¶æ£±ä½ç½®ï¼‰</h2><p>â€‹å¯ä»¥å‘ç°æœ‰ä¸€é¢å·²ç»å®Œæˆå¥½äº†ï¼Œåˆ™è¿™é¢å¯¹å‘è‡ªå·±ï¼Œçœ‹å¯¹é¢éœ€è¦çš„æ£±å—åœ¨å·¦è¿˜æ˜¯åœ¨å³ï¼š</p><pre><code>    1. åœ¨å·¦ï¼šå·¦å…¬å¼ä¸¤æ¬¡ï¼Œå³å…¬å¼ä¸¤æ¬¡ï¼Œå·¦å…¬å¼å››æ¬¡ï¼Œå³å…¬å¼å››æ¬¡ï¼Œå®Œæ¯•ã€‚    1. åœ¨å³ï¼šå³å…¬å¼ä¸¤æ¬¡ï¼Œå·¦å…¬å¼ä¸¤æ¬¡ï¼Œå³å…¬å¼å››æ¬¡ï¼Œå·¦å…¬å¼å››æ¬¡ï¼Œå®Œæ¯•ã€‚</code></pre><h1 id="3ã€æ€»ç»“"><a href="#3ã€æ€»ç»“" class="headerlink" title="3ã€æ€»ç»“"></a>3ã€æ€»ç»“</h1><p>â€‹å› ä¸ºè§‰å¾—å¾ˆéš¾ï¼Œä¸€ç›´æ²¡æœ‰å»å°è¯•ï¼Œå°è¯•ä¸€ç‚¹å°±æ”¾ä¸€è¾¹å»äº†ï¼Œè¿˜æœ‰å°±æ˜¯è¦æ‰¾åˆ°åˆé€‚çš„æ–¹æ³•ï¼Œæ˜¯çœ‹è§†é¢‘ï¼Œè¿˜æ˜¯çœ‹æ•™ç¨‹æ–‡å­—ï¼Œé€‚åˆè‡ªå·±çš„æ‰æ˜¯æœ€å¥½çš„ï¼Œä½†ä¸€å®šè¦å»å°è¯•ã€‚æ¥ä¸‹æ¥å°±æ˜¯çœ‹çœ‹èƒ½ä¸èƒ½æŠŠ5é˜¶çš„é­”æ–¹ç»™æ‹¼å¥½ï¼Œè¿˜æœ‰å°±æ˜¯æŠŠä»¥å‰å­¦ä¸€åŠæˆ–è€…æ²¡æœ‰ä¸€åŠçš„ç»™è¡¥ä¸Šï¼Œæ¯”å¦‚ç¬›å­ç­‰ï¼Œè¿˜æœ‰å°±æ˜¯å­¦çš„ä¸æ·±å…¥çš„51ã€32ç­‰ï¼ŒPCBç»˜åˆ¶ç­‰ã€‚ã€‚ã€‚</p><p>â€‹æ¨èå­¦ä¹ è§†é¢‘;<a href="https://www.bilibili.com/video/BV1zp411o75F?t=1869">https://www.bilibili.com/video/BV1zp411o75F?t=1869</a></p><p>â€‹</p>]]></content>
      
      
      
        <tags>
            
            <tag> é­”æ–¹ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>2021å¹´RMæœºç”²å¤§å¸ˆé«˜æ ¡è”ç›Ÿèµ›</title>
      <link href="/2021/03/28/2021-nian-rm-ji-jia-da-shi-gao-xiao-lian-meng-sai/"/>
      <url>/2021/03/28/2021-nian-rm-ji-jia-da-shi-gao-xiao-lian-meng-sai/</url>
      
        <content type="html"><![CDATA[<h1 id="2021RMé«˜æ ¡è”ç›Ÿèµ›è½å¹•"><a href="#2021RMé«˜æ ¡è”ç›Ÿèµ›è½å¹•" class="headerlink" title="2021RMé«˜æ ¡è”ç›Ÿèµ›è½å¹•"></a>2021RMé«˜æ ¡è”ç›Ÿèµ›è½å¹•</h1><p><a href="https://imgtu.com/i/c9Ex1I"><img src="https://z3.ax1x.com/2021/03/29/c9Ex1I.jpg" class="lazyload placeholder" data-srcset="https://z3.ax1x.com/2021/03/29/c9Ex1I.jpg" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="c9Ex1I.jpg"></a></p><p><a href="https://imgtu.com/i/c9EXhd"><img src="https://z3.ax1x.com/2021/03/29/c9EXhd.jpg" class="lazyload placeholder" data-srcset="https://z3.ax1x.com/2021/03/29/c9EXhd.jpg" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="c9EXhd.jpg"></a></p><p><a href="https://imgtu.com/i/c9Ev9A"><img src="https://z3.ax1x.com/2021/03/29/c9Ev9A.jpg" class="lazyload placeholder" data-srcset="https://z3.ax1x.com/2021/03/29/c9Ev9A.jpg" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="c9Ev9A.jpg"></a></p><p>â€‹ç¬¬ä¸€æ¬¡æ­£å¼è·Ÿç€å­¦é•¿å‚åŠ RMæ¯”èµ›ï¼Œä»¥å‰ä¸€ç›´æ˜¯é€šè¿‡è§†é¢‘äº†è§£RMçš„ï¼Œç¬¬ä¸€æ¬¡è¿‘è·ç¦»çš„æ¥è§¦ï¼Œç¡®å®æ„Ÿåˆ°å¾ˆéœ‡æ’¼ï¼Œä½†éœ‡æ’¼çš„åŒæ—¶ä¹Ÿç¬é—´æ„Ÿè§‰åˆ°æˆ‘ä»¬çš„å°è½¦å’Œå…¶ä»–å­¦æ ¡çš„å°è½¦ä¹‹é—´å·¨å¤§çš„å®åŠ›æ‚¬æ®Šï¼Œåˆ«äººçš„è½¦æ— è®ºæ˜¯æœºæ¢°ã€ç”µæ§ã€è§†è§‰æ–¹é¢éƒ½æ¯”æˆ‘ä»¬é«˜ä¸€å¤§æˆªï¼ˆæˆ‘ä»¬å…¶å®å°±æ²¡æœ‰è§†è§‰æ–¹é¢çš„è‡ªç„ç³»ç»Ÿï¼Œå…¨é æ‰‹åŠ¨ç„å‡†ï¼Œè¿˜æ˜¯é¥æ§å™¨æ“ä½œçš„ï¼‰ï¼Œé€è¿‡æ¯”èµ›ï¼Œå‘ç°äº†å¾ˆå¤šçš„é—®é¢˜ï¼Œç›¸å…³ä»£ç ä¸å¤Ÿå®Œå–„ï¼ˆæªç®¡è¿‡çƒ­ã€è£åˆ¤ç³»ç»Ÿå›ä¼ ã€é”®é¼ æ“ä½œæŒ‡ä»¤ç­‰é—®é¢˜ï¼‰ï¼Œæ®æˆ‘è§‚å¯Ÿï¼Œå…¨åœºå°±æˆ‘ä¸€äººä½¿ç”¨é¥æ§å™¨æ“ä½œçš„ï¼Œç¡®å®æ²¡æœ‰é”®é¼ æ“ä½œçµæ´»ã€‚è½¦çš„é—®é¢˜ä¸€å¤§å †ï¼Œè¯´å®è¯ï¼Œæ‹¿ç€è¿™è¾†æ‹¼å‡‘çš„å°è½¦å»å‚èµ›ç¡®å®æŒºä¸¢äººçš„ï¼Œåœºä¸Šä¹Ÿå¬åˆ°äº†åˆ«äººèƒŒåçš„è®®è®ºä¸å˜²ç¬‘ï¼Œç¡®å®ä¸å¤ªå¥½å—ï¼Œä½†è¿™ä¹Ÿæ€ªä¸äº†è°ï¼Œåªèƒ½æ€ªè‡ªå·±æŠ€æœ¯ä¸åˆ°å®¶ï¼Œä¹Ÿä¸èƒ½ä¸€æ˜§çš„æŠŠåŸå› æ”¾åˆ°å­¦æ ¡èµ„é‡‘ä¸è¶³ä¸Šã€‚</p><p>â€‹éšç€æ¯”èµ›çš„æ¨è¿›ï¼Œé€æ¸æ„Ÿå—åˆ°äº†RMçš„é­…åŠ›ï¼Œçœ‹åˆ°äº†æ¯ä¸€ä¸ªå‚èµ›é˜Ÿå¯¹æˆ˜è½¦çš„æŠ•å…¥ï¼Œä»–ä»¬çš„è®¾è®¡æœ‰å¾ˆå¤šå€¼å¾—å­¦ä¹ çš„åœ°æ–¹ï¼ˆå·²ç»æˆä¸ºæ ‡é…çš„â€œå°é™€èºâ€ï¼Œè§†è§‰è‡ªç„ç³»ç»Ÿï¼Œé€šè¿‡5è¿å‘é—´æ–­å‘å°„è§£å†³æªç®¡è¿‡çƒ­é—®é¢˜çš„æ–¹æ³•ã€‚ã€‚ã€‚ï¼‰ï¼Œäº²è‡ªæ“ä½œå°è½¦æ¯”èµ›ï¼Œæ„Ÿè§‰ç¡®å®ä¸é”™ï¼Œå°±æ˜¯è‡ªå·±å¤ªèœäº†ã€‚ã€‚ã€‚</p><p>â€‹å…¶å®ï¼Œè¿™æ¬¡æ¯”èµ›çš„æ„ä¹‰è¿˜æ˜¯å¾ˆå¤§çš„ï¼Œè™½ç„¶è¾“çš„å¾ˆä¸¢äººï¼ˆå…¶å®æ˜¯åœ¨æ„æ–™ä¹‹ä¸­çš„ï¼Œä½†é‡å¤§é‚£å±€æˆ‘æ„Ÿè§‰æ˜¯æœ‰æœºä¼šçš„ï¼Œä½†æ˜¯æ²¡æœ‰æŠŠæ¡ä½ï¼Œä¸Šåœºä¹‹å‰æ²¡æœ‰è¾ƒå¥½çš„ä¼˜åŒ–ä»£ç ï¼ŒåŠæ—¶å‘ç°äº‘å°æ™ƒåŠ¨çš„é—®é¢˜ï¼‰ï¼Œå…¶å®è¿˜æ˜¯æœ‰å¾ˆå¤šæ„Ÿæƒ³çš„ï¼Œåªä¸è¿‡ä¸€æ—¶è¦æŠŠå®ƒå†™ä¸‹æ¥ï¼Œå°±ä¸çŸ¥é“å¦‚ä½•è¯´äº†ã€‚ã€‚ã€‚</p><p><a href="https://imgtu.com/i/c9EOtH"><img src="https://z3.ax1x.com/2021/03/29/c9EOtH.jpg" class="lazyload placeholder" data-srcset="https://z3.ax1x.com/2021/03/29/c9EOtH.jpg" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="c9EOtH.jpg"></a></p><p>â€‹<a href="https://imgtu.com/i/c9Eb7D"><img src="https://z3.ax1x.com/2021/03/29/c9Eb7D.jpg" class="lazyload placeholder" data-srcset="https://z3.ax1x.com/2021/03/29/c9Eb7D.jpg" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="c9Eb7D.jpg"></a></p><p>é—æ†¾çš„æ˜¯ï¼Œåœ¨ä¸æ¯…æ¶µçš„æœ€åä¸€å¹´æ¯”èµ›ä¸­æ²¡æœ‰ç»™ä»–æ‰“å‡ºä¸€åˆ†çš„æˆç»©ï¼Œæ„Ÿè§‰æŒºéš¾å—çš„ã€‚å¸Œæœ›å­¦é•¿è€ƒç ”ä¸Šå²¸ï¼Œç»§ç»­æœç€RMåŠªåŠ›ã€‚</p><p>â€‹çœŸä¸çŸ¥é“å­¦é•¿èµ°åï¼Œå®éªŒå®¤çš„æˆ‘ä»¬è¿˜èƒ½ä¸èƒ½ç»§ç»­æ‰“RMï¼Œç¡®å®æŒºè¿·èŒ«çš„ã€‚ã€‚ã€‚ä¸è¿‡æˆ‘è§‰å¾—æ¯”èµ›ç»“æœå…¶å®ä¹Ÿæ²¡é‚£ä¹ˆé‡è¦ï¼Œé‡è¦çš„æ˜¯åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­èƒ½å¤Ÿä»é›¶å¼€å§‹ï¼Œé€ å‡ºä¸€è¾†â€œå±äºâ€è‡ªå·±çš„è½¦ï¼Œæé«˜èƒ½åŠ›çš„åŒæ—¶æ”¶è·å¿«ä¹ã€‚</p><p>â€‹RMçš„ä¸»é¢˜æ›²ç¡®å®å¾ˆæœ‰æ„ŸæŸ“åŠ›ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚â€œæˆ‘ä¸€ç›´è¿½å¯»ç€ä½ ï¼Œä½ å¥½åƒä¸è¿œä¹Ÿä¸è¿‘ï¼Œå´æ€»ä¿æŒç€è·ç¦»ã€‚ã€‚ã€‚ã€‚ã€‚â€</p><p>â€‹ä½ : <a href="https://y.qq.com/n/yqq/mv/v/o0025wv26q0.html">https://y.qq.com/n/yqq/mv/v/o0025wv26q0.html</a></p><p>â€‹ç»ˆäºå†™äº†è‡ªå·±çš„ç¬¬ä¸€ç¯‡åšå®¢ï¼Œè®°å½•ä¸€ä¸‹å¹³æ—¶çš„å­¦ä¹ ç»éªŒå’Œç”Ÿæ´»å§ï¼Œå¸Œæœ›ä»¥æ­¤èƒ½å¤Ÿç£ä¿ƒè‡ªå·±ï¼Œä¹Ÿç›¸å½“äºä¸€ä¸ªå¤‡å¿˜å½•å§ã€‚ã€‚ã€‚</p><p>â€‹å­¦é•¿å‘çš„åšå®¢ï¼š</p><p><a href="https://imgtu.com/i/28a1MT"><img src="https://z3.ax1x.com/2021/06/03/28a1MT.md.png" class="lazyload placeholder" data-srcset="https://z3.ax1x.com/2021/06/03/28a1MT.md.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="28a1MT.md.png" style="zoom:150%;" /></a></p>]]></content>
      
      
      
        <tags>
            
            <tag> RM </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>éšç¬”æ—¥å¿—</title>
      <link href="/2021/03/25/sui-bi-ri-zhi/"/>
      <url>/2021/03/25/sui-bi-ri-zhi/</url>
      
        <content type="html"><![CDATA[<h1 id="2024"><a href="#2024" class="headerlink" title="2024"></a>2024</h1><h2 id="ç›®æ ‡ï¼š"><a href="#ç›®æ ‡ï¼š" class="headerlink" title="ç›®æ ‡ï¼š"></a>ç›®æ ‡ï¼š</h2><ol><li>æˆåŠŸå…¥ä¼ï¼›</li></ol><h2 id="æ—¥å¿—ï¼š"><a href="#æ—¥å¿—ï¼š" class="headerlink" title="æ—¥å¿—ï¼š"></a>æ—¥å¿—ï¼š</h2><h3 id="7æœˆï¼š"><a href="#7æœˆï¼š" class="headerlink" title="7æœˆï¼š"></a>7æœˆï¼š</h3><h1 id="2023"><a href="#2023" class="headerlink" title="2023"></a>2023</h1><h2 id="ç›®æ ‡ï¼š-1"><a href="#ç›®æ ‡ï¼š-1" class="headerlink" title="ç›®æ ‡ï¼š"></a>ç›®æ ‡ï¼š</h2><p>1ï¼šå­¦ä¹ LVGLï¼ˆåˆ¶ä½œ<a href="https://www.xutoubee.cn/">espMointor_plus</a>;å¢¨æ°´å±æ°”è±¡ç«™ï¼Œäº†è§£GUIçš„åˆ¶ä½œå’Œç›¸å…³ç¨‹åºç¼–å†™ï¼‰</p><p>2ï¼šå­¦ä¹ C++&amp;C#</p><h2 id="æ—¥å¿—ï¼š-1"><a href="#æ—¥å¿—ï¼š-1" class="headerlink" title="æ—¥å¿—ï¼š"></a>æ—¥å¿—ï¼š</h2><h2 id="9æœˆï¼š"><a href="#9æœˆï¼š" class="headerlink" title="9æœˆï¼š"></a>9æœˆï¼š</h2><p><strong>1æ—¥ï¼š</strong>[ â€”[â€”â€”åŸºäºSTM32MP157å¼€å‘æ¿ æ–‡æ¡£ (embedfire.com)]</p><ol><li>cubemx &amp;HALï¼ˆ<a href="https://blog.csdn.net/as480133937/article/details/98845509">ã€STM32ã€‘ç³»ç»Ÿæ—¶é’ŸRCCè¯¦è§£(è¶…è¯¦ç»†ï¼Œè¶…å…¨é¢)_rccæ—¶é’Ÿ_Zå°æ—‹çš„åšå®¢-CSDNåšå®¢</a>ï¼‰</li></ol><p>å­¦ä¹ ç³»åˆ—ï¼Œ<a href="https://blog.csdn.net/as480133937/article/details/98885316">ã€STM32ã€‘STM32 CubeMx </a>ï¼Œ <a href="https://doc.embedfire.com/linux/stm32mp1/hal/zh/latest/doc/chapter41/chapter41.html">å°†STM32CubeIDEå·¥ç¨‹è½¬ä¸ºkeil MDKå·¥ç¨‹</a>;</p><ol start="2"><li>J-FLASHæŸ¥çœ‹æ•°æ®ï¼ˆå®‰è£…ç›®å½•ä¸‹æœ‰å¾ˆå¤šå°å·¥å…·ï¼‰</li></ol><h3 id="8æœˆï¼š"><a href="#8æœˆï¼š" class="headerlink" title="8æœˆï¼š"></a>8æœˆï¼š</h3><p><strong>31æ—¥ï¼š</strong></p><ol><li>æ‰ç”µé‡å¯å‚æ•°CRCæ ¡éªŒå¤±è´¥-&gt;å¯èƒ½æ˜¯bootloaderé‡Œçš„å½±å“ï¼Œï¼ˆæ”¹ä¸ºä»0x0800 0000å¯åŠ¨ï¼Œå¤§å°0x4000ï¼‰ï¼›</li><li>åŸºç«™è®¾ç½®ç”»é¢ï¼šæ·»åŠ åŸºç«™ï¼›</li><li><a href="https://www.cnblogs.com/pertor/p/9484663.html">STM32å­¦ä¹ ç¬”è®°ï¼šè¯»å†™å†…éƒ¨Flashï¼ˆä»‹ç»+é™„ä»£ç ï¼‰ </a></li></ol><p><strong>30æ—¥ï¼š</strong></p><ol><li>å®‰è£…äº§æµ‹å·¥å…·ï¼šæ‰¾ä¸åˆ°msvcp120dllæ— æ³•ç»§ç»­è¿è¡Œ-&gt;win+r-&gt;cmd-&gt;scf&#x2F;scannow-&gt;é‡å¯ï¼ˆæœªè§£å†³ï¼‰ï¼›</li><li>RDSSçš„zigbeeé¡µé¢ï¼š</li></ol><blockquote><p>â‘ åˆ‡æ¢åˆ°zigbeeè®¾ç½®ç”»é¢ï¼Œæ–‡æœ¬æ¡†æ˜¾ç¤ºzigbeeå‚æ•°ï¼ˆä¸ç”¨æ‰¹é‡æ›´æ–°ï¼‰ï¼ˆelse ifäº’æ–¥ï¼‰</p><p>â‘¡ç‚¹å‡»å¯¹åº”æ–‡æœ¬æ¡†ï¼Œå¼¹å‡ºè‡ªå®šä¹‰é”®ç›˜ï¼Œå¹¶ä¸”é”®ç›˜æ–‡æœ¬æ¡†æ˜¾ç¤ºæ­¤æ—¶çš„å‚æ•°ï¼Œé€šè¿‡é”®ç›˜ä¿®æ”¹åæŒ‰goé”®æ˜¾ç¤ºåœ¨zigbeeå‚æ•°æ–‡æœ¬æ¡†ï¼Œè‹¥æŒ‰é€€å‡ºé”®ç›˜é¡µé¢ä¸ä¿®æ”¹å†…å®¹ï¼Œæœ€åç‚¹å‡»confirmæŒ‰é”®æäº¤zigbeeå‚æ•°è®¾ç½®</p><p>â‘¢ä»¿ç…§ç³»ç»Ÿè‡ªå¸¦é”®ç›˜ï¼Œä½¿ç”¨luaè„šæœ¬é€šè¿‡åªæ“ä½œä¸²å£å±å®ç°è‡ªå®šä¹‰é”®ç›˜ï¼ˆæŒ‰é”®é€šçŸ¥æ”¹ä¸ºä»…æŒ‰ä¸‹æ—¶ï¼Œå¦åˆ™å¦‚æœå®šä¹‰ä¸ºåˆ‡æ¢ç”»é¢ï¼Œå…ˆåˆ‡ç”»é¢ï¼Œå†å‘é€æŒ‰é’®é€šçŸ¥ï¼‰</p><p><strong>strtoul()</strong> ä¼šæ‰«æå‚æ•°nptr å­—ç¬¦ä¸²ï¼Œè·³è¿‡å‰é¢çš„ç©ºç™½å­—ç¬¦ï¼ˆä¾‹å¦‚ç©ºæ ¼ï¼Œtabç¼©è¿›ç­‰ï¼Œå¯ä»¥é€šè¿‡ isspace() å‡½æ•°æ¥æ£€æµ‹ï¼‰ï¼Œç›´åˆ°é‡ä¸Šæ•°å­—æˆ–æ­£è´Ÿç¬¦å·æ‰å¼€å§‹åšè½¬æ¢ï¼Œå†é‡åˆ°éæ•°å­—æˆ–å­—ç¬¦ä¸²ç»“æŸæ—¶(â€˜\0â€™)ç»“æŸè½¬æ¢ï¼Œå¹¶å°†ç»“æœè¿”å›ï¼›</p></blockquote><ol start="3"><li>CRCæ ¡éªŒï¼šCyclic Redundancy Check</li></ol><p><strong>17æ—¥ï¼š</strong></p><p>å¤§å½©ï¼šæ§ä»¶ï¼š</p><blockquote><p><strong>æ»‘åŠ¨é€‰æ‹©</strong>æ§ä»¶ï¼ˆæ»‘åŠ¨é€‰æ‹©ã€çŠ¶æ€é€‰æ‹©ï¼‰;</p><p><strong>æ»‘å—</strong>æ§ä»¶ï¼ˆitemä»£è¡¨é€‰é¡¹ï¼Œå¦‚10ï¼›20ï¼›30â€¦åˆ™item&#x3D;0ä»£è¡¨é€‰æ‹©ç¬¬0é¡¹10ï¼‰;</p><p><strong>RTC</strong>æ§ä»¶ï¼›</p><p><strong>GIF</strong>æ§ä»¶ï¼›</p><p><strong>å›¾æ ‡</strong>æ§ä»¶ï¼ˆæŒ‰é’®äº’æ–¥ï¼šé€‰ä¸­äº’æ–¥çš„æ‰€æœ‰æŒ‰é’®-&gt;ç¼–è¾‘-&gt;æŒ‰é’®äº’æ–¥ï¼‰ï¼›</p><p><strong>æ›²çº¿</strong>æ§ä»¶ï¼ˆä¾‹å¦‚ï¼ŒæŠŠæ›²çº¿å®½åº¦è®¾ç½®ä¸º480åƒç´ ï¼Œé‡‡æ ·ç‚¹æ•°è®¾ç½®ä¸º480ä¸ªï¼Œ1ä¸ªåƒç´ ç‚¹å¯¹åº”1ä¸ªæ›²çº¿é‡‡æ ·æ•°æ®ã€‚é‚£ä¹ˆæ•´ä¸ªå®½åº¦çš„æ›²çº¿æ˜¾ç¤ºå®Œæ¯•æ­£å¥½éœ€è¦480ä¸ªæ•°æ®ï¼Œå½“481ä¸ªæ•°æ®åˆ°æ¥çš„æ—¶å€™ï¼Œæ›´æ–°FIFOæ•°æ®ï¼Œæ›²çº¿å‘å³å¹³ç§»æ˜¾ç¤ºã€‚å¦‚æœæ›²çº¿å®½åº¦ä¸º200åƒç´ ï¼Œé‡‡æ ·ç‚¹æ•°ä¸º201ï¼Œæ•´ä¸ªæ§ä»¶å®½åº¦åªèƒ½æ˜¾ç¤º200ä¸ªé‡‡æ ·ç‚¹ï¼Œé‚£ä¹ˆç¬¬201ä¸ªæ›²çº¿çš„æ•°æ®ç‚¹åˆ°æ¥çš„æ—¶å€™å±å¹•ä¸Šæ˜¾ç¤ºçš„æ›²çº¿å°±ä¼šå¼€å§‹å‘å³å¹³ç§»æ˜¾ç¤ºï¼‰ï¼›</p><p><strong>èœå•</strong>æ§ä»¶ï¼›</p><p><strong>äºŒç»´ç </strong>æ§ä»¶ï¼›</p><p><strong>æ•°æ®è®°å½•</strong>æ§ä»¶ï¼›</p><p><strong>å†å²æ›²çº¿</strong>æ§ä»¶;</p><blockquote><p>æ•°æ®è®°å½•æ§ä»¶ä¸å†å²æ›²çº¿å…±ç”¨å­˜å‚¨å—åœ¨128K flashé‡Œé¢ï¼Œå¼€å¯æ•°æ®å­˜å‚¨æ—¶ï¼Œåº”è®¾ç½®å­˜å‚¨åœ°å€</p><p>æ•°æ®å­˜å‚¨åœ°å€è®¡ç®—ï¼š</p><p>æ•°æ®æ§ä»¶å­˜å‚¨å¤§å° &#x3D; æœ€å¤§è®°å½•æ•°*å•æ¡è®°å½•å¤§å°+24 ï¼ˆå•ä½ï¼šå­—èŠ‚ï¼‰</p><p>å†å²æ›²çº¿å­˜å‚¨å¤§å° &#x3D; é€šé“ä¸ªæ•°*é‡‡æ ·ç‚¹æ•°+30 ï¼ˆå•ä½ï¼š å­—èŠ‚ï¼‰</p></blockquote><p><strong>åœ†å½¢è¿›åº¦æ¡</strong>æ§ä»¶ï¼šLUAè„šæœ¬å…³è”åœ†å½¢è¿›åº¦æ¡ä¸æ–‡æœ¬æ¡†ï¼ˆä»£æ›¿MCUä¸‹å‘æŒ‡ä»¤ï¼Œä¸²å£å±å†…éƒ¨ç›´æ¥å›è°ƒæ§åˆ¶ï¼‰ï¼›</p><p><strong>æ—‹è½¬æ§ä»¶</strong>ï¼š ï¼ˆå¯å®ç°ä»ªè¡¨æ•ˆæœï¼‰ï¼›</p><p><strong>åŸºæœ¬å›¾å½¢</strong>æ§ä»¶ï¼Œ<strong>è§†é¢‘</strong>æ§ä»¶ï¼Œ<strong>AVè¾“å…¥</strong>æ§ä»¶ </p></blockquote><p><strong>16æ—¥ï¼š</strong></p><ol><li>çœ‹å¤§å½©å®˜ç½‘å¼€å‘æ–‡æ¡£ï¼ŒvisualTFTã€keilä¸è™šæ‹Ÿä¸²å£å±è°ƒè¯•ï¼ŒMCUç¨‹åºå¤„ç†æ¡†æ¶ï¼›</li><li>æ–‡ä»¶ç³»ç»Ÿ-&gt;FATFSï¼›</li><li>IAPï¼ˆIn-Application Programmingâ€ï¼‰ï¼ŒICPï¼ˆIn-Application Programmingï¼‰ï¼ŒISP: Bootloaderï¼›</li><li>uc-osll</li></ol><h1 id="2022"><a href="#2022" class="headerlink" title="2022"></a>2022</h1><h2 id="ç›®æ ‡ï¼š-2"><a href="#ç›®æ ‡ï¼š-2" class="headerlink" title="ç›®æ ‡ï¼š"></a>ç›®æ ‡ï¼š</h2><p>è€ƒç ”ä¸Šå²¸ï¼ï¼ï¼Ã—</p><h2 id="æ—¥å¿—ï¼š-2"><a href="#æ—¥å¿—ï¼š-2" class="headerlink" title="æ—¥å¿—ï¼š"></a>æ—¥å¿—ï¼š</h2><h3 id="11æœˆï¼š"><a href="#11æœˆï¼š" class="headerlink" title="11æœˆï¼š"></a>11æœˆï¼š</h3><p><strong>5æ—¥ï¼š</strong>æ¯•è®¾é€‰é¢˜äº†å…³äºæ— äººæœºè·Ÿè¸ªè¯†åˆ«çš„ï¼Œå¤§æ¦‚äº†è§£äº†ä¸‹ï¼Œå¼€äº†ä¸€ç¯‡åšå®¢å¸–å­ç§¯ç´¯ç´ æï¼Œå·®ä¸å¤šäº†ï¼Œè¦æ”¶æ”¶å¿ƒï¼Œç°åœ¨ä¸è¦å¤ªå…³æ³¨è¿™ä¸ªï¼Œå…¨èº«å¿ƒæŠ•å…¥è€ƒç ”ï¼Œè¿˜æœ‰48å¤©ï¼ŒåŠ æ²¹ï¼</p><h3 id="10æœˆï¼š"><a href="#10æœˆï¼š" class="headerlink" title="10æœˆï¼š"></a>10æœˆï¼š</h3><p><strong>26æ—¥ï¼š</strong><a href="https://www.jb51.net/softjc/842790.html">ToDeskå¦‚ä½•æ‰“å¼€éŸ³é¢‘æ’­æ”¾</a>  <a href="https://www.somode.com/course/7896.html">æ‰¾ä¸åˆ°æ–‡ä»¶gpedit.mscæ€ä¹ˆåŠè¯¦ç»†ä»‹ç»</a></p><p><strong>25æ—¥ï¼š</strong><a href="https://www.jianshu.com/p/5e38fa61ea29?utm_campaign=maleskine&utm_content=note&utm_medium=seo_notes">ä½¿ç”¨Atomæ‰“é€ æ— æ‡ˆå¯å‡»çš„Markdownç¼–è¾‘å™¨</a> å›¾åºŠå‡ºäº†ç‚¹é—®é¢˜ï¼Œè€ƒè™‘åç»­æ¢</p><p><strong>17~20æ—¥ï¼š</strong>è®¤è¯†å®ä¹ ï¼šeNSPç½‘ç»œä»¿çœŸï¼ˆç½‘ç»œè®¾æ–½é…ç½®ç›¸å…³ã€pingã€PCé€šä¿¡ã€VLANã€IPã€macã€å­ç½‘æ©ç ä¸IPç›¸ä¸ï¼Œç½‘å…³ã€è·¯ç”±ï¼Œ(æ•™ç¨‹ï¼šBç«™ï¼šä¼—å…ƒåŠ©æ•™å…ƒå…ƒ)ã€æŠ“åŒ…è½¯ä»¶wiresharkã€RRTã€BBTã€å¸é¡¶å¤©çº¿ã€å­ç½‘ï¼Œç½‘å…ƒï¼‰ï¼ˆäº¤æ¢æœºå¥½åƒä¸æ˜¯å¤ªé«˜æ·±çš„ä¸œè¥¿ï¼Œä¸æ˜¯å¾ˆè´µï¼Œå®¶ç”¨çš„å‡ åå—é’±ï¼ŒåƒHUBé›†çº¿å™¨ä¸€æ ·ï¼‰</p><p><strong>11~15æ—¥ï¼š</strong>é‡‘å·¥å®ä¹ ï¼šæ¿€å…‰é›•åˆ»æœºå¯ä»¥æä¸€ä¸‹ï¼›ï¼ˆ3Bä»£ç ï¼Œæ•°æ§Gä»£ç ï¼‰</p><h3 id="9æœˆï¼š-1"><a href="#9æœˆï¼š-1" class="headerlink" title="9æœˆï¼š"></a>9æœˆï¼š</h3><p><strong>16æ—¥ï¼š</strong><a href="http://t.zoukankan.com/qsyll0916-p-7788475.html">å…³äºä¸²å£é€šä¿¡æ³¢ç‰¹ç‡çš„å‡ ç‚¹æ€è€ƒ</a></p><h3 id="6æœˆï¼š"><a href="#6æœˆï¼š" class="headerlink" title="6æœˆï¼š"></a>6æœˆï¼š</h3><p><strong>15æ—¥ï¼š</strong><a href="https://blog.csdn.net/qq_44907926/article/details/118585030?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522165526055716781818777291%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&request_id=165526055716781818777291&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~top_positive~default-1-118585030-null-null.142%5Ev16%5Epc_search_result_control_group,157%5Ev14%5Enew_3&utm_term=%E7%88%AC%E8%99%AB&spm=1018.2226.3001.4187">ä¸€ç¯‡ä¸‡å­—åšæ–‡å¸¦ä½ å…¥å‘çˆ¬è™«è¿™æ¡ä¸å½’è·¯ ã€ä¸‡å­—å›¾æ–‡ã€‘</a></p><p><a href="https://blog.csdn.net/weixin_52122271/article/details/120718703?spm=1001.2014.3001.5501">Flaskæ¡†æ¶â€”â€”ç¬¬ä¸€ä¸ªFlaskç¨‹åº</a></p><h3 id="4æœˆï¼š"><a href="#4æœˆï¼š" class="headerlink" title="4æœˆï¼š"></a>4æœˆï¼š</h3><p><strong>9æ—¥ï¼š</strong><a href="https://blog.csdn.net/zs1342084776/article/details/88701261">MYSQL WorkBenchä½¿ç”¨æ•™ç¨‹</a></p><p><strong>8æ—¥ï¼š</strong><a href="https://rossning92.github.io/pid-simulation/">PIDåœ¨çº¿ç›´è§‚æ„Ÿå—</a></p><h3 id="3æœˆï¼š"><a href="#3æœˆï¼š" class="headerlink" title="3æœˆï¼š"></a>3æœˆï¼š</h3><p><strong>20æ—¥ï¼š</strong><a href="http://c.biancheng.net/view/2625.html">MySQL WorkBenchä½¿ç”¨æ•™ç¨‹</a></p><p><strong>9æ—¥ï¼š</strong><a href="https://www.cnblogs.com/xuexianqi/p/12795890.html">MySQLå®‰è£…æ•™ç¨‹</a></p><h3 id="2æœˆï¼š"><a href="#2æœˆï¼š" class="headerlink" title="2æœˆï¼š"></a>2æœˆï¼š</h3><p><strong>8æ—¥ï¼š</strong><a href="https://blog.csdn.net/sysjtlwx/article/details/73824903">[Arduino]çƒ§å†™Arduino BootLoaderçš„å‡ ç§æ–¹æ³•</a></p><h1 id="2021"><a href="#2021" class="headerlink" title="2021"></a>2021</h1><h2 id="ç›®æ ‡ï¼š-3"><a href="#ç›®æ ‡ï¼š-3" class="headerlink" title="ç›®æ ‡ï¼š"></a>ç›®æ ‡ï¼š</h2><h2 id="æ—¥å¿—ï¼š-3"><a href="#æ—¥å¿—ï¼š-3" class="headerlink" title="æ—¥å¿—ï¼š"></a>æ—¥å¿—ï¼š</h2><h3 id="10æœˆï¼š-1"><a href="#10æœˆï¼š-1" class="headerlink" title="10æœˆï¼š"></a>10æœˆï¼š</h3><p><strong>5æ—¥ï¼š</strong>å¼€å§‹æ–°ä¸€é˜¶æ®µçš„å­¦ä¹ </p><h3 id="8æœˆï¼š-1"><a href="#8æœˆï¼š-1" class="headerlink" title="8æœˆï¼š"></a>8æœˆï¼š</h3><p><strong>8æ—¥ï¼š</strong>ç³»ç»Ÿå­¦ä¹ 8266ç³»åˆ—æ¨¡ç»„ï¼Œäº†è§£ç›¸å…³ç½‘ç»œåè®®ï¼ˆæ·˜äº†ä¸€æŠŠpocker2é”®ç›˜ï¼Œä¿®äº†ä¿®ï¼Œå‡†å¤‡æ¢ipadçš„è§¦æ‘¸æ€»æˆï¼Œäº†è§£äº†ä¸€äº›é‚®ç¥¨çš„çŸ¥è¯†ï¼Œä¹°äº†ä¸€ä¸ªé›†é‚®å†Œï¼Œå‡†å¤‡æ”¶é›†ç€ç©ï¼‰</p><h3 id="7æœˆï¼š-1"><a href="#7æœˆï¼š-1" class="headerlink" title="7æœˆï¼š"></a>7æœˆï¼š</h3><p><strong>29æ—¥ï¼š</strong>åšå¢¨æ°´å±æ°”è±¡ç«™ï¼Œç¿»æ–°äº†ä¸€ä¸‹åšå®¢</p><p><strong>26æ—¥ï¼š</strong><a href="https://blog.csdn.net/m0_45040529/article/details/109254507">Arduinoæ–‡ä»¶æ¢³ç†</a></p><p><strong>25æ—¥ï¼š</strong> ç ”ç©¶esp8266é©±åŠ¨å¢¨æ°´å±ï¼Œæ‰‹ä¸Šçš„8266åº”è¯¥æ˜¯é‡å¤åˆ·å›ºä»¶äº†ï¼Œå¯¼è‡´å‡ºé”™ï¼Œå‚è€ƒç½‘ä¸Šæ•™ç¨‹ä½¿ç”¨Python2å®‰è£…esptoolè¿›è¡Œå›ºä»¶æ“¦é™¤ï¼Œæ­£å¥½çœ‹ä¸€ä¸‹pythonçŸ¥è¯†ï¼Œæ¥ä¸‹æ¥å‡†å¤‡ç”¨8266è·å–ç›¸å…³ç½‘ç»œä¿¡æ¯ï¼Œå¹¶è¿›è¡Œå¢¨æ°´å±GUIè®¾è®¡ï¼Œä¸ºå¢¨æ°´å±å¤©æ°”ç«™åšå‡†å¤‡ã€‚</p><p><strong>22æ—¥ï¼š</strong> é£æœºé£ä¸¢äº†ã€‚æ­£å¥½å¼€å§‹åšäº›æ­£äº‹ã€‚æ ‘è“æ´¾å›¾ä¼ åšå‡ºæ¥äº†ï¼Œæ•ˆæœå¾ˆå¥½ï¼Œæ˜¯æ‘„åƒå¤´çš„é—®é¢˜ã€‚åœ¨çœ‹å¾®é›ªçš„å¢¨æ°´å±èµ„æ–™ã€‚<br><strong>21æ—¥ï¼š</strong> å‡†å¤‡åšå¢¨æ°´å±å¤©æ°”ç«™ï¼Œå°è¯•ç”¨VScodeã€‚</p><p><strong>20æ—¥ï¼š</strong>ä¸€ç›´åœ¨ç©èˆªæ¨¡ï¼Œæ ‘è“æ´¾å›¾ä¼ å‘å°„ç«¯é‡åˆ°ç‚¹é—®é¢˜ï¼Œåº”æ˜¯æ²¡æœ‰è¯†åˆ«å‡ºæ‘„åƒå¤´ï¼Œé‡æ–°ä¹°äº†ä¸€ä¸ªï¼Œè¿˜æ²¡åˆ°ï¼Œä¸èƒ½åœ¨è¿™æ–¹é¢èŠ±å¤ªå¤šæ—¶é—´äº†ï¼Œè¦å¼€å§‹å­¦ä¹ äº†ï¼Œæœ‰ç‚¹ç¼ºå°‘æ–¹å‘ã€‚</p><p><strong>5~7æ—¥ï¼š</strong> çœ‹äº†ä¸€ä¸‹å®éªŒå®¤çš„3Dæ‰“å°æœºï¼Œæ‹†å¼€æ¥ä¿®äº†ä¸€ä¸‹ï¼Œç„¶åæ‰“å°ä¸œè¥¿ï¼Œä¸å¤ªå¥½ç”¨ã€‚</p><p><strong>4æ—¥ï¼š</strong> æ‰¾ç‚¹é›¶ä»¶å‡‘äº†ä¸€æ¶F330å››è½´ã€‚</p><p><strong>3æ—¥ï¼š</strong>è€ƒè¯•åŸºæœ¬éƒ½å®Œäº†ï¼Œè¿˜å·®ä¸€ä¸ª12å·çš„å¤§è·¨ã€‚ä¸€åˆ°æ”¾å‡ï¼Œæ‰‹åˆç—’äº†ï¼Œæƒ³ç©èˆªæ¨¡äº†ã€‚çœ‹åˆ°äº†OpenHDæ ‘è“æ´¾å›¾ä¼ æ–¹æ¡ˆï¼ˆæœ€è¿œ70å…¬é‡Œï¼‰ï¼Œè¦å…¥å‘äº†ï¼Œåœ¨å­¦æ ¡è°ƒå¥½åå›å»ç©è¿œèˆªFPVã€‚è¿˜æœ‰å°±æ˜¯å¢¨æ°´å±å¤©æ°”ç«™ï¼Œä¿®ä¸€ä¸‹å®éªŒå®¤çš„3Dæ‰“å°æœºã€‚</p><h3 id="6æœˆï¼š-1"><a href="#6æœˆï¼š-1" class="headerlink" title="6æœˆï¼š"></a>6æœˆï¼š</h3><p><strong>26æ—¥ï¼š</strong>  å¤ä¹ ä¿¡å·ä¸ç³»ç»Ÿï¼Œè¦åŠ å¿«è¿›åº¦äº†ï¼Œè¿˜è¦å¸¦ç€å¤ä¹ ä¿¡æ¯è®ºï¼ŒæŠ½ç©ºçœ‹äº†ä¸€ä¸‹ç¤ºæ³¢å™¨çš„FFTè¿ç®—åŠŸèƒ½ï¼Œå‡†å¤‡ç»“åˆä¿¡å·ä¸ç³»ç»Ÿçš„å¤ä¹ äº†è§£ä¸€ä¸‹æ­£ç‚¹åŸå­å°ç¤ºæ³¢å™¨çš„è¿™é¡¹åŠŸèƒ½ä½¿ç”¨ã€‚</p><p><strong>25æ—¥ï¼š</strong>å¤§æ¦‚äº†è§£äº†ä¸€ä¸‹å…‰è€¦ï¼Œæ²¡ä»”ç»†çœ‹å®Œã€‚äº†è§£äº†ä¸€ä¸‹å®éªŒå®¤é‚£å°3Dæ‰“å°æœºï¼Œè€ƒå®Œè¯•æ‹†å¼€æ¥çœ‹çœ‹ï¼Œæ‰“å°ç‚¹ä¸œè¥¿ï¼Œæ„Ÿè§‰ä¸é”™ã€‚</p><p><strong>24æ—¥ï¼š</strong>äº†è§£äº†ä¸€ä¸‹ç”µè·æ³µçš„åŸç†ï¼Œå¯ä»¥å‡å‹ï¼Œäº§ç”Ÿè´Ÿå‹ã€‚</p><p><strong>23æ—¥ï¼š</strong>å¤ä¹ ä¿¡å·ä¸ç³»ç»Ÿï¼Œä¸Šè¯¾èµ°ç¥ï¼Œæ„Ÿè§‰å¤ä¹ çš„ä¸åœ¨çŠ¶æ€ï¼Œå®éªŒå®¤åŸæ¥çš„æ¡Œå­æ¬åˆ°äº†æ¯•ä¸šå­¦é•¿çš„æ¡Œå­ä¸Šï¼Œæ„Ÿè§‰è¿˜å¥½ï¼ˆæˆ‘æ¯”è¾ƒå®¹æ˜“å—å¤–ç•Œç¯å¢ƒçš„å½±å“ï¼‰ï¼Œï¼ˆå¤§å››æ¯•ä¸šäº†ï¼Œçœ‹ç€ä»–ä»¬æ‹–ç€è¡Œæèµ°å‡ºæ ¡å›­ï¼Œä¸éš¾æƒ³åˆ°ä¸¤å¹´åçš„è‡ªå·±ä¼šæ˜¯ä»€ä¹ˆæ ·çš„ï¼‰æ™šä¸Šå¬äº†ä¸€ä¸ªä¿¡æ¯å·¥ç¨‹å¤§å­¦çš„ç ”ç©¶ç”Ÿæ‹›ç”Ÿå®£è®²ï¼ŒåŠ ä¸Šè¿™å‡ å¤©çš„ä¸åœ¨çŠ¶æ€ï¼Œæ„Ÿè§‰å¾ˆè¿·èŒ«ï¼Œè¿·èŒ«ä¸­åˆæ„Ÿè§‰ï¼Œä»ç°åœ¨å¼€å§‹è¯¥åšäº›ä»€ä¹ˆäº†ï¼Œè¯¥åšå‡ºä¸€äº›æ”¹å˜äº†ï¼Œè¯¥æ€è€ƒä¸€ä¸‹æœªæ¥çš„å‘å±•è§„åˆ’äº†ã€‚å°è¯•åœ¨å®éªŒå®¤é‡Œé™ä¸‹å¿ƒæ¥å­¦ä¹ </p><p><a href="https://imgtu.com/i/Ru4DsS"><img src="https://z3.ax1x.com/2021/06/23/Ru4DsS.md.jpg" class="lazyload placeholder" data-srcset="https://z3.ax1x.com/2021/06/23/Ru4DsS.md.jpg" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="Ru4DsS.md.jpg"></a></p><p>å¿«æ”¾æš‘å‡äº†ï¼Œä¼°è®¡ä¼šç•™æ ¡ï¼Œå¿ƒé‡Œåˆæƒ³ç•™æ ¡åˆæƒ³å›å®¶ï¼Œæœ€å¥½çš„æ˜¯ï¼Œå…ˆç•™æ ¡ï¼Œè¶ç€æœ‰æ—¶é—´å¤šå­¦ç‚¹ä¸œè¥¿ï¼Œç„¶åç”µèµ›åçš„å‰©ä½™æ—¶é—´å›è¶Ÿå®¶ã€‚</p><p><a href="https://imgtu.com/i/Ru5Cod"><img src="https://z3.ax1x.com/2021/06/23/Ru5Cod.md.jpg" class="lazyload placeholder" data-srcset="https://z3.ax1x.com/2021/06/23/Ru5Cod.md.jpg" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="Ru5Cod.md.jpg"></a></p><p>ï¼ˆæŒ‰ç…§å­¦é•¿çš„å»ºè®®ï¼Œæš‘å‡åº”è¯¥æ‰¾ç‚¹æ—¶é—´è€ƒè™‘è€ƒç ”è€ƒå“ªæ‰€å­¦æ ¡äº†ï¼Œè¦æœ‰ä¸€ä¸ªç›®æ ‡ï¼‰</p><p><strong>22æ—¥ï¼š</strong>NFCå¡çš„å…ƒä»¶éƒ½åˆ°äº†ï¼Œç„Šæ¥äº†ä¸€ä¸‹ï¼Œé£æªä»æ¿å­åº•ä¸‹åŠ çƒ­çš„ï¼Œç±»ä¼¼äºå›æµç„Šï¼Œé…ä¸Šè‡ªå·±ä¹°çš„é”¡è†å’Œæ´—æ¿æ°´ï¼Œç”¨çš„å¾ˆé¡ºæ‰‹ï¼Œå¾ˆæˆåŠŸï¼Œç¬¬ä¸€æ¬¡ç„Šæ¥è¿™ç§ç²¾å¯†çš„æ¿å­ï¼Œåšäº†å››å—ï¼Œè‡ªå·±ç•™äº†ä¸€å—ï¼Œå…¶ä½™é€äººäº†ï¼ŒæŒºå¥½çš„ã€‚ï¼ˆæ­£ç‚¹åŸå­çš„ç¤ºæ³¢å™¨DS100ä¹Ÿåˆ°äº†ï¼Œæ„Ÿè§‰å¾ˆå¥½ï¼Œä»Šåä¼šå¾ˆæ–¹ä¾¿çš„ï¼‰</p><p><a href="https://imgtu.com/i/RuhwB4"><img src="https://z3.ax1x.com/2021/06/23/RuhwB4.md.jpg" class="lazyload placeholder" data-srcset="https://z3.ax1x.com/2021/06/23/RuhwB4.md.jpg" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="RuhwB4.md.jpg"></a></p><p><strong>21æ—¥ï¼š</strong> ä¸Šè¯¾ï¼Œä¸Šè¯¾ï¼Œå‘å‘†ï¼Œå‘å‘†ã€‚ã€‚ã€‚</p><p><strong>20æ—¥ï¼š</strong>ç™½å¤©ä¸»è¦å¸®åŒå­¦åšæ•°ç”µè¯¾è®¾äº†ï¼ˆå¤ªæµªè´¹æ—¶é—´äº†ã€‚ã€‚ï¼‰ï¼Œä»Šå¤©çªå‘å¥‡æƒ³ï¼ŒæŠŠå¾ˆè€çš„ï¼ˆ2013å¹´çš„ï¼‰TI G2å£è¢‹å®éªŒæ¿å­èµ„æ–™ç¿»äº†ç¿»ï¼Œæ„Ÿè§‰è®¾è®¡çš„ä¸é”™ï¼Œæ­£å¥½ä¹Ÿå›é¡¾äº†ä¸‹å¯’å‡å­¦çš„MSP430ï¼Œæ¥ä¸‹æ¥ä¹Ÿå¯ä»¥å¸¦ç€å­¦ä¸‹å»ï¼Œå•ç‰‡æœºéƒ½æ˜¯é€šç”¨çš„ï¼Œæ¢æ±¤ä¸æ¢è¯ï¼Œè¿˜æ˜¯ä»¥ä¸€ä¸ªæ¿å­ä¸ºä¸»ï¼Œå­¦å†…åœ¨çš„æŠ€æœ¯ã€‚æ€»æ„Ÿè§‰ä¸èƒ½è¿™æ ·ä¸‹å»äº†ï¼Œå¾—è¦æœ‰äº›æ”¹å˜äº†ï¼Œå¯¹æœªæ¥åˆæœ‰ç‚¹å°è¿·èŒ«äº†ã€‚æ˜å¤©ä¸€å®šè¦å¼€å§‹å¤ä¹ ä¿¡å·ä¸ç³»ç»Ÿäº†ã€‚</p><p><strong>19æ—¥ï¼š</strong>æ•°ç”µè¯¾è®¾å®Œæˆäº†ï¼Œç™½å¤©ä¸»è¦å¸®åŒå­¦è§£å†³è¯¾è®¾çš„ä¸€äº›é—®é¢˜ï¼Œæ˜¨å¤©æ™šä¸Šè¾—è½¬åä¾§ï¼Œè¶ç€618ä¹°äº†æ­£ç‚¹åŸå­çš„è¿·ä½ ç¤ºæ³¢å™¨DS100ï¼ŒæŒºå¥½çš„ï¼Œä»¥åç”¨ç€ä¹Ÿæ–¹ä¾¿ï¼Œå°±æ˜¯è¿™ä¸ªæœˆå¾—åƒåœŸäº†ã€‚ã€‚ã€‚æ™šä¸Šæ²¡ä»€ä¹ˆäº‹å¹²ï¼Œçœ‹äº†ä¸€ä¸‹åˆ«äººç”¨32åˆ¶ä½œç¤ºæ³¢å™¨çš„å¼€æºæ–¹æ¡ˆï¼Œæ„Ÿè§‰éƒ½ä¸å¤ªå¥½ï¼Œç„¶åæ”¶æ‹¾äº†ä¸€ä¸‹å„ç§å…ƒä»¶ï¼Œç„¶åè¶ç€ç†„ç¯å‰æŠŠ51çš„ADè½¬æ¢å­¦å®Œäº†ï¼Œå®Œå–„äº†ä¹‹å‰çš„åšå®¢å†…å®¹ã€‚æ˜å¤©å¾—æŠŠä¿¡å·ä¸ç³»ç»Ÿå®éªŒå®Œå–„ä¸€ä¸‹äº†ï¼ˆæ˜å¤©æœ€åä¸€èŠ‚è¯¾äº†ï¼‰ï¼Œç„¶åå¼€å§‹ä¿¡å·ä¸ç³»ç»Ÿçš„å¤ä¹ äº†ã€‚ä¸‹ä¸‹å‘¨ä¸‰æœŸæœ«ï¼Œè¿˜ä»€ä¹ˆéƒ½ä¸å¤ªæ‡‚ã€‚ã€‚ã€‚</p><p><strong>18æ—¥ï¼š</strong>ä»Šå¤©æŠŠæ•°ç”µè¯¾è®¾åšå®Œäº†ï¼ˆæ•°å­—é¢‘ç‡è®¡ï¼‰ï¼Œæ˜å¤©å»ç­”è¾©ï¼Œæ¥ä¸‹æ¥ä¼šå­¦äº›æ–°çŸ¥è¯†ï¼Œé¡ºå¸¦ç€ç©ä¸€äº›å¼€æºé¡¹ç›®ï¼ˆä»Šå¤©618ï¼Œä¹°äº†ç‚¹ä¸œè¥¿ï¼‰</p><p><a href="https://imgtu.com/i/R9YVUA"><img src="https://z3.ax1x.com/2021/06/18/R9YVUA.md.png" class="lazyload placeholder" data-srcset="https://z3.ax1x.com/2021/06/18/R9YVUA.md.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="R9YVUA.md.png"></a></p><p><strong>15æ—¥ï¼š</strong>çœ‹åˆ°Bç«™æœ‰ä¸ªåšNFCå¡ç‰‡çš„ï¼ŒæŒºå¥½çœ‹çš„ï¼Œæ”¹äº†ä¸€ä¸‹ï¼Œå‘åˆ°å˜‰ç«‹åˆ›æ‰“æ ·äº†ï¼Œå…ƒä»¶ä¹Ÿä¹°äº†ç‚¹ï¼ˆå®é™…ç„Šç›˜åº”è¯¥æ˜¯é“¶è‰²çš„ï¼Œä¸çŸ¥é“å¥½ä¸å¥½çœ‹ï¼Œé‡‘è‰²çš„å¤ªè´µäº†ï¼‰</p><p><a href="https://imgtu.com/i/R9JUne"><img src="https://z3.ax1x.com/2021/06/18/R9JUne.md.png" class="lazyload placeholder" data-srcset="https://z3.ax1x.com/2021/06/18/R9JUne.md.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="R9JUne.md.png" style="zoom: 50%;" /></a><a href="https://imgtu.com/i/R9Js9P"><img src="https://z3.ax1x.com/2021/06/18/R9Js9P.md.png" class="lazyload placeholder" data-srcset="https://z3.ax1x.com/2021/06/18/R9Js9P.md.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="R9Js9P.md.png" style="zoom:50%;" /></a></p><p>2021.6.13ï¼šæ•°ç”µå¤ä¹ äº†ä¸€å‘¨ï¼Œè€ƒå®Œäº†ï¼Œå‡†å¤‡å¤ä¹ å‰©ä¸‹çš„å‡ é—¨è¯¾ã€‚è¿™å‡ å¤©æŠŠæ ‘è“æ´¾æ­å»ºæœåŠ¡å™¨çœ‹ä¸€ä¸‹ã€‚æ ‘è“æ´¾ä½¿ç”¨3.5å¯¸TFTå±å¹•ä¸HDMIäº¤äº’ä½¿ç”¨ï¼š<a href="https://www.jianshu.com/p/67f593706e15">æ ‘è“æ´¾å®‰è£…3.5å¯¸å±å¹•é©±åŠ¨</a> <a href="https://blog.csdn.net/Link2Points/article/details/113002383">æ ‘è“æ´¾4b3.5inchæ˜¾ç¤ºå±+è¿œç¨‹+FTP+å»ºç«™</a> ï¼ˆå±å¹•åˆ‡æ¢ä¹‹é—´é‡åˆ°ç‚¹å°é—®é¢˜ï¼ŒåŠ è£…å±å¹•åå½±å“æ•£çƒ­1.éœ€è¦å…ˆå¼€å¯rootæƒé™sudo passwd root &#x2F;&#x2F;è®¾ç½®rootå¯†ç su root&#x2F;&#x2F;åˆ‡åˆ°rootç”¨æˆ·ï¼Œè¾“å…¥å¯†ç 2.è¿›å…¥boot ï¼šcd bootï¼ˆ1ï¼šcd LCD-show&#x2F;   2ï¼š.&#x2F;LCD-hdmi    .&#x2F;LCD35-showï¼‰</p><p><a href="https://imgtu.com/i/27VTPJ"><img src="https://z3.ax1x.com/2021/06/14/27VTPJ.md.jpg" class="lazyload placeholder" data-srcset="https://z3.ax1x.com/2021/06/14/27VTPJ.md.jpg" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="27VTPJ.md.jpg" /></a></p><p><strong>5æ—¥ï¼š</strong>æ¿å­åˆ°äº†ï¼Œç„Šæ¥äº†ä¸€ä¸‹ï¼Œé”¡è†ä¸å¤ªå¥½ç”¨ï¼ŒèŠ¯ç‰‡å¿˜ä¾›ç”µäº†ï¼Œæœ€ç»ˆåˆ¶ä½œå‡ºæ¥ä¸€å¼ å®Œæ•´çš„æ¿å­</p><p><a href="https://imgtu.com/i/2I7kTJ"><img src="https://z3.ax1x.com/2021/06/13/2I7kTJ.md.jpg" class="lazyload placeholder" data-srcset="https://z3.ax1x.com/2021/06/13/2I7kTJ.md.jpg" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="2I7kTJ.md.jpg" /></a></p><p><strong>3æ—¥ï¼š</strong>è¯¾è®¾å¼„å®Œäº†ï¼Œå¾—å¥½å¥½å¤ä¹ äº†ã€‚</p><h3 id="5æœˆï¼š"><a href="#5æœˆï¼š" class="headerlink" title="5æœˆï¼š"></a>5æœˆï¼š</h3><p><strong>30æ—¥ï¼š</strong>ç”»äº†ä¸€ä¸ªusb2.0é›†çº¿å™¨PCBï¼Œç”¨å˜‰ç«‹åˆ›æ‰“æ¿äº†ï¼Œå…ƒä»¶ä¹Ÿä¹°äº†ã€‚</p><p><strong>29æ—¥ï¼š</strong>æ¥ä¸‹æ¥ä¸»è¦è¿˜æ˜¯å­¦ä¹ ï¼Œåˆå¿«è¦è€ƒè¯•äº†ã€‚å…¶æ¬¡å°±æ˜¯ä¸€äº›è¿˜æ²¡è·³çš„å‘ï¼š</p><ol><li><p>51å•ç‰‡æœºç»§ç»­å­¦ä¹ ï¼ˆç°åœ¨åˆ°ADéƒ¨åˆ†äº†ï¼‰ã€‚</p></li><li><p>é€šä¿¡è¯¾è®¾ç»§ç»­å®Œå–„ï¼Œå°½é‡æŠŠå°ç¨‹åºåšå‡ºæ¥ï¼Œé€šè¿‡ä¸€å¥—å®Œæ•´çš„å¼€å‘æµç¨‹å¢åŠ å¼€å‘ç»éªŒï¼ˆè¿˜æœ‰å°±æ˜¯å®¤å‹å’ŒåŒå­¦çš„è¯¾è®¾ï¼Œå¸¦ç€å®Œå–„ã€‚è¿˜æœ‰å°±æ˜¯ä»¥åè¦å­¦ä¼šæ‹’ç»åˆ«äººï¼Œä¸èƒ½ä»€ä¹ˆäº‹éƒ½æ½åˆ°è‡ªå·±èº«ä¸Šï¼‰ã€‚</p></li><li><p>è‡ªå·±åšä¸€ä¸ªUSBé›†çº¿å™¨ï¼Œä»ç”µè·¯PCBåˆ°å…ƒä»¶é‡‡ä¹°ï¼Œç„Šæ¥ï¼Œåˆ°åˆ¶ä½œå¤–å£³ï¼Œå­¦ä¼šä½¿ç”¨3Dæ‰“å°æœºï¼Œå­¦å‡ é¡¹æ–°æŠ€èƒ½ï¼Œé€šè¿‡é¡¹ç›®å……å®è‡ªå·±ã€‚</p></li><li><p>ä¹°äº†3å—å¢¨æ°´å±ï¼Œæœ‰æ—¶é—´ç ”ç©¶ç ”ç©¶æ˜¾ç¤ºéƒ¨åˆ†ï¼Œç„¶åå‡†å¤‡åˆ¶ä½œWIFIæ°”è±¡ç«™ï¼Œå°½é‡æƒ³Bç«™å¤§ä½¬åšå‡ºé‚£ç§å¸¦QQä¿¡æ¯æ˜¾ç¤ºçš„éƒ¨åˆ†ï¼Œåšå¥½åå°½é‡ä¹Ÿç”»ä¸ªå¤–å£³ï¼Œå°½é‡å†æš‘å‡ç»“æŸå‰åšå‡ºæ¥ã€‚</p></li><li><p>æƒ³è¶ç€618æ”¹æ”¹é”®ç›˜ï¼Œä¸»è¦æ¢é”®å¸½ï¼Œæ”¹é”®çº¿åˆ†ç¦»ï¼Œå¯ä»¥çš„è¯å‡†å¤‡å†åŠ ä¸ªç™½ç¯æˆ–è€…è“ç¯ã€‚</p></li><li><p>æ ‘è“æ´¾ï¼Œè¿‘æœŸè¿˜æ²¡æƒ³å¥½æ€ä¹ˆç©ï¼Œæƒ³æƒ³å§ã€‚</p></li><li><p>åšä¸€ä¸ªç®€æ˜“çš„å°ç”µæºï¼Œä»¥åç”¨ç€æ–¹ä¾¿ã€‚</p></li><li><p>å¯¹äº†ï¼Œå¯è§å…‰é€šä¿¡ï¼Œæœ‰æœºä¼šææã€‚</p><p>ä»¥ä¸Šéƒ½æ˜¯æƒ³åšçš„ï¼Œä½†æˆ‘è¿™ä¸ªæ€§æ ¼ä¼°è®¡èƒ½åšå‡ºæ¥ä¸€åŠå°±ä¸é”™äº†ï¼Œä»…ä¾›æé†’è‡ªå·±ä¸€ä¸‹å§ï¼Œé˜²æ­¢å¿˜è®°</p></li></ol><p>è¿‘æœŸï¼Œå°±è¿™æ ·ï¼Œè¿˜æœ‰çš„å°±æƒ³ä¸èµ·æ¥äº†ã€‚å¯¹äº†ï¼Œè¿˜æœ‰å°±æ˜¯è®¤çœŸå­¦ä¹ ï¼Œè®¤çœŸç”Ÿæ´»ã€‚</p><p><strong>28æ—¥ï¼š</strong>å»çœ‹ä¸€ä¸‹å“†å•¦Aæ¢¦ ä¼´æˆ‘åŒè¡Œ2</p><p><a href="https://imgtu.com/i/2iNnX9"><img src="https://z3.ax1x.com/2021/05/27/2iNnX9.md.jpg" class="lazyload placeholder" data-srcset="https://z3.ax1x.com/2021/05/27/2iNnX9.md.jpg" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="2iNnX9.md.jpg" style="zoom:200%;" /></a></p><p><strong>25~27æ—¥ï¼š</strong>ä¸»è¦æŠŠå…¥å…šé‚£äº›ææ–™å¼„äº†ä¸€ä¸‹</p><p><strong>23æ—¥ï¼š</strong>è€ƒå®Œç”µç£åœºäº†ï¼Œé¢˜ç›®è¿˜æ˜¯æŒºéš¾çš„ï¼Œä½†æ„Ÿè§‰è¿˜æ˜¯å¤ä¹ çš„ä¸åˆ°ä½ï¼Œæˆ‘è§‰å¾—æœ‰äº›é¢˜æ˜¯å¯ä»¥é€šè¿‡å¤ä¹ åšå‡ºæ¥çš„ï¼Œè¿˜æ˜¯è‡ªå·±æ²¡æœ‰å¹³è¡¡å¥½ç”µèµ›å’Œå­¦ä¹ ä¹‹é—´çš„å…³ç³»ï¼Œæ¡äº†èŠéº»ä¸¢äº†è¥¿ç“œï¼Œåˆ°æœ€åèŠéº»éƒ½å¯èƒ½ä¸¢äº†ï¼Œå¸Œæœ›ç”µç£åœºä¸è¦æŒ‚â€¦.ä»Šåè¦æŠŠå­¦ä¹ æ”¾åœ¨é¦–è¦åœ°ä½ï¼Œè¦å¹³è¡¡å¥½å­¦ä¹ ä¸çˆ±å¥½ä¹‹é—´çš„å…³ç³»ï¼Œè¿™æ¬¡ç®—æ˜¯ä¸€ä¸ªæ•™è®­å§ã€‚å…¶å®ä¹Ÿæƒ³äº†å¾ˆå¤šï¼Œæƒ³åˆ°äº†ä»¥åçš„äº‹ï¼Œå­¦ä¹ è¿˜æ˜¯ç‰¹åˆ«é‡è¦çš„ï¼Œè‡³å°‘åœ¨ç°é˜¶æ®µæ˜¯è¿™æ ·çš„ã€‚è€ƒå®Œç”µç£åœºå’Œå®¤å‹å‡ºå»åƒäº†ä¸€é¡¿ï¼Œå¥½å¥½æ”¾æ¾äº†ä¸€ä¸‹ï¼Œå–äº†ä¸¤ç“¶å•¤é…’ï¼Œæ„Ÿè§‰è¿˜è¡Œï¼Œå›å®¿èˆåï¼Œå¦å¤–ä¸¤ä¸ªå®¤å‹å¸¦äº†å…­ç“¶æ±Ÿå°ç™½ï¼Œåˆæ˜¯ä¸€é¡¿ï¼Œå–å®Œè¿˜ä¸å¤Ÿï¼Œä¸€äººåˆæ¥äº†åŠç“¶ç‰›æ å±±ï¼Œæˆ‘æ˜¯ä»æ¥æ²¡å–è¿‡é‚£ä¹ˆå¤šé…’å•Šï¼Œæ„Ÿè§‰è¿˜å°†å°±ï¼Œä¸€èˆ¬èˆ¬å§ï¼Œå°±æ˜¯ç¬¬äºŒå¤©è„‘è¢‹ç–¼ï¼Œä¸œåŒ—äººæ˜¯çœŸèƒ½å–å•Šï¼Œä¸‹æ¬¡æ³¨æ„ï¼Œä¸èƒ½å†è¿™æ ·å–ä¸‹å»äº†ã€‚</p><p><strong>10~21æ—¥ï¼š</strong>æ ¡ç”µèµ›</p><p><a href="https://imgtu.com/i/2itFRe"><img src="https://z3.ax1x.com/2021/05/27/2itFRe.md.jpg" class="lazyload placeholder" data-srcset="https://z3.ax1x.com/2021/05/27/2itFRe.md.jpg" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="2itFRe.md.jpg" style="zoom: 150%;" /></a></p><p>é€‰çš„Bé¢˜ï¼Œçœ‹ç€ç®€å•ï¼Œåšèµ·æ¥æ˜¯çœŸéš¾å•Šã€‚ã€‚ã€‚å…³é”®è¿˜åœ¨ç”µç£åœºè¦è€ƒè¯•æœŸé—´ï¼Œæå¾—æˆ‘éƒ½è¿ˆä¸å¼€æ­¥å­å»åšï¼Œåªèƒ½ç™½å¤©å¤ä¹ ï¼Œæ™šä¸Šåšï¼Œ</p><p><a href="https://imgtu.com/i/2it8Mj"><img src="https://z3.ax1x.com/2021/05/27/2it8Mj.md.jpg" class="lazyload placeholder" data-srcset="https://z3.ax1x.com/2021/05/27/2it8Mj.md.jpg" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="2it8Mj.md.jpg" style="zoom:150%;" /></a>å…¶å®ç™½å¤©è„‘å­é‡Œä¹Ÿåœ¨æƒ³ç€ç”µèµ›ï¼Œè®©æˆ‘å¾ˆéš¾å—ã€‚</p><p>â€‹è¿™æ¬¡ç”µèµ›çš„å¯è§å…‰é€šä¿¡æ˜¯éå¸¸å€¼å¾—ç ”ç©¶çš„ï¼Œæˆ‘è§‰å¾—å¾ˆæœ‰æ„ä¹‰ï¼Œçœ‹æ¥ä¸¤ç¯‡æ¯•è®¾è®ºæ–‡ï¼Œç†è®ºä¸Šå®ç°è¿˜æ˜¯æ¯”è¾ƒå®¹æ˜“çš„ï¼Œä½†ç°å®åšèµ·æ¥ä¸å¤ªå®¹æ˜“ï¼Œå’Œå…ƒä»¶ç‰¹æ€§å…³ç³»å¾ˆå¤§ï¼Œå°åŠŸç‡LEDä¸‹å¯ä»¥å®ç°æ¯”è¾ƒç¨³å®šä¸€ç‚¹çš„ä¿¡æ¯ä¼ è¾“ï¼Œä½†æ˜¯æ¢æˆè‡ªå·±åšçš„12Vå¤§åŠŸç‡é©±åŠ¨æ¿å°±ä¸å¤ªå¥½ç”¨äº†ï¼Œå¹²æ‰°å¾ˆå¤§ï¼Œä¸å…‰æ˜¯è‡ªç„¶å…‰å½±å“ï¼Œè¿˜å’Œé©±åŠ¨éƒ¨åˆ†çš„ç¨³å®šæ€§æœ‰å…³ï¼Œè¿™ä¸€éƒ¨åˆ†å¡äº†å››å¤©ï¼Œæœ€ç»ˆä¸å¾—ä¸æ”¾å¼ƒäº†ï¼Œç¦»è€ƒè¯•è¿˜å‰©ä¸¤å¤©äº†ï¼Œè¿˜æ²¡å¼€å§‹å¤ä¹ â€¦.</p><p>æ¨èä¸€ä¸‹åˆ«äººåšçš„å¯è§å…‰é€šä¿¡éƒ¨åˆ†ï¼Œåšçš„æŒºå¥½ï¼š<a href="https://blog.csdn.net/fengge2018/article/details/108301334?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522162212383916780271591917%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&request_id=162212383916780271591917&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~top_positive~default-1-108301334.first_rank_v2_pc_rank_v29&utm_term=%E5%8F%AF%E8%A7%81%E5%85%89%E9%80%9A%E4%BF%A1&spm=1018.2226.3001.4187">å¯è§å…‰é€šä¿¡</a></p><p>åç»­è¿˜ä¼šç»§ç»­ææçš„ã€‚ä»Šå¤©åˆšå‡ºç”µèµ›ç»“æœï¼Œä¼˜ç§€å¥–ï¼ˆæ²¡åŠæ³•ï¼Œè°å«æˆ‘ä¼˜ç§€å‘¢ã€‚æŠ¥é”€æ³¡æ±¤äº†ï¼Œå¾—è‡ªå·±è¿˜èŠ±å‘—äº†ã€‚ã€‚ã€‚ï¼‰</p><p>å¯¹äº†ï¼ŒHELLO,2021 TI.</p><p><strong>2~5æ—¥ï¼š</strong>å°†é€šä¿¡è¯¾è®¾ï¼ˆæ™ºèƒ½æ¸©å®¤å¤§æ£šï¼‰å®Œå–„äº†ä¸€ä¸‹ï¼Œå…·ä½“åŠŸèƒ½å·²å®ç°ï¼Œæš‚æ—¶æ²¡æœ‰åšç”¨æˆ·ç«¯ç•Œé¢ï¼ˆå‡†å¤‡ç”¨å¾®ä¿¡å°ç¨‹åºåšä¸€ä¸ªï¼‰ã€‚é‡‡ç”¨ä¸­å›½ç§»åŠ¨onenet-MQTTå¼€æºä»£ç +æ­£ç‚¹åŸå­ç›¸å…³ä¾‹ç¨‹ï¼Œç”¨çš„æ˜¯emqxå…è´¹çš„æœåŠ¡å™¨ï¼ˆæ™šä¸Šçš„æ—¶å€™ç‰¹åˆ«ä¸ç¨³å®šï¼Œè°ƒä¸å‡ºæ¥ï¼Œç™½å¤©ä¸€è°ƒå°±å¥½äº†ï¼Œè¯´åˆ°åº•è¿˜æ˜¯å…è´¹çš„ï¼‰</p><p><a href="https://imgtu.com/i/2iY4rn"><img src="https://z3.ax1x.com/2021/05/27/2iY4rn.md.jpg" class="lazyload placeholder" data-srcset="https://z3.ax1x.com/2021/05/27/2iY4rn.md.jpg" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="2iY4rn.md.jpg"  /></a></p><p>å¦å¤–å¸®å‡ ä¸ªåŒå­¦ä¹Ÿåšäº†4ä»½è¯¾è®¾ï¼Œ51ï¼Œ32ï¼Œarduino, esp01séƒ½æœ‰çš„ï¼Œä¸»è¦ç”¨åˆ°äº†ç‚¹ç¯ç§‘æŠ€çš„å¼€å‘æ–‡æ¡£ï¼ŒæŒºå¥½ç”¨çš„ï¼Œä¹Ÿæ˜¯å…è´¹çš„ï¼Œä¹Ÿå¯ä»¥è¿æ¥å°çˆ±åŒå­¦ã€‚51é‚£å—ä¸²å£é€šä¿¡å…·ä½“çœ‹äº†ä¸€ä¸‹ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">uart_init</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">TMOD=<span class="number">0x20</span>;<span class="comment">//å³0010 0000,å®šæ—¶å™¨/è®¡æ•°å™¨1,å·¥ä½œæ–¹å¼2</span></span><br><span class="line">TH1=<span class="number">0xfd</span>;<span class="comment">//è®¾ç½®æ³¢ç‰¹ç‡ä¸º9600</span></span><br><span class="line">TL1=<span class="number">0xfd</span>;</span><br><span class="line">TR1=<span class="number">1</span>;<span class="comment">//å¯åŠ¨å®šæ—¶å™¨/è®¡æ•°å™¨1</span></span><br><span class="line"></span><br><span class="line">SCON=<span class="number">0x50</span>; <span class="comment">//0101 0000.ä¸²å£å·¥ä½œæ–¹å¼1ï¼Œå…è®¸ä¸²è¡Œæ§åˆ¶</span></span><br><span class="line">PCON=<span class="number">0x00</span>;<span class="comment">//è®¾ç½®SMOD=0</span></span><br><span class="line">IE=<span class="number">0x90</span>; <span class="comment">//CPUå…è®¸ä¸­æ–­ï¼Œä¸²è¡Œå…è®¸ä¸­æ–­</span></span><br><span class="line"></span><br><span class="line">TI=<span class="number">1</span>;<span class="comment">//ç›´æ¥ä½¿ç”¨printfå¿…é¡»åŠ å…¥æ­¤å¥æ‰èƒ½å®ç°å‘é€</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>1æ—¥ï¼š</strong><img src="https://z3.ax1x.com/2021/05/27/2iJOBt.md.jpg" class="lazyload placeholder" data-srcset="https://z3.ax1x.com/2021/05/27/2iJOBt.md.jpg" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="2iJOBt.md.jpg"  /></p><h3 id="4æœˆï¼š-1"><a href="#4æœˆï¼š-1" class="headerlink" title="4æœˆï¼š"></a>4æœˆï¼š</h3><p><strong>21æ—¥ï¼š</strong>æœ€è¿‘çŠ¶æ€æœ‰ç‚¹ä¸å¤ªå¥½ï¼Œä¸Šè¯¾å¿ƒä¸åœ¨ç„‰ï¼Œæ„Ÿè§‰äººå˜æ‡’äº†ï¼Œä¸è¿‡ç°åœ¨è°ƒæ•´çš„è¿˜å¯ä»¥äº†ï¼Œè¦é™ä¸‹å¿ƒæ¥ï¼Œå¥½å¥½å­¦ä¹ äº†ï¼Œçªç„¶å‘ç°ï¼Œæˆ‘å‡ ä¹æ²¡æœ‰æŠŠå¹³æ—¶æ—¶é—´ç”¨åœ¨ä¸“ä¸šè¯¾å­¦ä¹ ä¸Šï¼Œä¸€ç›´æ··æ··æ²Œæ²Œçš„ï¼Œæœ€è¿‘ä¹Ÿæ²¡æœ‰ä»€ä¹ˆè¦åšçš„äº‹ï¼Œæ‰€ä»¥æ„Ÿè§‰å¾ˆâ€œé—²â€ï¼Œå…¶å®è¿˜æœ‰å¾ˆå¤šäº‹æ²¡åšã€‚å¾—å¥½å¥½å¤ä¹ ä¸“ä¸šè¯¾äº†ï¼Œç°åœ¨æœ‰çš„ä¸œè¥¿è¿˜ä¸€å¤´é›¾æ°´ï¼ˆä¸Šè¯¾æ—¶å¬ä¸€ç‚¹ï¼Œä¸‹è¯¾å°±æ‰”ä¸€è¾¹äº†ï¼‰ï¼Œä¸èƒ½å†åƒä»¥å‰ç­‰åˆ°æœŸæœ«å†å¤ä¹ äº†ã€‚è¿˜æœ‰å°±æ˜¯å…´è¶£çˆ±å¥½ï¼Œè¿‘æœŸå°±æ˜¯æŠŠé€šä¿¡è¯¾è®¾å¥½å¥½å¼„ä¸€ä¸‹ï¼ˆå¸¦ç€é˜Ÿå‹ä»å¤´å¼€å§‹ï¼Œè¿™æ ·ä¹Ÿèƒ½å¤šå­¦ä¸€ç‚¹ï¼‰ï¼Œé¡ºå¸¦ç€å­¦51ï¼ˆå­¦é•¿å»ºè®®çœ‹32ï¼ŒåæœŸè°ƒæ•´ä¸€ä¸‹ï¼‰ã€‚æ ‘è“æ´¾ä¹Ÿä¹°äº†ï¼Œåˆ°äº†ä¹‹åå°±å…ˆå½“ä¸€ä¸ªå°ç”µè„‘ç©ç©å§ï¼Œä»¥åæœ‰éœ€è¦å†è¿›ä¸€æ­¥å­¦ä¹ ï¼ˆæˆ‘è§‰å¾—ä»¥åä¸€å®šä¼šç”¨åˆ°çš„ï¼‰ï¼ˆæˆ‘æ€»æ˜¯å¯¹è‡ªå·±çš„ç›´è§‰å¼‚å¸¸çš„è‡ªä¿¡  &gt;&lt;    ã€‚ã€‚ã€‚ï¼‰é¢ã€‚ã€‚ã€‚è™½ç„¶æƒ³çš„å¾ˆå¤šï¼Œè¿˜æ˜¯å¾—è„šè¸å®åœ°å•Šã€‚è¿˜æœ‰å°±æ˜¯æˆ‘æ„Ÿè§‰å“ˆå°”æ»¨çš„æ˜¥å¤©ï¼ˆä¹Ÿè®¸æ˜¯å¤å¤©ï¼‰å·²ç»åˆ°äº†ï¼Œå‚æ™šçš„å¤•é˜³è¿˜æœ‰å–·æ°”å¼é£æœºçš„èˆªè¿¹çº¿çœŸçš„å¤ªç¾äº†ï¼Œåƒè¿‡é¥­å»æ•£æ­¥ä¸€å®šå¾ˆèˆ’æœï¼Œè™½ç„¶æ²¡å»è¿‡ã€‚ã€‚ã€‚ï¼ˆæˆ‘å¾—çœ‹çœ‹è¿™ä¸ªåšå®¢æ€ä¹ˆå‘è¡¨æƒ…ï¼Œè¦ä¸ä½“ç°ä¸äº†æˆ‘çš„å¿ƒæƒ…ã€‚ã€‚ã€‚åªèƒ½çœç•¥å·ä»£æ›¿äº†ï¼‰è¿‘æœŸçš„è¯ï¼Œå°±è¿™æ ·ï¼ŒæŒºå¥½â€¦</p><p>PS: ä¸€é¦–å¥½å¬çš„æ­Œï¼š<a href="http://music.163.com/song?id=29375057&userid=2045942784">http://music.163.com/song?id=29375057&amp;userid=2045942784</a></p><img src="https://z3.ax1x.com/2021/04/09/cUYMjS.md.jpg" class="lazyload placeholder" data-srcset="https://z3.ax1x.com/2021/04/09/cUYMjS.md.jpg" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="cUYMjS.md.jpg" style="zoom: 200%;" /><h1 id="ç«™ç‚¹æ—¥å¿—"><a href="#ç«™ç‚¹æ—¥å¿—" class="headerlink" title="ç«™ç‚¹æ—¥å¿—"></a>ç«™ç‚¹æ—¥å¿—</h1><p>2024.7.19ï¼šé‡å»ºåšå®¢ï¼›</p><p>2021.8.25ï¼šæ›¿æ¢äº†æ‰€æœ‰æ–‡ç« çš„å°é¢å›¾ç‰‡ï¼Œæ›´æœ‰è¯†åˆ«æ€§ã€‚</p><p>2021.8.3ï¼šåšå®¢æ•´ä½“å¼„å®Œäº†ï¼Œæ¥ä¸‹æ¥å°±æ˜¯ä¼˜åŒ–é€Ÿåº¦å’Œä¸“æ³¨å­¦ä¹ å†™åšå®¢äº†ã€‚æŠ˜è…¾äº†å‡ å¤©å‘ç°æˆ‘å¯¹åšå®¢è¿™ä¸œè¥¿æœ‰äº†æ›´æ·±å…¥çš„è®¤è¯†ï¼Œè‡ªå·±è¿˜ä¸å¤ªå¥½è¯´ï¼Œæ¥è‡ªé»‘çŸ³åšå®¢çš„ä¸€ä½åšå‹è¯´ï¼šâ€œWordpress,hexoéƒ½æ˜¯å¾ˆä¸é”™çš„åšå®¢ç³»ç»Ÿï¼Œæˆ‘è§‰å¾—è™½ç„¶ç°åœ¨çŸ­è§†é¢‘éå¸¸æµè¡Œï¼Œä½†æ˜¯è¦æƒ³æŠŠå­¦åˆ°çš„çŸ¥è¯†å’ŒæŠ€èƒ½å½¢æˆè‡ªå·±çœŸæ­£çš„èƒ½åŠ›ï¼Œå‡å°‘ç¢ç‰‡åŒ–ä¿¡æ¯å¯¹å¤§è„‘çš„åˆºæ¿€ï¼Œå°±å¿…é¡»åœ¨ä¸€ä¸ªç›¸å¯¹å®‰é™çš„ç¯å¢ƒä¸­å­¦ä¹ ã€‚è€Œåšå®¢è¿™æ ·çš„å¹³å°å¯ä»¥å¾ˆå¥½çš„è®°å½•è‡ªå·±çš„æ‰€æ€æ‰€æƒ³ï¼Œä¹Ÿèƒ½å¤Ÿå½¢æˆç³»ç»Ÿçš„çŸ¥è¯†ä½“ç³»ã€‚åŒæ—¶ï¼Œå†™åšå®¢ä¹Ÿæ˜¯ä¸æ–­åŠ æ·±è‡ªå·±å¯¹çŸ¥è¯†ç†è§£çš„ç¨‹åº¦ï¼Œæœ‰å¥è¯è¯´çš„å¥½ï¼šâ€œå¦‚æœä½ åœ¨å­¦ä¹ ä¸€é¡¹æ–°çŸ¥è¯†æˆ–æ–°æŠ€èƒ½çš„åŒæ—¶è€ƒè™‘å¦‚ä½•å°†å…¶æ•™ç»™ä»–äººï¼Œä½ å¸æ”¶å†…åŒ–çŸ¥è¯†çš„é€Ÿåº¦å°†æ¯”ä½ ä»…ä»…ä½œä¸ºä¸€ä¸ªå­¦ä¹ è€…è¦å¿«å¾—å¤šã€‚å¿«é€ŸæŒæ¡æ–°çŸ¥è¯†ã€æ–°æŠ€èƒ½çš„æ–¹æ³•ä¹‹ä¸€å°±æ˜¯å­¦å®Œä»¥åç«‹åˆ»ä¸ä»–äººåˆ†äº«ã€‚â€ä»è¿™ä¸ªæ„ä¹‰è®²ï¼Œå­¦ä¹ â€”â€”&gt;åˆ†äº«â€”â€”&gt;åé¦ˆâ€”â€”&gt;å†å­¦ä¹ â€”â€”&gt;å†åˆ†äº«â€”â€”&gt;å†åé¦ˆè¿™æ ·ä¸€ç§å­¦ä¹ æ¨¡å¼ï¼Œåœ¨åšå®¢è¿™é‡Œå°±å¯ä»¥å¾ˆå¥½çš„ä½“ç°ï¼Œæˆ‘è§‰å¾—è¿™ä¹Ÿæ˜¯åšå®¢çš„ä»·å€¼æ‰€åœ¨ã€‚è®¸å¤šæœ‰ä»·å€¼çš„é—®é¢˜å’Œå›ç­”éƒ½æ˜¯é€šè¿‡åšå®¢è¿›è¡Œäº†è¯¦ç»†è€Œæ¸…æ¥šçš„è¯´æ˜ï¼Œæ‰€ä»¥è·å–é—®é¢˜ç­”æ¡ˆæœ€å¿«æœ€æœ‰æ•ˆçš„åŠæ³•å°±æ˜¯çœ‹åšå®¢ã€‚<br>çœ‹äº†ç½‘ç«™ä¸»äººçš„åšå®¢ï¼Œæ„Ÿè§¦é¢‡æ·±ï¼Œç»“åˆè‡ªå·±ä¹Ÿåœ¨è‡ªå­¦è¿™æ–¹é¢çš„çŸ¥è¯†ï¼Œå‘è¡¨ä¸‹å¯¹åšå®¢çš„ä¸€äº›çœ‹æ³•ã€‚ç›¸äº’å­¦ä¹ ï¼Œå…±åŒè¿›æ­¥ï¼â€æˆ‘è§‰å¾—å°±æ˜¯è¿™ä¸ªæ„æ€ï¼Œæ¥ä¸‹æ¥æ›´æ·±å…¥çš„æŠ•å…¥å­¦ä¹ å§ã€‚</p><p> 2021.7.29ï¼šæ•´ä½“ç¿»æ–°åšå®¢ï¼Œé‡‡ç”¨materyä¸»é¢˜ã€‚</p><p>2021.4.11:æ–°å¢å¹¶å®Œå–„çœ‹æ¿å¨˜åŠŸèƒ½ï¼ˆçœ‹æ¿å¨˜é¦–æ¬¡ç™»å½•ä¸ºé»˜è®¤ï¼Œå¯è‡ªè¡Œåˆ‡æ¢ä¸åŒäººç‰©ï¼Œä¸‹æ¬¡æ‰“å¼€å³ä¸ºæœ€åä¸€æ¬¡åˆ‡æ¢çš„äººç‰©ï¼‰ã€‚</p><p>2021.5.25ï¼šæ–°å¢é¼ æ ‡ç‚¹å‡»ç‰¹æ•ˆï¼ˆé¢å¤–é…ç½®æ—¶å¯¼è‡´æ–‡ä»¶æœªå¤‡ä»½ï¼Œä¸­é—´å‡ºäº†ä¸€ç‚¹å°å·®é”™ï¼Œå¯¼è‡´ç½‘é¡µæ‰“å¼€é€Ÿåº¦æ…¢äº†ä¸€äº›ï¼‰ã€‚</p><p>2021.5.27ï¼šå°è¯•åŠ å¿«ç½‘é¡µè®¿é—®é€Ÿåº¦ï¼ˆä½¿ç”¨hexo-all-minifierï¼Œå‹ç¼©ï¼‰ã€‚</p><p>2021.5.29ï¼šé…ç½®Markdownè¯­æ³•å…¬å¼å—ä¸Hexoå…¼å®¹ã€‚<a href="https://www.dazhuanlan.com/2020/06/09/5edf70eb9e803/">https://www.dazhuanlan.com/2020/06/09/5edf70eb9e803/</a></p><p>2021.5.31ï¼šæ ¹æ®æ—¥æœŸtopå€¼è®¾å®šç½®é¡¶æ—¥å¿—ï¼Œæ·»åŠ å·¦ä¾§Musicåšå®¢ä¸»é¢˜éŸ³ä¹ã€‚</p><p>2021.6.3:å‘å¸ƒä¸€ç¯‡æ–°åšå®¢2021.6.3ã€‚</p>]]></content>
      
      
      
        <tags>
            
            <tag> ç”Ÿæ´» </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
